import{B as G,z as J,p as ae,m as se,_ as K,l as X,F as oe,i as ne,j as ie,f as Z,N as $,E as v,G as T,H as S,o as d,c as L,w as k,d as n,I as c,k as Y,s as a,h as O,t as f,J as C,K as V,e as re,a as y,L as de,M as ce,n as z,q as U,S as ue,C as me,D as he}from"./index-0ed59e7e.js";import{T as fe}from"./Table-4d530e6b.js";import{_ as ve}from"./FormField-ad06fe60.js";import{_ as ge}from"./FormCheckRadioPicker-e50afe8e.js";import{D as ke}from"./Cow-df9083fe.js";import{M as j}from"./milking-4c27a3b6.js";import{T as W}from"./alert-4a0087f9.js";import{u as _e,_ as pe}from"./Top-c9492917.js";import"./cow-14c247ee.js";const ye={data(){return{milk:{date:new Date,time:"M"},milkDetail:{cow:null,qty:null,amount:null},milkDetails:[],loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{calAmount(){return this.milkDetail.amount=this.milkDetail.qty*100,this.milkDetail.amount},user(){return this.$store.state.auth.user},value:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}}},watch:{data:{handler(t,l){t!=null&&(this.mode=="edit"&&(this.milkDetails=t.milkDetails),this.milk.date=new Date(t.date?t.date:new Date),this.milk.time=t.time?t.time:"M",this.milk._id=t._id)},deep:!0}},methods:{clear(){var t;this.mode==="edit"&&this.$emit("update:data",null),this.milk.date=new Date,this.milk.time="M",this.milkDetails=[],this.$emit("update:mode",""),(t=this.milk)==null||delete t._id},confirmCancel(t){this.value=!1,this.$emit(t)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},removeDetail(t){let l=this.milkDetails.indexOf(t);l!==-1&&this.milkDetails.splice(l,1)},add(){this.milkDetail.cow&&this.milkDetail.qty>0&&this.milkDetail.amount?this.milkDetails.filter(l=>{var u;return l.cow.code===((u=this.milkDetail)==null?void 0:u.cow.code)}).length<=0?(this.milkDetails.push(this.milkDetail),this.alert="",this.milkDetail={}):this.alert="โคซ้ำ":this.alert="กรุณากรอกข้อมูลให้ครบ"},async submit(){this.loading=!0,this.alert="",this.milk.milkDetails=this.milkDetails;try{this.mode==="create"?await j.create(this.milk)&&(this.loading=!1,this.value=!1,this.confirm(),W.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})):await j.update(this.milk._id,this.milk)&&(this.loading=!1,this.value=!1,this.confirm(),W.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"}))}catch(t){console.error("Error : ",t),this.loading=!1,this.alert=t.response.data.message}},formatDate(t){return J(t).format("DD/MM/YYYY")}},components:{BaseButton:ae,BaseButtons:se,CardBox:K,BaseDivider:X,OverlayLayer:oe,FormField:ve,FormControl:ne,NotificationBar:ie,BaseLevel:Z,DDLCow:ke,FormCheckRadioPicker:ge,BaseIcon:$},props:{modelValue:{type:[String,Number,Boolean],default:null},mode:{type:String,default:""},data:{type:Object,default:null}}},we={key:0,class:"grid grid-cols-2 gap-3 mt-1"},xe={class:"grid grid-cols-2 lg:grid-cols-4 gap-5"},be=a("header",{class:"flex items-stretch border-b border-gray-100 dark:border-gray-800"},[a("p",{class:"flex items-center py-3 grow font-bold"}," รายการรีดนม ")],-1),De={key:3,class:"overflow-x-auto"},Ce=a("thead",null,[a("tr",null,[a("th",{class:"whitespace-nowrap text-center"}," โค "),a("th",{class:"whitespace-nowrap text-center"}," น้ำนมดิบ/กก. "),a("th",{class:"whitespace-nowrap text-center"}," จำนวนเงิน "),a("th")])],-1),Me={"data-label":"โค"},Be={"data-label":"น้ำนมดิบ/กก.",class:"text-center"},Ve={"data-label":"จำนวนเงิน",class:"text-right"},Te={class:"lg:w-6 whitespace-nowrap"},Se={key:4,class:"text-center py-10 text-gray-500 dark:text-gray-400"},Ye=a("p",null,"ไม่มีรายการ...",-1),Ee=[Ye];function Fe(t,l,u,p,s,i){const w=v("FormControl"),_=v("FormField"),E=v("FormCheckRadioPicker"),M=v("BaseDivider"),B=v("DDLCow"),x=v("BaseButton"),b=v("BaseButtons"),N=v("NotificationBar"),Q=v("CardBox"),I=v("OverlayLayer");return T((d(),L(I,null,{default:k(()=>[T(n(Q,{title:u.mode==="create"?"การรีดนม":"การรีดนม ("+((s.milk.time=="M"?"เช้า":"บ่าย")+" - "+i.formatDate(s.milk.date))+")",class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"","has-scroll":"",onSubmit:re(i.submit,["prevent"]),onHeaderIconClick:i.cancel},{default:k(()=>[u.mode!="edit"?(d(),c("div",we,[n(_,{label:"วันที่รีดนม",help:"* ห้ามว่าง"},{default:k(()=>[n(w,{modelValue:s.milk.date,"onUpdate:modelValue":l[0]||(l[0]=h=>s.milk.date=h),icon:"calendar",type:"date",required:"",disabled:u.mode=="edit"},null,8,["modelValue","disabled"])]),_:1}),n(_,{label:"รอบ"},{default:k(()=>[n(E,{modelValue:s.milk.time,"onUpdate:modelValue":l[1]||(l[1]=h=>s.milk.time=h),type:"radio",options:{M:"เช้า",A:"บ่าย"},disabled:u.mode=="edit"},null,8,["modelValue","disabled"])]),_:1})])):Y("",!0),u.mode!="edit"?(d(),L(M,{key:1})):Y("",!0),a("div",xe,[n(_,{label:"โค",help:"* ห้ามว่าง"},{default:k(()=>[n(B,{modelValue:s.milkDetail.cow,"onUpdate:modelValue":l[2]||(l[2]=h=>s.milkDetail.cow=h),valueType:"object"},null,8,["modelValue"])]),_:1}),n(_,{label:"น้ำนมดิบ/กก.",help:"* ห้ามว่าง"},{default:k(()=>[n(w,{modelValue:s.milkDetail.qty,"onUpdate:modelValue":l[3]||(l[3]=h=>s.milkDetail.qty=h),type:"number",icon:"scale"},null,8,["modelValue"])]),_:1}),n(_,{label:"จำนวนเงินรวม",help:"ราคาน้ำนมดิบ/กก. 100 บาท"},{default:k(()=>[n(w,{modelValue:i.calAmount,"onUpdate:modelValue":l[4]||(l[4]=h=>i.calAmount=h),type:"number",icon:"cashMultiple"},null,8,["modelValue"])]),_:1}),n(b,{type:"justify-start"},{default:k(()=>[n(x,{label:"เพิ่ม",color:"info",onClick:l[5]||(l[5]=h=>i.add())})]),_:1})]),s.alert?(d(),L(N,{key:2,color:"danger",outline:"",icon:"alertCircleOutline"},{default:k(()=>[O(f(s.alert),1)]),_:1})):Y("",!0),be,s.milkDetails.length>0?(d(),c("div",De,[a("table",null,[Ce,a("tbody",null,[(d(!0),c(C,null,V(s.milkDetails,h=>(d(),c("tr",{key:h.cow._id},[a("td",Me,f(h.cow.code)+" : "+f(h.cow.name),1),a("td",Be,f(h.qty),1),a("td",Ve,f(h.amount),1),a("td",Te,[n(b,{type:"justify-end lg:justify-start","no-wrap":""},{default:k(()=>[n(x,{color:"danger",icon:"trashCanOutline",small:"",onClick:q=>i.removeDetail(h)},null,8,["onClick"])]),_:2},1024)])]))),128))])])])):(d(),c("div",Se,Ee)),n(b,{type:"justify-center mt-3"},{default:k(()=>[n(x,{label:"บันทึก",color:"success",type:"submit",loading:s.loading},null,8,["loading"]),n(x,{label:"ยกเลิก",color:"danger",onClick:i.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[S,i.value]])]),_:1},512)),[[S,i.value]])}const ee=G(ye,[["render",Fe]]),$e={ref:"calendarContainer",class:"min-h-full min-w-full text-gray-300"},Oe={class:"w-full grid grid-cols-7"},Le=["onClick"],Qe=a("div",{class:"w-1/12"},[a("div",{class:"h-2 w-2 rounded-full bg-orange-600"})],-1),qe={class:"w-11/12"},Ae={class:"text-xs tracking-tight text-clip overflow-hidden"},Ne=["onClick"],Ie={class:"w-1/12 mr-1"},Ue={class:"w-11/12"},je={class:"text-xs tracking-tight text-clip text-left overflow-hidden"},Pe=["onClick"],ze={class:"h-6 w-6 flex justify-center items-center text-xs bg-orange-600 rounded-full shadow-sm"},Re={class:"font-medium text-white"},He={class:"mt-2"},We=["onClick"],Ge={class:"text-sm text-clip overflow-hidden items-center"},Je=["onClick"],Ke={class:"opacity-40"},Xe=a("p",{class:"hidden md:block"},"รีดนม",-1),Ze=["onClick"],et={class:"h-6 w-6 flex justify-center items-center text-xs bg-orange-600 rounded-full shadow-sm"},tt={class:"font-medium text-white"},lt={key:0,class:"md:hidden"},at=["onClick"],st={class:"text-sm text-clip overflow-hidden"},ot={__name:"Calendar",props:{events:{type:Object,required:!0}},setup(t){const l=_e();l.$subscribe((m,o)=>{N(),Q()});const u={1:"อา",2:"จ.",3:"อ.",4:"พ.",5:"พฤ",6:"ศ.",7:"ส."},p=y(0),s=y(0),i=y(0),w=y(0),_=y(!1),E=y(!1),M=y([]),B=y(""),x=y("create"),b=y({}),N=()=>{p.value=new Date(l.getYear,l.getMonth+1,0).getDate()},Q=()=>{i.value=new Date(l.getYear,l.getMonth,1).getDay()},I=()=>{s.value=new Date(l.getYear,l.getMonth,0).getDate()},h=()=>{let m=i.value<=5?35:42;w.value=m-p.value-i.value},q=m=>{let o=new Date;return l.getYear==o.getFullYear()&&l.getMonth==o.getMonth()&&m==o.getDate()},R=(m,o,e,r,g)=>l.getYear==o.substring(4,8)&&l.getMonth+(e?0:1)==o.substring(2,4)&&m==o.substring(0,2)&&r==g,te=(m,o,e)=>l.getYear==o.substring(4,8)&&l.getMonth+(e?0:1)==o.substring(2,4)&&m==o.substring(0,2),F=(m,o,e)=>{if(!o.length)return[];let r=[];return o.forEach(g=>{R(m,g.date,e)&&r.push(g)}),r},D=(m,o,e,r)=>{if(!o.length)return[];let g=[];return o.forEach(P=>{R(m,P.date,e,P.time,r)&&(g=P.milks)}),g},H=(m,o,e)=>{if(!o.length)return 0;let r=0;return o.forEach(g=>{te(m,g.date,e)&&(r+=g.sumQty)}),r},A=(m,o,e,r)=>{x.value=e?"edit":"create";let g=l.getYear+"-"+(l.getMonth+1)+"-"+m;b.value={_id:r,date:g,time:e,milkDetails:o},_.value=!0},le=(m,o)=>{const e=F(m,o);M.value=e,B.value=m,E.value=!0};return de(()=>{N(),Q(),I(),h()}),ce(()=>{Q(),I(),h()}),(m,o)=>(d(),c(C,null,[a("div",$e,[a("div",Oe,[n(pe),(d(),c(C,null,V(u,e=>a("div",{key:e,class:"text-center text-sm md:text-base lg:text- font-medium border-b mt-3 border-gray-600"},f(e),1)),64)),(d(!0),c(C,null,V(i.value,e=>T((d(),c("div",{key:e,class:"h-16 md:h-36 w-full opacity-50 border-t border-gray-600 align-top"},[a("div",{class:z(["w-full h-full text-xs md:text-sm lg:text-base text-center transition-colors p-3",{"bg-slate-300 text-gray-900 font-medium  ":q(e),"hover:bg-gray-100 hover:text-gray-700":!q(e)}])},[O(f(s.value-(i.value-e))+" ",1),(d(!0),c(C,null,V(F(s.value-(i.value-e),t.events,!0),r=>T((d(),c("div",{key:r.title,class:"hidden md:block"},[a("div",{class:"w-full px-2 py-1 flex space-x-1 items-center whitespace-nowrap overflow-hidden hover:border hover:border-gray-200 cursor-pointer rounded-lg",onClick:g=>m.togglePopover(g,r)},[Qe,a("div",qe,[a("h5",Ae,f(r.title),1)])],8,Le)])),[[S,F(s.value-(i.value-e),t.events,!0).length]])),128)),D(s.value-(i.value-e),t.events,!0).length>3?(d(),c("div",{key:0,class:"hidden md:flex mt-2 w-full px-2 py-1 space-x-2 items-center whitespace-nowrap overflow-hidden hover:text-gray-800 hover:font-medium cursor-pointer rounded-sm",onClick:r=>A(s.value-(i.value-e),D(s.value-(i.value-e),t.events,!0))},[a("div",Ie,[n($,{path:"plus"})]),a("div",Ue,[a("h6",je,f(" มีอีก "+(D(s.value-(i.value-e),t.events,!0).length-3)+" รายการ"),1)])],8,Ne)):Y("",!0),D(s.value-(i.value-e),t.events,!0).length>0?(d(),c("div",{key:1,class:"flex md:hidden h-2/3 w-full justify-center items-center",onClick:r=>A(s.value-(i.value-e),D(s.value-(i.value-e),t.events,!0))},[a("div",ze,[a("h3",Re,f(D(s.value-(i.value-e),t.events,!0).length),1)])],8,Pe)):Y("",!0)],2)])),[[S,i.value>0]])),128)),(d(!0),c(C,null,V(p.value,e=>(d(),c("div",{key:e,class:"h-16 md:h-36 w-full border-t border-gray-600 align-top"},[a("div",{class:z(["w-full h-full text-xs md:text-sm lg:text-base text-center transition-colors p-2",{"bg-gray-600 text-gray-900 font-medium  ":q(e),"hover:bg-gray-100 hover:text-gray-700":!q(e)}])},[O(f(e)+" ",1),a("div",He,[(d(!0),c(C,null,V(F(e,t.events),r=>T((d(),c("div",{key:r.date,class:"hidden md:block p-1"},[a("div",{class:"w-full flex p-1 shadow-lg border border-gray-800 shadow cursor-pointer rounded-md",onClick:g=>A(e,D(e,t.events,!1,r.time),r.time,r.id)},[a("p",Ge,[n($,{path:r.time==="M"?"clockTimeSevenOutline":"clockTimeThreeOutline",class:z(r.time==="M"?"text-yellow-400":"text-orange-500")},null,8,["path","class"]),O(" "+f(r.time=="M"?"เช้า":"บ่าย")+" - "+f(r.sumQty)+" กก. ",1)])],8,We)])),[[S,F(e,t.events).length>0]])),128))]),T(a("div",null,[a("div",{class:"w-full mt-2 text-center items-center overflow-hidden hover:border hover:border-gray-200 cursor-pointer rounded-lg",onClick:r=>A(e,D(e,t.events))},[a("div",Ke,[n($,{path:"plus"}),O(),Xe])],8,Je)],512),[[S,F(e,t.events).length===0]]),H(e,t.events)>0?(d(),c("div",{key:0,class:"flex md:hidden h-2/3 w-full justify-center items-center",onClick:r=>le(e,t.events)},[a("div",et,[a("h3",tt,f(H(e,t.events)),1)])],8,Ze)):Y("",!0)],2)]))),128)),(d(!0),c(C,null,V(w.value,e=>T((d(),c("div",{key:e,class:"h-16 md:h-36 w-full opacity-50"})),[[S,w.value>0]])),128))]),n(Z,{type:"justify-between w-full mt-2",class:"md:hidden"},{default:k(()=>[n($,{path:"chevronLeft",size:"30",class:"cursor-pointer hover:text-gray-300",onClick:o[0]||(o[0]=e=>U(l).decrementMonth(1))}),n($,{path:"chevronRight",size:"30",class:"cursor-pointer hover:text-gray-300",onClick:o[1]||(o[1]=e=>U(l).incrementMonth(1))})]),_:1}),n(X),E.value?(d(),c("div",lt,[O(" รายการรีดนม "+f(B.value)+"/"+f(U(l).getMonth+1)+"/"+f(U(l).getYear+543)+" ",1),(d(!0),c(C,null,V(M.value,e=>T((d(),c("div",{key:e.date},[a("div",{class:"w-full text-left flex overflow-hidden p-2 mt-2 border border-gray-800 shadow cursor-pointer rounded-md",onClick:r=>A(B.value,D(B.value,t.events,!1,e.time),e.time,e.id)},[a("p",st," รอบ "+f(e.time=="M"?"เช้า":"บ่าย")+" น้ำนมดิบ "+f(e.sumQty)+" กก. รีดแล้ว "+f(e.count)+" ตัว ",1)],8,at)])),[[S,M.value.length>0]])),128))])):Y("",!0)],512),n(ee,{modelValue:_.value,"onUpdate:modelValue":o[2]||(o[2]=e=>_.value=e),mode:x.value,data:b.value,onConfirm:m.getMilks},null,8,["modelValue","mode","data","onConfirm"])],64))}},nt={data(){return{modalMilk:!1,items:[],events:[],forms:[{label:"โค",class:"lg:col-start-2",value:"cow",type:"ddl",module:"cow"},{label:"วันที่รีดนม",value:"date",icon:"calendar",type:"date"}],search:{cow:null,date:null},loading:!1,mode:"create",dataEdit:null,checked:{code:{value:"date",type:"date"},label:{value:"cow.name"}},datas:[{label:"วันที่รีดนม",class:"text-center",type:"date",value:"date"},{label:"โค",class:"text-center",value:"relate.cow.name"},{label:"ปริมาณน้ำนมดิบ/เช้า (กก.)",class:"text-center",value:"morningQty"},{label:"ปริมาณน้ำนมดิบ/บ่าย (กก.)",class:"text-center",value:"afternoonQty"},{label:"ปริมาณน้ำนมดิบรวม (กก.)",class:"text-center",func:t=>t.morningQty+t.afternoonQty},{label:"จำนวนเงินรวม",class:"text-right",type:"number",value:"amount"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},components:{SectionMain:ue,LayoutAuthenticated:me,Table:fe,SectionTitleBarSub:he,MilkModal:ee,Calendar:ot,CardBox:K},computed:{user(){return this.$store.state.auth.user}},created(){this.getMilks()},methods:{async getMilks(){this.loading=!0;const t=await j.all(this.search);if(this.events=[],t.data)for(let l of t.data.milks){let u={};u.sumQty=0,u.sumAmt=0,l.details.forEach(p=>{p.cow=p.relate.cow,u.sumQty+=p.qty,u.sumAmt+=p.amount}),u.count=l.details.length,u.milks=l.details,u.date=J(l.date,"YYYY-MM-DD").format("DDMMYYYY"),u.time=l.time,u.id=l._id,this.events.push(u)}this.loading=!1},async removeMilk(t){this.loading=!0,(await j.delete(t)).data&&this.getMilks(),this.loading=!1},edit(t){this.dataEdit=t,this.mode="edit",this.modalMilk=!0},reset(){this.search.cow=null,this.search.date=new Date}}};function it(t,l,u,p,s,i){const w=v("SectionTitleBarSub"),_=v("MilkModal"),E=v("Calendar"),M=v("CardBox"),B=v("SectionMain"),x=v("LayoutAuthenticated");return d(),L(x,null,{default:k(()=>[n(B,null,{default:k(()=>[n(w,{icon:"cupWater",title:"การรีดนม",btnText:"เพิ่มการรีดนม","has-btn-add":"",onOpenModal:l[0]||(l[0]=b=>{s.mode="create",s.modalMilk=!0})}),n(_,{modelValue:s.modalMilk,"onUpdate:modelValue":l[1]||(l[1]=b=>s.modalMilk=b),mode:s.mode,dataEdit:s.dataEdit,onConfirm:i.getMilks},null,8,["modelValue","mode","dataEdit","onConfirm"]),s.loading?(d(),L(M,{key:1,loading:""})):(d(),L(M,{key:0},{default:k(()=>[n(E,{events:s.events},null,8,["events"])]),_:1}))]),_:1})]),_:1})}const kt=G(nt,[["render",it]]);export{kt as default};

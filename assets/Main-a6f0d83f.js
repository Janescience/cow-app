import{z as S,C as L,D as M,E as T,T as j,f as V,g as w,_ as A,O as H,Q as N,B as O,c as B,w as g,F as o,o as i,d,J as l,K as Y,L as $,s as e,t as u,h as C,k as b}from"./index-6eeb5704.js";import{C as I}from"./Criteria-5ffb25b3.js";import{P as U}from"./protection-19be3844.js";import"./alert-c5bf701a.js";import"./CardBoxCollapse-cf37be3b.js";import"./FormField-9e78af55.js";import"./Cow-e22a5815.js";import"./cow-3811bb4b.js";import"./Recipe-358f2bd3.js";import"./Vaccine-4b76e702.js";const z={data(){return{perPage:12,currentPage:0,items:[],forms:[{label:"วัคซีน",value:"vaccine",icon:"needle",type:"ddl",module:"vaccine",valueType:"_id"}],search:{vaccine:null},loading:!1}},components:{SectionMain:L,LayoutAuthenticated:M,SectionTitleBarSub:T,Table:j,Criteria:I,BaseLevel:V,UserAvatar:w,CardBox:A,BaseIcon:H},computed:{itemsPaginated(){return this.items?this.items.slice(this.perPage*this.currentPage,this.perPage*(this.currentPage+1)):[]},numPages(){return Math.ceil((this.items?this.items.length:0)/this.perPage)},currentPageHuman(){return this.currentPage+1},pagesList(){const t=[];for(let n=0;n<this.numPages;n++)t.push(n);return t}},created(){this.getDatas()},methods:{async getDatas(t){this.loading=!0;const n=await U.all(t);if(this.items=[],n.data){const y=n.data.protections,p=N.groupBy(y,"vaccine._id"),r=new Date().setUTCHours(0,0,0,0);for(let s of Object.keys(p)){const c=p[s];let _=null,m=0;for(let h of c){const f=new Date(h.date).setUTCHours(0,0,0,0);r>=f&&(_+=h.amount,m++)}this.items.push({vaccine:c[0].vaccine,amount:_,count:m,protections:c})}}this.loading=!1},add(){this.$router.push({name:"protectionDetail",params:{id:"add"}})},history(t){this.$router.push({name:"protectionHistory",params:{vaccine:t.vaccine._id}})},formatDate(t){return t?O(t).format("dddd d MMMM YYYY"):null},reset(){this.search.vaccine=null,this.getDatas()}}},E={key:0,class:"grid lg:gap-3 md:gap-2 gap-1 grid-cols-1 lg:grid-cols-4 md:grid-cols-3"},F={class:"bg-blue-900 rounded-full lg:text-base text-md p-2 flex justify-center"},R={class:"mt-2 h-18 mb-1"},J={key:0,class:"dark:text-gray-400 grid grid-cols-2"},K=e("div",null," จำนวนรวม ",-1),Q={class:"flex justify-end"},q={class:"underline decoration-2 dark:text-gray-100 mr-1"},G={key:1,class:"dark:text-gray-400 grid grid-cols-2"},W=e("div",null," ราคารวม ",-1),X={class:"flex justify-end"},Z={class:"underline decoration-2 dark:text-gray-100 mr-1"},ee={class:"dark:text-gray-400 grid grid-cols-3"},te=e("div",null," ล่าสุด ",-1),se={class:"flex justify-end col-span-2"},ae={class:"underline decoration-2 dark:text-gray-100 mr-1"},ne={class:"dark:text-gray-400 grid grid-cols-3"},oe=e("div",null," ต่อไป ",-1),ie={class:"flex justify-end col-span-2"},re={class:"underline decoration-2 dark:text-gray-100 mr-1"},ce={key:1,class:"text-center py-10 text-gray-500 dark:text-gray-400"},de=e("p",null," กำลังโหลดข้อมูล...",-1);function le(t,n,y,p,r,s){const c=o("SectionTitleBarSub"),_=o("Criteria"),m=o("BaseLevel"),h=o("CardBox"),f=o("BaseIcon"),P=o("SectionMain"),D=o("LayoutAuthenticated");return i(),B(D,null,{default:g(()=>[d(P,null,{default:g(()=>[d(c,{icon:"needle",title:"การป้องกัน/บำรุง (แยกตามวัคซีน)","has-btn-add":"",onOpenModal:s.add,btnText:"เพิ่มการป้องกัน/บำรุง"},null,8,["onOpenModal"]),d(_,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:s.getDatas,onReset:s.reset,forms:r.forms,search:r.search,btnLoading:r.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),r.loading?(i(),l("div",ce,[d(f,{path:"dotsCircle",size:"22",class:"animate-spin"}),de])):(i(),l("div",E,[(i(!0),l(Y,null,$(s.itemsPaginated,a=>(i(),B(h,{key:a.name,onClick:v=>s.history(a),hoverable:""},{default:g(()=>{var v,x;return[d(m,{type:"justify-center mt-1"},{default:g(()=>{var k;return[e("div",F,u((k=a.vaccine)==null?void 0:k.name),1)]}),_:2},1024),e("div",R,[a.count?(i(),l("div",J,[K,e("div",Q,[e("div",q,u(a.count),1),C(" ครั้ง ")])])):b("",!0),a.amount?(i(),l("p",G,[W,e("div",X,[e("div",Z,u(t.$filters.currency(a.amount)),1),C(" บาท ")])])):b("",!0),e("p",ee,[te,e("div",se,[e("div",ae,u(s.formatDate((v=a.vaccine)==null?void 0:v.currentDate)),1)])]),e("p",ne,[oe,e("div",ie,[e("div",re,u(s.formatDate((x=a.vaccine)==null?void 0:x.nextDate)),1)])])])]}),_:2},1032,["onClick"]))),128))]))]),_:1})]),_:1})}const ke=S(z,[["render",le]]);export{ke as default};

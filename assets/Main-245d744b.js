import{b as x,_ as E,a as q,d as T,c as F}from"./BaseDivider-e6f522d1.js";import{_ as L}from"./LayoutAuthenticated-c63231e3.js";import{_ as N}from"./SectionTitleBarSub-10fabe8f.js";import{T as Y}from"./Table-7335323f.js";import{C as U}from"./Criteria-aeebf4c3.js";import{E as u,x as V,v as M,h as O,_ as H,z as l,G as C,H as S,o as _,c as g,w as s,d as n,j,g as w,f as A,t as I,e as R}from"./index-833fccd7.js";import{a as z}from"./CardBoxModal-2c7e77f6.js";import{_ as G}from"./FormField-e4067010.js";import{_ as P}from"./FormControl-c6bef721.js";import{_ as Q}from"./NotificationBar-a8fe964b.js";import{T as b}from"./alert-c25fb8f9.js";import{E as W}from"./equipment-8c9d3166.js";import{B as J}from"./building-822ea451.js";import{_ as K}from"./FormCheckRadioPicker-ea4a7d63.js";import"./UserAvatar-e8a89c62.js";import"./CardBoxCollapse-3e6546ff.js";import"./Cow-2e6f527c.js";import"./cow-2cb1e0fe.js";import"./Recipe-ed7ed823.js";import"./Vaccine-fe177487.js";import"./Corral-a83ab125.js";async function X(t={}){let e="?";return t.status&&(e=e+`status=${t.status}&`),t?e.replace(/&*$/,""):""}class Z{async all(e){const o=await X(e);return u.get("/maintenance"+o).then(m=>m)}get(e){return u.get(`/maintenance/${e}`)}create(e){return e.date&&(e.date=V(new Date(e.date)).format("YYYY-MM-DD")),u.post("/maintenance",e)}delete(e){return u.delete(`/maintenance/${e}`)}update(e,o){return o.date&&(o.date=V(new Date(o.date)).format("YYYY-MM-DD")),u.put(`/maintenance/${e}`,o)}}const f=new Z,$=t=>t==="create"?[{id:"E",label:"อุปกรณ์"},{id:"B",label:"สิ่งก่อสร้าง"}]:[{id:"",label:"ทั้งหมด"},{id:"E",label:"อุปกรณ์"},{id:"B",label:"สิ่งก่อสร้าง"}],ee={data(){return{maintenance:{code:"",date:null,category:"E",amount:null,maintenancer:"",reason:""},list:[],categories:$("create"),loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}}},created(){this.mode==="create"&&this.equipments()},watch:{data(t){t&&this.mode==="edit"&&(this.maintenance=t,this.maintenance.date=new Date(t.date))},"maintenance.category"(t){t==="E"?this.equipments():t==="B"&&this.buildings()}},methods:{clear(){this.maintenance={},this.maintenance.category="E",this.maintenance.date=new Date},confirmCancel(t){this.value=!1,this.$emit(t)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await f.create(this.maintenance)&&(this.loading=!1,this.confirm()):await f.update(this.maintenance._id,this.maintenance)&&(this.loading=!1,this.confirm()),b.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})}catch(t){console.error("Error : ",t),this.loading=!1,this.alert=t.response.data.message,b.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}},async equipments(){const t=await W.all();if(t.data){this.list=[{id:"",label:"เลือกรายการ"}];const e=t.data.equipments;for(let o of e)this.list.push({id:o.code,label:o.code+" : "+o.name})}else this.list=[{id:"",label:"ไม่มีรายการ"}]},async buildings(){const t=await J.all();if(t.data){this.list=[{id:"",label:"เลือกรายการ"}];const e=t.data.buildings;for(let o of e)this.list.push({id:o.code,label:o.code+" : "+o.name})}else this.list=[{id:"",label:"ไม่มีรายการ"}]}},components:{BaseButton:x,BaseButtons:O,CardBox:E,BaseDivider:q,OverlayLayer:z,FormField:G,FormControl:P,NotificationBar:Q,BaseLevel:H,FormCheckRadioPicker:K,BaseIcon:T},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},te={class:"grid grid-cols-2 lg:grid-cols-3 gap-5"};function ae(t,e,o,m,a,i){const c=l("FormControl"),d=l("FormField"),y=l("NotificationBar"),v=l("BaseDivider"),p=l("BaseButton"),B=l("BaseButtons"),h=l("CardBox"),k=l("OverlayLayer");return C((_(),g(k,null,{default:s(()=>[C(n(h,{title:"การซ่อมบำรุง "+(this.mode==="create"?"":"(แก้ไข)"),class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"",onSubmit:R(i.submit,["prevent"]),onHeaderIconClick:i.cancel},{default:s(()=>{var D;return[j("div",te,[n(d,{label:"หมวดหมู่",help:"* ห้ามว่าง"},{default:s(()=>[n(c,{modelValue:a.maintenance.category,"onUpdate:modelValue":e[0]||(e[0]=r=>a.maintenance.category=r),icon:"accountEdit",options:a.categories,required:""},null,8,["modelValue","options"])]),_:1}),(D=a.maintenance)!=null&&D.category?(_(),g(d,{key:0,label:"รายการ",help:"* ห้ามว่าง"},{default:s(()=>[n(c,{modelValue:a.maintenance.code,"onUpdate:modelValue":e[1]||(e[1]=r=>a.maintenance.code=r),icon:"accountEdit",options:a.list,required:""},null,8,["modelValue","options"])]),_:1})):w("",!0),n(d,{label:"วันที่ซ่อม",help:"* ห้ามว่าง"},{default:s(()=>[n(c,{modelValue:a.maintenance.date,"onUpdate:modelValue":e[2]||(e[2]=r=>a.maintenance.date=r),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),n(d,{label:"รายละเอียด"},{default:s(()=>[n(c,{modelValue:a.maintenance.reason,"onUpdate:modelValue":e[3]||(e[3]=r=>a.maintenance.reason=r),type:"textarea"},null,8,["modelValue"])]),_:1}),n(d,{label:"ราคา",help:"* ห้ามว่าง"},{default:s(()=>[n(c,{modelValue:a.maintenance.amount,"onUpdate:modelValue":e[4]||(e[4]=r=>a.maintenance.amount=r),type:"number",icon:"cashMultiple",required:""},null,8,["modelValue"])]),_:1}),n(d,{label:"ผู้ซ่อมบำรุง"},{default:s(()=>[n(c,{modelValue:a.maintenance.maintenancer,"onUpdate:modelValue":e[5]||(e[5]=r=>a.maintenance.maintenancer=r),icon:"accountHardHat"},null,8,["modelValue"])]),_:1})]),a.alert?(_(),g(y,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:s(()=>[A(I(a.alert),1)]),_:1})):w("",!0),n(v),n(B,{type:"justify-center"},{default:s(()=>[n(p,{label:"บันทึก",color:"success",type:"submit",loading:a.loading},null,8,["loading"]),n(p,{label:"ยกเลิก",color:"danger",onClick:i.cancel},null,8,["onClick"])]),_:1})]}),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[S,i.value]])]),_:1},512)),[[S,i.value]])}const ne=M(ee,[["render",ae]]),oe={data(){return{openModal:!1,modalData:null,items:[],forms:[{label:"สถานะ",value:"status"}],search:{status:""},loading:!1,mode:"create",dataEdit:null,checked:{code:{value:"code"},label:{value:"name"}},datas:[{label:"รหัสรายการ",value:"code"},{label:"ชื่อรายการ",value:"name"},{label:"รายละเอียด",value:"reason"},{label:"วันที่ซ่อม",class:"text-center",value:"date",type:"date"},{label:"ราคา",value:"amount",class:"text-right"},{label:"ผู้ซ่อมบำรุง",value:"maintenancer"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},components:{SectionMain:F,LayoutAuthenticated:L,SectionTitleBarSub:N,Table:Y,Modal:ne,Criteria:U},computed:{getDataCopy(){return{...this.modalData}}},created(){this.getDatas()},methods:{async getDatas(t){this.loading=!0;const e=await f.all(t);this.items=[],e.data&&(this.items=e.data.maintenances),this.loading=!1},async remove(t){this.loading=!0,(await f.delete(t)).data&&this.getDatas(),this.loading=!1,b.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},async removeSelected(t){this.loading=!0;let e=[];for(let m of t)e.push(m._id);(await f.deletes(e)).data&&(this.getDatas(),b.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})),this.loading=!1},edit(t){this.modalData=t,this.mode="edit",this.openModal=!0},reset(){this.search.status="",this.getDatas()},resetData(){this.modalData={},this.modalData.category="E",this.modalData.date=new Date}}};function ie(t,e,o,m,a,i){const c=l("SectionTitleBarSub"),d=l("Modal"),y=l("Criteria"),v=l("Table"),p=l("SectionMain"),B=l("LayoutAuthenticated");return _(),g(B,null,{default:s(()=>[n(p,null,{default:s(()=>[n(c,{icon:"progressWrench",title:"การซ่อมบำรุง","has-btn-add":"",onOpenModal:e[0]||(e[0]=h=>{a.mode="create",a.openModal=!0}),btnText:"เพิ่มการซ่อมบำรุง"}),n(d,{modelValue:a.openModal,"onUpdate:modelValue":e[1]||(e[1]=h=>a.openModal=h),data:i.getDataCopy,mode:a.mode,onConfirm:i.getDatas,onCancel:i.resetData},null,8,["modelValue","data","mode","onConfirm","onCancel"]),n(y,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:i.getDatas,onReset:i.reset,forms:a.forms,search:a.search,btnLoading:a.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),n(v,{title:"รายการซ่อมบำรุง","has-checkbox":"","checked-data":a.checked,items:a.items,datas:a.datas,buttons:a.buttons,onEdit:i.edit,onDelete:i.remove,onDeleteSelected:i.removeSelected,loading:a.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const Me=M(oe,[["render",ie]]);export{Me as default};

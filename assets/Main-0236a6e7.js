import{z as L,C as T,D as M,E as j,T as w,f as V,g as A,_ as H,O as N,Q as O,B as Y,c as D,w as g,F as o,o as c,d,J as u,K as $,L as I,s,t as i,h as m,k as P}from"./index-6333eab8.js";import{C as U}from"./Criteria-beb9b1bc.js";import{P as z}from"./protection-6f1380bd.js";import"./alert-dcf95fe5.js";import"./CardBoxCollapse-ab658be0.js";import"./FormField-0a98a130.js";import"./Cow-9b13f805.js";import"./cow-40c316d2.js";import"./Recipe-5a219a76.js";import"./Vaccine-67d7d671.js";const E={data(){return{perPage:12,currentPage:0,items:[],forms:[{label:"วัคซีน",value:"vaccine",icon:"needle",type:"ddl",module:"vaccine",valueType:"_id"}],search:{vaccine:null},loading:!1}},components:{SectionMain:T,LayoutAuthenticated:M,SectionTitleBarSub:j,Table:w,Criteria:U,BaseLevel:V,UserAvatar:A,CardBox:H,BaseIcon:N},computed:{itemsPaginated(){return this.items?this.items.slice(this.perPage*this.currentPage,this.perPage*(this.currentPage+1)):[]},numPages(){return Math.ceil((this.items?this.items.length:0)/this.perPage)},currentPageHuman(){return this.currentPage+1},pagesList(){const e=[];for(let n=0;n<this.numPages;n++)e.push(n);return e}},created(){this.getDatas()},methods:{async getDatas(e){this.loading=!0;const n=await z.all(e);if(this.items=[],n.data){const v=n.data.protections,f=O.groupBy(v,"vaccine._id"),r=new Date().setUTCHours(0,0,0,0);for(let a of Object.keys(f)){const l=f[a];let _=null,h=0;for(let p of l){const x=new Date(p.date).setUTCHours(0,0,0,0);r>=x&&(_+=p.amount,h++)}this.items.push({vaccine:l[0].vaccine,amount:_,count:h,protections:l})}}this.loading=!1},add(){this.$router.push({name:"protectionDetail",params:{id:"add"}})},history(e){this.$router.push({name:"protectionHistory",params:{vaccine:e.vaccine._id}})},formatDate(e){return e?Y(e).format("DD/MM/YYYY"):null},reset(){this.search.vaccine=null,this.getDatas()}}},F={key:0,class:"grid lg:gap-3 md:gap-2 gap-1 grid-cols-1 lg:grid-cols-4 md:grid-cols-3"},R={class:"bg-blue-900 rounded-full w-20 h-20 justify-center flex text-2xl items-center"},J={class:"text-center mt-2"},K={class:"lg:text-2xl text-xl"},Q={key:0,class:"lg:text-md dark:text-gray-400 text-sm flex justify-center"},q={class:"underline decoration-2 ml-1 mr-1"},G={key:1,class:"lg:text-md dark:text-gray-400 flex text-sm justify-center"},W={class:"underline decoration-2 ml-1 mr-1"},X={class:"lg:text-md dark:text-gray-400 flex text-sm justify-center"},Z={class:"underline decoration-2 ml-1 mr-1"},ee={class:"underline decoration-2 ml-1 mr-1"},te={key:1,class:"text-center py-10 text-gray-500 dark:text-gray-400"},ae=s("p",null," กำลังโหลดข้อมูล...",-1);function se(e,n,v,f,r,a){const l=o("SectionTitleBarSub"),_=o("Criteria"),h=o("BaseLevel"),p=o("CardBox"),x=o("BaseIcon"),b=o("SectionMain"),S=o("LayoutAuthenticated");return c(),D(S,null,{default:g(()=>[d(b,null,{default:g(()=>[d(l,{icon:"needle",title:"การป้องกัน/บำรุง","has-btn-add":"",onOpenModal:a.add,btnText:"เพิ่มการป้องกัน/บำรุง"},null,8,["onOpenModal"]),d(_,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:a.getDatas,onReset:a.reset,forms:r.forms,search:r.search,btnLoading:r.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),r.loading?(c(),u("div",te,[d(x,{path:"dotsCircle",size:"22",class:"animate-spin"}),ae])):(c(),u("div",F,[(c(!0),u($,null,I(a.itemsPaginated,t=>(c(),D(p,{key:t.name,onClick:y=>a.history(t),hoverable:""},{default:g(()=>{var y,k,B;return[d(h,{type:"justify-center mt-3"},{default:g(()=>{var C;return[s("div",R,i((C=t.vaccine)==null?void 0:C.code.split("_")[1])+" ",1)]}),_:2},1024),s("div",J,[s("h4",K,i((y=t.vaccine)==null?void 0:y.name),1),t.count?(c(),u("p",Q,[m(" จำนวนรวม "),s("div",q,i(t.count),1),m(" ครั้ง ")])):P("",!0),t.amount?(c(),u("p",G,[m(" ราคารวม "),s("div",W,i(e.$filters.currency(t.amount)),1)])):P("",!0),s("p",X,[m(" ล่าสุด "),s("div",Z,i(a.formatDate((k=t.vaccine)==null?void 0:k.currentDate)),1),m(" | ต่อไป "),s("div",ee,i(a.formatDate((B=t.vaccine)==null?void 0:B.nextDate)),1)])])]}),_:2},1032,["onClick"]))),128))]))]),_:1})]),_:1})}const he=L(E,[["render",se]]);export{he as default};

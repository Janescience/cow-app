import{z as J,B as K,p as oe,m as ne,_ as X,l as Z,F as ie,i as re,j as de,f as ee,N as F,E as g,G as M,H as B,o as r,c as L,w as _,d as n,I as m,k as Y,s as a,h as O,t as v,J as C,K as D,e as ce,a as w,L as ue,M as me,n as R,q as I,S as he,C as fe,D as ve}from"./index-b8f50ace.js";import{T as ge}from"./Table-f373bbaa.js";import{_ as ke}from"./FormField-207c8e6d.js";import{_ as _e}from"./FormCheckRadioPicker-26fd984b.js";import{D as pe}from"./Cow-c198d858.js";import{M as U}from"./milking-c90b9f69.js";import{T as G}from"./alert-7955475f.js";import{u as ye,_ as we}from"./Top-319bde38.js";import"./cow-1e74c274.js";const xe={data(){return{milk:{date:new Date,time:"M"},milkDetail:{cow:null,qty:null,amount:null},milkDetails:[],loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{calAmount(){return this.milkDetail.amount=this.milkDetail.qty*100,this.milkDetail.amount},user(){return this.$store.state.auth.user},value:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}}},watch:{data:{handler(t,l){t!=null&&(this.mode=="edit"&&(this.milkDetails=t.milkDetails),this.milk.date=t.date?new Date(t.date):new Date,this.milk.time=t.time?t.time:"M",this.milk._id=t._id)}}},methods:{clear(){this.milk.date=new Date,this.milk.time="M",this.milkDetails=[]},confirmCancel(t,l){this.value=!1,this.$emit(t,l)},confirm(t){this.clear(),this.confirmCancel("confirm",t)},cancel(){this.clear(),this.confirmCancel("cancel")},removeDetail(t){let l=this.milkDetails.indexOf(t);l!==-1&&this.milkDetails.splice(l,1)},add(){this.milkDetail.cow&&this.milkDetail.qty>0&&this.milkDetail.amount?this.milkDetails.filter(l=>{var s;return l.cow.code===((s=this.milkDetail)==null?void 0:s.cow.code)}).length<=0?(this.milkDetails.push(this.milkDetail),this.alert="",this.milkDetail={}):this.alert="โคซ้ำ":this.alert="กรุณากรอกข้อมูลให้ครบ"},async submit(){this.loading=!0,this.alert="",this.milk.milkDetails=this.milkDetails;const t={...this.milk};try{this.mode==="create"?await U.create(t)&&(this.loading=!1,this.value=!1,this.confirm(t),G.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})):await U.update(this.milk._id,this.milk)&&(this.loading=!1,this.value=!1,this.confirm(),G.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"}))}catch(l){console.error("Error : ",l),this.loading=!1,this.alert=l.response.data.message}},formatDate(t){return K(t).format("DD/MM/YYYY")}},components:{BaseButton:oe,BaseButtons:ne,CardBox:X,BaseDivider:Z,OverlayLayer:ie,FormField:ke,FormControl:re,NotificationBar:de,BaseLevel:ee,DDLCow:pe,FormCheckRadioPicker:_e,BaseIcon:F},props:{modelValue:{type:[String,Number,Boolean],default:null},mode:{type:String,default:""},data:{type:Object,default:null}}},be={key:0,class:"grid grid-cols-2 gap-3 mt-1"},Ce={class:"grid grid-cols-2 lg:grid-cols-4 gap-5"},De=a("header",{class:"flex items-stretch border-b border-gray-100 dark:border-gray-800"},[a("p",{class:"flex items-center py-3 grow font-bold"}," รายการรีดนม ")],-1),Me={key:3,class:"overflow-x-auto"},Be=a("thead",null,[a("tr",null,[a("th",{class:"whitespace-nowrap text-center"}," โค "),a("th",{class:"whitespace-nowrap text-center"}," น้ำนมดิบ/กก. "),a("th",{class:"whitespace-nowrap text-center"}," จำนวนเงิน "),a("th")])],-1),Ve={"data-label":"โค"},Te={"data-label":"น้ำนมดิบ/กก.",class:"text-center"},Se={"data-label":"จำนวนเงิน",class:"text-right"},Ye={class:"lg:w-6 whitespace-nowrap"},Ee={key:4,class:"text-center py-10 text-gray-500 dark:text-gray-400"},Fe=a("p",null,"ไม่มีรายการ...",-1),Oe=[Fe];function Le(t,l,s,j,d,c){const h=g("FormControl"),p=g("FormField"),V=g("FormCheckRadioPicker"),T=g("BaseDivider"),S=g("DDLCow"),y=g("BaseButton"),x=g("BaseButtons"),q=g("NotificationBar"),A=g("CardBox"),$=g("OverlayLayer");return M((r(),L($,null,{default:_(()=>[M(n(A,{title:s.mode==="create"?"การรีดนม":"การรีดนม ("+((d.milk.time=="M"?"เช้า":"บ่าย")+" - "+c.formatDate(d.milk.date))+")",class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"","has-scroll":"",onSubmit:ce(c.submit,["prevent"]),onHeaderIconClick:c.cancel},{default:_(()=>[s.mode!="edit"?(r(),m("div",be,[n(p,{label:"วันที่รีดนม",help:"* ห้ามว่าง"},{default:_(()=>[n(h,{modelValue:d.milk.date,"onUpdate:modelValue":l[0]||(l[0]=f=>d.milk.date=f),icon:"calendar",type:"date",required:"",disabled:s.mode=="edit"},null,8,["modelValue","disabled"])]),_:1}),n(p,{label:"รอบ"},{default:_(()=>[n(V,{modelValue:d.milk.time,"onUpdate:modelValue":l[1]||(l[1]=f=>d.milk.time=f),type:"radio",name:"milk-time",options:{M:"เช้า",A:"บ่าย"},disabled:s.mode=="edit"},null,8,["modelValue","disabled"])]),_:1})])):Y("",!0),s.mode!="edit"?(r(),L(T,{key:1})):Y("",!0),a("div",Ce,[n(p,{label:"โค",help:"* ห้ามว่าง"},{default:_(()=>[n(S,{modelValue:d.milkDetail.cow,"onUpdate:modelValue":l[2]||(l[2]=f=>d.milkDetail.cow=f),valueType:"object"},null,8,["modelValue"])]),_:1}),n(p,{label:"น้ำนมดิบ/กก.",help:"* ห้ามว่าง"},{default:_(()=>[n(h,{modelValue:d.milkDetail.qty,"onUpdate:modelValue":l[3]||(l[3]=f=>d.milkDetail.qty=f),type:"number",icon:"scale"},null,8,["modelValue"])]),_:1}),n(p,{label:"จำนวนเงินรวม",help:"ราคาน้ำนมดิบ/กก. 100 บาท"},{default:_(()=>[n(h,{modelValue:c.calAmount,"onUpdate:modelValue":l[4]||(l[4]=f=>c.calAmount=f),type:"number",icon:"cashMultiple"},null,8,["modelValue"])]),_:1}),n(x,{type:"justify-start"},{default:_(()=>[n(y,{label:"เพิ่ม",color:"info",onClick:l[5]||(l[5]=f=>c.add())})]),_:1})]),d.alert?(r(),L(q,{key:2,color:"danger",outline:"",icon:"alertCircleOutline"},{default:_(()=>[O(v(d.alert),1)]),_:1})):Y("",!0),De,d.milkDetails.length>0?(r(),m("div",Me,[a("table",null,[Be,a("tbody",null,[(r(!0),m(C,null,D(d.milkDetails,f=>(r(),m("tr",{key:f.cow._id},[a("td",Ve,v(f.cow.code)+" : "+v(f.cow.name),1),a("td",Te,v(f.qty),1),a("td",Se,v(f.amount),1),a("td",Ye,[n(x,{type:"justify-end lg:justify-start","no-wrap":""},{default:_(()=>[n(y,{color:"danger",icon:"trashCanOutline",small:"",onClick:P=>c.removeDetail(f)},null,8,["onClick"])]),_:2},1024)])]))),128))])])])):(r(),m("div",Ee,Oe)),n(x,{type:"justify-center mt-3"},{default:_(()=>[n(y,{label:"บันทึก",color:"success",type:"submit",loading:d.loading},null,8,["loading"]),n(y,{label:"ยกเลิก",color:"danger",onClick:c.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[B,c.value]])]),_:1},512)),[[B,c.value]])}const te=J(xe,[["render",Le]]),$e={ref:"calendarContainer",class:"min-h-full min-w-full text-gray-300"},Qe={class:"w-full grid grid-cols-7"},qe=["onClick"],Ae=a("div",{class:"w-1/12"},[a("div",{class:"h-2 w-2 rounded-full bg-orange-600"})],-1),Ne={class:"w-11/12"},Ie={class:"text-xs tracking-tight text-clip overflow-hidden"},Ue=["onClick"],je={class:"w-1/12 mr-1"},Pe={class:"w-11/12"},ze={class:"text-xs tracking-tight text-clip text-left overflow-hidden"},Re=["onClick"],He={class:"h-6 w-6 flex justify-center items-center text-xs bg-orange-600 rounded-full shadow-sm"},We={class:"font-medium text-white"},Ge={class:"mt-2"},Je=["onClick"],Ke={class:"text-sm text-clip overflow-hidden items-center"},Xe=["onClick"],Ze={class:"opacity-40"},et=a("p",{class:"hidden md:block"},"รีดนม",-1),tt=["onClick"],lt={class:"h-6 w-6 flex justify-center items-center text-xs bg-orange-600 rounded-full shadow-sm"},at={class:"font-medium text-white"},st={key:0,class:"md:hidden"},ot=["onClick"],nt={class:"text-sm text-clip overflow-hidden"},it={__name:"Calendar",props:{events:{type:Object,required:!0}},emits:["confirm"],setup(t,{emit:l}){const s=ye();s.$subscribe((u,o)=>{A(),$()});const j={1:"อา",2:"จ.",3:"อ.",4:"พ.",5:"พฤ",6:"ศ.",7:"ส."},d=w(0),c=w(0),h=w(0),p=w(0),V=w(!1),T=w(!1),S=w([]),y=w(""),x=w("create"),q=w({}),A=()=>{d.value=new Date(s.getYear,s.getMonth+1,0).getDate()},$=()=>{h.value=new Date(s.getYear,s.getMonth,1).getDay()},f=()=>{c.value=new Date(s.getYear,s.getMonth,0).getDate()},P=()=>{let u=h.value<=5?35:42;p.value=u-d.value-h.value},N=u=>{let o=new Date;return s.getYear==o.getFullYear()&&s.getMonth==o.getMonth()&&u==o.getDate()},H=(u,o,e,i,k)=>s.getYear==o.substring(4,8)&&s.getMonth+(e?0:1)==o.substring(2,4)&&u==o.substring(0,2)&&i==k,le=(u,o,e)=>s.getYear==o.substring(4,8)&&s.getMonth+(e?0:1)==o.substring(2,4)&&u==o.substring(0,2),E=(u,o,e)=>{if(!o.length)return[];let i=[];return o.forEach(k=>{H(u,k.date,e)&&i.push(k)}),i},b=(u,o,e,i)=>{if(!o.length)return[];let k=[];return o.forEach(z=>{H(u,z.date,e,z.time,i)&&(k=z.milks)}),k},W=(u,o,e)=>{if(!o.length)return 0;let i=0;return o.forEach(k=>{le(u,k.date,e)&&(i+=k.sumQty)}),i},Q=(u,o,e,i)=>{x.value=e?"edit":"create";let k=s.getYear+"-"+(s.getMonth+1)+"-"+u;q.value={_id:i,date:k,time:e,milkDetails:o},V.value=!0},ae=(u,o)=>{const e=E(u,o);S.value=e,y.value=u,T.value=!0},se=u=>{l("confirm",u)};return ue(()=>{A(),$(),f(),P()}),me(()=>{$(),f(),P()}),(u,o)=>(r(),m(C,null,[a("div",$e,[a("div",Qe,[n(we),(r(),m(C,null,D(j,e=>a("div",{key:e,class:"text-center text-sm md:text-base lg:text- font-medium border-b mt-3 border-gray-600"},v(e),1)),64)),(r(!0),m(C,null,D(h.value,e=>M((r(),m("div",{key:e,class:"h-16 md:h-36 w-full opacity-50 border-t border-gray-600 align-top"},[a("div",{class:R(["w-full h-full text-xs md:text-sm lg:text-base text-center transition-colors p-3",{"bg-slate-300 text-gray-900 font-medium  ":N(e),"hover:bg-gray-100 hover:text-gray-700":!N(e)}])},[O(v(c.value-(h.value-e))+" ",1),(r(!0),m(C,null,D(E(c.value-(h.value-e),t.events,!0),i=>M((r(),m("div",{key:i.title,class:"hidden md:block"},[a("div",{class:"w-full px-2 py-1 flex space-x-1 items-center whitespace-nowrap overflow-hidden hover:border hover:border-gray-200 cursor-pointer rounded-lg",onClick:k=>u.togglePopover(k,i)},[Ae,a("div",Ne,[a("h5",Ie,v(i.title),1)])],8,qe)])),[[B,E(c.value-(h.value-e),t.events,!0).length]])),128)),b(c.value-(h.value-e),t.events,!0).length>3?(r(),m("div",{key:0,class:"hidden md:flex mt-2 w-full px-2 py-1 space-x-2 items-center whitespace-nowrap overflow-hidden hover:text-gray-800 hover:font-medium cursor-pointer rounded-sm",onClick:i=>Q(c.value-(h.value-e),b(c.value-(h.value-e),t.events,!0))},[a("div",je,[n(F,{path:"plus"})]),a("div",Pe,[a("h6",ze,v(" มีอีก "+(b(c.value-(h.value-e),t.events,!0).length-3)+" รายการ"),1)])],8,Ue)):Y("",!0),b(c.value-(h.value-e),t.events,!0).length>0?(r(),m("div",{key:1,class:"flex md:hidden h-2/3 w-full justify-center items-center",onClick:i=>Q(c.value-(h.value-e),b(c.value-(h.value-e),t.events,!0))},[a("div",He,[a("h3",We,v(b(c.value-(h.value-e),t.events,!0).length),1)])],8,Re)):Y("",!0)],2)])),[[B,h.value>0]])),128)),(r(!0),m(C,null,D(d.value,e=>(r(),m("div",{key:e,class:"h-16 md:h-36 w-full border-t border-gray-600 align-top"},[a("div",{class:R(["w-full h-full text-xs md:text-sm lg:text-base text-center transition-colors p-2",{"bg-gray-600 text-gray-900 font-medium  ":N(e),"hover:bg-gray-100 hover:text-gray-700":!N(e)}])},[O(v(e)+" ",1),a("div",Ge,[(r(!0),m(C,null,D(E(e,t.events),i=>M((r(),m("div",{key:i.date,class:"hidden md:block p-1"},[a("div",{class:"w-full flex p-1 shadow-lg border border-gray-800 shadow cursor-pointer rounded-md",onClick:k=>Q(e,b(e,t.events,!1,i.time),i.time,i.id)},[a("p",Ke,[n(F,{path:i.time==="M"?"clockTimeSevenOutline":"clockTimeThreeOutline",class:R(i.time==="M"?"text-yellow-400":"text-orange-500")},null,8,["path","class"]),O(" "+v(i.time=="M"?"เช้า":"บ่าย")+" - "+v(i.sumQty)+" กก. ",1)])],8,Je)])),[[B,E(e,t.events).length>0]])),128))]),M(a("div",null,[a("div",{class:"w-full mt-2 text-center items-center overflow-hidden hover:border hover:border-gray-200 cursor-pointer rounded-lg",onClick:i=>Q(e,b(e,t.events))},[a("div",Ze,[n(F,{path:"plus"}),O(),et])],8,Xe)],512),[[B,E(e,t.events).length===0]]),W(e,t.events)>0?(r(),m("div",{key:0,class:"flex md:hidden h-2/3 w-full justify-center items-center",onClick:i=>ae(e,t.events)},[a("div",lt,[a("h3",at,v(W(e,t.events)),1)])],8,tt)):Y("",!0)],2)]))),128)),(r(!0),m(C,null,D(p.value,e=>M((r(),m("div",{key:e,class:"h-16 md:h-36 w-full opacity-50"})),[[B,p.value>0]])),128))]),n(ee,{type:"justify-between w-full mt-2",class:"md:hidden"},{default:_(()=>[n(F,{path:"chevronLeft",size:"30",class:"cursor-pointer hover:text-gray-300",onClick:o[0]||(o[0]=e=>I(s).decrementMonth(1))}),n(F,{path:"chevronRight",size:"30",class:"cursor-pointer hover:text-gray-300",onClick:o[1]||(o[1]=e=>I(s).incrementMonth(1))})]),_:1}),n(Z),T.value?(r(),m("div",st,[O(" รายการรีดนม "+v(y.value)+"/"+v(I(s).getMonth+1)+"/"+v(I(s).getYear+543)+" ",1),(r(!0),m(C,null,D(S.value,e=>M((r(),m("div",{key:e.date},[a("div",{class:"w-full text-left flex overflow-hidden p-2 mt-2 border border-gray-800 shadow cursor-pointer rounded-md",onClick:i=>Q(y.value,b(y.value,t.events,!1,e.time),e.time,e.id)},[a("p",nt," รอบ "+v(e.time=="M"?"เช้า":"บ่าย")+" น้ำนมดิบ "+v(e.sumQty)+" กก. รีดแล้ว "+v(e.count)+" ตัว ",1)],8,ot)])),[[B,S.value.length>0]])),128))])):Y("",!0)],512),n(te,{modelValue:V.value,"onUpdate:modelValue":o[2]||(o[2]=e=>V.value=e),mode:x.value,data:q.value,onConfirm:se},null,8,["modelValue","mode","data"])],64))}},rt={data(){return{modalMilk:!1,items:[],events:[],forms:[{label:"โค",class:"lg:col-start-2",value:"cow",type:"ddl",module:"cow"},{label:"วันที่รีดนม",value:"date",icon:"calendar",type:"date"}],loading:!1,mode:"create",dataEdit:null,checked:{code:{value:"date",type:"date"},label:{value:"cow.name"}},datas:[{label:"วันที่รีดนม",class:"text-center",type:"date",value:"date"},{label:"โค",class:"text-center",value:"relate.cow.name"},{label:"ปริมาณน้ำนมดิบ/เช้า (กก.)",class:"text-center",value:"morningQty"},{label:"ปริมาณน้ำนมดิบ/บ่าย (กก.)",class:"text-center",value:"afternoonQty"},{label:"ปริมาณน้ำนมดิบรวม (กก.)",class:"text-center",func:t=>t.morningQty+t.afternoonQty},{label:"จำนวนเงินรวม",class:"text-right",type:"number",value:"amount"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},components:{SectionMain:he,LayoutAuthenticated:fe,Table:ge,SectionTitleBarSub:ve,MilkModal:te,Calendar:it,CardBox:X},computed:{user(){return this.$store.state.auth.user}},created(){this.getMilks()},methods:{async getMilks(){this.loading=!0;const t=await U.all();if(this.events=[],t.data)for(let l of t.data.milks)this.filterMilk(l);this.loading=!1},async removeMilk(t){this.loading=!0,(await U.delete(t)).data&&this.getMilks(),this.loading=!1},filterMilk(t){let l={};l.sumQty=0,l.sumAmt=0,t.milkDetails.map(s=>{s.cow=typeof s.cow=="string"?s.relate.cow:s.cow,l.sumQty+=s.qty,l.sumAmt+=s.amount}),l.count=t.milkDetails.length,l.milks=t.milkDetails,l.date=K(t.date,"YYYY-MM-DD").format("DDMMYYYY"),l.time=t.time,l.id=t._id,this.events.push(l)},addMilk(t){this.filterMilk(t)},edit(t){this.dataEdit=t,this.mode="edit",this.modalMilk=!0}}};function dt(t,l,s,j,d,c){const h=g("SectionTitleBarSub"),p=g("MilkModal"),V=g("Calendar"),T=g("CardBox"),S=g("SectionMain"),y=g("LayoutAuthenticated");return r(),L(y,null,{default:_(()=>[n(S,null,{default:_(()=>[n(h,{icon:"cupWater",title:"การรีดนม",btnText:"เพิ่มการรีดนม","has-btn-add":"",onOpenModal:l[0]||(l[0]=x=>{d.mode="create",d.modalMilk=!0})}),n(p,{modelValue:d.modalMilk,"onUpdate:modelValue":l[1]||(l[1]=x=>d.modalMilk=x),mode:d.mode,dataEdit:d.dataEdit,onConfirm:c.getMilks},null,8,["modelValue","mode","dataEdit","onConfirm"]),d.loading?(r(),L(T,{key:1,loading:""})):(r(),L(T,{key:0},{default:_(()=>[n(V,{events:d.events,onConfirm:c.addMilk},null,8,["events","onConfirm"])]),_:1}))]),_:1})]),_:1})}const pt=J(rt,[["render",dt]]);export{pt as default};

import{y as _,z as D,p as F,m as x,_ as M,l as T,G as L,i as N,j as O,f as Y,O as I,F as n,H as S,I as V,o as v,c as C,w as r,d as l,s as U,h as u,t as m,k as j,e as A,T as H,D as q,C as z,E as P}from"./index-56b7da08.js";import{_ as E}from"./FormField-eee27373.js";import{T as b}from"./alert-1e5c979f.js";import{_ as W}from"./FormCheckRadioPicker-21109a3d.js";import{W as R}from"./worker-13960f61.js";async function G(e={}){let a="?";return e.worker&&(a=a+`worker=${e.worker}&`),e?a.replace(/&*$/,""):""}class Q{async all(a){const s=await G(a);return _.get("/salary"+s).then(p=>p)}get(a){return _.get(`/salary/${a}`)}create(a){return _.post("/salary",a)}delete(a){return _.delete(`/salary/${a}`)}update(a,s){return _.put(`/salary/${a}`,s)}}const y=new Q,J={data(){return{salary:{year:new Date().getFullYear(),month:new Date().getMonth()+1,amount:null,remark:""},years:[],months:[{id:1,label:"มกราคม"},{id:2,label:"กุมภาพันธ์"},{id:3,label:"มีนาคม"},{id:4,label:"เมษายน"},{id:5,label:"พฤษภาคม"},{id:6,label:"มิถุนายน"},{id:7,label:"กรกฏาคม"},{id:8,label:"สิงหาคม"},{id:9,label:"กันยายน"},{id:10,label:"ตุลาคม"},{id:11,label:"พฤศจิกายน"},{id:12,label:"ธันวาคม"}],loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},watch:{data(e){e&&this.mode==="edit"&&(this.salary=e)}},created(){this.getYears()},methods:{clear(){this.salary={}},confirmCancel(e){this.value=!1,this.$emit(e)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="",this.salary.worker=this.$route.params.id;try{this.mode==="create"?await y.create(this.salary)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")):await y.update(this.salary._id,this.salary)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")),b.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})}catch(e){console.error("Error : ",e),this.loading=!1,this.alert=e.response.data.message,b.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}},getYears(){const e=new Date().getFullYear()+543,a=new Date().getFullYear();for(let s=5;s>0;s--)this.years.push({id:a+s,label:e+s});this.years.push({id:a,label:e});for(let s=1;s<6;s++)this.years.push({id:a-s,label:e-s})}},components:{BaseButton:F,BaseButtons:x,CardBox:M,BaseDivider:T,OverlayLayer:L,FormField:E,FormControl:N,NotificationBar:O,BaseLevel:Y,FormCheckRadioPicker:W,BaseIcon:I},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},K={class:"grid grid-cols-2 lg:grid-cols-3 gap-5"};function X(e,a,s,p,t,i){const f=n("FormControl"),h=n("FormField"),d=n("NotificationBar"),B=n("BaseDivider"),g=n("BaseButton"),k=n("BaseButtons"),w=n("CardBox"),o=n("OverlayLayer");return S((v(),C(o,null,{default:r(()=>[S(l(w,{title:"เงินเดือน "+(this.mode==="create"?"":"(แก้ไข)"),class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"",onSubmit:A(i.submit,["prevent"]),onHeaderIconClick:i.cancel},{default:r(()=>[U("div",K,[l(h,{label:"ปี พ.ศ.",help:"* ห้ามว่าง"},{default:r(()=>[l(f,{modelValue:t.salary.year,"onUpdate:modelValue":a[0]||(a[0]=c=>t.salary.year=c),options:t.years},null,8,["modelValue","options"])]),_:1}),l(h,{label:"เดือน",help:"* ห้ามว่าง"},{default:r(()=>[l(f,{modelValue:t.salary.month,"onUpdate:modelValue":a[1]||(a[1]=c=>t.salary.month=c),options:t.months},null,8,["modelValue","options"])]),_:1}),l(h,{label:"เงินเดือน",help:"* ห้ามว่าง "},{default:r(()=>[l(f,{icon:"cashMultiple",type:"number",modelValue:t.salary.amount,"onUpdate:modelValue":a[2]||(a[2]=c=>t.salary.amount=c)},null,8,["modelValue"])]),_:1}),l(h,{label:"หมายเหตุ"},{default:r(()=>[l(f,{modelValue:t.salary.remark,"onUpdate:modelValue":a[3]||(a[3]=c=>t.salary.remark=c),type:"textarea"},null,8,["modelValue"])]),_:1})]),t.alert?(v(),C(d,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:r(()=>[u(m(t.alert),1)]),_:1})):j("",!0),l(B),l(k,{type:"justify-center"},{default:r(()=>[l(g,{label:"บันทึก",color:"success",type:"submit",loading:t.loading},null,8,["loading"]),l(g,{label:"ยกเลิก",color:"danger",onClick:i.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[V,i.value]])]),_:1},512)),[[V,i.value]])}const Z=D(J,[["render",X]]),$={data(){return{openModal:!1,modalData:null,mode:"create",worker:{},salary:{},salaries:[],loading:!1,alert:"",datas:[{label:"ปี",value:"year",class:"text-center"},{label:"เดือน",class:"text-center",value:"month"},{label:"เงินเดือน",value:"amount",class:"text-right"},{label:"หมายเหตุ",class:"text-center",value:"remark"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},computed:{getDataCopy(){return{...this.modalData}}},created(){this.getWorker()},methods:{async getWorker(){this.loading=!0;const e=await R.get(this.$route.params.id);e.data&&(this.worker=e.data.worker,this.getSalaries()),this.loading=!1},async getSalaries(){this.loading=!0;const e=await y.all({worker:this.worker._id});e.data&&(this.salaries=e.data.salarys),this.loading=!1},async remove(e){this.loading=!0,(await y.delete(e)).data&&this.getSalaries(),this.loading=!1,b.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},async removeSelected(e){this.loading=!0;let a=[];for(let p of e)a.push(p._id);(await y.deletes(a)).data&&(this.getSalaries(),b.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})),this.loading=!1},edit(e){this.modalData=e,this.mode="edit",this.openModal=!0},resetData(){this.modalData=null}},components:{BaseButton:F,BaseButtons:x,CardBox:M,BaseDivider:T,OverlayLayer:L,FormField:E,FormControl:N,NotificationBar:O,BaseLevel:Y,FormCheckRadioPicker:W,BaseIcon:I,Table:H,LayoutAuthenticated:q,SectionMain:z,SectionTitleBarSub:P,Modal:Z}},ee={class:"grid grid-cols-2 lg:grid-cols-5 gap-5"};function ae(e,a,s,p,t,i){const f=n("SectionTitleBarSub"),h=n("Modal"),d=n("FormField"),B=n("CardBox"),g=n("Table"),k=n("SectionMain"),w=n("LayoutAuthenticated");return v(),C(w,null,{default:r(()=>[l(k,null,{default:r(()=>[l(f,{icon:"cashMultiple",title:"จัดการเงินเดือน","has-btn-add":"",onOpenModal:a[0]||(a[0]=o=>{t.mode="create",t.openModal=!0}),btnText:"เพิ่มเงินเดือน"}),l(h,{modelValue:t.openModal,"onUpdate:modelValue":a[1]||(a[1]=o=>t.openModal=o),data:i.getDataCopy,mode:t.mode,onConfirm:i.getSalaries},null,8,["modelValue","data","mode","onConfirm"]),l(B,{icon:"accountBox",title:"ข้อมูลคนงาน",class:"shadow-lg w-full mb-5","header-icon":"",form:""},{default:r(()=>[U("div",ee,[l(d,{label:"ชื่อ"},{default:r(()=>{var o;return[u(m((o=t.worker)==null?void 0:o.name),1)]}),_:1}),l(d,{label:"อายุ"},{default:r(()=>{var o;return[u(m((o=t.worker)==null?void 0:o.age),1)]}),_:1}),l(d,{label:"อายุงาน"},{default:r(()=>{var o;return[u(m((o=t.worker)==null?void 0:o.age),1)]}),_:1}),l(d,{label:"หน้าที่"},{default:r(()=>{var o;return[u(m((o=t.worker)==null?void 0:o.duty),1)]}),_:1}),l(d,{label:"เงินเดือนปัจจุบัน"},{default:r(()=>{var o;return[u(m((o=t.worker)==null?void 0:o.salary),1)]}),_:1}),l(d,{label:"หมายเหตุ"},{default:r(()=>{var o,c;return[u(m((o=t.worker)!=null&&o.remark?(c=t.worker)==null?void 0:c.remark:"-"),1)]}),_:1})])]),_:1}),l(g,{title:"ประวัติเงินเดือน","has-checkbox":"","checked-data":e.checked,items:t.salaries,datas:t.datas,buttons:t.buttons,onEdit:i.edit,onDelete:i.remove,onDeleteSelected:i.removeSelected,loading:t.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const ne=D($,[["render",ae]]);export{ne as default};

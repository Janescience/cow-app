import{c as S,_ as L,d as M}from"./BaseDivider-d20c799d.js";import{_ as T}from"./LayoutAuthenticated-399c6108.js";import{_ as j}from"./SectionTitleBarSub-29d7237b.js";import{T as V}from"./Table-1ba3794d.js";import{C as w}from"./Criteria-242de7a6.js";import{_ as A}from"./UserAvatar-6e8abc3f.js";import{v as H,_ as N,y as Y,x as $,c as B,w as p,z as n,o as r,d,s as l,F as I,D as O,j as t,t as u,f as b,g as C}from"./index-ec259908.js";import{P as U}from"./protection-d859442f.js";import"./alert-d8ea619a.js";import"./CardBoxModal-7e295395.js";import"./FormControl-e03344a5.js";import"./CardBoxCollapse-af90c144.js";import"./FormField-fb8ff6d9.js";import"./FormCheckRadioPicker-c7050b51.js";import"./Cow-6b6f2299.js";import"./cow-cf15b639.js";import"./Recipe-6c2f94d2.js";import"./Vaccine-597b4eae.js";const z={data(){return{perPage:12,currentPage:0,items:[],forms:[{label:"วัคซีน",value:"vaccine",icon:"needle",type:"ddl",module:"vaccine",valueType:"_id"}],search:{vaccine:null},loading:!1}},components:{SectionMain:S,LayoutAuthenticated:T,SectionTitleBarSub:j,Table:V,Criteria:w,BaseLevel:N,UserAvatar:A,CardBox:L,BaseIcon:M},computed:{itemsPaginated(){return this.items?this.items.slice(this.perPage*this.currentPage,this.perPage*(this.currentPage+1)):[]},numPages(){return Math.ceil((this.items?this.items.length:0)/this.perPage)},currentPageHuman(){return this.currentPage+1},pagesList(){const e=[];for(let o=0;o<this.numPages;o++)e.push(o);return e}},created(){this.getDatas()},methods:{async getDatas(e){this.loading=!0;const o=await U.all(e);if(this.items=[],o.data){const y=o.data.protections,g=Y.groupBy(y,"vaccine._id"),i=new Date().setUTCHours(0,0,0,0);for(let s of Object.keys(g)){const c=g[s];let _=null,m=0;for(let h of c){const f=new Date(h.date).setUTCHours(0,0,0,0);i>=f&&(_+=h.amount,m++)}this.items.push({vaccine:c[0].vaccine,amount:_,count:m,protections:c})}}this.loading=!1},add(){this.$router.push({name:"protectionDetail",params:{id:"add"}})},history(e){this.$router.push({name:"protectionHistory",params:{vaccine:e.vaccine._id}})},formatDate(e){return e?$(e).format("dddd d MMMM YYYY"):null},reset(){this.search.vaccine=null,this.getDatas()}}},F={key:0,class:"grid lg:gap-3 md:gap-2 gap-1 grid-cols-1 lg:grid-cols-4 md:grid-cols-3"},R={class:"bg-blue-900 rounded-full lg:text-base text-md p-2 flex justify-center"},E={class:"mt-2 h-18 mb-1"},q={key:0,class:"dark:text-gray-400 grid grid-cols-2"},G=t("div",null," จำนวนรวม ",-1),J={class:"flex justify-end"},K={class:"underline decoration-2 dark:text-gray-100 mr-1"},Q={key:1,class:"dark:text-gray-400 grid grid-cols-2"},W=t("div",null," ราคารวม ",-1),X={class:"flex justify-end"},Z={class:"underline decoration-2 dark:text-gray-100 mr-1"},tt={class:"dark:text-gray-400 grid grid-cols-3"},et=t("div",null," ล่าสุด ",-1),st={class:"flex justify-end col-span-2"},at={class:"underline decoration-2 dark:text-gray-100 mr-1"},ot={class:"dark:text-gray-400 grid grid-cols-3"},nt=t("div",null," ต่อไป ",-1),rt={class:"flex justify-end col-span-2"},it={class:"underline decoration-2 dark:text-gray-100 mr-1"},ct={key:1,class:"text-center py-10 text-gray-500 dark:text-gray-400"},dt=t("p",null," กำลังโหลดข้อมูล...",-1);function lt(e,o,y,g,i,s){const c=n("SectionTitleBarSub"),_=n("Criteria"),m=n("BaseLevel"),h=n("CardBox"),f=n("BaseIcon"),P=n("SectionMain"),D=n("LayoutAuthenticated");return r(),B(D,null,{default:p(()=>[d(P,null,{default:p(()=>[d(c,{icon:"needle",title:"ฉีดวัคซีน","has-btn-add":"",onOpenModal:s.add,btnText:"เพิ่มการฉีดวัคซีน"},null,8,["onOpenModal"]),d(_,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:s.getDatas,onReset:s.reset,forms:i.forms,search:i.search,btnLoading:i.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),i.loading?(r(),l("div",ct,[d(f,{path:"dotsCircle",size:"22",class:"animate-spin"}),dt])):(r(),l("div",F,[(r(!0),l(I,null,O(s.itemsPaginated,a=>(r(),B(h,{key:a.name,onClick:v=>s.history(a),hoverable:""},{default:p(()=>{var v,x;return[d(m,{type:"justify-center mt-1"},{default:p(()=>{var k;return[t("div",R,u((k=a.vaccine)==null?void 0:k.name),1)]}),_:2},1024),t("div",E,[a.count?(r(),l("div",q,[G,t("div",J,[t("div",K,u(a.count),1),b(" ครั้ง ")])])):C("",!0),a.amount?(r(),l("p",Q,[W,t("div",X,[t("div",Z,u(e.$filters.currency(a.amount)),1),b(" บาท ")])])):C("",!0),t("p",tt,[et,t("div",st,[t("div",at,u(s.formatDate((v=a.vaccine)==null?void 0:v.currentDate)),1)])]),t("p",ot,[nt,t("div",rt,[t("div",it,u(s.formatDate((x=a.vaccine)==null?void 0:x.nextDate)),1)])])])]}),_:2},1032,["onClick"]))),128))]))]),_:1})]),_:1})}const Mt=H(z,[["render",lt]]);export{Mt as default};

import{y as m,B as v,z as w,p as k,m as x,_ as Y,l as F,F as T,i as L,j as N,f as U,N as A,E as i,G as y,H as S,o as B,c as V,w as s,d as l,s as E,h as q,t as O,k as H,e as I,S as j,C as R,D as z}from"./index-7127aab5.js";import{T as G}from"./Table-03458201.js";import{C as P}from"./Criteria-a056731c.js";import{_ as Q}from"./FormField-43f21bdf.js";import{T as p}from"./alert-993587e2.js";import{_ as J}from"./FormCheckRadioPicker-06e43c39.js";import"./Cow-2328920f.js";import"./cow-ab2463d5.js";import"./Vaccine-13b4809d.js";async function K(a={}){let e="?";return a.status&&(e=e+`status=${a.status}&`),a?e.replace(/&*$/,""):""}class W{async all(e){const r=await K(e);return m.get("/building"+r).then(c=>c)}get(e){return m.get(`/building/${e}`)}create(e){return e.date&&(e.date=v(new Date(e.date)).format("YYYY-MM-DD")),m.post("/building",e)}delete(e){return m.delete(`/building/${e}`)}update(e,r){return r.startDate&&(r.startDate=v(new Date(r.startDate)).format("YYYY-MM-DD")),r.endDate&&(r.endDate=v(new Date(r.endDate)).format("YYYY-MM-DD")),m.put(`/building/${e}`,r)}}const f=new W,C=a=>a==="ddl"?[{id:"",label:"ทั้งหมด"},{id:"A",label:"ใช้งาน"},{id:"I",label:"ไม่ใช้งาน"}]:{A:"ใช้งาน",I:"ไม่ใช้งาน"},X={data(){return{building:{name:"",code:"",date:new Date,status:"A",amount:null,builder:"",remark:""},status:C("ddl"),loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(a){this.$emit("update:modelValue",a)}}},watch:{data(a){a&&this.mode==="edit"&&(this.building=a,this.building.date=new Date(a.date))}},methods:{clear(){this.building={},this.building.date=new Date,this.building.status="A"},confirmCancel(a){this.value=!1,this.$emit(a)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await f.create(this.building)&&(this.loading=!1,this.confirm()):await f.update(this.building._id,this.building)&&(this.loading=!1,this.confirm()),p.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})}catch(a){console.error("Error : ",a),this.loading=!1,this.alert=a.response.data.message,p.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}}},components:{BaseButton:k,BaseButtons:x,CardBox:Y,BaseDivider:F,OverlayLayer:T,FormField:Q,FormControl:L,NotificationBar:N,BaseLevel:U,FormCheckRadioPicker:J,BaseIcon:A},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},Z={class:"grid grid-cols-2 lg:grid-cols-3 gap-5"};function $(a,e,r,c,t,n){const d=i("FormControl"),u=i("FormField"),h=i("NotificationBar"),_=i("BaseDivider"),g=i("BaseButton"),D=i("BaseButtons"),b=i("CardBox"),M=i("OverlayLayer");return y((B(),V(M,null,{default:s(()=>[y(l(b,{title:"สิ่งปลูกสร้าง "+(this.mode==="create"?"":"(แก้ไข)"),class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"",onSubmit:I(n.submit,["prevent"]),onHeaderIconClick:n.cancel},{default:s(()=>[E("div",Z,[l(u,{label:"รหัส",help:"* ห้ามว่าง"},{default:s(()=>[l(d,{modelValue:t.building.code,"onUpdate:modelValue":e[0]||(e[0]=o=>t.building.code=o),icon:"accountEdit",required:""},null,8,["modelValue"])]),_:1}),l(u,{label:"ชื่อ",help:"* ห้ามว่าง"},{default:s(()=>[l(d,{modelValue:t.building.name,"onUpdate:modelValue":e[1]||(e[1]=o=>t.building.name=o),icon:"accountEdit",required:""},null,8,["modelValue"])]),_:1}),l(u,{label:"วันที่สร้าง",help:"* ห้ามว่าง"},{default:s(()=>[l(d,{modelValue:t.building.date,"onUpdate:modelValue":e[2]||(e[2]=o=>t.building.date=o),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),l(u,{label:"ราคา",help:"* ห้ามว่าง"},{default:s(()=>[l(d,{modelValue:t.building.amount,"onUpdate:modelValue":e[3]||(e[3]=o=>t.building.amount=o),type:"number",icon:"cashMultiple",required:""},null,8,["modelValue"])]),_:1}),l(u,{label:"สถานะ"},{default:s(()=>[l(d,{modelValue:t.building.status,"onUpdate:modelValue":e[4]||(e[4]=o=>t.building.status=o),options:t.status},null,8,["modelValue","options"])]),_:1}),l(u,{label:"ผู้ก่อสร้าง"},{default:s(()=>[l(d,{modelValue:t.building.builder,"onUpdate:modelValue":e[5]||(e[5]=o=>t.building.builder=o),icon:"accountHardHat"},null,8,["modelValue"])]),_:1}),l(u,{label:"หมายเหตุ"},{default:s(()=>[l(d,{modelValue:t.building.remark,"onUpdate:modelValue":e[6]||(e[6]=o=>t.building.remark=o),type:"textarea"},null,8,["modelValue"])]),_:1})]),t.alert?(B(),V(h,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:s(()=>[q(O(t.alert),1)]),_:1})):H("",!0),l(_),l(D,{type:"justify-center"},{default:s(()=>[l(g,{label:"บันทึก",color:"success",type:"submit",loading:t.loading},null,8,["loading"]),l(g,{label:"ยกเลิก",color:"danger",onClick:n.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[S,n.value]])]),_:1},512)),[[S,n.value]])}const ee=w(X,[["render",$]]),te={data(){return{openModal:!1,modalData:null,items:[],forms:[{label:"สถานะ",value:"status",options:C("ddl")}],search:{status:""},loading:!1,mode:"create",dataEdit:null,checked:{code:{value:"code"},label:{value:"name"}},datas:[{label:"รหัส",value:"code"},{label:"ชื่อ",value:"name"},{label:"วันที่สร้าง",class:"text-center",value:"date",type:"date"},{label:"ราคา",value:"amount",class:"text-right"},{label:"สถานะ",class:"text-center",func:a=>C()[a.status]},{label:"ผู้ก่อสร้าง",value:"builder"},{label:"หมายเหตุ",value:"remark"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},components:{SectionMain:j,LayoutAuthenticated:R,SectionTitleBarSub:z,Table:G,Modal:ee,Criteria:P},computed:{getDataCopy(){return{...this.modalData}}},created(){this.getDatas()},methods:{async getDatas(a){this.loading=!0;const e=await f.all(a);this.items=[],e.data&&(this.items=e.data.buildings),this.loading=!1},async remove(a){this.loading=!0,(await f.delete(a)).data&&this.getDatas(),this.loading=!1,p.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},async removeSelected(a){this.loading=!0;let e=[];for(let c of a)e.push(c._id);(await f.deletes(e)).data&&(this.getDatas(),p.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})),this.loading=!1},edit(a){this.modalData=a,this.mode="edit",this.openModal=!0},reset(){this.search.status="",this.getDatas()},resetData(){this.modalData=null}}};function ae(a,e,r,c,t,n){const d=i("SectionTitleBarSub"),u=i("Modal"),h=i("Criteria"),_=i("Table"),g=i("SectionMain"),D=i("LayoutAuthenticated");return B(),V(D,null,{default:s(()=>[l(g,null,{default:s(()=>[l(d,{icon:"barn",title:"สิ่งปลูกสร้าง","has-btn-add":"",onOpenModal:e[0]||(e[0]=b=>{t.mode="create",t.openModal=!0}),btnText:"เพิ่มสิ่งปลูกสร้าง"}),l(u,{modelValue:t.openModal,"onUpdate:modelValue":e[1]||(e[1]=b=>t.openModal=b),data:n.getDataCopy,mode:t.mode,onConfirm:n.getDatas,onCancel:n.resetData},null,8,["modelValue","data","mode","onConfirm","onCancel"]),l(h,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:n.getDatas,onReset:n.reset,forms:t.forms,search:t.search,btnLoading:t.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),l(_,{title:"รายการสิ่งปลูกสร้าง","has-checkbox":"","checked-data":t.checked,items:t.items,datas:t.datas,buttons:t.buttons,onEdit:n.edit,onDelete:n.remove,onDeleteSelected:n.removeSelected,loading:t.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const me=w(te,[["render",ae]]);export{me as default};

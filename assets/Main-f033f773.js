import{z as v,P as r,S as _,C as b,D as g,c as y,w as i,E as s,o as S,d as n}from"./index-12b4016e.js";import{T as D}from"./Table-014b1938.js";import{C as x}from"./Criteria-72fb76ed.js";import{P as d}from"./protection-178dcf93.js";import{T as C}from"./alert-8c8566fa.js";import"./FormField-41447fb2.js";import"./FormCheckRadioPicker-daaeed2d.js";import"./Cow-f5825df1.js";import"./cow-a691a502.js";import"./Vaccine-79789b25.js";const T={data(){return{openModal:!1,modalData:null,items:[],forms:[{label:"วัคซีน",value:"vaccine",icon:"needle",type:"ddl",module:"vaccine",valueType:"_id"},{label:"ฉีดวัคซีนล่าสุด",value:"dateCurrent",icon:"calendar",type:"date"},{label:"ฉีดวัคซีนครั้งต่อไป",value:"dateNext",icon:"calendar",type:"date"}],search:{dateCurrent:null,dateNext:null,vaccine:""},loading:!1,mode:"create",dataEdit:null,checked:{label:{value:"vaccine.name"},code:{value:"vaccine.code"}},datas:[{label:"ครั้งที่",value:"seq"},{label:"วัคซีน",value:"vaccine.name"},{label:"จำนวนที่ฉีด (ตัว)",class:"text-center",value:"qty"},{label:"รวมเป็นเงิน (บาท)",class:"text-center",value:"amount"},{label:"วันที่ฉีดวัคซีน",class:"text-center",value:"date",type:"date"},{label:"หมายเหตุ",class:"text-center",value:"remark"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning",condition:t=>{const a=r.groupBy(this.items,"vaccine._id");for(let c of Object.keys(a)){const l=a[c],e=r.orderBy(l,"seq","desc");if(e.length>0&&t._id==e[0]._id)return!0}return!1}}]}},components:{SectionMain:_,LayoutAuthenticated:b,SectionTitleBarSub:g,Table:D,Criteria:x},computed:{user(){return this.$store.state.auth.user},getDataCopy(){return{...this.modalData}}},created(){this.search.vaccine=this.$route.params.vaccine,this.getDatas(this.search)},methods:{async getDatas(t){this.loading=!0;const a=await d.all(t);this.items=[],a.data&&(this.items=a.data.protections),this.loading=!1},async remove(t){this.loading=!0,(await d.delete(t)).data&&this.getDatas(),this.loading=!1,C.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},add(){this.$router.push({name:"protectionDetail",params:{id:"add"}})},edit(t){this.$router.push({name:"protectionDetail",params:{id:t._id}})},reset(){this.search.dateCurrent=null,this.search.dateNext=null,this.search.vaccine=""}}};function k(t,a,c,l,e,o){const u=s("SectionTitleBarSub"),m=s("Criteria"),h=s("Table"),p=s("SectionMain"),f=s("LayoutAuthenticated");return S(),y(f,null,{default:i(()=>[n(p,null,{default:i(()=>[n(u,{icon:"doctor",title:"การป้องกัน/บำรุง","has-btn-add":"",onOpenModal:o.add,btnText:"เพิ่มการป้องกัน/บำรุง"},null,8,["onOpenModal"]),n(m,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:o.getDatas,onReset:o.reset,forms:e.forms,search:e.search},null,8,["onSearch","onReset","forms","search"]),n(h,{title:"รายการป้องกัน/บำรุง","has-checkbox":"","checked-data":e.checked,items:e.items,datas:e.datas,buttons:e.buttons,onEdit:o.edit,onDelete:o.remove,onDeleteSelected:t.removeSelected,loading:e.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const V=v(T,[["render",k]]);export{V as default};

import{c as b,_ as S,d as L}from"./BaseDivider-d71bfeec.js";import{_ as T}from"./LayoutAuthenticated-b15d27dc.js";import{_ as M}from"./SectionTitleBarSub-854c78cc.js";import{T as j}from"./Table-748b264b.js";import{C as V}from"./Criteria-5bd6ec3f.js";import{_ as w}from"./UserAvatar-70af2860.js";import{v as A,_ as H,y as N,x as Y,c as B,w as h,z as n,o as r,d,s as l,F as $,D as I,j as t,t as _,f as O,g as D}from"./index-400adc90.js";import{P as U}from"./protection-9c0c74e5.js";import"./alert-4b9315cd.js";import"./CardBoxModal-05bcb9f4.js";import"./FormControl-773f832f.js";import"./CardBoxCollapse-65410340.js";import"./FormField-39e0ae9c.js";import"./FormCheckRadioPicker-382eab69.js";import"./Cow-7eca16c2.js";import"./cow-949167b7.js";import"./Recipe-ea48d54e.js";import"./Vaccine-99aff13a.js";import"./Corral-0c64611c.js";const z={data(){return{perPage:12,currentPage:0,items:[],forms:[{label:"วัคซีน",value:"vaccine",icon:"needle",type:"ddl",module:"vaccine",valueType:"_id"}],search:{vaccine:null},loading:!1}},components:{SectionMain:b,LayoutAuthenticated:T,SectionTitleBarSub:M,Table:j,Criteria:V,BaseLevel:H,UserAvatar:w,CardBox:S,BaseIcon:L},computed:{itemsPaginated(){return this.items?this.items.slice(this.perPage*this.currentPage,this.perPage*(this.currentPage+1)):[]},numPages(){return Math.ceil((this.items?this.items.length:0)/this.perPage)},currentPageHuman(){return this.currentPage+1},pagesList(){const e=[];for(let o=0;o<this.numPages;o++)e.push(o);return e}},created(){this.getDatas()},methods:{async getDatas(e){this.loading=!0;const o=await U.all(e);if(this.items=[],o.data){const y=o.data.protections,g=N.groupBy(y,"vaccine._id"),i=new Date().setUTCHours(0,0,0,0);for(let s of Object.keys(g)){const c=g[s];let m=null,u=0;for(let p of c){const f=new Date(p.date).setUTCHours(0,0,0,0);i>=f&&(m+=p.amount,u++)}this.items.push({vaccine:c[0].vaccine,amount:m,count:u,protections:c})}}this.loading=!1},add(){this.$router.push({name:"protectionDetail",params:{id:"add"}})},history(e){this.$router.push({name:"protectionHistory",params:{vaccine:e.vaccine._id}})},formatDate(e){return e?Y(e).format("DD/MM/YYYY"):null},reset(){this.search.vaccine=null,this.getDatas()}}},F={key:0,class:"grid lg:gap-3 md:gap-2 gap-1 grid-cols-1 lg:grid-cols-4 md:grid-cols-3"},R={class:"bg-gray-600 rounded-md lg:text-base text-md p-2 flex justify-center"},E={class:"mt-2 h-18 mb-1"},q={key:0,class:"dark:text-gray-400 grid grid-cols-2"},G=t("div",null," จำนวนรวม ",-1),J={class:"flex justify-end"},K={class:"dark:text-gray-100 mr-1"},Q={key:1,class:"dark:text-gray-400 grid grid-cols-2"},W=t("div",null," ราคารวม ",-1),X={class:"flex justify-end"},Z={class:"underline decoration-2 dark:text-gray-100 mr-1"},tt={class:"dark:text-gray-400 grid grid-cols-3"},et=t("div",null," ล่าสุด ",-1),st={class:"flex justify-end col-span-2"},at={class:"dark:text-gray-100 mr-1"},ot={class:"dark:text-gray-400 grid grid-cols-3"},nt=t("div",null," ต่อไป ",-1),rt={class:"flex justify-end col-span-2"},it={class:"dark:text-gray-100 mr-1"},ct={key:1,class:"text-center py-10 text-gray-500 dark:text-gray-400"},dt=t("p",null," กำลังโหลดข้อมูล...",-1);function lt(e,o,y,g,i,s){const c=n("SectionTitleBarSub"),m=n("Criteria"),u=n("BaseLevel"),p=n("CardBox"),f=n("BaseIcon"),C=n("SectionMain"),P=n("LayoutAuthenticated");return r(),B(P,null,{default:h(()=>[d(C,null,{default:h(()=>[d(c,{icon:"needle",title:"ฉีดวัคซีน","has-btn-add":"",onOpenModal:s.add,btnText:"เพิ่มการฉีดวัคซีน"},null,8,["onOpenModal"]),d(m,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:s.getDatas,onReset:s.reset,forms:i.forms,search:i.search,btnLoading:i.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),i.loading?(r(),l("div",ct,[d(f,{path:"dotsCircle",size:"22",class:"animate-spin"}),dt])):(r(),l("div",F,[(r(!0),l($,null,I(s.itemsPaginated,a=>(r(),B(p,{key:a.name,onClick:v=>s.history(a),hoverable:""},{default:h(()=>{var v,x;return[d(u,{type:"justify-center mt-1"},{default:h(()=>{var k;return[t("div",R,_((k=a.vaccine)==null?void 0:k.name),1)]}),_:2},1024),t("div",E,[a.count?(r(),l("div",q,[G,t("div",J,[t("div",K,_(a.count),1),O(" ครั้ง ")])])):D("",!0),a.amount?(r(),l("p",Q,[W,t("div",X,[t("div",Z,_(e.$filters.currency(a.amount)),1)])])):D("",!0),t("p",tt,[et,t("div",st,[t("div",at,_(s.formatDate((v=a.vaccine)==null?void 0:v.currentDate)),1)])]),t("p",ot,[nt,t("div",rt,[t("div",it,_(s.formatDate((x=a.vaccine)==null?void 0:x.nextDate)),1)])])])]}),_:2},1032,["onClick"]))),128))]))]),_:1})]),_:1})}const Mt=A(z,[["render",lt]]);export{Mt as default};

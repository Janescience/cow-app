import{b as U,_ as O,a as Y,d as q,c as R}from"./BaseDivider-3bd10d7c.js";import{_ as E}from"./LayoutAuthenticated-26010161.js";import{_ as P}from"./SectionTitleBarSub-190378a7.js";import{T as H}from"./Table-fbdb84bf.js";import{C as I}from"./Criteria-117f2e94.js";import{v as M,L as D,x as z,h as G,_ as J,z as n,G as S,H as A,o as c,c as u,w as i,d as r,j as h,t as m,g as d,f as F,e as K}from"./index-c9555507.js";import{a as Q}from"./CardBoxModal-af2232b7.js";import{_ as W}from"./FormField-367a34f1.js";import{_ as X}from"./FormControl-9960a6f0.js";import{_ as Z}from"./NotificationBar-f2db1bd0.js";import{D as j}from"./Cow-180ca56b.js";import{g as y}from"./age-calculate-3b5fe841.js";import{T as x}from"./alert-b2181f36.js";import{B,s as $,o as ee}from"./birth-fd93ab29.js";import{_ as te}from"./FormCheckRadioPicker-03a16da5.js";import"./UserAvatar-d47e699f.js";import"./CardBoxCollapse-79f0452c.js";import"./Recipe-c53ee350.js";import"./Vaccine-8e495eea.js";import"./cow-8f324bef.js";const ae={data(){return{birth:{sex:"",overgrown:"",birthDate:new Date,drugDate:D(new Date,15),washDate:D(new Date,29),calf:{name:""},status:"",reproduction:"",gestAge:null},show:{cow:null,seq:""},loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},user(){return this.$store.state.auth.user}},watch:{data:{handler(t,a){t&&(this.birth=t,this.birth.calf||(this.birth.calf={}),this.birth.birthDate=new Date(t.birthDate),this.birth.drugDate=t.drugDate?new Date(t.drugDate):null,this.birth.washDate=t.washDate?new Date(t.washDate):null)}},"birth.birthDate"(t){this.birth.status=="B"&&(this.birth.drugDate=D(t,15))},"birth.drugDate"(t){this.birth.status=="B"&&(this.birth.washDate=D(t,14))}},methods:{clear(){this.birth={}},confirmCancel(t){this.value=!1,this.$emit(t),this.$emit("update:data",null)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){var t;this.loading=!0,this.alert="";try{this.birth.gestAge=y((t=this.birth)==null?void 0:t.pregnantDate,this.birth.birthDate).ageNumber,this.birth.overgrown==="N"&&(this.birth.drugDate=null,this.birth.washDate=null),this.birth.status=="P"&&(this.birth.sex="",this.birth.drugDate=null,this.birth.washDate=null),await B.create(this.birth._id,this.birth)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm"),x.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"}))}catch(a){console.error("Error : ",a),this.loading=!1,x.fire({icon:"error",title:a.response.data.err.message})}},calAge(t,a){return y(t,a).ageString},formatDate(t){return z(t).format("DD/MM/YYYY")}},components:{BaseButton:U,BaseButtons:G,CardBox:O,BaseDivider:Y,OverlayLayer:Q,FormField:W,FormControl:X,NotificationBar:Z,BaseLevel:J,DDLCow:j,FormCheckRadioPicker:te,BaseIcon:q},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},le={class:"grid grid-cols-2 lg:grid-cols-5 gap-5 bg-gray-600 rounded p-2 text-center"},re={class:"text-gray-300"},ie={class:"text-gray-300"},se={class:"text-gray-300"},oe={class:"text-gray-300"},ne={class:"text-gray-300"},ce={class:"grid grid-cols-2 lg:grid-cols-4 gap-5"},ue=["href"];function de(t,a,p,L,e,o){const s=n("FormField"),g=n("BaseDivider"),f=n("FormCheckRadioPicker"),b=n("FormControl"),w=n("NotificationBar"),_=n("BaseButton"),v=n("BaseButtons"),N=n("CardBox"),T=n("OverlayLayer");return S((c(),u(T,null,{default:i(()=>[S(r(N,{title:"บันทึกการติดตามโคท้อง/คลอดลูก",class:"shadow-lg w-full lg:w-3/5 z-50","header-icon":"close",modal:"",form:"",onSubmit:K(o.submit,["prevent"]),onHeaderIconClick:o.cancel},{default:i(()=>{var V,k;return[h("div",le,[r(s,{label:"รหัสโค",class:"text-black"},{default:i(()=>{var l;return[h("div",re,m((l=e.birth.cow)==null?void 0:l.code),1)]}),_:1}),r(s,{label:"ชื่อโค",class:"text-black"},{default:i(()=>{var l;return[h("div",ie,m((l=e.birth.cow)==null?void 0:l.name),1)]}),_:1}),r(s,{label:"ครั้งที่",class:"text-black"},{default:i(()=>{var l,C;return[h("div",se,m((C=(l=e.birth)==null?void 0:l.reproduction)==null?void 0:C.seq),1)]}),_:1}),r(s,{label:"วันที่ตั้งครรภ์",class:"text-black"},{default:i(()=>{var l;return[h("div",oe,m(o.formatDate((l=e.birth)==null?void 0:l.pregnantDate)),1)]}),_:1}),r(s,{label:"อายุครรภ์",class:"text-black",help:"วันที่ตั้งครรภ์-ปัจจุบัน"},{default:i(()=>{var l;return[h("div",ne,m(o.calAge((l=e.birth)==null?void 0:l.pregnantDate,new Date)),1)]}),_:1})]),r(g),h("div",ce,[r(s,{label:"ผลการตั้งครรภ์"},{default:i(()=>[r(f,{modelValue:e.birth.status,"onUpdate:modelValue":a[0]||(a[0]=l=>e.birth.status=l),type:"radio",options:{B:"คลอด",A:"แท้ง"}},null,8,["modelValue"])]),_:1}),e.birth.status==="B"||e.birth.status==="A"?(c(),u(s,{key:0,label:"วันที่"+(e.birth.status==="B"?"คลอด":"แท้ง"),help:"Default อายุครรภ์ 9.15 เดือน"},{default:i(()=>[r(b,{modelValue:e.birth.birthDate,"onUpdate:modelValue":a[1]||(a[1]=l=>e.birth.birthDate=l),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1},8,["label"])):d("",!0),e.birth.status==="B"||e.birth.status==="A"?(c(),u(s,{key:1,label:"อายุครรภ์",help:"วันที่ตั้งครรภ์-วันที่คลอด"},{default:i(()=>{var l;return[F(m(o.calAge((l=e.birth)==null?void 0:l.pregnantDate,e.birth.birthDate)),1)]}),_:1})):d("",!0),e.birth.status==="B"||e.birth.status==="A"?(c(),u(s,{key:2,label:"เพศ",help:"* ห้ามว่าง"},{default:i(()=>[r(f,{modelValue:e.birth.sex,"onUpdate:modelValue":a[2]||(a[2]=l=>e.birth.sex=l),type:"radio",options:{M:"ตัวผู้",F:"ตัวเมีย"}},null,8,["modelValue"])]),_:1})):d("",!0),(e.birth.status=="B"||e.birth.status==="A")&&e.birth.sex=="F"&&!((V=e.birth.calf)!=null&&V._id)?(c(),u(s,{key:3,label:"ชื่อลูก",help:"* ห้ามว่าง"},{default:i(()=>[r(b,{modelValue:e.birth.calf.name,"onUpdate:modelValue":a[3]||(a[3]=l=>e.birth.calf.name=l),icon:"babyFaceOutline",required:""},null,8,["modelValue"])]),_:1})):(e.birth.status=="B"||e.birth.status==="A")&&e.birth.sex=="F"&&((k=e.birth.calf)!=null&&k._id)?(c(),u(s,{key:4,label:"ลูก"},{default:i(()=>[h("a",{href:"/manage/cow/detail/"+e.birth.calf._id,class:"underline"},m(e.birth.calf.code+" : "+e.birth.calf.name),9,ue)]),_:1})):d("",!0),e.birth.status=="B"||e.birth.status==="A"?(c(),u(s,{key:5,label:"รก",help:"* ห้ามว่าง"},{default:i(()=>[r(f,{modelValue:e.birth.overgrown,"onUpdate:modelValue":a[4]||(a[4]=l=>e.birth.overgrown=l),type:"radio",options:{Y:"ค้าง",N:"ไม่ค้าง"}},null,8,["modelValue"])]),_:1})):d("",!0),e.birth.overgrown==="Y"?(c(),u(s,{key:6,label:"วันที่ใช้ยาขับ",help:"* ห้ามว่าง (วันที่คลอด + 15 วัน)"},{default:i(()=>[r(b,{modelValue:e.birth.drugDate,"onUpdate:modelValue":a[5]||(a[5]=l=>e.birth.drugDate=l),icon:"calendar",type:"date","lower-limit":e.birth.date},null,8,["modelValue","lower-limit"])]),_:1})):d("",!0),e.birth.overgrown==="Y"?(c(),u(s,{key:7,label:"วันที่ล้างมดลูก",help:"* ห้ามว่าง (วันที่ใช้ยาขับ + 14 วัน)"},{default:i(()=>[r(b,{modelValue:e.birth.washDate,"onUpdate:modelValue":a[6]||(a[6]=l=>e.birth.washDate=l),icon:"calendar",type:"date","lower-limit":e.birth.drugDate},null,8,["modelValue","lower-limit"])]),_:1})):d("",!0),e.birth.status==="A"?(c(),u(s,{key:8,label:"สาเหตุ"},{default:i(()=>[r(b,{modelValue:e.birth.reason,"onUpdate:modelValue":a[7]||(a[7]=l=>e.birth.reason=l),type:"textarea"},null,8,["modelValue"])]),_:1})):d("",!0)]),e.alert?(c(),u(w,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:i(()=>[F(m(e.alert),1)]),_:1})):d("",!0),r(g),r(v,{type:"justify-center"},{default:i(()=>[r(_,{label:"บันทึก",color:"success",type:"submit",loading:e.loading},null,8,["loading"]),r(_,{label:"ยกเลิก",color:"danger",onClick:o.cancel},null,8,["onClick"])]),_:1})]}),_:1},8,["onSubmit","onHeaderIconClick"]),[[A,o.value]])]),_:1},512)),[[A,o.value]])}const he=M(ae,[["render",de]]),me={data(){return{openModal:!1,modalData:null,items:[],forms:[{label:"โค",value:"cow",type:"ddl",module:"cow"},{label:"เพศ",value:"sex",options:[{id:"",label:"ทั้งหมด"},{id:"M",label:"ตัวผู้"},{id:"F",label:"ตัวเมีย"}]},{label:"วันที่ตั้งครรภ์",value:"pregnantDate",icon:"calendar",type:"date"},{label:"วันที่คลอด",value:"birthDate",icon:"calendar",type:"date"}],search:{cow:null,birthDate:null,pregnantDate:null,sex:""},loading:!1,mode:"create",dataEdit:null,checked:{code:{value:"seq"},label:{value:"cow.name"}},datas:[{label:"ครั้งที่",value:"seq",class:"text-center"},{label:"รหัสโค",value:"cow.code"},{label:"ชื่อโค",value:"cow.name"},{label:"วันที่ตั้งครรภ์",class:"text-center",value:"pregnantDate",type:"date"},{label:"อายุครรภ์",func:t=>t!=null&&t.sex?y(t==null?void 0:t.pregnantDate,t==null?void 0:t.birthDate).ageString:this.calAge(t==null?void 0:t.pregnantDate)},{label:"วันที่คลอด",class:"text-center",value:"birthDate",type:"date"},{label:"เพศ",class:"text-center",func:t=>$()[t.sex]},{label:"ลูกวัว",class:"text-center",func:t=>{var a,p;return t.calf?((a=t.calf)==null?void 0:a.code)+" : "+((p=t.calf)==null?void 0:p.name):""}},{label:"รกค้าง",class:"text-center",func:t=>ee()[t.overgrown]},{label:"วันที่ใช้ยาขับ",class:"text-center",value:"drugDate",type:"date"},{label:"วันที่ล้างมดลูก",class:"text-center",value:"washDate",type:"date"}],buttons:[{label:"ลบ",type:"delete",color:"danger",condition:t=>!t.sex},{label:"แก้ไข",type:"edit",color:"warning",condition:t=>t.birthDate},{label:"บันทึกการคลอดลูก",color:"info",type:"oth",func:t=>{this.mode="create",this.openModal=!0,this.modalData=t},condition:t=>!t.birthDate}]}},components:{SectionMain:R,LayoutAuthenticated:E,SectionTitleBarSub:P,Table:H,Modal:he,Criteria:I},computed:{getDataCopy(){return{...this.modalData}}},created(){this.getDatas()},methods:{async getDatas(t){this.loading=!0;const a=await B.all(t);this.items=[],a.data&&(this.items=a.data.births),this.loading=!1},async remove(t){this.loading=!0,(await B.delete(t)).data&&(this.getDatas(),x.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})),this.loading=!1},edit(t){this.modalData=t,this.mode="edit",this.openModal=!0},resetData(){this.modalData=null},reset(){this.search.cow=null,this.search.birthDate=null,this.search.pregnantDate=null,this.search.sex="",this.getDatas()},calAge(t){return y(t).ageString}}};function be(t,a,p,L,e,o){const s=n("SectionTitleBarSub"),g=n("Modal"),f=n("Criteria"),b=n("Table"),w=n("SectionMain"),_=n("LayoutAuthenticated");return c(),u(_,null,{default:i(()=>[r(w,null,{default:i(()=>[r(s,{icon:"babyFaceOutline",title:"การติดตามโคท้อง/คลอดลูก"}),r(g,{modelValue:e.openModal,"onUpdate:modelValue":a[0]||(a[0]=v=>e.openModal=v),data:o.getDataCopy,mode:e.mode,onConfirm:o.getDatas,onCancel:o.resetData},null,8,["modelValue","data","mode","onConfirm","onCancel"]),r(f,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:o.getDatas,onReset:o.reset,forms:e.forms,search:e.search,btnLoading:e.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),r(b,{title:"รายการคลอดลูก","has-checkbox":"","checked-data":e.checked,items:e.items,datas:e.datas,buttons:e.buttons,onEdit:o.edit,onDelete:o.remove,onDeleteSelected:t.removeSelected,loading:e.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const Ue=M(me,[["render",be]]);export{Ue as default};

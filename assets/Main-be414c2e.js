import{z as S,P as M,p as F,m as T,_ as N,l as j,F as q,i as O,j as R,f as A,N as E,E as l,G as D,H as w,o as y,c as v,w as n,d as t,s as c,h as r,t as _,k as U,e as H,S as I,C as z,D as P}from"./index-ff66dafa.js";import{T as G}from"./Table-a22ed9d6.js";import{D as J,C as K}from"./Criteria-056e0bef.js";import{_ as Q}from"./FormField-b6dd63cf.js";import{T as B}from"./alert-6b368e3f.js";import{F as h}from"./food-28f10bbc.js";import{C as W}from"./cow-880beca0.js";import{_ as X}from"./FormCheckRadioPicker-d20cd780.js";import"./Cow-70104812.js";import"./Vaccine-b2ea6c36.js";const Y={data(){return{food:{corral:"",recipe:{},qty:0,amount:0,amountAvg:0,numCow:0},loading:!1,alert:"",ddlCorral:[],numCowCorral:0,corrals:[]}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(o){this.$emit("update:modelValue",o)}},user(){return this.$store.state.auth.user}},watch:{data(o){o&&(this.food=o)},"food.recipe"(o){o?this.food.amount=o.amount:this.food.amount=null},"food.corral"(o){o&&(this.numCowCorral=this.corrals[o].length)}},created(){this.getCorrals()},methods:{clear(){this.food={}},confirmCancel(o){this.value=!1,this.$emit(o)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await h.create(this.food)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")):await h.update(this.food._id,this.food)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")),B.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})}catch(o){console.error("Error : ",o),this.clear(),this.loading=!1,this.alert=await o.response.data.message,B.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}},async getCorrals(){const o=await W.all();if(o){const a=o.data.cows;this.corrals=M.groupBy(a,"corral");for(let f of Object.keys(this.corrals))this.ddlCorral.push({id:f,label:f})}}},components:{BaseButton:F,BaseButtons:T,CardBox:N,BaseDivider:j,OverlayLayer:q,FormField:Q,FormControl:O,NotificationBar:R,BaseLevel:A,DDLRecipe:J,FormCheckRadioPicker:X,BaseIcon:E},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},Z={class:"grid lg:grid-cols-3 grid-cols-2 gap-5"},$={class:"text-red-700 font-bold p-2"},ee=c("br",null,null,-1),oe={class:"text-red-700 font-bold p-2"},te=c("br",null,null,-1),ae={class:"text-red-700 font-bold p-2"};function le(o,a,f,V,e,s){const g=l("DDLRecipe"),i=l("FormField"),p=l("FormControl"),d=l("BaseLevel"),b=l("NotificationBar"),C=l("BaseDivider"),u=l("BaseButton"),k=l("BaseButtons"),x=l("CardBox"),L=l("OverlayLayer");return D((y(),v(L,null,{default:n(()=>[D(t(x,{title:(this.mode==="create"?"บันทึก":"แก้ไข")+"การให้อาหาร",class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"",onSubmit:H(s.submit,["prevent"]),onHeaderIconClick:s.cancel},{default:n(()=>[c("div",Z,[t(i,{label:"สูตรอาหาร",help:"* ห้ามว่าง",class:"lg:col-span-1 col-span-2"},{default:n(()=>[t(g,{modelValue:e.food.recipe,"onUpdate:modelValue":a[0]||(a[0]=m=>e.food.recipe=m),valueType:"object"},null,8,["modelValue"])]),_:1}),t(i,{label:"คอก",help:"* ห้ามว่าง"},{default:n(()=>[t(p,{modelValue:e.food.corral,"onUpdate:modelValue":a[1]||(a[1]=m=>e.food.corral=m),options:e.ddlCorral,required:""},null,8,["modelValue","options"])]),_:1}),t(i,{label:"จำนวนที่ให้/วัน (กก.)",help:"* ห้ามว่าง"},{default:n(()=>[t(p,{modelValue:e.food.qty,"onUpdate:modelValue":a[2]||(a[2]=m=>e.food.qty=m),icon:"shaker",type:"number",required:""},null,8,["modelValue"])]),_:1}),t(i,{class:"lg:col-span-3 col-span-2"},{default:n(()=>[t(d,{type:"justify-end"},{default:n(()=>[r(" ราคาสูตรอาหาร/กก. "),c("p",$,_(e.food.amount>0?e.food.amount:"-"),1),r(" บาท "),ee]),_:1}),t(d,{type:"justify-end"},{default:n(()=>[r(" จำนวนโค "),c("p",oe,_(e.numCowCorral>0?e.numCowCorral:"-"),1),r(" ตัว "),te]),_:1}),t(d,{type:"justify-end"},{default:n(()=>[r(" รวมเป็นเงิน/วัน "),c("p",ae,_(e.food.qty&&e.food.amount>0?e.food.qty*e.food.amount:"-"),1),r(" บาท ")]),_:1})]),_:1})]),e.alert?(y(),v(b,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:n(()=>[r(_(e.alert),1)]),_:1})):U("",!0),t(C),t(k,{type:"justify-center"},{default:n(()=>[t(u,{label:"บันทึก",color:"success",type:"submit",loading:e.loading},null,8,["loading"]),t(u,{label:"ยกเลิก",color:"danger",onClick:s.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[w,s.value]])]),_:1},512)),[[w,s.value]])}const se=S(Y,[["render",le]]),ne={data(){return{openModal:!1,modalData:null,items:[],forms:[{label:"สูตรอาหาร",value:"recipe",type:"ddl",module:"recipe"},{label:"คอก",value:"corral",icon:"barn",type:"number"}],search:{recipe:{},corral:""},loading:!1,mode:"create",dataEdit:null,checked:{code:{value:"corral"},label:{value:"recipe.name"}},datas:[{label:"คอก",class:"text-center",value:"corral"},{label:"จำนวนวัว",class:"text-center",value:"numCow"},{label:"สูตรอาหาร",class:"text-center",value:"recipe.name"},{label:"จำนวนที่ให้/วัน (กก.)",class:"text-center",value:"qty"},{label:"รวมเป็นเงิน/วัน",class:"text-center",value:"amount"},{label:"คิดเป็นเงิน/ตัว",class:"text-center",value:"amountAvg"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},components:{SectionMain:I,LayoutAuthenticated:z,SectionTitleBarSub:P,Table:G,Modal:se,Criteria:K},computed:{getDataCopy(){return{...this.modalData}}},created(){this.getDatas()},methods:{async getDatas(o){this.loading=!0;const a=await h.all(o);this.items=[],a.data&&(this.items=a.data.foods),this.loading=!1},async remove(o){this.loading=!0,(await h.delete(o)).data&&this.getDatas(),this.loading=!1,B.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},edit(o){this.modalData=o,this.mode="edit",this.openModal=!0},reset(){this.search.recipe=null,this.search.corral="",this.getDatas()},resetData(){this.modalData=null}}};function re(o,a,f,V,e,s){const g=l("SectionTitleBarSub"),i=l("Modal"),p=l("Criteria"),d=l("Table"),b=l("SectionMain"),C=l("LayoutAuthenticated");return y(),v(C,null,{default:n(()=>[t(b,null,{default:n(()=>[t(g,{icon:"foodDrumstickOutline",title:"การให้อาหาร","has-btn-add":"",onOpenModal:a[0]||(a[0]=u=>{e.mode="create",e.openModal=!0}),btnText:"เพิ่มการให้อาหาร"}),t(i,{modelValue:e.openModal,"onUpdate:modelValue":a[1]||(a[1]=u=>e.openModal=u),data:s.getDataCopy,mode:e.mode,onConfirm:s.getDatas,onCancel:s.resetData},null,8,["modelValue","data","mode","onConfirm","onCancel"]),t(p,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:s.getDatas,onReset:s.reset,forms:e.forms,search:e.search,btnLoading:e.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),t(d,{title:"รายการให้อาหาร","has-checkbox":"","checked-data":e.checked,items:e.items,datas:e.datas,buttons:e.buttons,onEdit:s.edit,onDelete:s.remove,onDeleteSelected:o.removeSelected,loading:e.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const be=S(ne,[["render",re]]);export{be as default};

import{z as k,Q,p as M,m as q,_ as L,l as x,G as H,i as T,j as Y,f as O,O as N,T as j,F as r,H as B,I as V,o as b,c as D,w as a,d as l,s as f,h as i,t as h,k as F,e as z,C as G,D as J,E as K}from"./index-90205c12.js";import{_ as R}from"./FormField-c24cbbb9.js";import{D as W,C as X}from"./Criteria-9236797b.js";import{T as S}from"./alert-5e760029.js";import{F as v}from"./food-d2c20864.js";import{C as Z}from"./cow-e2242f0c.js";import{m as U,y as A}from"./date-66c7a2ce.js";import{_ as $}from"./FormCheckRadioPicker-d3739a39.js";import"./CardBoxCollapse-e5f1ee89.js";import"./Cow-bcbf7bfb.js";import"./Vaccine-a7efa8d3.js";const ee={data(){return{food:{corral:"",numCow:0,year:new Date().getFullYear(),month:new Date().getMonth()+1},foodDetail:{recipe:{},qty:null},foodDetails:[],loading:!1,alert:"",ddlCorral:[],numCowCorral:null,corrals:[],months:U(),years:A(),foodDetailColumns:[{label:"สูตรอาหาร",value:"recipe.name"},{label:"ราคา/กก.",value:"recipe.amount",type:"currency"},{label:"จำนวนที่ให้/วัน (กก.)",value:"qty",type:"number"},{label:"รวมเป็นเงิน/วัน",value:"amount",type:"currency"}],buttons:[{label:"ลบ",type:"delete",color:"danger"}]}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},watch:{data(e){this.food=e,this.food.year=e!=null&&e.year?e.year:new Date().getFullYear(),this.food.month=e!=null&&e.month?e.month:new Date().getMonth()+1,this.foodDetails=e!=null&&e.foodDetails?e.foodDetails:[];for(let t of this.foodDetails)t.recipe=t.relate},"food.corral"(e){e&&(this.numCowCorral=this.corrals[e].length>0?this.corrals[e].length:null)}},created(){this.getCorrals()},methods:{clear(){this.food={},this.foodDetails=[]},confirmCancel(e){this.value=!1,this.$emit(e)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},add(){const e=this.foodDetail.recipe,t=this.foodDetail.qty,n=t*e.amount;this.foodDetails.push({recipe:e,qty:t,amount:n}),this.foodDetail={}},sum(){const e=this.foodDetails.reduce((u,o)=>u+o.amount,0),t=this.foodDetails.reduce((u,o)=>u+o.qty,0),n=e/(this.numCowCorral?this.numCowCorral:0);return{qty:t,amount:e,perCow:n}},daysOfMonth(){return new Date(this.food.year,this.food.month,0).getDate()},remove(e){let t=this.cows.indexOf(e);t!==-1&&this.foodDetails.splice(t,1)},async submit(){this.loading=!0,this.alert="",this.food.foodDetails=this.foodDetails,this.food.numCow=this.numCowCorral;try{this.mode==="create"?await v.create(this.food)&&(this.loading=!1,this.confirm()):await v.update(this.food._id,this.food)&&(this.loading=!1,this.confirm()),S.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})}catch(e){console.error("Error : ",e),this.clear(),this.loading=!1,this.alert=await e.response.data.message,S.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}},async getCorrals(){const e=await Z.all();if(e){const t=e.data.cows;this.corrals=Q.groupBy(t,"corral");for(let n of Object.keys(this.corrals))this.ddlCorral.push({id:n,label:n})}}},components:{BaseButton:M,BaseButtons:q,CardBox:L,BaseDivider:x,OverlayLayer:H,FormField:R,FormControl:T,NotificationBar:Y,BaseLevel:O,DDLRecipe:W,FormCheckRadioPicker:$,BaseIcon:N,Table:j},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},oe={class:"grid lg:grid-cols-3 grid-cols-2 gap-5"},te={class:"grid lg:grid-cols-3 grid-cols-2 gap-5"},le={class:"grid grid-cols-3 gap-5"},ae={class:"text-red-700 font-bold"},se={class:"text-red-700 font-bold"},ne={class:"text-red-700 font-bold"},re={class:"text-red-700 font-bold"},ie={class:"text-red-700 font-bold"},de={class:"text-red-700 font-bold"};function ce(e,t,n,u,o,s){const p=r("FormControl"),c=r("FormField"),g=r("DDLRecipe"),_=r("BaseButton"),y=r("BaseButtons"),C=r("Table"),m=r("BaseLevel"),w=r("CardBox"),I=r("NotificationBar"),E=r("BaseDivider"),P=r("OverlayLayer");return B((b(),D(P,null,{default:a(()=>[B(l(w,{title:(this.mode==="create"?"บันทึก":"แก้ไข")+"การให้อาหาร",class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"",onSubmit:z(s.submit,["prevent"]),onHeaderIconClick:s.cancel},{default:a(()=>[f("div",oe,[l(c,{label:"ปี พ.ศ.",help:"* ห้ามว่าง"},{default:a(()=>[l(p,{modelValue:o.food.year,"onUpdate:modelValue":t[0]||(t[0]=d=>o.food.year=d),options:o.years},null,8,["modelValue","options"])]),_:1}),l(c,{label:"เดือน",help:"* ห้ามว่าง"},{default:a(()=>[l(p,{modelValue:o.food.month,"onUpdate:modelValue":t[1]||(t[1]=d=>o.food.month=d),options:o.months},null,8,["modelValue","options"])]),_:1}),l(c,{label:"คอก",help:"* ห้ามว่าง"},{default:a(()=>[l(p,{modelValue:o.food.corral,"onUpdate:modelValue":t[2]||(t[2]=d=>o.food.corral=d),options:o.ddlCorral,required:"",disabled:n.mode==="edit"},null,8,["modelValue","options","disabled"])]),_:1})]),o.food.corral?(b(),D(w,{key:0,title:"รายละเอียดสูตรอาหาร","header-icon":"",class:"dark:bg-slate-700"},{default:a(()=>[f("div",te,[l(c,{label:"สูตรอาหาร",help:"* ห้ามว่าง",class:"lg:col-span-1 col-span-2"},{default:a(()=>[l(g,{modelValue:o.foodDetail.recipe,"onUpdate:modelValue":t[3]||(t[3]=d=>o.foodDetail.recipe=d),valueType:"object"},null,8,["modelValue"])]),_:1}),l(c,{label:"จำนวนที่ให้/วัน (กก.)",help:"* ห้ามว่าง"},{default:a(()=>[l(p,{modelValue:o.foodDetail.qty,"onUpdate:modelValue":t[4]||(t[4]=d=>o.foodDetail.qty=d),icon:"shaker",type:"number"},null,8,["modelValue"])]),_:1}),l(y,{type:"justify-start"},{default:a(()=>[l(_,{label:"ล้าง",color:"danger",onClick:t[5]||(t[5]=d=>e.reset())}),l(_,{disabled:!o.foodDetail.recipe||!o.foodDetail.qty,label:"เพิ่ม",color:"info",onClick:t[6]||(t[6]=d=>s.add())},null,8,["disabled"])]),_:1})]),l(C,{title:"รายการสูตรอาหาร ("+o.foodDetails.length+" รายการ)",items:o.foodDetails,datas:o.foodDetailColumns,buttons:o.buttons,perPage:"5",onDelete:s.remove},null,8,["title","items","datas","buttons","onDelete"]),f("div",le,[l(c,null,{default:a(()=>[l(m,null,{default:a(()=>[i(" จำนวนโค "),f("p",ae,h(o.numCowCorral>0&&o.numCowCorral?o.numCowCorral:"-"),1),i(" ตัว ")]),_:1}),l(m,null,{default:a(()=>[i(" คิดเป็นเงิน/ตัว "),f("p",se,h(e.$filters.currency(s.sum().perCow)),1),i(" บาท ")]),_:1})]),_:1}),l(c,null,{default:a(()=>[l(m,null,{default:a(()=>[i(" รวมจำนวนที่ให้/วัน "),f("p",ne,h(e.$filters.number(s.sum().qty)),1),i(" กก. ")]),_:1}),l(m,null,{default:a(()=>[i(" รวมเป็นเงิน/วัน "),f("p",re,h(e.$filters.currency(s.sum().amount)),1),i(" บาท ")]),_:1})]),_:1}),l(c,null,{default:a(()=>[l(m,null,{default:a(()=>[i(" รวมจำนวนที่ให้/เดือน "),f("p",ie,h(e.$filters.number(s.sum().qty)),1),i(" กก. ")]),_:1}),l(m,null,{default:a(()=>[i(" รวมเป็นเงิน/เดือน "),f("p",de,h(e.$filters.currency(s.sum().amount)),1),i(" บาท ")]),_:1})]),_:1})])]),_:1})):F("",!0),o.alert?(b(),D(I,{key:1,color:"danger",outline:"",icon:"alertCircleOutline"},{default:a(()=>[i(h(o.alert),1)]),_:1})):F("",!0),l(E),l(y,{type:"justify-center"},{default:a(()=>[l(_,{label:"บันทึก",color:"success",type:"submit",disabled:o.foodDetails.length===0,loading:o.loading},null,8,["disabled","loading"]),l(_,{label:"ยกเลิก",color:"danger",onClick:s.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[V,s.value]])]),_:1},512)),[[V,s.value]])}const ue=k(ee,[["render",ce]]),me={data(){return{mode:"create",modalData:null,openModal:!1,foods:[],loading:!1,corral:null,search:{corral:this.$route.params.corral,year:new Date().getFullYear(),month:new Date().getMonth()+1},forms:[{label:"ปี",value:"year",type:"ddl",module:"year"},{label:"เดือน",value:"month",type:"ddl",module:"month"}],foodColumns:[{label:"ปี พ.ศ.",value:"year",func:e=>A()[e.year]},{label:"เดือน",value:"month",func:e=>U()[e.month-1].label},{label:"จำนวนวัว",value:"numCow"},{label:"จำนวนสูตร",func:e=>e.foodDetails.length},{label:"รวมจำนวนที่ให้/วัน (กก.)",func:e=>e.foodDetails.reduce((t,n)=>t+n.qty,0)},{label:"รวมเป็นเงิน/วัน",func:e=>this.$filters.currency(e.foodDetails.reduce((t,n)=>t+n.amount,0))}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},getDataCopy(){return{...this.modalData}}},watch:{data(e){this.foods=e==null?void 0:e.foods,this.corral=e.corral}},created(){this.getDatas()},methods:{async getDatas(){this.loading=!0;const e=await v.all(this.search);e.data&&(this.foods=e.data.foods),this.loading=!1},confirmCancel(e){this.value=!1,this.$emit(e)},cancel(){this.confirmCancel("cancel")},add(){},sum(){const e=this.foods.reduce((n,u)=>n+u.amount,0);return{qty:this.foods.reduce((n,u)=>n+u.qty,0),amount:e}},edit(e){this.modalData=e,this.mode="edit",this.openModal=!0},daysOfMonth(){},resetData(){this.modalData=null},remove(e){let t=this.cows.indexOf(e);t!==-1&&this.foodDetails.splice(t,1)}},components:{BaseButton:M,BaseButtons:q,CardBox:L,BaseDivider:x,FormField:R,FormControl:T,BaseLevel:O,BaseIcon:N,Table:j,Modal:ue,SectionMain:G,LayoutAuthenticated:J,SectionTitleBarSub:K,Criteria:X}};function fe(e,t,n,u,o,s){const p=r("SectionTitleBarSub"),c=r("Criteria"),g=r("Modal"),_=r("Table"),y=r("SectionMain"),C=r("LayoutAuthenticated");return b(),D(C,null,{default:a(()=>[l(y,null,{default:a(()=>[l(p,{icon:"foodDrumstickOutline",title:"รายละเอียดการให้อาหาร","has-btn-add":"",onOpenModal:t[0]||(t[0]=m=>{o.mode="create",o.openModal=!0}),btnText:"เพิ่มการให้อาหาร"}),l(c,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:s.getDatas,onReset:e.reset,forms:o.forms,search:o.search,btnLoading:o.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),l(g,{modelValue:o.openModal,"onUpdate:modelValue":t[1]||(t[1]=m=>o.openModal=m),data:s.getDataCopy,onCancel:s.resetData,mode:o.mode,onConfirm:s.getDatas},null,8,["modelValue","data","onCancel","mode","onConfirm"]),l(_,{title:"รายการให้อาหาร ("+o.foods.length+" รายการ)",items:o.foods,datas:o.foodColumns,buttons:o.buttons,perPage:"5",onDelete:s.remove,onEdit:s.edit},null,8,["title","items","datas","buttons","onDelete","onEdit"])]),_:1})]),_:1})}const Ve=k(me,[["render",fe]]);export{Ve as default};

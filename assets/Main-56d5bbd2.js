import{b as S,_ as k,a as w,d as x,c as M}from"./BaseDivider-61ee89c2.js";import{_ as T}from"./LayoutAuthenticated-1901d823.js";import{_ as F}from"./SectionTitleBarSub-8c22e3c4.js";import{T as L}from"./Table-9dcddb90.js";import{C as E}from"./Criteria-35c42e3f.js";import{v as B,h as N,_ as U,z as n,G as y,H as V,o as D,c as q,w as i,d as o,j as A,f as O,t as I,g as j,e as H}from"./index-d112b817.js";import{a as R}from"./CardBoxModal-037276b0.js";import{_ as z}from"./FormField-1c9cc7b4.js";import{_ as G}from"./FormControl-ea42ddb9.js";import{_ as P}from"./NotificationBar-028f985c.js";import{T as f}from"./alert-32d4a5a7.js";import{E as d}from"./equipment-474ef963.js";import{_ as J}from"./FormCheckRadioPicker-49cc75de.js";import"./UserAvatar-3f93aca2.js";import"./CardBoxCollapse-451f0abb.js";import"./Cow-ed7bc072.js";import"./cow-9a42aa2f.js";import"./Recipe-d0be585f.js";import"./Vaccine-e5427c6f.js";import"./Corral-3dbf33df.js";const v=t=>t==="ddl"?[{id:"",label:"ทั้งหมด"},{id:"A",label:"ใช้งาน"},{id:"I",label:"ไม่ใช้งาน"}]:{A:"ใช้งาน",I:"ไม่ใช้งาน"},K={data(){return{equipment:{name:"",code:"",startDate:new Date,endDate:null,status:"A",amount:"",remark:""},status:v("ddl"),loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},user(){return this.$store.state.auth.user}},watch:{data(t){t&&this.mode==="edit"&&(this.equipment=t,this.equipment.startDate=new Date(t.startDate),this.equipment.endDate=t.endDate?new Date(t.endDate):null)}},methods:{clear(){this.equipment.name="",this.equipment.code="",this.equipment.startDate=new Date,this.equipment.endDate=null,this.equipment.remark="",this.equipment.amount="",this.equipment.status="A"},confirmCancel(t){this.value=!1,this.$emit(t)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await d.create(this.equipment)&&(this.loading=!1,this.confirmCancel("confirm")):await d.update(this.equipment._id,this.equipment)&&(this.loading=!1,this.confirmCancel("confirm")),f.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})}catch(t){console.error("Error : ",t),this.loading=!1,this.alert=t.response.data.message,f.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}}},components:{BaseButton:S,BaseButtons:N,CardBox:k,BaseDivider:w,OverlayLayer:R,FormField:z,FormControl:G,NotificationBar:P,BaseLevel:U,FormCheckRadioPicker:J,BaseIcon:x},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},Q={class:"grid grid-cols-2 lg:grid-cols-3 gap-5"};function W(t,a,u,_,e,l){const r=n("FormControl"),m=n("FormField"),h=n("NotificationBar"),g=n("BaseDivider"),c=n("BaseButton"),b=n("BaseButtons"),p=n("CardBox"),C=n("OverlayLayer");return y((D(),q(C,null,{default:i(()=>[y(o(p,{title:"อุปกรณ์ "+(this.mode==="create"?"":"(แก้ไข)"),class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"",onSubmit:H(l.submit,["prevent"]),onHeaderIconClick:l.cancel},{default:i(()=>[A("div",Q,[o(m,{label:"รหัส",help:u.mode==="create"?"* ห้ามว่าง (บันทึกแล้วแก้ไขไม่ได้)":"* แก้ไขไม่ได้"},{default:i(()=>[o(r,{modelValue:e.equipment.code,"onUpdate:modelValue":a[0]||(a[0]=s=>e.equipment.code=s),icon:"accountEdit",disabled:u.mode==="edit",required:""},null,8,["modelValue","disabled"])]),_:1},8,["help"]),o(m,{label:"ชื่อ",help:"* ห้ามว่าง"},{default:i(()=>[o(r,{modelValue:e.equipment.name,"onUpdate:modelValue":a[1]||(a[1]=s=>e.equipment.name=s),icon:"accountEdit",required:""},null,8,["modelValue"])]),_:1}),o(m,{label:"วันที่เริ่มใช้งาน",help:"* ห้ามว่าง"},{default:i(()=>[o(r,{modelValue:e.equipment.startDate,"onUpdate:modelValue":a[2]||(a[2]=s=>e.equipment.startDate=s),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),o(m,{label:"วันที่สิ้นสุดใช้งาน"},{default:i(()=>[o(r,{modelValue:e.equipment.endDate,"onUpdate:modelValue":a[3]||(a[3]=s=>e.equipment.endDate=s),icon:"calendar",type:"date"},null,8,["modelValue"])]),_:1}),o(m,{label:"ราคา",help:"* ห้ามว่าง"},{default:i(()=>[o(r,{modelValue:e.equipment.amount,"onUpdate:modelValue":a[4]||(a[4]=s=>e.equipment.amount=s),type:"number",icon:"cashMultiple",required:""},null,8,["modelValue"])]),_:1}),o(m,{label:"สถานะ"},{default:i(()=>[o(r,{modelValue:e.equipment.status,"onUpdate:modelValue":a[5]||(a[5]=s=>e.equipment.status=s),options:e.status},null,8,["modelValue","options"])]),_:1}),o(m,{label:"หมายเหตุ"},{default:i(()=>[o(r,{modelValue:e.equipment.remark,"onUpdate:modelValue":a[6]||(a[6]=s=>e.equipment.remark=s),type:"textarea"},null,8,["modelValue"])]),_:1})]),e.alert?(D(),q(h,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:i(()=>[O(I(e.alert),1)]),_:1})):j("",!0),o(g),o(b,{type:"justify-center"},{default:i(()=>[o(c,{label:"บันทึก",color:"success",type:"submit",loading:e.loading},null,8,["loading"]),o(c,{label:"ยกเลิก",color:"danger",onClick:l.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[V,l.value]])]),_:1},512)),[[V,l.value]])}const X=B(K,[["render",W]]),Y={data(){return{openModal:!1,modalData:null,items:[],forms:[{label:"สถานะ",value:"status",options:v("ddl")}],search:{status:""},loading:!1,mode:"create",dataEdit:null,checked:{code:{value:"code"},label:{value:"name"}},datas:[{label:"รหัส",value:"code"},{label:"ชื่อ",value:"name"},{label:"วันที่เริ่มใช้งาน",class:"text-center",value:"startDate",type:"date"},{label:"วันที่สิ้นสุดใช้งาน",class:"text-center",value:"endDate",type:"date"},{label:"ราคา",value:"amount",class:"text-right"},{label:"สถานะ",class:"text-center",func:t=>v()[t.status]},{label:"หมายเหตุ",value:"remark"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},components:{SectionMain:M,LayoutAuthenticated:T,SectionTitleBarSub:F,Table:L,Modal:X,Criteria:E},computed:{getDataCopy(){return{...this.modalData}}},created(){this.getDatas()},methods:{async getDatas(t){this.loading=!0;const a=await d.all(t);this.items=[],a.data&&(this.items=a.data.equipments),this.loading=!1},async remove(t){this.loading=!0,(await d.delete(t)).data&&this.getDatas(),this.loading=!1,f.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},async removeSelected(t){this.loading=!0;let a=[];for(let _ of t)a.push(_._id);(await d.deletes(a)).data&&(this.getDatas(),f.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})),this.loading=!1},edit(t){this.modalData=t,this.mode="edit",this.openModal=!0},reset(){this.search.status="",this.getDatas()},resetData(){this.modalData=null}}};function Z(t,a,u,_,e,l){const r=n("SectionTitleBarSub"),m=n("Modal"),h=n("Criteria"),g=n("Table"),c=n("SectionMain"),b=n("LayoutAuthenticated");return D(),q(b,null,{default:i(()=>[o(c,null,{default:i(()=>[o(r,{icon:"shovel",title:"อุปกรณ์","has-btn-add":"",onOpenModal:a[0]||(a[0]=p=>{e.mode="create",e.openModal=!0}),btnText:"เพิ่มอุปกรณ์"}),o(m,{modelValue:e.openModal,"onUpdate:modelValue":a[1]||(a[1]=p=>e.openModal=p),data:l.getDataCopy,mode:e.mode,onConfirm:l.getDatas,onCancel:l.resetData},null,8,["modelValue","data","mode","onConfirm","onCancel"]),o(h,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:l.getDatas,onReset:l.reset,forms:e.forms,search:e.search,btnLoading:e.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),o(g,{title:"รายการอุปกรณ์","has-checkbox":"","checked-data":e.checked,items:e.items,datas:e.datas,buttons:e.buttons,onEdit:l.edit,onDelete:l.remove,onDeleteSelected:l.removeSelected,loading:e.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const De=B(Y,[["render",Z]]);export{De as default};

import{b as F,_ as E,a as O,d as T,c as N}from"./BaseDivider-9edf4e01.js";import{_ as L}from"./LayoutAuthenticated-96665147.js";import{_ as U}from"./SectionTitleBarSub-1350e779.js";import{T as W}from"./Table-2f3f3207.js";import{C as R}from"./Criteria-1b65da79.js";import{v as M,B as A,h as H,_ as I,z as d,G as k,H as S,o as p,c as D,w as s,d as i,j as r,f as V,t as h,g as B,s as v,F as z,D as Q,e as j}from"./index-ae395474.js";import{a as G}from"./CardBoxModal-083dba37.js";import{_ as J}from"./FormField-09d99245.js";import{_ as K}from"./FormControl-6725e5f0.js";import{_ as P}from"./NotificationBar-2b87af79.js";import{T as C}from"./alert-019710c2.js";import{R as w}from"./Recipe-ccc9cf97.js";import"./UserAvatar-64ee2716.js";import"./CardBoxCollapse-693e8138.js";import"./FormCheckRadioPicker-155ac12c.js";import"./Cow-77d0c522.js";import"./cow-e7aeb5ac.js";import"./Vaccine-5db646be.js";import"./Corral-26e6d49e.js";const x=e=>e==="create"?[{id:1,label:"อาหารหยาบ"},{id:2,label:"อาหารข้น ผสมเอง"},{id:3,label:"อาหารข้น สำเร็จรูป"}]:[{id:"",label:"ทั้งหมด"},{id:1,label:"อาหารหยาบ"},{id:2,label:"อาหารข้น ผสมเอง"},{id:3,label:"อาหารข้น สำเร็จรูป"}],X={data(){return{recipe:{code:"",name:"",type:1,amount:0},recipeDetail:{},recipeDetails:[],type:x("create"),loading:!1,alertError:"",alertWarning:"",alertDetail:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},user(){return this.$store.state.auth.user}},watch:{data(e){var t,n;e&&(this.recipe=e,this.recipe.amount=(t=this.recipe)!=null&&t.amount?this.$filters.currency((n=this.recipe)==null?void 0:n.amount):null,this.recipeDetails=e.recipeDetails)},"recipe.frequency"(e){e&&(this.recipe.dateNext=A(new Date(this.recipe.dateCurrent),e))},"recipeDetail.cost"(e){var t,n;e&&((t=this.recipeDetail)!=null&&t.qty)?this.recipeDetail.amount=(e*((n=this.recipeDetail)==null?void 0:n.qty)).toFixed(2):this.recipeDetail.amount=null},"recipeDetail.qty"(e){var t,n;e&&((t=this.recipeDetail)!=null&&t.cost)?this.recipeDetail.amount=(e*((n=this.recipeDetail)==null?void 0:n.cost)).toFixed(2):this.recipeDetail.amount=null}},methods:{clear(){this.recipe={},this.recipeDetails=[]},confirmCancel(e){this.value=!1,this.$emit(e)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},addDetail(){var e,t,n,g;if(this.alertDetail="",(e=this.recipeDetail)!=null&&e.food&&((t=this.recipeDetail)!=null&&t.qty)&&((n=this.recipeDetail)!=null&&n.cost))if(this.recipeDetails.filter(o=>{var c;return o.food===((c=this.recipeDetail)==null?void 0:c.food)}).length<=0)if(((g=this.recipeDetail)==null?void 0:g.qty)<=1){let o=0;this.recipeDetails.forEach(c=>{o+=c.qty}),o<=1?(this.recipeDetails.push(this.recipeDetail),this.recipe.amount=0,this.recipeDetails.forEach(c=>{this.recipe.amount+=c.amount}),this.recipeDetail={}):this.alertDetail="จำนวนที่ใช้รวมห้ามเกิน 1 กก."}else this.alertDetail="จำนวนที่ใช้ห้ามเกิน 1 กก.";else this.alertDetail="อาหาร/วัตถุดิบ ซ้ำ";else this.alertDetail="กรุณากรอกข้อมูลให้ครบ"},removeDetail(e){var n;let t=this.recipeDetails.indexOf(e);t!==-1&&(this.recipe.amount-=(n=this.recipeDetails[t])==null?void 0:n.amount,this.recipeDetails.splice(t,1))},async submit(){this.loading=!0,this.alert="",this.alertWarning="";try{if(this.mode==="create"){let e=0;this.recipeDetails.forEach(t=>{e+=t.qty}),e===1?await w.create({recipe:this.recipe,recipeDetail:this.recipeDetails})&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm"),C.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})):this.alertWarning="กรุณาเพิ่ม รายการอาหาร/วัตถุดิบ ให้ครบ 1 กก."}else await w.update(this.recipe._id,{recipe:this.recipe,recipeDetail:this.recipeDetails})&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm"),C.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"}))}catch(e){console.error("Error : ",e),this.clear(),this.loading=!1,this.alertError=await e.response.data.message,C.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}}},components:{BaseButton:F,BaseButtons:H,CardBox:E,BaseDivider:O,OverlayLayer:G,FormField:J,FormControl:K,NotificationBar:P,BaseLevel:I,BaseIcon:T},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},Y={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 mb-5"},Z={class:"grid grid-cols-2 lg:grid-cols-6 gap-5"},$=r("header",{class:"flex items-stretch border-b border-gray-100 dark:border-gray-800"},[r("p",{class:"flex items-center py-3 grow font-bold"}," รายการอาหาร/วัตถุดิบ ")],-1),ee={key:1,class:"overflow-x-hidden overflow-y-auto h-80"},te=r("thead",null,[r("tr",null,[r("th",{class:"whitespace-nowrap text-center"}," อาหาร/วัตถุดิบ "),r("th",{class:"whitespace-nowrap text-center"}," ราคา/กก. "),r("th",{class:"whitespace-nowrap text-center"}," จำนวนที่ใช้ (กก.) "),r("th",{class:"whitespace-nowrap text-center"}," จำนวนเงิน "),r("th")])],-1),le={"data-label":"อาหาร/วัตถุดิบ"},ie={"data-label":"ราคา/กก.",class:"text-center"},ae={"data-label":"จำนวนที่ใช้ (กก.)",class:"text-center"},oe={"data-label":"จำนวนเงิน",class:"text-right"},re={class:"lg:w-6 whitespace-nowrap"},se={key:2,class:"text-center py-10 text-gray-500 dark:text-gray-400"},ne=r("p",null,"ไม่มีรายการ...",-1),ce=[ne];function de(e,t,n,g,l,o){const c=d("FormControl"),u=d("FormField"),m=d("BaseButton"),f=d("BaseButtons"),_=d("NotificationBar"),y=d("CardBox"),b=d("BaseDivider"),q=d("OverlayLayer");return k((p(),D(q,null,{default:s(()=>[k(i(y,{title:(this.mode==="create"?"บันทึก":"แก้ไข")+"สูตรอาหาร",class:"shadow-lg w-full lg:w-2/3 z-50","header-icon":"close",modal:"",form:"","has-scroll":"",onSubmit:j(o.submit,["prevent"]),onHeaderIconClick:o.cancel},{default:s(()=>[r("div",Y,[i(u,{label:"ชื่อสูตรอาหาร",help:"* ห้ามว่าง"},{default:s(()=>[i(c,{modelValue:l.recipe.name,"onUpdate:modelValue":t[0]||(t[0]=a=>l.recipe.name=a),icon:"potMixOutline",required:""},null,8,["modelValue"])]),_:1}),i(u,{label:"ประเภทอาหาร",help:"* ห้ามว่าง"},{default:s(()=>[i(c,{modelValue:l.recipe.type,"onUpdate:modelValue":t[1]||(t[1]=a=>l.recipe.type=a),options:l.type,required:""},null,8,["modelValue","options"])]),_:1}),i(u,{label:"จำนวนเงินรวม"},{default:s(()=>[i(c,{modelValue:l.recipe.amount,"onUpdate:modelValue":t[2]||(t[2]=a=>l.recipe.amount=a),icon:"cashMultiple",type:"number",required:""},null,8,["modelValue"])]),_:1})]),i(y,{title:"รายละเอียดสูตรอาหาร",class:"shadow-lg dark:bg-slate-700","header-icon":""},{default:s(()=>[r("div",Z,[i(u,{label:"อาหาร/วัตถุดิบ",help:"* ห้ามว่าง"},{default:s(()=>[i(c,{modelValue:l.recipeDetail.food,"onUpdate:modelValue":t[3]||(t[3]=a=>l.recipeDetail.food=a),icon:"foodVariant"},null,8,["modelValue"])]),_:1}),i(u,{label:"ราคา/กก.",help:"* ห้ามว่าง"},{default:s(()=>[i(c,{modelValue:l.recipeDetail.cost,"onUpdate:modelValue":t[4]||(t[4]=a=>l.recipeDetail.cost=a),icon:"cash",type:"number"},null,8,["modelValue"])]),_:1}),i(u,{label:"จำนวนที่ใช้ (กก.)",help:"* ห้ามว่าง (ห้ามเกิน 1 กก.)"},{default:s(()=>[i(c,{icon:"scale",type:"number",modelValue:l.recipeDetail.qty,"onUpdate:modelValue":t[5]||(t[5]=a=>l.recipeDetail.qty=a)},null,8,["modelValue"])]),_:1}),i(u,{label:"จำนวนเงิน"},{default:s(()=>[i(c,{modelValue:l.recipeDetail.amount,"onUpdate:modelValue":t[6]||(t[6]=a=>l.recipeDetail.amount=a),icon:"cashMultiple",type:"number"},null,8,["modelValue"])]),_:1}),i(f,{class:"col-span-2",type:"justify-center"},{default:s(()=>[i(m,{label:"เพิ่ม",color:"success",onClick:o.addDetail},null,8,["onClick"]),i(m,{label:"ล้าง",color:"danger",onClick:t[7]||(t[7]=a=>e.resetDetail())})]),_:1})]),l.alertDetail?(p(),D(_,{key:0,color:"warning",outline:"",icon:"alertCircleOutline"},{default:s(()=>[V(h(l.alertDetail),1)]),_:1})):B("",!0),$,l.recipeDetails.length>0?(p(),v("div",ee,[r("table",null,[te,r("tbody",null,[(p(!0),v(z,null,Q(l.recipeDetails,a=>(p(),v("tr",{key:a.food},[r("td",le,h(a.food),1),r("td",ie,h(e.$filters.currency(a.cost)),1),r("td",ae,h(a.qty),1),r("td",oe,h(e.$filters.currency(a.amount)),1),r("td",re,[i(f,{type:"justify-end lg:justify-start","no-wrap":""},{default:s(()=>[i(m,{color:"danger",label:"ลบ",onClick:he=>o.removeDetail(a)},null,8,["onClick"])]),_:2},1024)])]))),128))])])])):(p(),v("div",se,ce))]),_:1}),l.alertError?(p(),D(_,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:s(()=>[V(h(l.alertError),1)]),_:1})):B("",!0),l.alertWarning?(p(),D(_,{key:1,color:"warning",outline:"",icon:"alertCircleOutline"},{default:s(()=>[V(h(l.alertWarning),1)]),_:1})):B("",!0),i(b),i(f,{type:"justify-center"},{default:s(()=>[i(m,{label:"บันทึก",color:"success",type:"submit",loading:l.loading},null,8,["loading"]),i(m,{label:"ยกเลิก",color:"danger",onClick:o.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[S,o.value]])]),_:1},512)),[[S,o.value]])}const ue=M(X,[["render",de]]),pe={data(){return{openModal:!1,modalData:null,items:[],forms:[{label:"สูตรอาหาร",value:"recipe",type:"ddl",module:"recipe"},{label:"ประเภท",value:"type",options:x()}],search:{recipe:"",type:""},loading:!1,mode:"create",dataEdit:null,checked:{code:{value:"code"},label:{value:"name"}},datas:[{label:"สูตรอาหาร",value:"name"},{label:"ประเภท",func:e=>x()[e.type].label},{label:"ราคา/กก.",class:"text-right",value:"amount",func:e=>this.$filters.currency(e.amount)},{label:"จำนวนอาหาร/วัตถุดิบ",class:"text-center",func:e=>e.recipeDetails.length}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},components:{SectionMain:N,LayoutAuthenticated:L,SectionTitleBarSub:U,Table:W,Modal:ue,Criteria:R},computed:{user(){return this.$store.state.auth.user}},created(){this.getDatas()},methods:{async getDatas(){this.loading=!0;const e=await w.all(this.search);this.items=[],e.data&&(this.items=e.data.recipes),this.loading=!1},async remove(e){this.loading=!0,(await w.delete(e)).data&&this.getDatas(),this.loading=!1,C.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},edit(e){this.modalData=e,this.mode="edit",this.openModal=!0},reset(){this.search.recipe="",this.search.type="",this.getDatas()},resetData(){this.modalData=null}}};function me(e,t,n,g,l,o){const c=d("SectionTitleBarSub"),u=d("Modal"),m=d("Criteria"),f=d("Table"),_=d("SectionMain"),y=d("LayoutAuthenticated");return p(),D(y,null,{default:s(()=>[i(_,null,{default:s(()=>[i(c,{icon:"calculatorVariantOutline",title:"สูตรอาหาร","has-btn-add":"",onOpenModal:t[0]||(t[0]=b=>{l.mode="create",l.openModal=!0}),btnText:"เพิ่มสูตรอาหาร"}),i(u,{modelValue:l.openModal,"onUpdate:modelValue":t[1]||(t[1]=b=>l.openModal=b),data:l.modalData,mode:l.mode,onConfirm:o.getDatas,onCancel:o.resetData},null,8,["modelValue","data","mode","onConfirm","onCancel"]),i(m,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:o.getDatas,onReset:o.reset,forms:l.forms,search:l.search},null,8,["onSearch","onReset","forms","search"]),i(f,{title:"รายการสูตรอาหาร","has-checkbox":"","checked-data":l.checked,items:l.items,datas:l.datas,buttons:l.buttons,onEdit:o.edit,onDelete:o.remove,onDeleteSelected:e.removeSelected,loading:l.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const Te=M(pe,[["render",me]]);export{Te as default};

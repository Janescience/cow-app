import{c as _}from"./BaseDivider-f8478640.js";import{_ as g}from"./LayoutAuthenticated-fccff6f4.js";import{_ as v}from"./SectionTitleBarSub-b9e42d72.js";import{T as b}from"./Table-b5f57db0.js";import{C as y}from"./Criteria-bf94e91f.js";import{P as d}from"./protection-e7283181.js";import{T as D}from"./alert-28ab8999.js";import{v as S,y as n,c as k,w as m,z as o,o as T,d as r}from"./index-ebcde427.js";import"./UserAvatar-ad2f0a29.js";import"./CardBoxModal-ba84ad01.js";import"./FormControl-22f13e62.js";import"./CardBoxCollapse-2c9baa0c.js";import"./FormField-4f3f2594.js";import"./FormCheckRadioPicker-14a37647.js";import"./Cow-625364ed.js";import"./cow-22dcc5ca.js";import"./Recipe-7ef9f37b.js";import"./Vaccine-c69622ad.js";const B={data(){return{openModal:!1,modalData:null,vaccine:{},items:[],forms:[{label:"วันที่ฉีดวัคซีน",value:"date",icon:"calendar",type:"date"}],search:{date:null,vaccine:null},loading:!1,mode:"create",dataEdit:null,checked:{label:{value:"vaccine.name"},code:{value:"vaccine.seq"}},datas:[{label:"ครั้งที่",value:"seq"},{label:"วัคซีน",value:"vaccine.name"},{label:"จำนวนที่ฉีด (ตัว)",class:"text-center",value:"qty"},{label:"รวมเป็นเงิน (บาท)",class:"text-right",type:"currency",value:"amount"},{label:"วันที่ฉีดวัคซีน",class:"text-center",value:"date",type:"date"},{label:"หมายเหตุ",class:"text-center",value:"remark"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning",condition:e=>{const a=n.groupBy(this.items,"vaccine._id");for(let i of Object.keys(a)){const c=a[i],t=n.orderBy(c,"seq","desc");if(t.length>0&&e._id==t[0]._id)return!0}return!1}},{label:"ยืนยันฉีดวัคซีน",color:"success",type:"oth",func:e=>{this.confirm(e)},condition:e=>{const a=n.groupBy(this.items,"vaccine._id"),i=new Date().setUTCHours(0,0,0,0);for(let c of Object.keys(a)){const t=a[c],s=n.orderBy(t,"seq","desc");if(s.length>0){const l=new Date(e.date).setUTCHours(0,0,0,0);if(e._id==s[0]._id&&i>=l)return!0}}return!1}}]}},components:{SectionMain:_,LayoutAuthenticated:g,SectionTitleBarSub:v,Table:b,Criteria:y},created(){this.search.vaccine=this.$route.params.vaccine,this.getDatas(this.search)},methods:{async confirm(e){this.loading=!0,(await d.confirm(e)).data&&this.getDatas(this.search),this.loading=!1},async getDatas(e){this.loading=!0;const a=await d.all(e);this.items=[],a.data&&(this.items=a.data.protections,this.vaccine=a.data.protections[0].vaccine),this.loading=!1},async remove(e){this.loading=!0,(await d.delete(e)).data&&this.getDatas(),this.loading=!1,D.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},add(){this.$router.push({name:"protectionDetail",params:{id:"add"}})},edit(e){this.$router.push({name:"protectionDetail",params:{id:e._id}})},reset(){this.search.date=null,this.search.vaccine=null,this.getDatas()}}};function w(e,a,i,c,t,s){const l=o("SectionTitleBarSub"),u=o("Criteria"),p=o("Table"),h=o("SectionMain"),f=o("LayoutAuthenticated");return T(),k(f,null,{default:m(()=>[r(h,null,{default:m(()=>[r(l,{icon:"needle",title:"ประวัติการป้องกัน/บำรุง ("+t.vaccine.name+")","path-back":"/manage/protection"},null,8,["title"]),r(u,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:s.getDatas,onReset:s.reset,forms:t.forms,search:t.search,btnLoading:t.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),r(p,{title:"รายการประวัติป้องกัน/บำรุง","has-checkbox":"","checked-data":t.checked,items:t.items,datas:t.datas,buttons:t.buttons,onEdit:s.edit,onDelete:s.remove,onDeleteSelected:e.removeSelected,loading:t.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const I=S(B,[["render",w]]);export{I as default};

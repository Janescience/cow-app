import{z as S,C as U,D as O,p as R,O as T,m as P,_ as Q,i as I,g as L,f as N,T as E,Q as k,B as w,c as B,w as i,F as b,o as M,d as s,s as t,h as j,t as r,k as C}from"./index-629ff7e8.js";import{_ as z}from"./CardBoxCollapse-c9b062bd.js";import{_ as H}from"./FormField-549ee950.js";import{I as K}from"./ImageUpload-04bc8b98.js";import{C as F}from"./cow-9e22cfb1.js";import{M as W}from"./milking-a3c9bb63.js";import{r as q,a as G,R as J}from"./reproduct-8434b6c6.js";import{s as X,o as Z,B as $}from"./birth-bac916bf.js";import{H as tt}from"./heal-656611ad.js";import{P as et}from"./protection-b06a3e8c.js";import{F as lt}from"./food-b66ca13c.js";import{N as at}from"./notification-26a77402.js";import{g as st}from"./age-calculate-bb92e417.js";import{T as A}from"./alert-92a2c52a.js";import{s as ot,q as nt}from"./cow-ae6b6e19.js";const it={data(){return{cow:{},milks:[],milkDetails:[],historyMilks:[],reproducts:[],births:[],heals:[],protections:[],foods:[],notifications:[],loading:{cow:!0,milk:!0,reproduct:!0,birth:!0,heal:!0,protection:!0,food:!0,notification:!0},alert:"",newCow:!1,status:ot("create"),quality:nt("create"),milkDatas:[{label:"วันที่รีดนม",class:"text-center",type:"date",value:"date"},{label:"เช้า (กก.)",class:"text-center",value:"mQty"},{label:"บ่าย (กก.)",class:"text-center",value:"aQty"},{label:"รวม (กก.)",class:"text-center",func:l=>l.mQty+l.aQty},{label:"คิดเป็นเงิน",class:"text-right",type:"currency",value:"amount"}],reproductDatas:[{label:"ครั้งที่",class:"text-center",value:"seq"},{label:"วันที่เข้าระบบสืบพันธุ์",class:"text-center",value:"loginDate",type:"date"},{label:"ผล",func:l=>q()[l.result].label},{label:"วันที่เป็นสัด",class:"text-center",value:"estrusDate",type:"date"},{label:"วันที่ผสมพันธุ์",class:"text-center",value:"matingDate",type:"date"},{label:"วันที่ตรวจท้อง",class:"text-center",value:"checkDate",type:"date"},{label:"พ่อพันธุ์",value:"dad"},{label:"สถานะ",func:l=>G()[l.status].label},{label:"วิธีรักษา",value:"howTo"}],birthDatas:[{label:"ครั้งที่",value:"seq",class:"text-center"},{label:"วันที่ตั้งครรภ์",class:"text-center",value:"pregnantDate",type:"date"},{label:"อายุครรภ์",func:l=>this.calAge(l==null?void 0:l.pregnantDate)},{label:"วันที่คลอด",class:"text-center",value:"birthDate",type:"date"},{label:"เพศ",class:"text-center",func:l=>X()[l.sex]},{label:"ลูกวัว",class:"text-center",func:l=>{var a,m;return l.calf?((a=l.calf)==null?void 0:a.code)+" : "+((m=l.calf)==null?void 0:m.name):""}},{label:"รกค้าง",class:"text-center",func:l=>Z()[l.overgrown]},{label:"วันที่ใช้ยาขับ",class:"text-center",value:"drugDate",type:"date"},{label:"วันที่ล้างมดลูก",class:"text-center",value:"washDate",type:"date"}],protectionDatas:[{label:"ยา/วัคซีน",value:"vaccine.name"},{label:"ครั้งที่",class:"text-center",value:"seq"},{label:"ให้ยาล่าสุด",class:"text-center",value:"vaccine.currentDate",type:"date"},{label:"จำนวนเงิน",class:"text-right",value:"amount",type:"currency"},{label:"ให้ยาครั้งต่อไป",class:"text-center",value:"vaccine.nextDate",type:"date"}],notificationDatas:[{label:"รายการ",value:"name"},{label:"ก่อน",class:"text-center",value:"before"},{label:"มีผล",class:"text-center",value:"date"},{label:"หลัง",class:"text-center",value:"after"},{label:"แจ้งเตือน",class:"text-center",value:"alert",type:"icon"}],healDatas:[{label:"ครั้งที่",value:"seq",class:"text-center"},{label:"วันที่รักษา",class:"text-center",value:"date",type:"date"},{label:"อาการ/โรค",class:"text-center",value:"disease"},{label:"วิธีการรักษา",class:"text-center",value:"method"},{label:"คนรักษา",class:"text-center",value:"healer"},{label:"ค่ารักษา",class:"text-center",value:"amount"}],foodDatas:[{label:"สูตรอาหาร",value:"recipe.name"},{label:"เฉลี่ยกิน/วัน (กก.)",class:"text-center",value:"qty",func:l=>(l.qty/l.numCow).toFixed(2)},{label:"คิดเป็นเงิน/วัน",class:"text-right",value:"amount",func:l=>l.amountAvg.toFixed(2)}]}},components:{SectionMain:U,LayoutAuthenticated:O,BaseButton:R,BaseIcon:T,BaseButtons:P,CardBox:Q,FormControl:I,FormField:H,UserAvatar:L,BaseLevel:N,ImageUpload:K,Table:E,CardBoxCollapse:z},computed:{canRemove(){return this.milks.length==0&&this.reproducts.length==0&&this.births.length==0},user(){return this.$store.state.auth.user},milk(){let l=0,a=0,m=0;this.historyMilks=[],Object.keys(this.milks).forEach(_=>{let g=this.milks[_],p={},d=0,u=0,h=0;g.map(c=>{c.milkDetails.map(f=>{c.time==="M"?(a+=f.qty,d+=f.qty):(m+=f.qty,u+=f.qty),h+=f.amount}),c.milkDetails.length>0&&(l+=c.milkDetails.length,p.date=c.date,p.mQty=d,p.aQty=u,p.amount=h)}),Object.keys(p).length!==0&&this.historyMilks.push(p)}),this.historyMilks=k.orderBy(this.historyMilks,"date","desc");let D=(a+m)/l,e=a/l,o=m/l;return{avgTotal:(l>0?D:0).toFixed(2),avgMorning:(l>0?e:0).toFixed(2),avgAfternoon:(l>0?o:0).toFixed(2),all:(a+m).toFixed(2)}}},created(){const l=this.$route.params.id;this.getCowData(l)},methods:{async getCow(l){this.loading.cow=!0;const a=await F.get(l);a.data&&(this.cow=a.data.cow,this.cow.birthDate=new Date(this.cow.birthDate),this.loading.cow=!1)},async getCowData(l){this.loading.cow=!0;const a=await F.get(l);if(a.data){this.cow=a.data.cow,this.cow.birthDate=new Date(this.cow.birthDate),this.loading.cow=!1,this.loading.reproduct=!0;const m=await J.all({cow:l});m.data&&(this.reproducts=m.data.reproducts),this.loading.reproduct=!1,this.loading.birth=!0;const D=await $.all({cow:l,status:"B"});D&&(this.births=D.data.births),this.loading.birth=!1,this.loading.heal=!0;const e=await tt.all({cow:l});e&&(this.heals=e.data.heals),this.loading.heal=!1,this.loading.protection=!0;const o=await et.all({cows:l});if(o){const d=k.groupBy(o.data.protections,"vaccine._id");for(let u of Object.keys(d)){const h=d[u],c=k.orderBy(h,"seq","desc");c.length>0&&this.protections.push(c[0])}}this.loading.protection=!1,this.loading.food=!0;const _=await lt.all({corral:this.cow.corral});_&&(this.foods=_.data.foods),this.loading.food=!1,this.loading.milk=!0;const g=await W.get({cow:l});if(g.data){for(let d of g.data.milks)d.groupKey=w(d.date,"YYYY-MM-DD").format("YYYYMMDD");this.milks=k.groupBy(g.data.milks,"groupKey")}this.loading.milk=!1;const p=await at.getCalendar({cow:l});if(p.data){const d=k.groupBy(p.data.events,"code"),u=w(new Date).startOf("day");let h=[];for(let c of Object.keys(d)){const f=d[c];let y="",x=null,V=null,Y=null,n=null;for(let v of f)v.period=="today"?(y=v.name,x=w(v.time.start).format("DD/MM/YYYY"),n=w(v.time.start).startOf("day")):v.period=="before"?V=w(v.time.start).format("DD/MM/YYYY"):v.period=="after"&&(Y=w(v.time.start).format("DD/MM/YYYY"));h.push({name:y,date:x,dueDate:n,before:V,after:Y,alert:u.isAfter(n)?"bellCheckOutline":"bellAlertOutline"})}this.notifications=k.orderBy(h,"dueDate","desc")}}},async update(){this.loading.cow=!0,this.alert="";try{await F.update(this.cow._id,this.cow)&&(this.getCow(this.$route.params.id),A.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"}))}catch(l){console.error("Error : ",l),this.loading=!1,this.alert=l.response.data.message,A.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}},reproduct(){let l=w(),a=this.reproducts.length>0?this.reproducts.length:"-",m=this.reproducts.length>0?this.formatDate(this.reproducts[0].loginDate):"-",D=this.reproducts.length>0?q()[this.reproducts[0].result].label:"-",e=0,o=0,_=0,g="-",p="-",d="-";for(let u of this.reproducts)u.estrusDate!=null&&w(u.estrusDate)<=l&&(e++,g=this.formatDate(u.estrusDate)),u.matingDate!=null&&w(u.matingDate)<=l&&(o++,p=this.formatDate(u.matingDate)),u.checkDate!=null&&w(u.checkDate)<=l&&(_++,d=this.formatDate(u.checkDate));return{login:{count:a,lastDate:m,result:D},estrus:{count:e>0?e:"-",lastDate:g},mating:{count:o>0?o:"-",lastDate:p},check:{count:_>0?_:"-",lastDate:d}}},birth(){return{count:this.births.length>0?this.births.length:"-",lastDate:this.births.length>0?this.formatDate(this.births[0].birthDate):"-",countMale:this.births.length>0?this.births.filter(l=>l.sex==="M").length:"-",countFemale:this.births.length>0?this.births.filter(l=>l.sex==="F").length:"-"}},heal(){let l=this.heals.length>0?this.heals.length:"-",a=this.heals.length>0?this.formatDate(this.heals[0].date):"-",m=this.heals.length>0?this.heals[0].disease:"-",D=this.heals.length>0&&this.heals[0].method?this.heals[0].method:"-";return{count:l,lastDate:a,lastDisease:m,lastMethod:D}},formatDate(l){return l?w(new Date(l)).format("DD/MM/YYYY"):""},calAge(l){return st(l)}}},rt={class:"px-4 sm:px-0 mb-4 flex items-center justify-between"},ct={class:"flex items-center justify-start"},ut=t("h1",{class:"text-base lg:text-2xl"}," รายละเอียดโค ",-1),dt={class:"grid lg:gap-3 gap-2 grid-cols-2 lg:grid-cols-7 md:grid-cols-6"},ht={class:"row-span-2"},mt=t("thead",null,[t("th",{class:"whitespace-nowrap"},"เฉลี่ย/วัน"),t("th",{class:"whitespace-nowrap"},"เฉลี่ยเช้า/วัน"),t("th",{class:"whitespace-nowrap"},"เฉลี่ยบ่าย/วัน"),t("th",{class:"whitespace-nowrap"},"รวมทั้งหมด")],-1),pt={class:"whitespace-nowrap"},gt={class:"grid lg:grid-cols-3 grid-cols-1 gap-5 lg:p-4"},ft={class:"overflow-x-auto"},bt=t("thead",null,[t("th",{class:"whitespace-nowrap"},"รายการ"),t("th",{class:"whitespace-nowrap"},"จำนวนครั้ง"),t("th",{class:"whitespace-nowrap"},"วันที่ล่าสุด"),t("th",{class:"whitespace-nowrap"},"ผลล่าสุด")],-1),wt=t("td",{class:"whitespace-nowrap"},"เข้าระบบสืบพันธุ์",-1),_t=t("td",{class:"whitespace-nowrap"},"เป็นสัด",-1),yt=t("td",null,null,-1),Dt=t("td",{class:"whitespace-nowrap"},"ผสม",-1),vt=t("td",null,null,-1),xt=t("td",{class:"whitespace-nowrap"},"ตรวจท้อง",-1),kt=t("td",null,null,-1),Bt=t("td",null,"จำนวนครั้ง",-1),Mt=t("td",null,"วันที่",-1),Ct=t("td",null,"จำนวนเพศผู้",-1),Vt=t("td",null,"จำนวนเพศเมีย",-1),Yt=t("td",{class:"whitespace-nowrap"},"จำนวนครั้ง",-1),Ft=t("td",{class:"whitespace-nowrap"},"วันที่",-1),qt={class:"whitespace-nowrap"},At=t("td",{class:"whitespace-nowrap"},"อาการ/โรค",-1),St={class:"whitespace-nowrap"},Ut=t("td",{class:"whitespace-nowrap"},"วิธีการรักษา",-1),Ot={class:"whitespace-nowrap"},Rt={class:"lg:col-span-2"};function Tt(l,a,m,D,e,o){const _=b("BaseIcon"),g=b("BaseButton"),p=b("BaseButtons"),d=b("ImageUpload"),u=b("BaseLevel"),h=b("FormControl"),c=b("FormField"),f=b("CardBox"),y=b("Table"),x=b("CardBoxCollapse"),V=b("SectionMain"),Y=b("LayoutAuthenticated");return M(),B(Y,null,{default:i(()=>[s(V,{class:"text-sm lg:text-base"},{default:i(()=>[t("section",rt,[t("div",ct,[s(_,{path:"cow",size:"30",class:"mr-3"}),ut]),s(p,{class:"text-sm lg:text-base",type:"justify-end"},{default:i(()=>[s(g,{class:"lg:p-2 p-1",label:"ย้อนกลับ",color:"light",onClick:a[0]||(a[0]=n=>this.$router.push("/manage/cow"))}),s(g,{class:"lg:p-2 p-1",label:"ออกรายงาน",color:"info",onClick:a[1]||(a[1]=n=>l.exportReport())})]),_:1})]),s(f,{class:"mb-5",loading:e.loading.cow,title:"ข้อมูลโค","header-icon":"",icon:"cardTextOutline"},{default:i(()=>[t("div",dt,[t("div",ht,[s(d,{modelValue:e.cow.image,"onUpdate:modelValue":a[2]||(a[2]=n=>e.cow.image=n),class:"mt-8 mr-2"},null,8,["modelValue"]),s(u,{type:"justify-center text-xs font-thin text-slate-500"},{default:i(()=>[j(" อัพโหลดรูปภาพ (คลิกที่รูป) ")]),_:1})]),s(c,{label:"รหัสโค",help:"* ห้ามว่าง"},{default:i(()=>[s(h,{modelValue:e.cow.code,"onUpdate:modelValue":a[3]||(a[3]=n=>e.cow.code=n),icon:"barcode",required:""},null,8,["modelValue"])]),_:1}),s(c,{label:"ชื่อโค",help:"* ห้ามว่าง"},{default:i(()=>[s(h,{modelValue:e.cow.name,"onUpdate:modelValue":a[4]||(a[4]=n=>e.cow.name=n),icon:"cow",required:""},null,8,["modelValue"])]),_:1}),s(c,{label:"วันเกิด",help:"* ห้ามว่าง"},{default:i(()=>[s(h,{modelValue:e.cow.birthDate,"onUpdate:modelValue":a[5]||(a[5]=n=>e.cow.birthDate=n),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),s(c,{label:"สถานะ",help:"* ห้ามว่าง"},{default:i(()=>[s(h,{modelValue:e.cow.status,"onUpdate:modelValue":a[6]||(a[6]=n=>e.cow.status=n),options:e.status,icon:"",required:""},null,8,["modelValue","options"])]),_:1}),s(c,{label:"คุณภาพน้ำนม",help:"* ห้ามว่าง"},{default:i(()=>[s(h,{modelValue:e.cow.quality,"onUpdate:modelValue":a[7]||(a[7]=n=>e.cow.quality=n),options:e.quality,icon:""},null,8,["modelValue","options"])]),_:1}),s(c,{label:"คอก"},{default:i(()=>[s(h,{modelValue:e.cow.corral,"onUpdate:modelValue":a[8]||(a[8]=n=>e.cow.corral=n),icon:"barn"},null,8,["modelValue"])]),_:1}),s(c,{label:"พ่อพันธุ์"},{default:i(()=>[s(h,{modelValue:e.cow.dad,"onUpdate:modelValue":a[9]||(a[9]=n=>e.cow.dad=n),icon:"genderMale"},null,8,["modelValue"])]),_:1}),s(c,{label:"แม่พันธุ์"},{default:i(()=>[s(h,{modelValue:e.cow.mom,"onUpdate:modelValue":a[10]||(a[10]=n=>e.cow.mom=n),icon:"genderFemale"},null,8,["modelValue"])]),_:1}),s(p,{type:"md:justify-end lg:justify-end justify-center",class:"md:col-span-2 lg:col-span-4 col-span-2 md:mt-5"},{default:i(()=>[s(g,{label:"ลบ",color:"danger",onClick:a[11]||(a[11]=n=>l.remove())}),s(g,{label:"บันทึก",color:"success",onClick:a[12]||(a[12]=n=>o.update())})]),_:1})])]),_:1},8,["loading"]),s(f,{icon:"cupWater",loading:e.loading.milk,title:"ข้อมูลน้ำนมดิบ",class:"mb-5","header-icon":""},{default:i(()=>[t("table",null,[mt,t("tbody",null,[t("tr",null,[t("td",pt,r(o.milk.avgTotal),1),t("td",null,r(o.milk.avgMorning),1),t("td",null,r(o.milk.avgAfternoon),1),t("td",null,r(o.milk.all),1)])])])]),_:1},8,["loading"]),s(x,{icon:"calendarClock",class:"transition-position mb-5","has-table":"",loading:e.loading.milk,title:"ข้อมูลอื่นๆล่าสุด","header-icon":""},{default:i(()=>[t("div",gt,[s(f,{icon:"",class:"lg:col-span-2 dark:border-gray-600 border-gray-900",loading:e.loading.reproduct,title:"การสืบพันธุ์/ผสมพันธุ์","header-icon":""},{default:i(()=>[t("div",ft,[t("table",null,[bt,t("tbody",null,[t("tr",null,[wt,t("td",null,r(o.reproduct().login.count),1),t("td",null,r(o.reproduct().login.lastDate),1),t("td",null,r(o.reproduct().login.result),1)]),t("tr",null,[_t,t("td",null,r(o.reproduct().estrus.count),1),t("td",null,r(o.reproduct().estrus.lastDate),1),yt]),t("tr",null,[Dt,t("td",null,r(o.reproduct().mating.count),1),t("td",null,r(o.reproduct().mating.lastDate),1),vt]),t("tr",null,[xt,t("td",null,r(o.reproduct().check.count),1),t("td",null,r(o.reproduct().check.lastDate),1),kt])])])])]),_:1},8,["loading"]),s(f,{icon:"babyFace",class:"dark:border-gray-600 border-gray-900",loading:e.loading.birth,title:"การคลอดลูก","header-icon":""},{default:i(()=>[t("table",null,[t("tbody",null,[t("tr",null,[Bt,t("td",null,r(o.birth().count),1)]),t("tr",null,[Mt,t("td",null,r(o.birth().lastDate),1)]),t("tr",null,[Ct,t("td",null,r(o.birth().countMale),1)]),t("tr",null,[Vt,t("td",null,r(o.birth().countFemale),1)])])])]),_:1},8,["loading"]),s(f,{icon:"doctor",loading:e.loading.heal,class:"dark:border-gray-600 border-gray-900",title:"การรักษา","header-icon":""},{default:i(()=>[t("table",null,[t("tbody",null,[t("tr",null,[Yt,t("td",null,r(o.heal().count),1)]),t("tr",null,[Ft,t("td",qt,r(o.heal().lastDate),1)]),t("tr",null,[At,t("td",St,r(o.heal().lastDisease),1)]),t("tr",null,[Ut,t("td",Ot,r(o.heal().lastMethod),1)])])])]),_:1},8,["loading"]),t("div",Rt,[s(y,{title:"การป้องกัน/บำรุง",items:e.protections,datas:e.protectionDatas,loading:e.loading.protection,perPage:"5",icon:"pillMultiple"},null,8,["items","datas","loading"])])])]),_:1},8,["loading"]),!e.loading.notification&&e.notifications.length>0?(M(),B(x,{key:0,icon:"messageBadgeOutline",class:"transition-position mb-5",loading:e.loading.milk,title:"การแจ้งเตือน","header-icon":""},{default:i(()=>[s(y,{title:"",items:e.notifications,datas:e.notificationDatas,loading:e.loading.notification,perPage:"5"},null,8,["items","datas","loading"])]),_:1},8,["loading"])):C("",!0),!e.loading.food&&e.foods.length>0?(M(),B(x,{key:1,icon:"foodDrumstickOutline",class:"transition-position mb-5",loading:e.loading.food,title:"การกินอาหาร (คอก "+e.cow.corral+")","header-icon":""},{default:i(()=>[s(y,{items:e.foods,datas:e.foodDatas,loading:e.loading.food,perPage:"5"},null,8,["items","datas","loading"])]),_:1},8,["loading","title"])):C("",!0),s(y,{title:"ประวัติการรีดนม",items:e.historyMilks,datas:e.milkDatas,loading:e.loading.milk,icon:"waterCheck",perPage:"5"},null,8,["items","datas","loading"]),!e.loading.reproduct&&e.reproducts.length>0?(M(),B(y,{key:2,title:"ประวัติการสืบพันธ์ุ/ผสมพันธ์ุ",items:e.reproducts,datas:e.reproductDatas,loading:e.loading.reproduct,perPage:"5"},null,8,["items","datas","loading"])):C("",!0),!e.loading.birth&&e.births.length>0?(M(),B(y,{key:3,title:"ประวัติการคลอดลูก",items:e.births,datas:e.birthDatas,loading:e.loading.birth,perPage:"5"},null,8,["items","datas","loading"])):C("",!0),!e.loading.heal&&e.heals.length>0?(M(),B(y,{key:4,title:"ประวัติการรักษา",items:e.heals,datas:e.healDatas,loading:e.loading.heal,perPage:"5"},null,8,["items","datas","loading"])):C("",!0)]),_:1})]),_:1})}const $t=S(it,[["render",Tt]]);export{$t as default};

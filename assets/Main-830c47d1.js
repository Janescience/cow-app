import{z as k,W as c,X as b,p as x,m as E,_ as F,l as L,F as R,i as U,j as N,f as q,E as s,G as B,H as C,o as d,c as m,w as r,d as l,s as O,k as p,h as A,t as H,e as z,S as I,C as G,D as W}from"./index-b8f50ace.js";import{T as X}from"./Table-f373bbaa.js";import{C as j}from"./Criteria-4bec6539.js";import{_ as J}from"./FormField-207c8e6d.js";import{D as K}from"./Cow-c198d858.js";import{a as v,r as y,R as D}from"./reproduct-95d5fe9c.js";import{T as P}from"./alert-7955475f.js";import"./FormCheckRadioPicker-26fd984b.js";import"./cow-1e74c274.js";const Q={data(){return{reproduct:{cow:null,loginDate:new Date,estrusDate:c(new Date,21),matingDate:c(new Date,22),checkDate:b(c(new Date,22),2),dad:"",howTo:"",status:1,result:2},status:v("create"),result:y("create"),loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},user(){return this.$store.state.auth.user}},watch:{"reproduct.loginDate"(e){this.reproduct.estrusDate=c(e,21)},"reproduct.estrusDate"(e){this.reproduct.matingDate=c(e,1)},"reproduct.matingDate"(e){this.reproduct.checkDate=b(e,2)},"reproduct.result"(e){e==1?this.reproduct.status=4:this.reproduct.status=1},dataEdit:{handler(e,o){e!=null&&this.mode=="edit"&&(this.reproduct=e,this.reproduct.loginDate=new Date(e.loginDate),this.reproduct.estrusDate=new Date(e.estrusDate),this.reproduct.matingDate=new Date(e.matingDate),this.reproduct.checkDate=new Date(e.checkDate))}}},methods:{clear(){var e;this.mode==="edit"&&this.$emit("update:dataEdit",null),this.reproduct.cow=null,this.reproduct.loginDate=new Date,this.reproduct.estrusDate=c(new Date,21),this.reproduct.matingDate=c(new Date,22),this.reproduct.checkDate=b(c(new Date,43),2),this.reproduct.dad="",this.reproduct.howTo="",this.reproduct.status=1,this.reproduct.result=2,(e=this.reproduct)==null||delete e._id},confirmCancel(e){this.value=!1,this.$emit(e)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await D.create(this.reproduct)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")):await D.update(this.reproduct._id,this.reproduct)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm"))}catch(e){console.error("Error : ",e),this.loading=!1,this.alert=e.response.data.message}}},components:{BaseButton:x,BaseButtons:E,CardBox:F,BaseDivider:L,OverlayLayer:R,FormField:J,FormControl:U,NotificationBar:N,BaseLevel:q,DDLCow:K},props:{modelValue:{type:[String,Number,Boolean],default:null},mode:{type:String,default:""},dataEdit:{type:Object,default:null}}},Y={class:"grid grid-cols-2 lg:grid-cols-3 gap-3 mt-1"};function Z(e,o,V,S,t,n){const g=s("DDLCow"),i=s("FormField"),u=s("FormControl"),_=s("NotificationBar"),w=s("BaseDivider"),h=s("BaseButton"),f=s("BaseButtons"),M=s("CardBox"),T=s("OverlayLayer");return B((d(),m(T,null,{default:r(()=>[B(l(M,{title:V.mode==="create"?"เพิ่มการสืบพันธุ์":"แก้ไขการสืบพันธุ์",class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"",onSubmit:z(n.submit,["prevent"]),onHeaderIconClick:n.cancel},{default:r(()=>[O("div",Y,[l(i,{label:"โค",help:"* ห้ามว่าง"},{default:r(()=>[l(g,{modelValue:t.reproduct.cow,"onUpdate:modelValue":o[0]||(o[0]=a=>t.reproduct.cow=a)},null,8,["modelValue"])]),_:1}),l(i,{label:"พ่อพันธุ์",help:""},{default:r(()=>[l(u,{modelValue:t.reproduct.dad,"onUpdate:modelValue":o[1]||(o[1]=a=>t.reproduct.dad=a),icon:"genderMale"},null,8,["modelValue"])]),_:1}),l(i,{label:"วันที่เข้าระบบสืบพันธุ์",help:"* ห้ามว่าง"},{default:r(()=>[l(u,{modelValue:t.reproduct.loginDate,"onUpdate:modelValue":o[2]||(o[2]=a=>t.reproduct.loginDate=a),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),l(i,{label:"ผล"},{default:r(()=>[l(u,{modelValue:t.reproduct.result,"onUpdate:modelValue":o[3]||(o[3]=a=>t.reproduct.result=a),options:t.result},null,8,["modelValue","options"])]),_:1}),t.reproduct.result==1?(d(),m(i,{key:0,label:"วิธีการรักษา",help:""},{default:r(()=>[l(u,{modelValue:t.reproduct.howTo,"onUpdate:modelValue":o[4]||(o[4]=a=>t.reproduct.howTo=a),icon:"doctor"},null,8,["modelValue"])]),_:1})):p("",!0),t.reproduct.result==2?(d(),m(i,{key:1,label:"วันที่เป็นสัด",help:"* ห้ามว่าง (วันที่เข้าระบบสืบพันธุ์ + 21 วัน)"},{default:r(()=>[l(u,{modelValue:t.reproduct.estrusDate,"onUpdate:modelValue":o[5]||(o[5]=a=>t.reproduct.estrusDate=a),icon:"calendar",type:"date","lower-limit":t.reproduct.loginDate,required:""},null,8,["modelValue","lower-limit"])]),_:1})):p("",!0),t.reproduct.result==2?(d(),m(i,{key:2,label:"วันที่ผสมพันธุ์",help:"* ห้ามว่าง (วันที่เป็นสัด + 24 ชม)"},{default:r(()=>[l(u,{modelValue:t.reproduct.matingDate,"onUpdate:modelValue":o[6]||(o[6]=a=>t.reproduct.matingDate=a),icon:"calendar",type:"date","lower-limit":t.reproduct.estrusDate,required:""},null,8,["modelValue","lower-limit"])]),_:1})):p("",!0),t.reproduct.result==2?(d(),m(i,{key:3,label:"วันที่ตรวจท้อง",help:"* ห้ามว่าง (วันที่ผสมพันธุ์ + 2 เดือน)"},{default:r(()=>[l(u,{modelValue:t.reproduct.checkDate,"onUpdate:modelValue":o[7]||(o[7]=a=>t.reproduct.checkDate=a),icon:"calendar",type:"date","lower-limit":t.reproduct.matingDate,required:""},null,8,["modelValue","lower-limit"])]),_:1})):p("",!0),l(i,{label:"สถานะ"},{default:r(()=>[l(u,{modelValue:t.reproduct.status,"onUpdate:modelValue":o[8]||(o[8]=a=>t.reproduct.status=a),options:t.status},null,8,["modelValue","options"])]),_:1})]),t.alert?(d(),m(_,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:r(()=>[A(H(t.alert),1)]),_:1})):p("",!0),l(w),l(f,{type:"justify-center"},{default:r(()=>[l(h,{label:"บันทึก",color:"success",type:"submit",loading:t.loading},null,8,["loading"]),l(h,{label:"ยกเลิก",color:"danger",onClick:n.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[C,n.value]])]),_:1},512)),[[C,n.value]])}const $=k(Q,[["render",Z]]),ee={data(){return{openModal:!1,items:[],forms:[{label:"โค",value:"cow",type:"ddl",module:"cow"},{label:"สถานะ",value:"status",options:v()},{label:"ผล",value:"result",options:y()},{label:"วันที่เข้าระบบสืบพันธุ์",value:"loginDate",icon:"calendar",type:"date"},{label:"วันที่เป็นสัด",value:"estrusDate",icon:"calendar",type:"date"},{label:"วันที่ผสมพันธุ์",value:"matingDate",icon:"calendar",type:"date"},{label:"วันที่ตรวจท้อง",value:"checkDate",icon:"calendar",type:"date"}],search:{cow:null,loginDate:null,estrusDate:null,matingDate:null,checkDate:null,status:"",result:""},loading:!1,mode:"create",dataEdit:null,checked:{code:{value:"seq"},label:{value:"cow.name"}},datas:[{label:"ครั้งที่",class:"text-center",value:"seq"},{label:"รหัสโค",value:"cow.code"},{label:"ชื่อโค",value:"cow.name"},{label:"วันที่เข้าระบบสืบพันธุ์",class:"text-center",value:"loginDate",type:"date"},{label:"ผล",func:e=>y()[e.result].label},{label:"วันที่เป็นสัด",class:"text-center",value:"estrusDate",type:"date"},{label:"วันที่ผสมพันธุ์",class:"text-center",value:"matingDate",type:"date"},{label:"วันที่ตรวจท้อง",class:"text-center",value:"checkDate",type:"date"},{label:"พ่อพันธุ์",value:"dad"},{label:"สถานะ",func:e=>v()[e.status].label},{label:"วิธีรักษา",value:"howTo"}],buttons:[{label:"ลบ",type:"delete",color:"danger",condition:e=>e.status!="2"&&e.status!="3"},{label:"แก้ไข",type:"edit",color:"warning",condition:e=>e.status!="2"&&e.status!="3"}]}},components:{SectionMain:I,LayoutAuthenticated:G,SectionTitleBarSub:W,Table:X,Modal:$,Criteria:j},computed:{user(){return this.$store.state.auth.user}},created(){this.getReproductions()},methods:{async getReproductions(){this.loading=!0;const e=await D.all(this.search);this.items=[],e.data&&(this.items=e.data.reproducts),this.loading=!1},async remove(e){this.loading=!0,(await D.delete(e)).data&&(this.getReproductions(),P.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})),this.loading=!1},edit(e){this.dataEdit=e,this.dataEdit.cow=e.cow._id,this.mode="edit",this.openModal=!0},reset(){this.search.cow=null,this.search.date=null}}};function te(e,o,V,S,t,n){const g=s("SectionTitleBarSub"),i=s("Modal"),u=s("Criteria"),_=s("Table"),w=s("SectionMain"),h=s("LayoutAuthenticated");return d(),m(h,null,{default:r(()=>[l(w,null,{default:r(()=>[l(g,{icon:"reproduction",title:"การสืบพันธุ์",btnText:"เพิ่มการสืบพันธุ์","has-btn-add":"",onOpenModal:o[0]||(o[0]=f=>{t.mode="create",t.openModal=!0})}),l(i,{modelValue:t.openModal,"onUpdate:modelValue":o[1]||(o[1]=f=>t.openModal=f),mode:t.mode,dataEdit:t.dataEdit,onConfirm:n.getReproductions},null,8,["modelValue","mode","dataEdit","onConfirm"]),l(u,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:n.getReproductions,onReset:n.reset,forms:t.forms,search:t.search},null,8,["onSearch","onReset","forms","search"]),l(_,{title:"รายการสืบพันธุ์","has-checkbox":"","checked-data":t.checked,items:t.items,datas:t.datas,buttons:t.buttons,onEdit:n.edit,onDelete:n.remove,onDeleteSelected:e.removeSelected,loading:t.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const de=k(ee,[["render",te]]);export{de as default};

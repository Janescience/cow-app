import{z as H,X as _,Y as N,n as I,m as Y,_ as z,l as J,G as K,i as Q,j as X,f as E,R as W,F as r,H as q,I as A,o as i,c as m,w as n,d as o,q as u,k as D,h as G,t as h,e as Z,C as $,D as ee,E as te,T as ae,g as oe,Q as le,B as se,J as w,K as O,L as j}from"./index-993e6575.js";import{C as re}from"./Criteria-c4f311cd.js";import{_ as ne}from"./FormField-8519d5a2.js";import{D as ce}from"./Cow-62ce4776.js";import{T as C}from"./alert-f40615b9.js";import{a as B,r as k}from"./reproduct-4b10c1e3.js";import{R as y}from"./reproduction-84e3f9d6.js";import"./CardBoxCollapse-d4b693d6.js";import"./Recipe-ffbd062f.js";import"./Vaccine-4e3be49f.js";import"./cow-d53e75e8.js";const ue={data(){return{reproduct:{cow:{},loginDate:new Date,estrusDate:_(new Date,21),matingDate:_(new Date,22),checkDate:N(_(new Date,22),2),dad:"",howTo:"",status:1,result:2},status:B("create"),result:k("create"),loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},user(){return this.$store.state.auth.user}},watch:{"reproduct.loginDate"(e){this.reproduct.estrusDate=_(e,21)},"reproduct.estrusDate"(e){this.reproduct.matingDate=_(e,1)},"reproduct.matingDate"(e){this.reproduct.checkDate=N(e,2)},"reproduct.result"(e){e==1?this.reproduct.status=4:this.reproduct.status=1},data:{handler(e,a){e&&(this.reproduct=e,this.reproduct.loginDate=e.loginDate?new Date(e.loginDate):null,this.reproduct.estrusDate=e.estrusDate?new Date(e.estrusDate):null,this.reproduct.matingDate=e.matingDate?new Date(e.matingDate):null,this.reproduct.checkDate=e.checkDate?new Date(e.checkDate):null)}}},methods:{clear(){this.reproduct={}},confirmCancel(e){this.clear(),this.value=!1,this.$emit(e)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await y.create(this.reproduct)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm"),C.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})):await y.update(this.reproduct._id,this.reproduct)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm"),C.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"}))}catch(e){console.error("Error : ",e),this.loading=!1,this.alert=e.response.data.message}}},components:{BaseButton:I,BaseButtons:Y,CardBox:z,BaseDivider:J,OverlayLayer:K,FormField:ne,FormControl:Q,NotificationBar:X,BaseLevel:E,DDLCow:ce,FormCheckRadioPicker:W},props:{modelValue:{type:[String,Number,Boolean],default:null},mode:{type:String,default:""},data:{type:Object,default:null}}},ie={class:"grid grid-cols-2 lg:grid-cols-3 gap-3 mt-1"};function de(e,a,g,f,t,c){const V=r("DDLCow"),d=r("FormField"),p=r("FormControl"),x=r("FormCheckRadioPicker"),b=r("NotificationBar"),S=r("BaseDivider"),v=r("BaseButton"),P=r("BaseButtons"),L=r("CardBox"),R=r("OverlayLayer");return q((i(),m(R,null,{default:n(()=>[q(o(L,{title:g.mode==="create"?"เพิ่มการผสมพันธุ์":"แก้ไขการผสมพันธุ์",class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"",onSubmit:Z(c.submit,["prevent"]),onHeaderIconClick:c.cancel},{default:n(()=>[u("div",ie,[o(d,{label:"โค",help:"* ห้ามว่าง",class:"lg:col-span-1 col-span-2"},{default:n(()=>[o(V,{modelValue:t.reproduct.cow,"onUpdate:modelValue":a[0]||(a[0]=s=>t.reproduct.cow=s),valueType:"object"},null,8,["modelValue"])]),_:1}),o(d,{label:"วันที่เข้าระบบสืบพันธุ์",help:"* ห้ามว่าง"},{default:n(()=>[o(p,{modelValue:t.reproduct.loginDate,"onUpdate:modelValue":a[1]||(a[1]=s=>t.reproduct.loginDate=s),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),o(d,{label:"ผล"},{default:n(()=>[o(p,{modelValue:t.reproduct.result,"onUpdate:modelValue":a[2]||(a[2]=s=>t.reproduct.result=s),options:t.result},null,8,["modelValue","options"])]),_:1}),t.reproduct.result==1?(i(),m(d,{key:0,label:"วิธีการรักษา",help:""},{default:n(()=>[o(p,{modelValue:t.reproduct.howTo,"onUpdate:modelValue":a[3]||(a[3]=s=>t.reproduct.howTo=s),icon:"doctor"},null,8,["modelValue"])]),_:1})):D("",!0),t.reproduct.result==2?(i(),m(d,{key:1,label:"วันที่เป็นสัด",help:"* ห้ามว่าง (วันที่เข้าระบบสืบพันธุ์ + 21 วัน)"},{default:n(()=>[o(p,{modelValue:t.reproduct.estrusDate,"onUpdate:modelValue":a[4]||(a[4]=s=>t.reproduct.estrusDate=s),icon:"calendar",type:"date","lower-limit":t.reproduct.loginDate,required:""},null,8,["modelValue","lower-limit"])]),_:1})):D("",!0),t.reproduct.result==2?(i(),m(d,{key:2,label:"วันที่ผสมพันธุ์",help:"* ห้ามว่าง (วันที่เป็นสัด + 24 ชม)"},{default:n(()=>[o(p,{modelValue:t.reproduct.matingDate,"onUpdate:modelValue":a[5]||(a[5]=s=>t.reproduct.matingDate=s),icon:"calendar",type:"date","lower-limit":t.reproduct.estrusDate,required:""},null,8,["modelValue","lower-limit"])]),_:1})):D("",!0),t.reproduct.result==2?(i(),m(d,{key:3,label:"วันที่ตรวจท้อง",help:"* ห้ามว่าง (วันที่ผสมพันธุ์ + 2 เดือน)"},{default:n(()=>[o(p,{modelValue:t.reproduct.checkDate,"onUpdate:modelValue":a[6]||(a[6]=s=>t.reproduct.checkDate=s),icon:"calendar",type:"date","lower-limit":t.reproduct.matingDate,required:""},null,8,["modelValue","lower-limit"])]),_:1})):D("",!0),o(d,{label:"สถานะ"},{default:n(()=>[o(p,{modelValue:t.reproduct.status,"onUpdate:modelValue":a[7]||(a[7]=s=>t.reproduct.status=s),options:t.status},null,8,["modelValue","options"])]),_:1}),o(d,{label:"สถานะ"},{default:n(()=>[o(x,{modelValue:e.birth.status,"onUpdate:modelValue":a[8]||(a[8]=s=>e.birth.status=s),type:"radio",options:{B:"พ่อพัน",P:"ตั้งครรภ์",A:"แท้ง"}},null,8,["modelValue"])]),_:1}),o(d,{label:"รายละเอียดพ่อพันธุ์/น้ำเชื้อ",help:""},{default:n(()=>[o(p,{modelValue:t.reproduct.dad,"onUpdate:modelValue":a[9]||(a[9]=s=>t.reproduct.dad=s),icon:""},null,8,["modelValue"])]),_:1})]),t.alert?(i(),m(b,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:n(()=>[G(h(t.alert),1)]),_:1})):D("",!0),o(S),o(P,{type:"justify-center"},{default:n(()=>[o(v,{label:"บันทึก",color:"success",type:"submit",loading:t.loading},null,8,["loading"]),o(v,{label:"ยกเลิก",color:"danger",onClick:c.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[A,c.value]])]),_:1},512)),[[A,c.value]])}const pe=H(ue,[["render",de]]),me={data(){return{perPage:12,currentPage:0,openModal:!1,items:[],forms:[{label:"โค",value:"cow",type:"ddl",module:"cow"},{label:"สถานะ",value:"status",options:B()},{label:"ผล",value:"result",options:k()},{label:"วันที่เข้าระบบสืบพันธุ์",value:"loginDate",icon:"calendar",type:"date"},{label:"วันที่เป็นสัด",value:"estrusDate",icon:"calendar",type:"date"},{label:"วันที่ผสมพันธุ์",value:"matingDate",icon:"calendar",type:"date"},{label:"วันที่ตรวจท้อง",value:"checkDate",icon:"calendar",type:"date"}],search:{cow:null,loginDate:null,estrusDate:null,matingDate:null,checkDate:null,status:"",result:""},loading:!1,mode:"create",modalData:null,checked:{code:{value:"seq"},label:{value:"cow.name"}},datas:[{label:"ครั้งที่",class:"text-center",value:"seq"},{label:"รหัสโค",value:"cow.code"},{label:"ชื่อโค",value:"cow.name"},{label:"วันที่เข้าระบบสืบพันธุ์",class:"text-center",value:"loginDate",type:"date"},{label:"ผล",func:e=>k()[e.result].label},{label:"วันที่เป็นสัด",class:"text-center",value:"estrusDate",type:"date"},{label:"วันที่ผสมพันธุ์",class:"text-center",value:"matingDate",type:"date"},{label:"วันที่ตรวจท้อง",class:"text-center",value:"checkDate",type:"date"},{label:"พ่อพันธุ์",value:"dad"},{label:"สถานะ",func:e=>B()[e.status].label},{label:"วิธีรักษา",value:"howTo"}],buttons:[{label:"ลบ",type:"delete",color:"danger",condition:e=>e.status!="2"&&e.status!="3"},{label:"แก้ไข",type:"edit",color:"warning",condition:e=>e.status!="2"&&e.status!="3"}]}},components:{SectionMain:$,LayoutAuthenticated:ee,SectionTitleBarSub:te,Table:ae,Modal:pe,Criteria:re,UserAvatar:oe,CardBox:z,BaseLevel:E,BaseButtons:Y,BaseButton:I},computed:{itemsPaginated(){return this.items?this.items.slice(this.perPage*this.currentPage,this.perPage*(this.currentPage+1)):[]},numPages(){return Math.ceil((this.items?this.items.length:0)/this.perPage)},currentPageHuman(){return this.currentPage+1},pagesList(){const e=[];for(let a=0;a<this.numPages;a++)e.push(a);return e},getDataCopy(){return{...this.modalData}}},created(){this.getReproductions()},methods:{async getReproductions(){this.loading=!0;const e=await y.all(this.search);if(this.items=[],e.data){const a=e.data.reproducts,g=le.groupBy(a,"cow._id");for(let f of Object.keys(g)){const t=g[f];let c=t.length;this.items.push({cow:t[0].cow,count:c,reproducts:t})}}this.loading=!1},async remove(e){this.loading=!0,(await y.delete(e)).data&&(this.getReproductions(),C.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})),this.loading=!1},async removeSelected(e){this.loading=!0;let a=[];for(let f of e)a.push(f._id);(await y.deletes(a)).data&&(this.getReproductions(),C.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})),this.loading=!1},edit(e){this.modalData=e,this.mode="edit",this.openModal=!0},reset(){this.search.cow=null,this.search.loginDate=null,this.search.estrusDate=null,this.search.matingDate=null,this.search.checkDate=null,this.search.status="",this.search.result="",this.getReproductions()},resetData(){this.modalData=null},formatDate(e){return se(e).format("DD/MM/YYYY")},mapReproductResult(e){return k()[e].label},mapReproductStatus(e){return B()[e].label}}},he={key:0,class:"grid lg:gap-3 md:gap-2 gap-1 grid-cols-2 lg:grid-cols-5 md:grid-cols-3"},ge={class:"text-center mt-2"},fe={class:"lg:text-lg text-xs flex justify-center"},_e={class:"dark:text-gray-400 text-orange-600 mr-1"},De={class:"grid grid-cols-2 gap-1 text-sm"},ye=u("div",{class:"dark:text-gray-400"}," ผสมทั้งหมด ",-1),be={class:"text-orange-600 font-extrabold"},ve=u("div",{class:"dark:text-gray-400"}," ผสมล่าสุด ",-1),we={class:"dark:text-gray-100"},Be=u("div",{class:"dark:text-gray-400"}," ผลล่าสุด ",-1),ke={class:"dark:text-gray-100"},Ce={key:1,class:"text-center py-10 text-gray-500 dark:text-gray-400"},Ve=u("p",null," กำลังโหลดข้อมูล...",-1),xe={class:"p-3 mt-2 border-t border-gray-100 dark:border-gray-800 dark:bg-gray-900 lg:rounded-lg shadow-lg"};function Se(e,a,g,f,t,c){const V=r("SectionTitleBarSub"),d=r("Modal"),p=r("Criteria"),x=r("UserAvatar"),b=r("BaseLevel"),S=r("CardBox"),v=r("BaseIcon"),P=r("BaseButton"),L=r("BaseButtons"),R=r("SectionMain"),s=r("LayoutAuthenticated");return i(),m(s,null,{default:n(()=>[o(R,null,{default:n(()=>[o(V,{icon:"reproduction",title:"การผสมพันธุ์",btnText:"เพิ่มการผสมพันธุ์","has-btn-add":"",onOpenModal:a[0]||(a[0]=l=>{t.mode="create",t.openModal=!0})}),o(d,{modelValue:t.openModal,"onUpdate:modelValue":a[1]||(a[1]=l=>t.openModal=l),mode:t.mode,data:c.getDataCopy,onConfirm:c.getReproductions,onCancel:c.resetData},null,8,["modelValue","mode","data","onConfirm","onCancel"]),o(p,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:c.getReproductions,onReset:c.reset,forms:t.forms,search:t.search,btnLoading:t.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),t.loading?(i(),w("div",Ce,[o(v,{path:"dotsCircle",size:"22",class:"animate-spin"}),Ve])):(i(),w("div",he,[(i(!0),w(O,null,j(c.itemsPaginated,l=>{var M;return i(),m(S,{key:(M=l==null?void 0:l.cow)==null?void 0:M._id,class:"bg-gray-200 p-2","has-table":"",hoverable:""},{default:n(()=>{var F,T;return[o(b,{type:"justify-center"},{default:n(()=>{var U;return[o(x,{username:"profile-card",class:"lg:w-24 lg:h-24 w-16 h-16 mt-2",avatar:(U=l==null?void 0:l.cow)==null?void 0:U.image},null,8,["avatar"])]}),_:2},1024),u("div",ge,[u("h4",fe,[u("p",_e,h((F=l==null?void 0:l.cow)==null?void 0:F.code),1),G(" - "+h((T=l==null?void 0:l.cow)==null?void 0:T.name),1)])]),u("div",De,[ye,u("div",null,[u("div",be,h(l.count),1)]),ve,u("h4",we,h(c.formatDate(l.reproducts[0].matingDate)),1),Be,u("div",ke,h(c.mapReproductStatus(l.reproducts[0].status)),1)])]}),_:2},1024)}),128))])),u("div",xe,[o(b,null,{default:n(()=>[o(L,null,{default:n(()=>[(i(!0),w(O,null,j(c.pagesList,l=>(i(),m(P,{key:l,active:l===t.currentPage,label:l+1,teeny:"",onClick:M=>t.currentPage=l},null,8,["active","label","onClick"]))),128))]),_:1}),u("small",null,"หน้า "+h(c.currentPageHuman)+" จาก "+h(c.numPages),1)]),_:1})])]),_:1})]),_:1})}const je=H(me,[["render",Se]]);export{je as default};

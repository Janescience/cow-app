import{z as Y,S as U,U as Q,p as W,m as X,_ as Z,l as $,G as oe,i as ee,j as se,g as te,f as ae,F as r,H as R,I as G,o as u,c as h,w as i,d as l,h as L,s as g,t as p,k as P,e as re,C as ne,D as ie,O as ce,T as ue,E as de,J as w,K as J,L as K,n as S}from"./index-b8576b8d.js";import{_ as le}from"./FormField-0ff30b53.js";import{C as me}from"./Criteria-458afbee.js";import{I as fe}from"./ImageUpload-3b7c6e54.js";import{C as y}from"./cow-70aabb53.js";import{T as D}from"./alert-c5699eab.js";import{D as ge}from"./Cow-c83bc39c.js";import{g as pe}from"./age-calculate-cd6774dd.js";import"./CardBoxCollapse-646ab4d5.js";import"./Vaccine-2a321008.js";const he={data(){return{cow:{image:"/image/img-mockup.png",code:"",name:"",status:1,birthDate:null,adopDate:null,corral:"",dad:"",mom:"",quality:1},status:U("create"),quality:Q("create"),loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},user(){return this.$store.state.auth.user}},watch:{dataEdit:{handler(t,e){t!=null&&this.mode=="edit"&&(this.cow=t,this.cow.image=this.cow.image?this.cow.image:"/image/img-mockup.png")},deep:!0}},methods:{clear(){this.$emit("update:dataEdit",null),this.cow.image="/image/img-mockup.png",this.cow.code="",this.cow.name="",this.cow.birthDate=null,this.cow.adopDate=null,this.cow.status=1,this.cow.corral="",this.cow.dad="",this.cow.mom="",delete this.cow._id},confirmCancel(t){this.value=!1,this.$emit(t)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await y.create(this.cow)&&(this.loading=!1,this.value=!1,this.confirm(),D.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})):await y.update(this.cow._id,this.cow)&&(this.loading=!1,this.value=!1,this.confirm(),D.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"}))}catch(t){console.error("Error : ",t),this.loading=!1,this.alert=t.response.data.message,D.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}}},components:{BaseButton:W,BaseButtons:X,CardBox:Z,BaseDivider:$,OverlayLayer:oe,FormField:le,FormControl:ee,NotificationBar:se,UserAvatar:te,BaseLevel:ae,ImageUpload:fe},props:{modelValue:{type:[String,Number,Boolean],default:null},mode:{type:String,default:""},dataEdit:{type:Object,default:null}}},_e={class:"grid lg:grid-cols-4 grid-cols-2 gap-5 mt-3"};function we(t,e,d,c,a,n){const v=r("ImageUpload"),x=r("BaseLevel"),m=r("FormControl"),f=r("FormField"),b=r("NotificationBar"),_=r("BaseDivider"),B=r("BaseButton"),V=r("BaseButtons"),k=r("CardBox"),q=r("OverlayLayer");return R((u(),h(q,null,{default:i(()=>[R(l(k,{title:d.mode==="create"?"เพิ่มโค":"แก้ไขโค",class:"shadow-lg w-full md:w-3/5 lg:w-1/1 z-50","header-icon":"close",modal:"",form:"",onSubmit:re(n.submit,["prevent"]),onHeaderIconClick:n.cancel},{default:i(()=>[l(v,{modelValue:a.cow.image,"onUpdate:modelValue":e[0]||(e[0]=s=>a.cow.image=s)},null,8,["modelValue"]),l(x,{type:"justify-center mb-6 text-sm"},{default:i(()=>[L(" อัพโหลดรูปภาพ (คลิกที่รูป) ")]),_:1}),g("div",_e,[l(f,{label:"รหัสโค",help:"* ห้ามว่าง"},{default:i(()=>[l(m,{modelValue:a.cow.code,"onUpdate:modelValue":e[1]||(e[1]=s=>a.cow.code=s),icon:"barcode",required:""},null,8,["modelValue"])]),_:1}),l(f,{label:"ชื่อโค",help:"* ห้ามว่าง"},{default:i(()=>[l(m,{modelValue:a.cow.name,"onUpdate:modelValue":e[2]||(e[2]=s=>a.cow.name=s),icon:"cow",required:""},null,8,["modelValue"])]),_:1}),l(f,{label:"วันเกิด",help:"* ห้ามว่าง"},{default:i(()=>[l(m,{modelValue:a.cow.birthDate,"onUpdate:modelValue":e[3]||(e[3]=s=>a.cow.birthDate=s),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),l(f,{label:"วันที่นำเข้าฟาร์ม",help:"* ห้ามว่าง"},{default:i(()=>[l(m,{modelValue:a.cow.adopDate,"onUpdate:modelValue":e[4]||(e[4]=s=>a.cow.adopDate=s),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),l(f,{label:"สถานะ",help:"* ห้ามว่าง"},{default:i(()=>[l(m,{modelValue:a.cow.status,"onUpdate:modelValue":e[5]||(e[5]=s=>a.cow.status=s),options:a.status,icon:"",required:""},null,8,["modelValue","options"])]),_:1}),l(f,{label:"คุณภาพน้ำนม",help:"* ห้ามว่าง"},{default:i(()=>[l(m,{modelValue:a.cow.quality,"onUpdate:modelValue":e[6]||(e[6]=s=>a.cow.quality=s),options:a.quality,icon:""},null,8,["modelValue","options"])]),_:1}),l(f,{label:"คอก"},{default:i(()=>[l(m,{modelValue:a.cow.corral,"onUpdate:modelValue":e[7]||(e[7]=s=>a.cow.corral=s),icon:"barn"},null,8,["modelValue"])]),_:1}),l(f,{label:"พ่อพันธุ์"},{default:i(()=>[l(m,{modelValue:a.cow.dad,"onUpdate:modelValue":e[8]||(e[8]=s=>a.cow.dad=s),icon:"genderMale"},null,8,["modelValue"])]),_:1}),l(f,{label:"แม่พันธุ์"},{default:i(()=>[l(m,{modelValue:a.cow.mom,"onUpdate:modelValue":e[9]||(e[9]=s=>a.cow.mom=s),icon:"genderFemale"},null,8,["modelValue"])]),_:1})]),a.alert?(u(),h(b,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:i(()=>[L(p(a.alert),1)]),_:1})):P("",!0),l(_),l(V,{type:"justify-center"},{default:i(()=>[l(B,{label:"บันทึก",color:"success",type:"submit",loading:a.loading},null,8,["loading"]),l(B,{label:"ยกเลิก",color:"danger",onClick:n.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[G,n.value]])]),_:1},512)),[[G,n.value]])}const ye=Y(he,[["render",we]]),be={data(){return{perPage:20,currentPage:0,modalCow:!1,cowStatus:U(),items:[],forms:[{label:"โค",value:"code",type:"ddl",module:"cow",valueType:"code"},{label:"สถานะ",value:"status",options:U()},{label:"คุณภาพน้ำนม",value:"quality",options:Q()},{label:"คอก",value:"corral",icon:"barn"}],search:{code:null,status:"",quality:"",corral:"",flag:"Y"},mode:"create",loading:!1}},computed:{itemsPaginated(){return this.items?this.items.slice(this.perPage*this.currentPage,this.perPage*(this.currentPage+1)):[]},numPages(){return Math.ceil((this.items?this.items.length:0)/this.perPage)},currentPageHuman(){return this.currentPage+1},pagesList(){const t=[];for(let e=0;e<this.numPages;e++)t.push(e);return t},user(){return this.$store.state.auth.user}},components:{SectionMain:ne,LayoutAuthenticated:ie,BaseButton:W,BaseIcon:ce,BaseButtons:X,CardBox:Z,FormControl:ee,FormField:le,BaseDivider:$,DDLCow:ge,CreateCowModal:ye,Table:ue,SectionTitleBarSub:de,Criteria:me,UserAvatar:te,BaseLevel:ae},created(){this.getCows()},methods:{async getCows(){var e,d;this.loading=!0;const t=await y.all(this.search);if(this.items=[],t.data){this.items=t.data.cows,this.loading=!1;for(let c of this.items){const a=await y.getDetails(c._id);a.data&&(c.grade=(d=(e=a.data)==null?void 0:e.quality)==null?void 0:d.grade,c.sum=a.data.sum)}}},async removeCow(t){this.loading=!0,(await y.update(t,{flag:"N"})).data&&this.getCows(),this.loading=!1},detail(t){this.$router.push({name:"cowDetail",params:{id:t._id}})},reset(){this.search.code=null,this.search.status="",this.search.quality="",this.search.corral=""},filter(t){const e={},d={},c={};return t.status==1?(e.icon="humanPregnant",e.style="text-blue-500 bg-indigo-900 rounded-full  p-1 mr-1"):t.status==2?(e.icon="waterOff",e.style="text-rose-500 bg-red-900 rounded-full p-1 mr-1"):t.status==3?(e.icon="water",e.style="text-white bg-teal-900 rounded-full mr-1"):t.status==4&&(e.icon="babyFaceOutline",e.style="text-yellow-500 bg-amber-900 rounded-full mr-1"),e.desc=this.cowStatus[t.status].label,t.grade==="A+"?d.style="text-lime-500":t.grade==="A"?d.style="text-green-500":t.grade==="B"?d.style="text-white":t.grade==="C"?d.style="text-orange-500":t.grade==="D"&&(d.style="text-red-500"),t.quality==1?(c.icon="emoticonHappyOutline",c.style="text-green-600 "):t.quality==3?(c.icon="emoticonSadOutline",c.style="text-red-600 "):t.quality==2&&(c.icon="emoticonNeutralOutline",c.style="text-gray-400"),{status:e,grade:d,quality:c}},calAge(t){return pe(t)}}},Be={key:0,class:"grid lg:gap-3 md:gap-2 gap-1 grid-cols-3 lg:grid-cols-5 md:grid-cols-4"},Ce={class:"text-center font-extrabold"},ve={class:"text-center mt-2"},xe={class:"lg:text-lg text-md flex justify-center"},Ve={class:"text-gray-400 mr-1"},ke={class:"justify-center flex mt-1 lg:p-2"},qe={key:0},Se={key:1},De={key:1,class:"text-center py-10 text-gray-500 dark:text-gray-400"},Ue=g("p",null," กำลังโหลดข้อมูล...",-1),Le={class:"p-2 mt-2 border-t border-gray-100 dark:border-gray-800"};function Pe(t,e,d,c,a,n){const v=r("SectionTitleBarSub"),x=r("CreateCowModal"),m=r("Criteria"),f=r("UserAvatar"),b=r("BaseLevel"),_=r("BaseIcon"),B=r("CardBox"),V=r("BaseButton"),k=r("BaseButtons"),q=r("SectionMain"),s=r("LayoutAuthenticated");return u(),h(s,null,{default:i(()=>[l(q,null,{default:i(()=>[l(v,{icon:"cow",title:"โค",btnText:"เพิ่มโค","has-btn-add":"",onOpenModal:e[0]||(e[0]=o=>{a.mode="create",a.modalCow=!0})}),l(x,{modelValue:a.modalCow,"onUpdate:modelValue":e[1]||(e[1]=o=>a.modalCow=o),onConfirm:n.getCows,mode:a.mode,dataEdit:t.dataEdit},null,8,["modelValue","onConfirm","mode","dataEdit"]),l(m,{grid:"grid-cols-2 md:grid-cols-3 lg:grid-cols-5",onSearch:n.getCows,onReset:n.reset,forms:a.forms,search:a.search},null,8,["onSearch","onReset","forms","search"]),a.loading?(u(),w("div",De,[l(_,{path:"dotsCircle",size:"22",class:"animate-spin"}),Ue])):(u(),w("div",Be,[(u(!0),w(J,null,K(n.itemsPaginated,o=>(u(),h(B,{key:o.name,onClick:C=>n.detail(o),class:"bg-gray-200","has-table":"",hoverable:""},{default:i(()=>{var C,F,O,A,M,I,N,T,E,j,z,H;return[g("div",Ce,p(o.corral),1),l(b,{type:"justify-center"},{default:i(()=>[l(f,{username:"profile-card",class:"lg:w-24 lg:h-24 w-20 h-20 mt-2",avatar:o.image},null,8,["avatar"])]),_:2},1024),g("div",ve,[g("h4",xe,[g("p",Ve,p(o.code),1),L(" - "+p(o.name),1)]),g("div",ke,[g("p",{class:S(((F=(C=n.filter(o))==null?void 0:C.grade)==null?void 0:F.style)+"  font-extrabold  lg:text-base text-sm text-center bg-gray-800 rounded-full h-6 w-6 shadow-xl mr-1")},[o.grade?(u(),w("div",qe,p(o.grade),1)):(u(),w("div",Se,[l(_,{path:"dotsCircle",size:"16",class:"animate-spin text-gray-500"})]))],2),o.status?(u(),h(_,{key:0,class:S((A=(O=n.filter(o))==null?void 0:O.status)==null?void 0:A.style),path:(I=(M=n.filter(o))==null?void 0:M.status)==null?void 0:I.icon,size:"14"},null,8,["class","path"])):P("",!0),(T=(N=n.filter(o))==null?void 0:N.quality)!=null&&T.icon?(u(),h(_,{key:1,path:(j=(E=n.filter(o))==null?void 0:E.quality)==null?void 0:j.icon,size:"22",class:S((H=(z=n.filter(o))==null?void 0:z.quality)==null?void 0:H.style)},null,8,["path","class"])):P("",!0)])])]}),_:2},1032,["onClick"]))),128))])),g("div",Le,[l(b,null,{default:i(()=>[l(k,null,{default:i(()=>[(u(!0),w(J,null,K(n.pagesList,o=>(u(),h(V,{key:o,active:o===a.currentPage,label:o+1,small:"",onClick:C=>a.currentPage=o},null,8,["active","label","onClick"]))),128))]),_:1}),g("small",null,"หน้า "+p(n.currentPageHuman)+" จาก "+p(n.numPages),1)]),_:1})])]),_:1})]),_:1})}const He=Y(be,[["render",Pe]]);export{He as default};

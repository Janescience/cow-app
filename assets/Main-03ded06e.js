import{z as R,X as p,Y as k,n as F,m as L,_ as U,l as N,G as q,i as O,j as A,f as E,R as P,F as s,H as B,I as S,o as c,c as d,w as r,d as o,q as H,k as h,h as I,t as j,e as z,C as G,D as X,E as Y,T as J}from"./index-c0353c99.js";import{C as K}from"./Criteria-d6a71ef2.js";import{_ as Q}from"./FormField-3396a7fb.js";import{D as W}from"./Cow-48b4cd0f.js";import{T as D}from"./alert-75e2b859.js";import{a as V,r as C}from"./reproduct-4b10c1e3.js";import{R as f}from"./reproduction-c726057c.js";import"./CardBoxCollapse-bc540e4c.js";import"./Recipe-70e0330b.js";import"./Vaccine-feb306c5.js";import"./cow-cadea9a2.js";const Z={data(){return{reproduct:{cow:{},loginDate:new Date,estrusDate:p(new Date,21),matingDate:p(new Date,22),checkDate:k(p(new Date,22),2),dad:"",howTo:"",status:1,result:2},status:V("create"),result:C("create"),loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},user(){return this.$store.state.auth.user}},watch:{"reproduct.loginDate"(e){this.reproduct.estrusDate=p(e,21)},"reproduct.estrusDate"(e){this.reproduct.matingDate=p(e,1)},"reproduct.matingDate"(e){this.reproduct.checkDate=k(e,2)},"reproduct.result"(e){e==1?this.reproduct.status=4:this.reproduct.status=1},data:{handler(e,l){e&&(this.reproduct=e,this.reproduct.loginDate=e.loginDate?new Date(e.loginDate):null,this.reproduct.estrusDate=e.estrusDate?new Date(e.estrusDate):null,this.reproduct.matingDate=e.matingDate?new Date(e.matingDate):null,this.reproduct.checkDate=e.checkDate?new Date(e.checkDate):null)}}},methods:{clear(){this.reproduct={}},confirmCancel(e){this.clear(),this.value=!1,this.$emit(e)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await f.create(this.reproduct)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm"),D.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})):await f.update(this.reproduct._id,this.reproduct)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm"),D.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"}))}catch(e){console.error("Error : ",e),this.loading=!1,this.alert=e.response.data.message}}},components:{BaseButton:F,BaseButtons:L,CardBox:U,BaseDivider:N,OverlayLayer:q,FormField:Q,FormControl:O,NotificationBar:A,BaseLevel:E,DDLCow:W,FormCheckRadioPicker:P},props:{modelValue:{type:[String,Number,Boolean],default:null},mode:{type:String,default:""},data:{type:Object,default:null}}},$={class:"grid grid-cols-2 lg:grid-cols-3 gap-3 mt-1"};function ee(e,l,g,_,t,n){const b=s("DDLCow"),i=s("FormField"),u=s("FormControl"),w=s("FormCheckRadioPicker"),y=s("NotificationBar"),v=s("BaseDivider"),m=s("BaseButton"),T=s("BaseButtons"),M=s("CardBox"),x=s("OverlayLayer");return B((c(),d(x,null,{default:r(()=>[B(o(M,{title:g.mode==="create"?"เพิ่มการสืบพันธุ์":"แก้ไขการสืบพันธุ์",class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"",onSubmit:z(n.submit,["prevent"]),onHeaderIconClick:n.cancel},{default:r(()=>[H("div",$,[o(i,{label:"โค",help:"* ห้ามว่าง",class:"lg:col-span-1 col-span-2"},{default:r(()=>[o(b,{modelValue:t.reproduct.cow,"onUpdate:modelValue":l[0]||(l[0]=a=>t.reproduct.cow=a),valueType:"object"},null,8,["modelValue"])]),_:1}),o(i,{label:"วันที่เข้าระบบสืบพันธุ์",help:"* ห้ามว่าง"},{default:r(()=>[o(u,{modelValue:t.reproduct.loginDate,"onUpdate:modelValue":l[1]||(l[1]=a=>t.reproduct.loginDate=a),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),o(i,{label:"ผล"},{default:r(()=>[o(u,{modelValue:t.reproduct.result,"onUpdate:modelValue":l[2]||(l[2]=a=>t.reproduct.result=a),options:t.result},null,8,["modelValue","options"])]),_:1}),t.reproduct.result==1?(c(),d(i,{key:0,label:"วิธีการรักษา",help:""},{default:r(()=>[o(u,{modelValue:t.reproduct.howTo,"onUpdate:modelValue":l[3]||(l[3]=a=>t.reproduct.howTo=a),icon:"doctor"},null,8,["modelValue"])]),_:1})):h("",!0),t.reproduct.result==2?(c(),d(i,{key:1,label:"วันที่เป็นสัด",help:"* ห้ามว่าง (วันที่เข้าระบบสืบพันธุ์ + 21 วัน)"},{default:r(()=>[o(u,{modelValue:t.reproduct.estrusDate,"onUpdate:modelValue":l[4]||(l[4]=a=>t.reproduct.estrusDate=a),icon:"calendar",type:"date","lower-limit":t.reproduct.loginDate,required:""},null,8,["modelValue","lower-limit"])]),_:1})):h("",!0),t.reproduct.result==2?(c(),d(i,{key:2,label:"วันที่ผสมพันธุ์",help:"* ห้ามว่าง (วันที่เป็นสัด + 24 ชม)"},{default:r(()=>[o(u,{modelValue:t.reproduct.matingDate,"onUpdate:modelValue":l[5]||(l[5]=a=>t.reproduct.matingDate=a),icon:"calendar",type:"date","lower-limit":t.reproduct.estrusDate,required:""},null,8,["modelValue","lower-limit"])]),_:1})):h("",!0),t.reproduct.result==2?(c(),d(i,{key:3,label:"วันที่ตรวจท้อง",help:"* ห้ามว่าง (วันที่ผสมพันธุ์ + 2 เดือน)"},{default:r(()=>[o(u,{modelValue:t.reproduct.checkDate,"onUpdate:modelValue":l[6]||(l[6]=a=>t.reproduct.checkDate=a),icon:"calendar",type:"date","lower-limit":t.reproduct.matingDate,required:""},null,8,["modelValue","lower-limit"])]),_:1})):h("",!0),o(i,{label:"สถานะ"},{default:r(()=>[o(u,{modelValue:t.reproduct.status,"onUpdate:modelValue":l[7]||(l[7]=a=>t.reproduct.status=a),options:t.status},null,8,["modelValue","options"])]),_:1}),o(i,{label:"สถานะ"},{default:r(()=>[o(w,{modelValue:e.birth.status,"onUpdate:modelValue":l[8]||(l[8]=a=>e.birth.status=a),type:"radio",options:{B:"พ่อพัน",P:"ตั้งครรภ์",A:"แท้ง"}},null,8,["modelValue"])]),_:1}),o(i,{label:"รายละเอียดพ่อพันธุ์/น้ำเชื้อ",help:""},{default:r(()=>[o(u,{modelValue:t.reproduct.dad,"onUpdate:modelValue":l[9]||(l[9]=a=>t.reproduct.dad=a),icon:""},null,8,["modelValue"])]),_:1})]),t.alert?(c(),d(y,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:r(()=>[I(j(t.alert),1)]),_:1})):h("",!0),o(v),o(T,{type:"justify-center"},{default:r(()=>[o(m,{label:"บันทึก",color:"success",type:"submit",loading:t.loading},null,8,["loading"]),o(m,{label:"ยกเลิก",color:"danger",onClick:n.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[S,n.value]])]),_:1},512)),[[S,n.value]])}const te=R(Z,[["render",ee]]),le={data(){return{openModal:!1,items:[],forms:[{label:"โค",value:"cow",type:"ddl",module:"cow"},{label:"สถานะ",value:"status",options:V()},{label:"ผล",value:"result",options:C()},{label:"วันที่เข้าระบบสืบพันธุ์",value:"loginDate",icon:"calendar",type:"date"},{label:"วันที่เป็นสัด",value:"estrusDate",icon:"calendar",type:"date"},{label:"วันที่ผสมพันธุ์",value:"matingDate",icon:"calendar",type:"date"},{label:"วันที่ตรวจท้อง",value:"checkDate",icon:"calendar",type:"date"}],search:{cow:null,loginDate:null,estrusDate:null,matingDate:null,checkDate:null,status:"",result:""},loading:!1,mode:"create",modalData:null,checked:{code:{value:"seq"},label:{value:"cow.name"}},datas:[{label:"ครั้งที่",class:"text-center",value:"seq"},{label:"รหัสโค",value:"cow.code"},{label:"ชื่อโค",value:"cow.name"},{label:"วันที่เข้าระบบสืบพันธุ์",class:"text-center",value:"loginDate",type:"date"},{label:"ผล",func:e=>C()[e.result].label},{label:"วันที่เป็นสัด",class:"text-center",value:"estrusDate",type:"date"},{label:"วันที่ผสมพันธุ์",class:"text-center",value:"matingDate",type:"date"},{label:"วันที่ตรวจท้อง",class:"text-center",value:"checkDate",type:"date"},{label:"พ่อพันธุ์",value:"dad"},{label:"สถานะ",func:e=>V()[e.status].label},{label:"วิธีรักษา",value:"howTo"}],buttons:[{label:"ลบ",type:"delete",color:"danger",condition:e=>e.status!="2"&&e.status!="3"},{label:"แก้ไข",type:"edit",color:"warning",condition:e=>e.status!="2"&&e.status!="3"}]}},components:{SectionMain:G,LayoutAuthenticated:X,SectionTitleBarSub:Y,Table:J,Modal:te,Criteria:K},computed:{getDataCopy(){return{...this.modalData}}},created(){this.getReproductions()},methods:{async getReproductions(){this.loading=!0;const e=await f.all(this.search);this.items=[],e.data&&(this.items=e.data.reproducts),this.loading=!1},async remove(e){this.loading=!0,(await f.delete(e)).data&&(this.getReproductions(),D.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})),this.loading=!1},async removeSelected(e){this.loading=!0;let l=[];for(let _ of e)l.push(_._id);(await f.deletes(l)).data&&(this.getReproductions(),D.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})),this.loading=!1},edit(e){this.modalData=e,this.mode="edit",this.openModal=!0},reset(){this.search.cow=null,this.search.loginDate=null,this.search.estrusDate=null,this.search.matingDate=null,this.search.checkDate=null,this.search.status="",this.search.result="",this.getReproductions()},resetData(){this.modalData=null}}};function oe(e,l,g,_,t,n){const b=s("SectionTitleBarSub"),i=s("Modal"),u=s("Criteria"),w=s("Table"),y=s("SectionMain"),v=s("LayoutAuthenticated");return c(),d(v,null,{default:r(()=>[o(y,null,{default:r(()=>[o(b,{icon:"reproduction",title:"การสืบพันธุ์",btnText:"เพิ่มการสืบพันธุ์","has-btn-add":"",onOpenModal:l[0]||(l[0]=m=>{t.mode="create",t.openModal=!0})}),o(i,{modelValue:t.openModal,"onUpdate:modelValue":l[1]||(l[1]=m=>t.openModal=m),mode:t.mode,data:n.getDataCopy,onConfirm:n.getReproductions,onCancel:n.resetData},null,8,["modelValue","mode","data","onConfirm","onCancel"]),o(u,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:n.getReproductions,onReset:n.reset,forms:t.forms,search:t.search,btnLoading:t.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),o(w,{title:"รายการสืบพันธุ์","has-checkbox":"","checked-data":t.checked,items:t.items,datas:t.datas,buttons:t.buttons,onEdit:n.edit,onDelete:n.remove,onDeleteSelected:n.removeSelected,loading:t.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const fe=R(le,[["render",oe]]);export{fe as default};

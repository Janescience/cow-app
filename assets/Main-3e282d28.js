import{z as k,p as x,m as T,_ as Y,l as F,F as N,i as L,j as H,f as U,N as O,E as o,G as y,H as B,o as b,c as w,w as s,d as l,s as E,h as q,t as j,k as A,e as I,y as u,B as D,S as R,C as z,D as G}from"./index-5091c3d1.js";import{T as P}from"./Table-f88c7575.js";import{C as Q}from"./Criteria-79eccba4.js";import{_ as W}from"./FormField-d43f591f.js";import{D as J}from"./Cow-2f6cbb08.js";import{T as v}from"./alert-a19535f0.js";import{H as C}from"./heal-b509bd64.js";import{_ as K}from"./FormCheckRadioPicker-80774e1f.js";import"./Vaccine-ae1839c3.js";import"./cow-3718dc28.js";const X={data(){return{heal:{cow:null,date:new Date,disease:"",method:"",healer:"",amount:null},loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(a){this.$emit("update:modelValue",a)}},user(){return this.$store.state.auth.user}},watch:{data(a){a&&this.mode==="edit"&&(this.heal=a,this.heal.date=new Date(a.date))}},methods:{clear(){this.heal.cow=null,this.heal.date=new Date,this.heal.disease="",this.heal.method="",this.heal.healer="",this.heal.amount=null},confirmCancel(a){this.value=!1,this.$emit(a)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await C.create(this.heal)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")):await C.update(this.heal._id,this.heal)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")),v.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})}catch(a){console.error("Error : ",a),this.loading=!1,this.alert=a.response.data.message,v.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}}},components:{BaseButton:x,BaseButtons:T,CardBox:Y,BaseDivider:F,OverlayLayer:N,FormField:W,FormControl:L,NotificationBar:H,BaseLevel:U,DDLCow:J,FormCheckRadioPicker:K,BaseIcon:O},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},Z={class:"grid grid-cols-2 lg:grid-cols-3 gap-5"};function $(a,e,i,f,t,n){const p=o("DDLCow"),c=o("FormField"),d=o("FormControl"),_=o("NotificationBar"),g=o("BaseDivider"),m=o("BaseButton"),h=o("BaseButtons"),S=o("CardBox"),M=o("OverlayLayer");return y((b(),w(M,null,{default:s(()=>[y(l(S,{title:(this.mode==="create"?"บันทึก":"แก้ไข")+"การรักษา",class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"",onSubmit:I(n.submit,["prevent"]),onHeaderIconClick:n.cancel},{default:s(()=>[E("div",Z,[l(c,{label:"โค",help:"* ห้ามว่าง"},{default:s(()=>[l(p,{modelValue:t.heal.cow,"onUpdate:modelValue":e[0]||(e[0]=r=>t.heal.cow=r)},null,8,["modelValue"])]),_:1}),l(c,{label:"วันที่รักษา",help:"* ห้ามว่าง"},{default:s(()=>[l(d,{modelValue:t.heal.date,"onUpdate:modelValue":e[1]||(e[1]=r=>t.heal.date=r),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),l(c,{label:"คนรักษา"},{default:s(()=>[l(d,{modelValue:t.heal.healer,"onUpdate:modelValue":e[2]||(e[2]=r=>t.heal.healer=r),icon:"doctor"},null,8,["modelValue"])]),_:1}),l(c,{label:"อาการ/โรค",help:"* ห้ามว่าง",class:"col-span-2"},{default:s(()=>[l(d,{modelValue:t.heal.disease,"onUpdate:modelValue":e[3]||(e[3]=r=>t.heal.disease=r),type:"textarea",required:""},null,8,["modelValue"])]),_:1}),l(c,{label:"วิธีการรักษา",class:"col-span-2 lg:col-span-1"},{default:s(()=>[l(d,{modelValue:t.heal.method,"onUpdate:modelValue":e[4]||(e[4]=r=>t.heal.method=r),type:"textarea"},null,8,["modelValue"])]),_:1}),l(c,{label:"ค่ารักษา"},{default:s(()=>[l(d,{modelValue:t.heal.amount,"onUpdate:modelValue":e[5]||(e[5]=r=>t.heal.amount=r),type:"number"},null,8,["modelValue"])]),_:1})]),t.alert?(b(),w(_,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:s(()=>[q(j(t.alert),1)]),_:1})):A("",!0),l(g),l(h,{type:"justify-center"},{default:s(()=>[l(m,{label:"บันทึก",color:"success",type:"submit",loading:t.loading},null,8,["loading"]),l(m,{label:"ยกเลิก",color:"danger",onClick:n.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[B,n.value]])]),_:1},512)),[[B,n.value]])}const ee=k(X,[["render",$]]);async function te(a={}){let e="?";if(a.cow&&(e=e+`cow=${a.cow}&`),a.date){const i=D(new Date(a.date)).format("YYYY-MM-DD");e=e+`date=${i}&`}return a?e.replace(/&*$/,""):""}class ae{async all(e){const i=await te(e);return u.get("/worker"+i).then(f=>f)}get(e){return u.get(`/worker/${e}`)}create(e){return e.date&&(e.date=D(new Date(e.date)).format("YYYY-MM-DD")),u.post("/worker",e)}delete(e){return u.delete(`/worker/${e}`)}update(e,i){return i.date&&(i.date=D(new Date(i.date)).format("YYYY-MM-DD")),u.put(`/worker/${e}`,i)}}const V=new ae,le={data(){return{openModal:!1,modalData:null,items:[],forms:[{label:"สถานะ",value:"status",type:"ddl",module:"worker"}],search:{status:null},loading:!1,mode:"create",dataEdit:null,checked:{code:{value:"name"},label:{value:"duty"}},datas:[{label:"ชื่อ",value:"name"},{label:"อายุ",class:"text-center",value:"age"},{label:"วันที่เริ่มงาน",class:"text-center",value:"startDate",type:"date"},{label:"วันที่สิ้นสุดงาน",class:"text-center",value:"endDate",type:"date"},{label:"หน้าที่",value:"duty"},{label:"เงินเดือน",value:"salary",class:"text-right"},{label:"เบอร​์โทรศัพท์",class:"text-center",value:"phoneNumber"},{label:"สถานะ",value:"status"},{label:"ประเทศ",value:"country"},{label:"หมายเหตุ",value:"remark"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},components:{SectionMain:R,LayoutAuthenticated:z,SectionTitleBarSub:G,Table:P,Modal:ee,Criteria:Q},computed:{user(){return this.$store.state.auth.user}},created(){this.getDatas()},methods:{async getDatas(a){this.loading=!0;const e=await V.all(a);this.items=[],e.data&&(this.items=e.data.workers),this.loading=!1},async remove(a){this.loading=!0,(await V.delete(a)).data&&this.getDatas(),this.loading=!1,v.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},edit(a){this.modalData=a,this.mode="edit",this.openModal=!0},reset(){this.search.status=null}}};function oe(a,e,i,f,t,n){const p=o("SectionTitleBarSub"),c=o("Modal"),d=o("Criteria"),_=o("Table"),g=o("SectionMain"),m=o("LayoutAuthenticated");return b(),w(m,null,{default:s(()=>[l(g,null,{default:s(()=>[l(p,{icon:"accountHardHat",title:"คนงาน","has-btn-add":"",onOpenModal:e[0]||(e[0]=h=>{t.mode="create",t.openModal=!0}),btnText:"เพิ่มคนงาน"}),l(c,{modelValue:t.openModal,"onUpdate:modelValue":e[1]||(e[1]=h=>t.openModal=h),data:t.modalData,mode:t.mode,onConfirm:n.getDatas},null,8,["modelValue","data","mode","onConfirm"]),l(d,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:n.getDatas,onReset:n.reset,forms:t.forms,search:t.search},null,8,["onSearch","onReset","forms","search"]),l(_,{title:"รายการคนงาน","has-checkbox":"","checked-data":t.checked,items:t.items,datas:t.datas,buttons:t.buttons,onEdit:n.edit,onDelete:n.remove,onDeleteSelected:a.removeSelected,loading:t.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const pe=k(le,[["render",oe]]);export{pe as default};

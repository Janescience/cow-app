import{z as q,p as F,m as U,_ as M,l as I,F as z,i as N,j as R,g as G,f as T,E as s,G as x,H as S,o as u,c as m,w as n,d as o,h as L,s as g,t as V,k as J,e as K,S as Q,C as Y,N as W,D as X,Q as Z,I as p,J as P,K as D}from"./index-402b946c.js";import{_ as E}from"./FormField-5308b665.js";import{T as $}from"./Table-f69f065c.js";import{C as ee}from"./Criteria-a121cdef.js";import{I as te}from"./ImageUpload-8684effa.js";import{C as f}from"./cow-3353cd15.js";import{s as A,q as O}from"./cow-ae6b6e19.js";import{T as v}from"./alert-824d99b3.js";import{D as oe}from"./Cow-e63a0200.js";import{g as ae}from"./age-calculate-bb92e417.js";import"./FormCheckRadioPicker-3c17dbb5.js";import"./Vaccine-d8940fa4.js";const le={data(){return{cow:{image:"/image/img-mockup.png",code:"",name:"",status:1,birthDate:null,corral:"",dad:"",mom:"",quality:1},status:A("create"),quality:O("create"),loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(l){this.$emit("update:modelValue",l)}},user(){return this.$store.state.auth.user}},watch:{dataEdit:{handler(l,a){l!=null&&this.mode=="edit"&&(this.cow=l,this.cow.image=this.cow.image?this.cow.image:"/image/img-mockup.png")},deep:!0}},methods:{clear(){this.$emit("update:dataEdit",null),this.cow.image="/image/img-mockup.png",this.cow.code="",this.cow.name="",this.cow.birthDate=null,this.cow.status=1,this.cow.corral="",this.cow.dad="",this.cow.mom="",delete this.cow._id},confirmCancel(l){this.value=!1,this.$emit(l)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await f.create(this.cow)&&(this.loading=!1,this.value=!1,this.confirm(),v.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})):await f.update(this.cow._id,this.cow)&&(this.loading=!1,this.value=!1,this.confirm(),v.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"}))}catch(l){console.error("Error : ",l),this.loading=!1,this.alert=l.response.data.message,v.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}}},components:{BaseButton:F,BaseButtons:U,CardBox:M,BaseDivider:I,OverlayLayer:z,FormField:E,FormControl:N,NotificationBar:R,UserAvatar:G,BaseLevel:T,ImageUpload:te},props:{modelValue:{type:[String,Number,Boolean],default:null},mode:{type:String,default:""},dataEdit:{type:Object,default:null}}},se={class:"grid lg:grid-cols-4 grid-cols-2 gap-5 mt-3"};function ne(l,a,k,H,t,i){const h=s("ImageUpload"),_=s("BaseLevel"),r=s("FormControl"),c=s("FormField"),w=s("NotificationBar"),C=s("BaseDivider"),d=s("BaseButton"),B=s("BaseButtons"),y=s("CardBox"),b=s("OverlayLayer");return x((u(),m(b,null,{default:n(()=>[x(o(y,{title:k.mode==="create"?"เพิ่มโค":"แก้ไขโค",class:"shadow-lg w-full md:w-3/5 lg:w-1/1 z-50","header-icon":"close",modal:"",form:"",onSubmit:K(i.submit,["prevent"]),onHeaderIconClick:i.cancel},{default:n(()=>[o(h,{modelValue:t.cow.image,"onUpdate:modelValue":a[0]||(a[0]=e=>t.cow.image=e)},null,8,["modelValue"]),o(_,{type:"justify-center mb-6 text-sm"},{default:n(()=>[L(" อัพโหลดรูปภาพ (คลิกที่รูป) ")]),_:1}),g("div",se,[o(c,{label:"รหัสโค",help:"* ห้ามว่าง"},{default:n(()=>[o(r,{modelValue:t.cow.code,"onUpdate:modelValue":a[1]||(a[1]=e=>t.cow.code=e),icon:"barcode",required:""},null,8,["modelValue"])]),_:1}),o(c,{label:"ชื่อโค",help:"* ห้ามว่าง"},{default:n(()=>[o(r,{modelValue:t.cow.name,"onUpdate:modelValue":a[2]||(a[2]=e=>t.cow.name=e),icon:"cow",required:""},null,8,["modelValue"])]),_:1}),o(c,{label:"วันเกิด",help:"* ห้ามว่าง"},{default:n(()=>[o(r,{modelValue:t.cow.birthDate,"onUpdate:modelValue":a[3]||(a[3]=e=>t.cow.birthDate=e),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),o(c,{label:"สถานะ",help:"* ห้ามว่าง"},{default:n(()=>[o(r,{modelValue:t.cow.status,"onUpdate:modelValue":a[4]||(a[4]=e=>t.cow.status=e),options:t.status,icon:"",required:""},null,8,["modelValue","options"])]),_:1}),o(c,{label:"คุณภาพน้ำนม",help:"* ห้ามว่าง"},{default:n(()=>[o(r,{modelValue:t.cow.quality,"onUpdate:modelValue":a[5]||(a[5]=e=>t.cow.quality=e),options:t.quality,icon:""},null,8,["modelValue","options"])]),_:1}),o(c,{label:"คอก"},{default:n(()=>[o(r,{modelValue:t.cow.corral,"onUpdate:modelValue":a[6]||(a[6]=e=>t.cow.corral=e),icon:"barn"},null,8,["modelValue"])]),_:1}),o(c,{label:"พ่อพันธุ์"},{default:n(()=>[o(r,{modelValue:t.cow.dad,"onUpdate:modelValue":a[7]||(a[7]=e=>t.cow.dad=e),icon:"genderMale"},null,8,["modelValue"])]),_:1}),o(c,{label:"แม่พันธุ์"},{default:n(()=>[o(r,{modelValue:t.cow.mom,"onUpdate:modelValue":a[8]||(a[8]=e=>t.cow.mom=e),icon:"genderFemale"},null,8,["modelValue"])]),_:1})]),t.alert?(u(),m(w,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:n(()=>[L(V(t.alert),1)]),_:1})):J("",!0),o(C),o(B,{type:"justify-center"},{default:n(()=>[o(d,{label:"บันทึก",color:"success",type:"submit",loading:t.loading},null,8,["loading"]),o(d,{label:"ยกเลิก",color:"danger",onClick:i.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[S,i.value]])]),_:1},512)),[[S,i.value]])}const ie=q(le,[["render",ne]]),re={data(){return{perPage:18,currentPage:0,modalCow:!1,items:[],forms:[{label:"โค",value:"code",type:"ddl",module:"cow",valueType:"code"},{label:"สถานะ",value:"status",options:A()},{label:"คุณภาพน้ำนม",value:"quality",options:O()},{label:"คอก",value:"corral",icon:"barn"}],search:{code:null,status:"",corral:"",flag:"Y"},mode:"create",loading:!1}},computed:{itemsPaginated(){return this.items?this.items.slice(this.perPage*this.currentPage,this.perPage*(this.currentPage+1)):[]},numPages(){return Math.ceil((this.items?this.items.length:0)/this.perPage)},currentPageHuman(){return this.currentPage+1},pagesList(){const l=[];for(let a=0;a<this.numPages;a++)l.push(a);return l},user(){return this.$store.state.auth.user}},components:{SectionMain:Q,LayoutAuthenticated:Y,BaseButton:F,BaseIcon:W,BaseButtons:U,CardBox:M,FormControl:N,FormField:E,BaseDivider:I,DDLCow:oe,CreateCowModal:ie,Table:$,SectionTitleBarSub:X,Criteria:ee,CardBoxClient:Z,BaseLevel:T},created(){this.getCows()},methods:{async getCows(){this.loading=!0;const l=await f.all(this.search);this.items=[],l.data&&(this.items=l.data.cows),this.loading=!1},async removeCow(l){this.loading=!0,(await f.update(l,{flag:"N"})).data&&this.getCows(),this.loading=!1},detail(l){this.$router.push({name:"cowDetail",params:{id:l._id}})},reset(){this.search.code=null,this.search.status="",this.search.corral=""},calAge(l){return ae(l)}}},ce={key:0,class:"grid lg:gap-3 md:gap-2 gap-1 grid-cols-3 lg:grid-cols-6 md:grid-cols-4"},ue={key:1,class:"text-center py-10 text-gray-500 dark:text-gray-400"},me=g("p",null," กำลังโหลดข้อมูล...",-1),de={class:"p-2 mt-2 border-t border-gray-100 dark:border-gray-800"};function pe(l,a,k,H,t,i){const h=s("SectionTitleBarSub"),_=s("CreateCowModal"),r=s("Criteria"),c=s("CardBoxClient"),w=s("BaseIcon"),C=s("BaseButton"),d=s("BaseButtons"),B=s("BaseLevel"),y=s("SectionMain"),b=s("LayoutAuthenticated");return u(),m(b,null,{default:n(()=>[o(y,null,{default:n(()=>[o(h,{icon:"cow",title:"โค",btnText:"เพิ่มโค","has-btn-add":"",onOpenModal:a[0]||(a[0]=e=>{t.mode="create",t.modalCow=!0})}),o(_,{modelValue:t.modalCow,"onUpdate:modelValue":a[1]||(a[1]=e=>t.modalCow=e),onConfirm:i.getCows,mode:t.mode,dataEdit:l.dataEdit},null,8,["modelValue","onConfirm","mode","dataEdit"]),o(r,{grid:"grid-cols-2 md:grid-cols-3 lg:grid-cols-5",onSearch:i.getCows,onReset:i.reset,forms:t.forms,search:t.search},null,8,["onSearch","onReset","forms","search"]),t.loading?(u(),p("div",ue,[o(w,{path:"dotsCircle",size:"22",class:"animate-spin"}),me])):(u(),p("div",ce,[(u(!0),p(P,null,D(i.itemsPaginated,e=>(u(),m(c,{key:e.name,img:e.image,name:e.name,"sub-text":"คอก "+(e.corral?e.corral:"-"),date:e.birthDate,status:e.status,onClick:j=>i.detail(e),quality:e.quality},null,8,["img","name","sub-text","date","status","onClick","quality"]))),128))])),g("div",de,[o(B,null,{default:n(()=>[o(d,null,{default:n(()=>[(u(!0),p(P,null,D(i.pagesList,e=>(u(),m(C,{key:e,active:e===t.currentPage,label:e+1,small:"",onClick:j=>t.currentPage=e},null,8,["active","label","onClick"]))),128))]),_:1}),g("small",null,"หน้า "+V(i.currentPageHuman)+" จาก "+V(i.numPages),1)]),_:1})])]),_:1})]),_:1})}const xe=q(re,[["render",pe]]);export{xe as default};

import{b as M,_ as F,a as S,d as O,c as j}from"./BaseDivider-128ffef2.js";import{_ as Q}from"./LayoutAuthenticated-76580d65.js";import{_ as z}from"./SectionTitleBarSub-8cf7cf92.js";import{v as L,y as E,h as P,_ as T,z as n,G as k,H as q,o as _,c as g,w as i,d as a,j as s,t as d,g as B,f as H,e as Y}from"./index-f90e0597.js";import{_ as N}from"./FormField-053b235d.js";import{_ as U}from"./FormControl-6d788e17.js";import{T as A}from"./Table-fdced705.js";import{C as G}from"./Criteria-de534fd8.js";import{T as v}from"./alert-f180e073.js";import{a as J}from"./CardBoxModal-c6f30598.js";import{_ as K}from"./NotificationBar-c246807f.js";import{D as W}from"./Recipe-ef6af37b.js";import{F as V}from"./food-7aa63764.js";import{C as X}from"./cow-251b18d6.js";import{a as x,y as I}from"./date-93646f70.js";import{_ as Z}from"./FormCheckRadioPicker-eb05c5fb.js";import"./UserAvatar-e6276c17.js";import"./CardBoxCollapse-ade1635e.js";import"./Cow-877601b4.js";import"./Vaccine-9dc8abfa.js";import"./Corral-1e967dc8.js";const $={data(){return{food:{corral:"",numCow:0,year:new Date().getFullYear(),month:new Date().getMonth()+1},foodDetail:{recipe:{},qty:null},foodDetails:[],loading:!1,alert:"",ddlCorral:[],numCowCorral:null,corrals:[],months:x(),years:I(),foodDetailColumns:[{label:"สูตรอาหาร",value:"recipe.name"},{label:"ราคา/กก.",value:"recipe.amount",type:"currency"},{label:"จำนวน/วัน (กก.)",value:"qty",type:"number"},{label:"รวมเป็นเงิน/วัน",value:"amount",type:"currency"}],buttons:[{label:"ลบ",type:"delete",color:"danger"}]}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},watch:{data(e){var t;this.food=e,this.food.year=e!=null&&e.year?e.year:new Date().getFullYear(),this.food.month=e!=null&&e.month?e.month:new Date().getMonth()+1,this.foodDetails=e!=null&&e.foodDetails?e.foodDetails:[];for(let r of this.foodDetails)r.recipe=(t=r.relate)==null?void 0:t.recipe},"food.corral"(e){e&&(this.numCowCorral=this.corrals[e].length>0?this.corrals[e].length:null,this.mode!=="edit"&&(this.food.numCow=this.numCowCorral))}},created(){this.getCorrals()},methods:{clear(){this.food={},this.foodDetails=[]},confirmCancel(e){this.value=!1,this.$emit(e)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},add(){const e=this.foodDetail.recipe,t=this.foodDetail.qty,r=t*e.amount;this.foodDetails.push({recipe:e,qty:t,amount:r}),this.foodDetail={}},sum(){const e=this.foodDetails.reduce((o,l)=>o+l.amount,0),t=this.foodDetails.reduce((o,l)=>o+l.qty,0),r=e/(this.numCowCorral?this.numCowCorral:0),m=t/(this.numCowCorral?this.numCowCorral:0);return{qty:t,amount:e,amountPerCow:r,qtyPerCow:m}},daysOfMonth(){return new Date(this.food.year,this.food.month,0).getDate()},remove(e){let t=this.cows.indexOf(e);t!==-1&&this.foodDetails.splice(t,1)},async submit(){this.loading=!0,this.alert="",this.food.foodDetails=this.foodDetails,this.food.numCow=this.numCowCorral;try{this.mode==="create"?await V.create(this.food)&&(this.loading=!1,this.confirm()):await V.update(this.food._id,this.food)&&(this.loading=!1,this.confirm()),v.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})}catch(e){console.error("Error : ",e),this.clear(),this.loading=!1,this.alert=await e.response.data.message,v.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}},async getCorrals(){const e=await X.all();if(e){const t=e.data.cows;this.corrals=E.groupBy(t,"corral");for(let r of Object.keys(this.corrals))this.ddlCorral.push({id:r,label:r})}}},components:{BaseButton:M,BaseButtons:P,CardBox:F,BaseDivider:S,OverlayLayer:J,FormField:N,FormControl:U,NotificationBar:K,BaseLevel:T,DDLRecipe:W,FormCheckRadioPicker:Z,BaseIcon:O,Table:A},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},ee={class:"grid lg:grid-cols-5 grid-cols-2 gap-5"},te={class:"grid lg:grid-cols-3 grid-cols-2 gap-5"},oe={class:"overflow-x-auto"},le=s("thead",null,[s("tr",null,[s("th"),s("th",{class:"whitespace-nowrap"},"จำนวน/วัน (กก.) "),s("th",{class:"whitespace-nowrap"},"ราคา/วัน "),s("th",{class:"whitespace-nowrap"},"จำนวน/เดือน (กก.)"),s("th",{class:"whitespace-nowrap"},"ราคา/เดือน")])],-1),ae=s("td",{class:"whitespace-nowrap"},"โค 1 ตัว",-1);function se(e,t,r,m,o,l){const f=n("FormControl"),u=n("FormField"),D=n("DDLRecipe"),h=n("BaseButton"),C=n("BaseButtons"),b=n("Table"),p=n("CardBox"),w=n("NotificationBar"),y=n("BaseDivider"),R=n("OverlayLayer");return k((_(),g(R,null,{default:i(()=>[k(a(p,{title:(this.mode==="create"?"บันทึก":"แก้ไข")+"การให้อาหาร",class:"shadow-lg w-full lg:w-3/4 z-50","header-icon":"close",modal:"",form:"","has-scroll":"",onSubmit:Y(l.submit,["prevent"]),onHeaderIconClick:l.cancel},{default:i(()=>[s("div",ee,[a(u,{label:"ปี พ.ศ.",help:"* ห้ามว่าง"},{default:i(()=>[a(f,{modelValue:o.food.year,"onUpdate:modelValue":t[0]||(t[0]=c=>o.food.year=c),options:o.years},null,8,["modelValue","options"])]),_:1}),a(u,{label:"เดือน",help:"* ห้ามว่าง"},{default:i(()=>[a(f,{modelValue:o.food.month,"onUpdate:modelValue":t[1]||(t[1]=c=>o.food.month=c),options:o.months},null,8,["modelValue","options"])]),_:1}),a(u,{label:"คอก"},{default:i(()=>[a(f,{modelValue:o.food.corral,"onUpdate:modelValue":t[2]||(t[2]=c=>o.food.corral=c),required:"",disabled:""},null,8,["modelValue"])]),_:1}),a(u,{label:"จำนวนโค"},{default:i(()=>[a(f,{modelValue:o.food.numCow,"onUpdate:modelValue":t[3]||(t[3]=c=>o.food.numCow=c),required:"",disabled:""},null,8,["modelValue"])]),_:1})]),o.food.corral?(_(),g(p,{key:0,title:"รายละเอียดสูตรอาหาร","header-icon":"",class:"dark:bg-slate-700 lg:mt-0 mt-3"},{default:i(()=>[s("div",te,[a(u,{label:"สูตรอาหาร",help:"* ห้ามว่าง",class:"lg:col-span-1 col-span-2"},{default:i(()=>[a(D,{modelValue:o.foodDetail.recipe,"onUpdate:modelValue":t[4]||(t[4]=c=>o.foodDetail.recipe=c),valueType:"object"},null,8,["modelValue"])]),_:1}),a(u,{label:"จำนวน/วัน (กก.)",help:"* ห้ามว่าง"},{default:i(()=>[a(f,{modelValue:o.foodDetail.qty,"onUpdate:modelValue":t[5]||(t[5]=c=>o.foodDetail.qty=c),icon:"shaker",type:"number"},null,8,["modelValue"])]),_:1}),a(C,{type:"justify-start"},{default:i(()=>[a(h,{label:"ล้าง",color:"danger",onClick:t[6]||(t[6]=c=>e.reset())}),a(h,{disabled:!o.foodDetail.recipe||!o.foodDetail.qty,label:"เพิ่ม",color:"info",onClick:t[7]||(t[7]=c=>l.add())},null,8,["disabled"])]),_:1})]),a(b,{title:"รายการสูตรอาหาร ("+o.foodDetails.length+" รายการ)",items:o.foodDetails,datas:o.foodDetailColumns,buttons:o.buttons,perPage:"5",onDelete:l.remove},null,8,["title","items","datas","buttons","onDelete"]),o.food.corral?(_(),g(p,{key:0,title:"สรุป","header-icon":"","has-table":"",class:"dark:bg-slate-800 mt-3"},{default:i(()=>[s("div",oe,[s("table",null,[le,s("tbody",null,[s("tr",null,[ae,s("td",null,d(e.$filters.number(l.sum().qtyPerCow)),1),s("td",null,d(e.$filters.currency(l.sum().amountPerCow)),1),s("td",null,d(e.$filters.number(l.sum().qtyPerCow*l.daysOfMonth())),1),s("td",null,d(e.$filters.currency(l.sum().amountPerCow*l.daysOfMonth())),1)]),s("tr",null,[s("td",null,"โค "+d(o.numCowCorral)+" ตัว",1),s("td",null,d(e.$filters.number(l.sum().qty)),1),s("td",null,d(e.$filters.currency(l.sum().amount)),1),s("td",null,d(e.$filters.number(l.sum().qty*l.daysOfMonth())),1),s("td",null,d(e.$filters.currency(l.sum().amount*l.daysOfMonth())),1)])])])])]),_:1})):B("",!0)]),_:1})):B("",!0),o.alert?(_(),g(w,{key:1,color:"danger",outline:"",icon:"alertCircleOutline"},{default:i(()=>[H(d(o.alert),1)]),_:1})):B("",!0),a(y),a(C,{type:"justify-center"},{default:i(()=>[a(h,{label:"บันทึก",color:"success",type:"submit",disabled:o.foodDetails.length===0,loading:o.loading},null,8,["disabled","loading"]),a(h,{label:"ยกเลิก",color:"danger",onClick:l.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[q,l.value]])]),_:1},512)),[[q,l.value]])}const re=L($,[["render",se]]),ne={data(){return{mode:"create",modalData:null,openModal:!1,foods:[],loading:!1,corral:null,search:{corral:this.$route.params.corral,year:null,month:null},forms:[{label:"ปี",value:"year",options:I("search")},{label:"เดือน",value:"month",options:x("search")}],foodColumns:[{label:"ปี",value:"year",func:e=>e.year},{label:"เดือน",value:"month",func:e=>x()[e.month-1].label},{label:"จำนวนวัว",class:"text-right",value:"numCow"},{label:"จำนวนสูตร",class:"text-right",func:e=>e.foodDetails.length},{label:"รวมจำนวนที่ให้/วัน (กก.)",class:"text-right",func:e=>this.$filters.number(e.foodDetails.reduce((t,r)=>t+r.qty,0))},{label:"รวมเป็นเงิน/วัน",class:"text-right",func:e=>this.$filters.currency(e.foodDetails.reduce((t,r)=>t+r.amount,0))},{label:"รวมจำนวนที่ให้/เดือน (กก.)",class:"text-right",func:e=>this.$filters.number(e.foodDetails.reduce((t,r)=>t+r.qty,0)*new Date(e.year,e.month,0).getDate())},{label:"รวมเป็นเงิน/เดือน",class:"text-right",func:e=>this.$filters.currency(e.foodDetails.reduce((t,r)=>t+r.amount,0)*new Date(e.year,e.month,0).getDate())}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},getDataCopy(){return{...this.modalData}}},watch:{data(e){this.foods=e==null?void 0:e.foods,this.corral=e.corral}},created(){this.getDatas()},methods:{async getDatas(){this.loading=!0;const e=await V.all(this.search);e.data&&e.data.foods.length>0?this.foods=e.data.foods:(this.foods=e.data.foods,v.fire({icon:"warning",title:"ไม่พบข้อมูล"})),this.loading=!1},confirmCancel(e){this.value=!1,this.$emit(e)},cancel(){this.confirmCancel("cancel")},add(){},sum(){const e=this.foods.reduce((r,m)=>r+m.amount,0);return{qty:this.foods.reduce((r,m)=>r+m.qty,0),amount:e}},edit(e){this.modalData=e,this.mode="edit",this.openModal=!0},daysOfMonth(e,t){return new Date(t,e,0).getDate()},resetData(){this.modalData=null},reset(){this.search={corral:this.$route.params.corral,year:null,month:null},this.getDatas()},remove(e){let t=this.cows.indexOf(e);t!==-1&&this.foodDetails.splice(t,1)}},components:{BaseButton:M,BaseButtons:P,CardBox:F,BaseDivider:S,FormField:N,FormControl:U,BaseLevel:T,BaseIcon:O,Table:A,Modal:re,SectionMain:j,LayoutAuthenticated:Q,SectionTitleBarSub:z,Criteria:G}},ie={class:"px-4 sm:px-0 mb-4 flex items-center justify-between"},ce={class:"flex items-center justify-start"},de={class:"text-base lg:text-2xl"};function ue(e,t,r,m,o,l){const f=n("BaseIcon"),u=n("BaseButton"),D=n("BaseButtons"),h=n("Criteria"),C=n("Modal"),b=n("Table"),p=n("SectionMain"),w=n("LayoutAuthenticated");return _(),g(w,null,{default:i(()=>[a(p,null,{default:i(()=>[s("section",ie,[s("div",ce,[a(f,{path:"corn",size:"30",class:"mr-3"}),s("h1",de," รายละเอียดการให้อาหาร (คอก "+d(this.$route.params.corral)+") ",1)]),a(D,{class:"text-sm lg:text-base",type:"justify-end"},{default:i(()=>[a(u,{class:"lg:p-2 p-1",label:"ย้อนกลับ",color:"light",onClick:t[0]||(t[0]=y=>this.$router.push("/manage/food"))}),a(u,{class:"lg:p-2 p-1",label:"เพิ่มการให้อาหาร",color:"success",onClick:t[1]||(t[1]=y=>{o.mode="create",o.openModal=!0,o.modalData={corral:this.$route.params.corral}})})]),_:1})]),a(h,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:l.getDatas,onReset:l.reset,forms:o.forms,search:o.search,btnLoading:o.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),a(C,{modelValue:o.openModal,"onUpdate:modelValue":t[2]||(t[2]=y=>o.openModal=y),data:l.getDataCopy,onCancel:l.resetData,mode:o.mode,onConfirm:l.getDatas},null,8,["modelValue","data","onCancel","mode","onConfirm"]),a(b,{title:"รายการให้อาหาร ("+o.foods.length+" รายการ)",items:o.foods,datas:o.foodColumns,buttons:o.buttons,perPage:"10",onDelete:l.remove,onEdit:l.edit},null,8,["title","items","datas","buttons","onDelete","onEdit"])]),_:1})]),_:1})}const Le=L(ne,[["render",ue]]);export{Le as default};

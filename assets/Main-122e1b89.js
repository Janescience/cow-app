import{z as S,E as c,o as r,I as p,d as o,w as i,h as g,P as B,p as q,m as I,_ as A,l as E,F as U,i as P,j as R,f as H,N as Y,G as D,H as j,c as b,s as l,t as u,k as y,J as T,K as O,e as z,S as G,C as J,D as K}from"./index-ed3cfc4b.js";import{T as Q}from"./Table-d9eab8ff.js";import{C as W}from"./Criteria-ccea5f87.js";import{V as X}from"./vaccine-b66e5d32.js";import{_ as Z}from"./FormField-e25ac5c6.js";import{T as x}from"./alert-4d8a709c.js";import{P as V}from"./protection-fad10cca.js";import{C as $}from"./cow-7fe09453.js";import{_ as ee}from"./FormCheckRadioPicker-a8cd8063.js";import"./Cow-0a843f5d.js";const te={data(){return{datas:[]}},created(){this.initialData()},computed:{value:{get(){var e;return this.valueType==="object"&&this.modelValue.vaccine_data&&(this.modelValue.vaccine_data=(e=this.modelValue)==null?void 0:e.name),this.modelValue},set(e){this.$emit("update:modelValue",e)}},user(){return this.$store.state.auth.user}},methods:{async initialData(){try{const e=await X.all();if(this.datas=[],e&&(this.datas=e.data.vaccines,this.datas.map(a=>a.vaccine_data=a.name)),this.defaultValue){const a=this.datas.filter(d=>d[this.defaultType]==this.defaultValue);a&&this.handleInput(this.reduceAction(a[0]))}}catch(e){this.datas=[],console.error("Error: "+e.message)}},reduceAction(e){return this.valueType==="object"?e:e[this.valueType]},handleInput(e){this.$emit("update:value",e),this.dataSelected=this.datas.find(a=>a.name===e),this.$emit("update:dataSelected",this.dataSelected)}},props:{clear:{default:!0,type:Boolean},disabled:{default:!1,type:Boolean},dataSelected:{default:null,type:Object},defaultType:{default:null,type:Object},valueType:{default:"_id",type:Object},defaultValue:{default:null,type:Object},modelValue:{type:[String,Number,Boolean,Array,Object],default:""},multiple:{default:!1,type:Boolean}}},ae={class:"relative"};function oe(e,a,d,w,t,s){const v=c("mdicon"),h=c("v-select");return r(),p("div",ae,[o(h,{class:"ddl",clearable:d.clear,disabled:d.disabled,options:t.datas,reduce:s.reduceAction,label:"vaccine_data",placeholder:"เลือกวัคซีน",onInput:s.handleInput,modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=_=>s.value=_),dataSelected:d.dataSelected,multiple:d.multiple},{"no-options":i(()=>[o(v,{name:"alertCircleOutline",width:"16",height:"16",class:"inline-block"}),g(" ไม่พบข้อมูล ")]),_:1},8,["clearable","disabled","options","reduce","onInput","modelValue","dataSelected","multiple"])])}const le=S(te,[["render",oe]]),se={data(){return{protection:{date:new Date,vaccine:{},qty:null,amount:null,remark:"",cows:[]},corral:null,corrals:null,ddlCorral:[],cows:[],showCows:!1,showVaccineCond:!1,vaccineCond:"Y",loading:!1,alert:"",search:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},user(){return this.$store.state.auth.user},resultSearch(){return this.search?this.cows.filter(e=>this.search.toLowerCase().split(" ").every(a=>e.name.toLowerCase().includes(a))):this.cows}},watch:{data(e){e&&this.mode==="edit"&&(this.protection=e,this.protection.date=new Date(e.date))},"protection.qty"(e){e&&(this.protection.amount=e*this.protection.vaccine.amount)},corral(e){e?(this.cows=this.corrals[e],this.showVaccineCond=!0):this.showVaccineCond=!1},vaccineCond(e){e=="N"?this.showCows=!0:this.showCows=!1}},created(){this.getCorrals()},methods:{clear(){this.protection.date=new Date,this.protection.vaccine={},this.protection.qty=null,this.protection.amount=null,this.protection.remark=""},confirmCancel(e){this.value=!1,this.$emit(e)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await V.create(this.protection)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")):await V.update(this.protection._id,this.protection)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")),x.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})}catch(e){console.error("Error : ",e),this.clear(),this.loading=!1,this.alert=await e.response.data.message,x.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}},async getCorrals(){const e=await $.all();if(e){const a=e.data.cows;this.corrals=B.groupBy(a,"corral");for(let d of Object.keys(this.corrals))this.ddlCorral.push({id:d,label:d})}},removeCow(e){let a=this.cows.indexOf(e);a!==-1&&(this.cows.splice(a,1),this.search="")},removeSubmitCow(e){let a=this.protection.cows.indexOf(e);a!==-1&&(this.protection.cows.splice(a,1),this.protection.qty=this.protection.cows.length)},submitCow(){this.protection.qty=this.cows.length,this.protection.cows.push(...this.cows),this.cows=[],this.corral="",this.showCows=!1},reset(){this.protection.cows=[]}},components:{BaseButton:q,BaseButtons:I,CardBox:A,BaseDivider:E,OverlayLayer:U,FormField:Z,FormControl:P,NotificationBar:R,BaseLevel:H,FormCheckRadioPicker:ee,BaseIcon:Y,DDLVaccine:le},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},ne={class:"grid grid-cols-2 lg:grid-cols-4 gap-5"},ie={key:0,class:"flex items-stretch border-b border-gray-100 dark:border-gray-800"},ce=l("p",{class:"flex items-center py-3 grow font-bold"}," เลือกลบโคที่ไม่ต้องการ ",-1),re={key:1,class:"overflow-x-hidden overflow-y-auto h-48"},de=l("thead",null,[l("tr",null,[l("th",{class:"whitespace-nowrap text-center"}," โค "),l("th",{class:"whitespace-nowrap text-center"}," คอก "),l("th",{class:"whitespace-nowrap text-center"}," สถานะ "),l("th")])],-1),ue={"data-label":"โค"},he={"data-label":"คอก"},me={"data-label":"สถานะ"},pe={class:"lg:w-6 whitespace-nowrap"},fe={class:"flex items-stretch border-b border-gray-100 dark:border-gray-800"},_e=l("p",{class:"flex items-center py-3 grow font-bold"}," รายการโคฉีดวัคซีน ",-1),ye={key:3,class:"overflow-x-hidden overflow-y-auto h-48"},be=l("thead",null,[l("tr",null,[l("th",{class:"whitespace-nowrap text-center"}," โค "),l("th",{class:"whitespace-nowrap text-center"}," คอก "),l("th",{class:"whitespace-nowrap text-center"}," สถานะ ")])],-1),ve={"data-label":"โค"},we={"data-label":"คอก"},Ce={"data-label":"สถานะ"},ge={class:"lg:w-6 whitespace-nowrap"},Ve={key:4,class:"text-center py-10 text-gray-500 dark:text-gray-400"},ke=l("p",null,"ไม่มีรายการ...",-1),Be=[ke];function xe(e,a,d,w,t,s){const v=c("DDLVaccine"),h=c("FormField"),_=c("FormControl"),k=c("FormCheckRadioPicker"),m=c("BaseButton"),f=c("BaseButtons"),C=c("NotificationBar"),N=c("BaseDivider"),F=c("CardBox"),M=c("OverlayLayer");return D((r(),b(M,null,{default:i(()=>[D(o(F,{title:(this.mode==="create"?"บันทึก":"แก้ไข")+"การป้องกัน/บำรุง",class:"shadow-lg w-full lg:w-3/5 z-50","header-icon":"close",modal:"",form:"","has-scroll":"",onSubmit:z(s.submit,["prevent"]),onHeaderIconClick:s.cancel},{default:i(()=>[l("div",ne,[o(h,{label:"วัคซีน",help:"* ห้ามว่าง",class:"col-span-2 lg:col-span-1"},{default:i(()=>[o(v,{modelValue:t.protection.vaccine,"onUpdate:modelValue":a[0]||(a[0]=n=>t.protection.vaccine=n),valueType:"object"},null,8,["modelValue"])]),_:1}),o(h,{label:"วันที่",help:"* ห้ามว่าง"},{default:i(()=>[o(_,{modelValue:t.protection.date,"onUpdate:modelValue":a[1]||(a[1]=n=>t.protection.date=n),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),o(h,{label:"รวมจำนวนที่ฉีด (ตัว)"},{default:i(()=>[g(u(t.protection.qty),1)]),_:1}),o(h,{label:"รวมเป็นเงิน (บาท)"},{default:i(()=>[g(u(t.protection.amount),1)]),_:1}),o(h,{label:"คอก"},{default:i(()=>[o(_,{modelValue:t.corral,"onUpdate:modelValue":a[2]||(a[2]=n=>t.corral=n),options:t.ddlCorral,required:""},null,8,["modelValue","options"])]),_:1}),t.showVaccineCond?(r(),b(h,{key:0,label:"ฉีดวัคซีน"},{default:i(()=>[o(k,{modelValue:t.vaccineCond,"onUpdate:modelValue":a[3]||(a[3]=n=>t.vaccineCond=n),type:"radio",options:{Y:"ฉีดทุกตัว",N:"ฉีดบางตัว"}},null,8,["modelValue"])]),_:1})):y("",!0),t.vaccineCond=="Y"&&t.showVaccineCond?(r(),b(f,{key:1,class:"mt-2",type:"justify-start"},{default:i(()=>[o(m,{label:"ยืนยัน",color:"info",onClick:s.submitCow},null,8,["onClick"])]),_:1})):y("",!0)]),t.showCows?(r(),p("header",ie,[ce,o(_,{modelValue:t.search,"onUpdate:modelValue":a[4]||(a[4]=n=>t.search=n),placeholder:"ค้นหาโค",required:""},null,8,["modelValue"])])):y("",!0),t.showCows?(r(),p("div",re,[l("table",null,[de,l("tbody",null,[(r(!0),p(T,null,O(s.resultSearch,n=>(r(),p("tr",{key:n._id},[l("td",ue,u(n.code)+" : "+u(n.name),1),l("td",he,u(n.corral),1),l("td",me,u(n.status),1),l("td",pe,[o(f,{type:"justify-end lg:justify-start","no-wrap":""},{default:i(()=>[o(m,{color:"danger",icon:"close",small:"",onClick:L=>s.removeCow(n)},null,8,["onClick"])]),_:2},1024)])]))),128))])])])):y("",!0),t.showCows?(r(),b(f,{key:2,class:"mt-2",type:"justify-center"},{default:i(()=>[o(m,{onClick:s.submitCow,label:"ยืนยัน",color:"info"},null,8,["onClick"])]),_:1})):y("",!0),l("header",fe,[_e,o(f,{class:"mt-2",type:"justify-center"},{default:i(()=>[o(m,{disabled:t.protection.cows.length<=0,onClick:s.reset,label:"ล้าง",small:"",color:"danger"},null,8,["disabled","onClick"])]),_:1})]),t.protection.cows.length>0?(r(),p("div",ye,[l("table",null,[be,l("tbody",null,[(r(!0),p(T,null,O(t.protection.cows,n=>(r(),p("tr",{key:n._id},[l("td",ve,u(n.code)+" : "+u(n.name),1),l("td",we,u(n.corral),1),l("td",Ce,u(n.status),1),l("td",ge,[o(f,{type:"justify-end lg:justify-start","no-wrap":""},{default:i(()=>[o(m,{color:"danger",icon:"close",small:"",onClick:L=>s.removeSubmitCow(n)},null,8,["onClick"])]),_:2},1024)])]))),128))])])])):(r(),p("div",Ve,Be)),t.alert?(r(),b(C,{key:5,color:"danger",outline:"",icon:"alertCircleOutline"},{default:i(()=>[g(u(t.alert),1)]),_:1})):y("",!0),o(N),o(f,{type:"justify-center"},{default:i(()=>[o(m,{label:"บันทึก",color:"success",type:"submit",disabled:t.protection.cows.length<=0,loading:t.loading},null,8,["disabled","loading"]),o(m,{label:"ยกเลิก",color:"danger",onClick:s.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[j,s.value]])]),_:1},512)),[[j,s.value]])}const Se=S(se,[["render",xe]]),De={data(){return{openModal:!1,modalData:null,items:[],forms:[{label:"วัคซีน",value:"vaccine",icon:"needle"},{label:"ฉีดวัคซีนล่าสุด",value:"dateCurrent",icon:"calendar",type:"date"},{label:"ฉีดวัคซีนครั้งต่อไป",value:"dateNext",icon:"calendar",type:"date"}],search:{dateCurrent:null,dateNext:null,vaccine:""},loading:!1,mode:"create",dataEdit:null,checked:{label:{value:"vaccine.name"},code:{value:"vaccine.code"}},datas:[{label:"ครั้งที่",value:"seq"},{label:"วัคซีน",value:"vaccine.name"},{label:"จำนวนที่ฉีด (ตัว)",class:"text-center",value:"qty"},{label:"รวมเป็นเงิน (บาท)",class:"text-center",value:"amount"},{label:"วันที่ฉีดวัคซีน",class:"text-center",value:"date",type:"date"},{label:"หมายเหตุ",class:"text-center",value:"remark"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning",condition:e=>{const a=B.groupBy(this.items,"vaccine._id");for(let d of Object.keys(a)){const w=a[d],t=B.orderBy(w,"seq","desc");if(t.length>0&&e.vaccine._id==t[0].vaccine._id)return!0}return!1}}]}},components:{SectionMain:G,LayoutAuthenticated:J,SectionTitleBarSub:K,Table:Q,Modal:Se,Criteria:W},computed:{user(){return this.$store.state.auth.user},getDataCopy(){return{...this.modalData}}},created(){this.getDatas()},methods:{async getDatas(e){this.loading=!0;const a=await V.all(e);this.items=[],a.data&&(this.items=a.data.protections),this.loading=!1},async remove(e){this.loading=!0,(await V.delete(e)).data&&this.getDatas(),this.loading=!1,x.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},edit(e){this.modalData=e,this.mode="edit",this.openModal=!0},reset(){this.search.dateCurrent=null,this.search.dateNext=null,this.search.vaccine=""}}};function je(e,a,d,w,t,s){const v=c("SectionTitleBarSub"),h=c("Modal"),_=c("Criteria"),k=c("Table"),m=c("SectionMain"),f=c("LayoutAuthenticated");return r(),b(f,null,{default:i(()=>[o(m,null,{default:i(()=>[o(v,{icon:"doctor",title:"การป้องกัน/บำรุง","has-btn-add":"",onOpenModal:a[0]||(a[0]=C=>{t.mode="create",t.openModal=!0}),btnText:"เพิ่มการป้องกัน/บำรุง"}),o(h,{modelValue:t.openModal,"onUpdate:modelValue":a[1]||(a[1]=C=>t.openModal=C),data:s.getDataCopy,mode:t.mode,onConfirm:s.getDatas},null,8,["modelValue","data","mode","onConfirm"]),o(_,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:s.getDatas,onReset:s.reset,forms:t.forms,search:t.search},null,8,["onSearch","onReset","forms","search"]),o(k,{title:"รายการป้องกัน/บำรุง","has-checkbox":"","checked-data":t.checked,items:t.items,datas:t.datas,buttons:t.buttons,onEdit:s.edit,onDelete:s.remove,onDeleteSelected:e.removeSelected,loading:t.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const Ue=S(De,[["render",je]]);export{Ue as default};

import{B as k,W as d,X as b,p as T,m as E,_ as F,l as L,F as R,i as U,j as N,f as q,E as s,G as B,H as C,o as c,c as m,w as r,d as o,s as O,k as p,h as A,t as H,e as I,S as z,C as G,D as W}from"./index-e6d23660.js";import{T as X}from"./Table-9b50ea7e.js";import{C as j}from"./Criteria-2751efad.js";import{_ as J}from"./FormField-b1743e54.js";import{D as K}from"./Cow-89c57a39.js";import{a as v,r as y,R as D}from"./reproduct-410b9746.js";import"./FormCheckRadioPicker-2bde28b1.js";import"./cow-7718b6e6.js";const P={data(){return{reproduct:{cow:null,loginDate:new Date,estrusDate:d(new Date,21),matingDate:d(new Date,22),checkDate:b(d(new Date,22),2),dad:"",howTo:"",status:1,result:2},status:v("create"),result:y("create"),loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},user(){return this.$store.state.auth.user}},watch:{"reproduct.loginDate"(e){this.reproduct.estrusDate=d(e,21)},"reproduct.estrusDate"(e){this.reproduct.matingDate=d(e,1)},"reproduct.matingDate"(e){this.reproduct.checkDate=b(e,2)},"reproduct.result"(e){e==1?this.reproduct.status=4:this.reproduct.status=1},dataEdit:{handler(e,l){e!=null&&this.mode=="edit"&&(this.reproduct=e,this.reproduct.loginDate=new Date(e.loginDate),this.reproduct.estrusDate=new Date(e.estrusDate),this.reproduct.matingDate=new Date(e.matingDate),this.reproduct.checkDate=new Date(e.checkDate))}}},methods:{clear(){var e;this.mode==="edit"&&this.$emit("update:dataEdit",null),this.reproduct.cow=null,this.reproduct.loginDate=new Date,this.reproduct.estrusDate=d(new Date,21),this.reproduct.matingDate=d(new Date,22),this.reproduct.checkDate=b(d(new Date,43),2),this.reproduct.dad="",this.reproduct.howTo="",this.reproduct.status=1,this.reproduct.result=2,(e=this.reproduct)==null||delete e._id},confirmCancel(e){this.value=!1,this.$emit(e)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await D.create(this.reproduct)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")):await D.update(this.reproduct._id,this.reproduct)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm"))}catch(e){console.error("Error : ",e),this.loading=!1,this.alert=e.response.data.message}}},components:{BaseButton:T,BaseButtons:E,CardBox:F,BaseDivider:L,OverlayLayer:R,FormField:J,FormControl:U,NotificationBar:N,BaseLevel:q,DDLCow:K},props:{modelValue:{type:[String,Number,Boolean],default:null},mode:{type:String,default:""},dataEdit:{type:Object,default:null}}},Q={class:"grid grid-cols-2 lg:grid-cols-3 gap-3 mt-1"};function Y(e,l,V,S,t,n){const g=s("DDLCow"),i=s("FormField"),u=s("FormControl"),_=s("NotificationBar"),w=s("BaseDivider"),h=s("BaseButton"),f=s("BaseButtons"),M=s("CardBox"),x=s("OverlayLayer");return B((c(),m(x,null,{default:r(()=>[B(o(M,{title:V.mode==="create"?"เพิ่มการสืบพันธุ์":"แก้ไขการสืบพันธุ์",class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"",onSubmit:I(n.submit,["prevent"]),onHeaderIconClick:n.cancel},{default:r(()=>[O("div",Q,[o(i,{label:"โค",help:"* ห้ามว่าง"},{default:r(()=>[o(g,{modelValue:t.reproduct.cow,"onUpdate:modelValue":l[0]||(l[0]=a=>t.reproduct.cow=a)},null,8,["modelValue"])]),_:1}),o(i,{label:"พ่อพันธุ์",help:""},{default:r(()=>[o(u,{modelValue:t.reproduct.dad,"onUpdate:modelValue":l[1]||(l[1]=a=>t.reproduct.dad=a),icon:"genderMale"},null,8,["modelValue"])]),_:1}),o(i,{label:"วันที่เข้าระบบสืบพันธุ์",help:"* ห้ามว่าง"},{default:r(()=>[o(u,{modelValue:t.reproduct.loginDate,"onUpdate:modelValue":l[2]||(l[2]=a=>t.reproduct.loginDate=a),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),o(i,{label:"ผล"},{default:r(()=>[o(u,{modelValue:t.reproduct.result,"onUpdate:modelValue":l[3]||(l[3]=a=>t.reproduct.result=a),options:t.result},null,8,["modelValue","options"])]),_:1}),t.reproduct.result==1?(c(),m(i,{key:0,label:"วิธีการรักษา",help:""},{default:r(()=>[o(u,{modelValue:t.reproduct.howTo,"onUpdate:modelValue":l[4]||(l[4]=a=>t.reproduct.howTo=a),icon:"doctor"},null,8,["modelValue"])]),_:1})):p("",!0),t.reproduct.result==2?(c(),m(i,{key:1,label:"วันที่เป็นสัด",help:"* ห้ามว่าง (วันที่เข้าระบบสืบพันธุ์ + 21 วัน)"},{default:r(()=>[o(u,{modelValue:t.reproduct.estrusDate,"onUpdate:modelValue":l[5]||(l[5]=a=>t.reproduct.estrusDate=a),icon:"calendar",type:"date","lower-limit":t.reproduct.loginDate,required:""},null,8,["modelValue","lower-limit"])]),_:1})):p("",!0),t.reproduct.result==2?(c(),m(i,{key:2,label:"วันที่ผสมพันธุ์",help:"* ห้ามว่าง (วันที่เป็นสัด + 24 ชม)"},{default:r(()=>[o(u,{modelValue:t.reproduct.matingDate,"onUpdate:modelValue":l[6]||(l[6]=a=>t.reproduct.matingDate=a),icon:"calendar",type:"date","lower-limit":t.reproduct.estrusDate,required:""},null,8,["modelValue","lower-limit"])]),_:1})):p("",!0),t.reproduct.result==2?(c(),m(i,{key:3,label:"วันที่ตรวจท้อง",help:"* ห้ามว่าง (วันที่ผสมพันธุ์ + 2 เดือน)"},{default:r(()=>[o(u,{modelValue:t.reproduct.checkDate,"onUpdate:modelValue":l[7]||(l[7]=a=>t.reproduct.checkDate=a),icon:"calendar",type:"date","lower-limit":t.reproduct.matingDate,required:""},null,8,["modelValue","lower-limit"])]),_:1})):p("",!0),o(i,{label:"สถานะ"},{default:r(()=>[o(u,{modelValue:t.reproduct.status,"onUpdate:modelValue":l[8]||(l[8]=a=>t.reproduct.status=a),options:t.status},null,8,["modelValue","options"])]),_:1})]),t.alert?(c(),m(_,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:r(()=>[A(H(t.alert),1)]),_:1})):p("",!0),o(w),o(f,{type:"justify-center"},{default:r(()=>[o(h,{label:"บันทึก",color:"success",type:"submit",loading:t.loading},null,8,["loading"]),o(h,{label:"ยกเลิก",color:"danger",onClick:n.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[C,n.value]])]),_:1},512)),[[C,n.value]])}const Z=k(P,[["render",Y]]),$={data(){return{openModal:!1,items:[],forms:[{label:"โค",value:"cow",type:"ddl",module:"cow"},{label:"สถานะ",value:"status",options:v()},{label:"ผล",value:"result",options:y()},{label:"วันที่เข้าระบบสืบพันธุ์",value:"loginDate",icon:"calendar",type:"date"},{label:"วันที่เป็นสัด",value:"estrusDate",icon:"calendar",type:"date"},{label:"วันที่ผสมพันธุ์",value:"matingDate",icon:"calendar",type:"date"},{label:"วันที่ตรวจท้อง",value:"checkDate",icon:"calendar",type:"date"}],search:{cow:null,loginDate:null,estrusDate:null,matingDate:null,checkDate:null,status:"",result:""},loading:!1,mode:"create",dataEdit:null,checked:{code:{value:"seq"},label:{value:"cow.name"}},datas:[{label:"ครั้งที่",class:"text-center",value:"seq"},{label:"รหัสโค",value:"cow.code"},{label:"ชื่อโค",value:"cow.name"},{label:"วันที่เข้าระบบสืบพันธุ์",class:"text-center",value:"loginDate",type:"date"},{label:"ผล",func:e=>y()[e.result].label},{label:"วันที่เป็นสัด",class:"text-center",value:"estrusDate",type:"date"},{label:"วันที่ผสมพันธุ์",class:"text-center",value:"matingDate",type:"date"},{label:"วันที่ตรวจท้อง",class:"text-center",value:"checkDate",type:"date"},{label:"พ่อพันธุ์",value:"dad"},{label:"สถานะ",func:e=>v()[e.status].label},{label:"วิธีรักษา",value:"howTo"}],buttons:[{label:"ลบ",type:"delete",color:"danger",condition:e=>e.status!="2"&&e.status!="3"},{label:"แก้ไข",type:"edit",color:"warning",condition:e=>e.status!="2"&&e.status!="3"}]}},components:{SectionMain:z,LayoutAuthenticated:G,SectionTitleBarSub:W,Table:X,Modal:Z,Criteria:j},computed:{user(){return this.$store.state.auth.user}},created(){this.getReproductions()},methods:{async getReproductions(){this.loading=!0;const e=await D.all(this.search);this.items=[],e.data&&(this.items=e.data.reproducts),this.loading=!1},async remove(e){this.loading=!0,(await D.delete(e)).data&&this.getReproductions(),this.loading=!1},edit(e){this.dataEdit=e,this.dataEdit.cow=e.cow._id,this.mode="edit",this.openModal=!0},reset(){this.search.cow=null,this.search.date=null}}};function ee(e,l,V,S,t,n){const g=s("SectionTitleBarSub"),i=s("Modal"),u=s("Criteria"),_=s("Table"),w=s("SectionMain"),h=s("LayoutAuthenticated");return c(),m(h,null,{default:r(()=>[o(w,null,{default:r(()=>[o(g,{icon:"reproduction",title:"การสืบพันธุ์",btnText:"เพิ่มการสืบพันธุ์","has-btn-add":"",onOpenModal:l[0]||(l[0]=f=>{t.mode="create",t.openModal=!0})}),o(i,{modelValue:t.openModal,"onUpdate:modelValue":l[1]||(l[1]=f=>t.openModal=f),mode:t.mode,dataEdit:t.dataEdit,onConfirm:n.getReproductions},null,8,["modelValue","mode","dataEdit","onConfirm"]),o(u,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:n.getReproductions,onReset:n.reset,forms:t.forms,search:t.search},null,8,["onSearch","onReset","forms","search"]),o(_,{title:"รายการสืบพันธุ์","has-checkbox":"","checked-data":t.checked,items:t.items,datas:t.datas,buttons:t.buttons,onEdit:n.edit,onDelete:n.remove,onDeleteSelected:e.removeSelected,loading:t.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const ue=k($,[["render",ee]]);export{ue as default};

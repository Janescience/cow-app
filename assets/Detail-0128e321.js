import{z as U,S as Y,C as A,p as I,N as L,m as T,_ as Q,i as N,g as E,f as O,P as V,B as D,c as w,w as c,E as f,o as y,d as o,s as t,h as P,t as n,k as x,I as B,K as j,J as K}from"./index-480a76fd.js";import{_ as z}from"./FormField-1b3dae76.js";import{I as H}from"./ImageUpload-0d7dd8b7.js";import{T as J}from"./Table-09ea93fc.js";import{C as M}from"./cow-e2a79447.js";import{M as W}from"./milking-497ae95a.js";import{r as C,a as G,R as X}from"./reproduct-286dc3d7.js";import{s as Z,o as $,B as ee}from"./birth-9d62ae2f.js";import{H as te}from"./heal-77fd28ca.js";import{P as se}from"./protection-dacf63cd.js";import{F as le}from"./food-0e9754fa.js";import{N as oe}from"./notification-e95d9925.js";import{g as ae}from"./age-calculate-bb92e417.js";import{T as q}from"./alert-b1ff2274.js";import{s as ie,q as ne}from"./cow-ae6b6e19.js";const re={data(){return{cow:{},milks:[],milkDetails:[],historyMilks:[],reproducts:[],births:[],heals:[],protections:[],foods:[],notifications:[],loading:{cow:!1,milk:!1,reproduct:!1,birth:!1,heal:!1,protection:!1,food:!1},alert:"",newCow:!1,status:ie("create"),quality:ne("create"),milkDatas:[{label:"วันที่รีดนม",class:"text-center",type:"date",value:"date"},{label:"ปริมาณน้ำนมดิบ/เช้า (กก.)",class:"text-center",value:"mQty"},{label:"ปริมาณน้ำนมดิบ/บ่าย (กก.)",class:"text-center",value:"aQty"},{label:"ปริมาณน้ำนมดิบรวม (กก.)",class:"text-center",func:s=>s.mQty+s.aQty},{label:"จำนวนเงินรวม",class:"text-right",type:"number",value:"amount"}],reproductDatas:[{label:"ครั้งที่",class:"text-center",value:"seq"},{label:"วันที่เข้าระบบสืบพันธุ์",class:"text-center",value:"loginDate",type:"date"},{label:"ผล",func:s=>C()[s.result].label},{label:"วันที่เป็นสัด",class:"text-center",value:"estrusDate",type:"date"},{label:"วันที่ผสมพันธุ์",class:"text-center",value:"matingDate",type:"date"},{label:"วันที่ตรวจท้อง",class:"text-center",value:"checkDate",type:"date"},{label:"พ่อพันธุ์",value:"dad"},{label:"สถานะ",func:s=>G()[s.status].label},{label:"วิธีรักษา",value:"howTo"}],birthDatas:[{label:"ครั้งที่",value:"seq",class:"text-center"},{label:"วันที่ตั้งครรภ์",class:"text-center",value:"pregnantDate",type:"date"},{label:"อายุครรภ์",func:s=>this.calAge(s==null?void 0:s.pregnantDate)},{label:"วันที่คลอด",class:"text-center",value:"birthDate",type:"date"},{label:"เพศ",class:"text-center",func:s=>Z()[s.sex]},{label:"ลูกวัว",class:"text-center",func:s=>{var l,h;return s.calf?((l=s.calf)==null?void 0:l.code)+" : "+((h=s.calf)==null?void 0:h.name):""}},{label:"รกค้าง",class:"text-center",func:s=>$()[s.overgrown]},{label:"วันที่ใช้ยาขับ",class:"text-center",value:"drugDate",type:"date"},{label:"วันที่ล้างมดลูก",class:"text-center",value:"washDate",type:"date"}],protectionDatas:[{label:"วัคซีน",value:"vaccine.name"},{label:"ครั้งที่",class:"text-center",value:"seq"},{label:"ให้ยาล่าสุด",class:"text-center",value:"vaccine.currentDate",type:"date"},{label:"ให้ยาครั้งต่อไป",class:"text-center",value:"vaccine.nextDate",type:"date"}],healDatas:[{label:"ครั้งที่",value:"seq",class:"text-center"},{label:"วันที่รักษา",class:"text-center",value:"date",type:"date"},{label:"อาการ/โรค",class:"text-center",value:"disease"},{label:"วิธีการรักษา",class:"text-center",value:"method"},{label:"คนรักษา",class:"text-center",value:"healer"}]}},components:{SectionMain:Y,LayoutAuthenticated:A,BaseButton:I,BaseIcon:L,BaseButtons:T,CardBox:Q,FormControl:N,FormField:z,UserAvatar:E,BaseLevel:O,ImageUpload:H,Table:J},computed:{canRemove(){return this.milks.length==0&&this.reproducts.length==0&&this.births.length==0},user(){return this.$store.state.auth.user},milk(){let s=0,l=0,h=0;this.historyMilks=[],Object.keys(this.milks).forEach(e=>{let a=this.milks[e],u={},p=0,g=0,m=0;a.map(r=>{r.milkDetails.map(d=>{r.time==="M"?(l+=d.qty,p+=d.qty):(h+=d.qty,g+=d.qty),m+=d.amount}),r.milkDetails.length>0&&(s+=r.milkDetails.length,u.date=r.date,u.mQty=p,u.aQty=g,u.amount=m)}),Object.keys(u).length!==0&&this.historyMilks.push(u)});let b=(l+h)/s;return{avg:(s>0?b:0).toFixed(2),all:(l+h).toFixed(2)}}},created(){const s=this.$route.params.id;this.getCowData(s)},methods:{async getCowData(s){this.loading.cow=!0;const l=await M.get(s);if(l.data){this.cow=l.data.cow,this.cow.birthDate=new Date(this.cow.birthDate),this.loading.cow=!1,this.loading.reproduct=!0;const h=await X.all({cow:s});h.data&&(this.reproducts=h.data.reproducts),this.loading.reproduct=!1,this.loading.birth=!0;const b=await ee.all({cow:s,status:"B"});b&&(this.births=b.data.births),this.loading.birth=!1,this.loading.heal=!0;const e=await te.all({cow:s});e&&(this.heals=e.data.heals),this.loading.heal=!1,this.loading.protection=!0;const a=await se.all({cows:s});if(a){const m=V.groupBy(a.data.protections,"vaccine._id");for(let r of Object.keys(m)){const d=m[r],_=V.orderBy(d,"seq","desc");_.length>0&&this.protections.push(_[0])}}this.loading.protection=!1,this.loading.food=!0;const u=await le.all({corral:this.cow.corral});u&&(this.foods=u.data.foods),this.loading.food=!1,this.loading.milk=!0;const p=await W.get({cow:s});if(p.data){for(let m of p.data.milks)m.groupKey=D(m.date,"YYYY-MM-DD").format("YYYYMMDD");this.milks=V.groupBy(p.data.milks,"groupKey")}this.loading.milk=!1;const g=await oe.getCalendar({cow:s});g.data&&(this.notifications=g.data.events)}},async update(){this.loading=!0,this.alert="";try{await M.update(this.cow._id,this.cow)&&(this.getCow(this.$route.params.id),this.loading=!1,q.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"}))}catch(s){console.error("Error : ",s),this.loading=!1,this.alert=s.response.data.message,q.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}},reproduct(){let s=D(),l=this.reproducts.length>0?this.reproducts.length:"-",h=this.reproducts.length>0?this.formatDate(this.reproducts[0].loginDate):"-",b=this.reproducts.length>0?C()[this.reproducts[0].result].label:"-",e=0,a=0,u=0,p="-",g="-",m="-";for(let r of this.reproducts)r.estrusDate!=null&&D(r.estrusDate)<=s&&(e++,p=this.formatDate(r.estrusDate)),r.matingDate!=null&&D(r.matingDate)<=s&&(a++,g=this.formatDate(r.matingDate)),r.checkDate!=null&&D(r.checkDate)<=s&&(u++,m=this.formatDate(r.checkDate));return{login:{count:l,lastDate:h,result:b},estrus:{count:e>0?e:"-",lastDate:p},mating:{count:a>0?a:"-",lastDate:g},check:{count:u>0?u:"-",lastDate:m}}},birth(){return{count:this.births.length>0?this.births.length:"-",lastDate:this.births.length>0?this.formatDate(this.births[0].birthDate):"-",countMale:this.births.length>0?this.births.filter(s=>s.sex==="M").length:"-",countFemale:this.births.length>0?this.births.filter(s=>s.sex==="F").length:"-"}},heal(){let s=this.heals.length>0?this.heals.length:"-",l=this.heals.length>0?this.formatDate(this.heals[0].date):"-",h=this.heals.length>0?this.heals[0].disease:"-",b=this.heals.length>0&&this.heals[0].method?this.heals[0].method:"-";return{count:s,lastDate:l,lastDisease:h,lastMethod:b}},formatDate(s){return s?D(new Date(s)).format("DD/MM/YYYY"):""},calAge(s){return ae(s)}}},ce={class:"px-4 sm:px-0 mb-4 flex items-center justify-between"},de={class:"flex items-center justify-start"},ue=t("h1",{class:"text-base lg:text-2xl"}," รายละเอียดโค ",-1),he={class:"grid lg:gap-3 gap-2 grid-cols-2 lg:grid-cols-7 md:grid-cols-6"},pe={class:"row-span-2"},me={class:"grid gap-5 grid-cols-1 lg:grid-cols-2 md:grid-cols-2 mb-5"},ge={class:"grid gap-5 grid-cols-4"},_e=t("p",{class:"col-span-2"}," น้ำนมดิบ เฉลี่ย/วัน ",-1),fe={class:"underline decoration-orange-700 decoration-4"},be=t("p",null," กิโลกรัม ",-1),ye=t("p",{class:"col-span-2"}," น้ำนมดิบ ทั้งหมด ",-1),ke={class:"underline decoration-orange-700 decoration-4"},De=t("p",null," กิโลกรัม ",-1),we={class:"grid gap-5 lg:grid-cols-3 grid-cols-2"},ve=t("p",{class:"lg:row-span-3 col-span-2 lg:col-span-1 font-bold"}," การเข้าระบบสืบพันธุ์ ",-1),xe=t("p",{class:"ml-5"}," จำนวนครั้ง ",-1),Ve={class:"ml-5 underline decoration-sky-700 decoration-4"},Be=t("p",{class:"ml-5"}," เข้าระบบครั้งล่าสุด ",-1),Me={class:"ml-5 underline decoration-sky-700 decoration-4"},Ce=t("p",{class:"ml-5"}," ผลครั้งล่าสุด ",-1),qe={class:"ml-5 underline decoration-sky-700 decoration-4"},Fe=t("p",{class:"lg:row-span-2 col-span-2 lg:col-span-1 font-bold"}," การเป็นสัด ",-1),Se=t("p",{class:"ml-5"}," จำนวนครั้ง ",-1),Re={class:"ml-5 underline decoration-sky-700 decoration-4"},Ue=t("p",{class:"ml-5"}," เป็นสัดครั้งล่าสุด ",-1),Ye={class:"ml-5 underline decoration-sky-700 decoration-4"},Ae=t("p",{class:"lg:row-span-2 col-span-2 lg:col-span-1 font-bold"}," การผสม ",-1),Ie=t("p",{class:"ml-5"}," จำนวนครั้ง ",-1),Le={class:"ml-5 underline decoration-sky-700 decoration-4"},Te=t("p",{class:"ml-5"}," ผสมครั้งล่าสุด ",-1),Qe={class:"ml-5 underline decoration-sky-700 decoration-4"},Ne=t("p",{class:"lg:row-span-2 col-span-2 lg:col-span-1 font-bold"}," การตรวจท้อง ",-1),Ee=t("p",{class:"ml-5"}," จำนวนครั้ง ",-1),Oe={class:"ml-5 underline decoration-sky-700 decoration-4"},Pe=t("p",{class:"ml-5"}," ตรวจท้องครั้งล่าสุด ",-1),je={class:"ml-5 underline decoration-sky-700 decoration-4"},Ke={class:"grid gap-5 grid-cols-1 lg:grid-cols-2"},ze={class:"grid gap-5 grid-cols-2"},He=t("p",null," จำนวนครั้ง ",-1),Je={class:"underline decoration-pink-500 decoration-4"},We=t("p",null," คลอดลูกล่าสุด ",-1),Ge={class:"underline decoration-pink-500 decoration-4"},Xe=t("p",null," จำนวนเพศผู้ ",-1),Ze={class:"underline decoration-pink-500 decoration-4"},$e=t("p",null," จำนวนเพศเมีย ",-1),et={class:"underline decoration-pink-500 decoration-4"},tt={class:"grid gap-5 grid-cols-2"},st=t("p",null," จำนวนครั้ง ",-1),lt={class:"underline decoration-emerald-500 decoration-4"},ot=t("p",null," รักษาล่าสุด ",-1),at={class:"underline decoration-emerald-500 decoration-4"},it=t("p",null," อาการ/โรคล่าสุด ",-1),nt={class:"underline decoration-emerald-500 decoration-4"},rt=t("p",null," วิธีการรักษาล่าสุด ",-1),ct={class:"underline decoration-emerald-500 decoration-4"},dt={key:0,class:"text-slate-600"};function ut(s,l,h,b,e,a){const u=f("BaseIcon"),p=f("BaseButton"),g=f("BaseButtons"),m=f("ImageUpload"),r=f("BaseLevel"),d=f("FormControl"),_=f("FormField"),k=f("CardBox"),v=f("Table"),F=f("SectionMain"),S=f("LayoutAuthenticated");return y(),w(S,null,{default:c(()=>[o(F,{class:"text-sm lg:text-base"},{default:c(()=>[t("section",ce,[t("div",de,[o(u,{path:"cow",size:"30",class:"mr-3"}),ue]),o(g,{class:"text-sm lg:text-base",type:"justify-end"},{default:c(()=>[o(p,{class:"lg:p-2 p-1",label:"ย้อนกลับ",color:"light",onClick:l[0]||(l[0]=i=>this.$router.push("/manage/cow"))}),o(p,{class:"lg:p-2 p-1",label:"ออกรายงาน",color:"info",onClick:l[1]||(l[1]=i=>s.exportReport())})]),_:1})]),o(k,{class:"mb-5",loading:e.loading.cow,title:"ข้อมูลโค","header-icon":"",icon:"cardTextOutline"},{default:c(()=>[t("div",he,[t("div",pe,[o(m,{modelValue:e.cow.image,"onUpdate:modelValue":l[2]||(l[2]=i=>e.cow.image=i),class:"mt-8 mr-2"},null,8,["modelValue"]),o(r,{type:"justify-center text-xs font-thin text-slate-500"},{default:c(()=>[P(" อัพโหลดรูปภาพ (คลิกที่รูป) ")]),_:1})]),o(_,{label:"รหัสโค",help:"* ห้ามว่าง"},{default:c(()=>[o(d,{modelValue:e.cow.code,"onUpdate:modelValue":l[3]||(l[3]=i=>e.cow.code=i),icon:"barcode",required:""},null,8,["modelValue"])]),_:1}),o(_,{label:"ชื่อโค",help:"* ห้ามว่าง"},{default:c(()=>[o(d,{modelValue:e.cow.name,"onUpdate:modelValue":l[4]||(l[4]=i=>e.cow.name=i),icon:"cow",required:""},null,8,["modelValue"])]),_:1}),o(_,{label:"วันเกิด",help:"* ห้ามว่าง"},{default:c(()=>[o(d,{modelValue:e.cow.birthDate,"onUpdate:modelValue":l[5]||(l[5]=i=>e.cow.birthDate=i),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),o(_,{label:"สถานะ",help:"* ห้ามว่าง"},{default:c(()=>[o(d,{modelValue:e.cow.status,"onUpdate:modelValue":l[6]||(l[6]=i=>e.cow.status=i),options:e.status,icon:"",required:""},null,8,["modelValue","options"])]),_:1}),o(_,{label:"คุณภาพน้ำนม",help:"* ห้ามว่าง"},{default:c(()=>[o(d,{modelValue:e.cow.quality,"onUpdate:modelValue":l[7]||(l[7]=i=>e.cow.quality=i),options:e.quality,icon:""},null,8,["modelValue","options"])]),_:1}),o(_,{label:"คอก"},{default:c(()=>[o(d,{modelValue:e.cow.corral,"onUpdate:modelValue":l[8]||(l[8]=i=>e.cow.corral=i),icon:"barn"},null,8,["modelValue"])]),_:1}),o(_,{label:"พ่อพันธุ์"},{default:c(()=>[o(d,{modelValue:e.cow.dad,"onUpdate:modelValue":l[9]||(l[9]=i=>e.cow.dad=i),icon:"genderMale"},null,8,["modelValue"])]),_:1}),o(_,{label:"แม่พันธุ์"},{default:c(()=>[o(d,{modelValue:e.cow.mom,"onUpdate:modelValue":l[10]||(l[10]=i=>e.cow.mom=i),icon:"genderFemale"},null,8,["modelValue"])]),_:1}),o(g,{type:"md:justify-end lg:justify-end justify-center",class:"md:col-span-2 lg:col-span-4 col-span-2 md:mt-5"},{default:c(()=>[o(p,{disabled:!a.canRemove,label:"ลบ",color:"danger",onClick:l[11]||(l[11]=i=>s.remove())},null,8,["disabled"]),o(p,{label:"บันทึก",color:"success",onClick:l[12]||(l[12]=i=>a.update())})]),_:1})])]),_:1},8,["loading"]),t("div",me,[o(k,{icon:"cupWater",loading:e.loading.milk,title:"ข้อมูลน้ำนม","header-icon":""},{default:c(()=>[t("div",ge,[_e,t("p",fe,n(a.milk.avg),1),be,ye,t("p",ke,n(a.milk.all),1),De])]),_:1},8,["loading"]),o(k,{icon:"reproduction",class:"row-span-2",loading:e.loading.reproduct,title:"ข้อมูลการสืบพันธุ์/ผสมพันธุ์","header-icon":""},{default:c(()=>[t("div",we,[ve,xe,t("p",Ve,n(a.reproduct().login.count),1),Be,t("p",Me,n(a.reproduct().login.lastDate),1),Ce,t("p",qe,n(a.reproduct().login.result),1),Fe,Se,t("p",Re,n(a.reproduct().estrus.count),1),Ue,t("p",Ye,n(a.reproduct().estrus.lastDate),1),Ae,Ie,t("p",Le,n(a.reproduct().mating.count),1),Te,t("p",Qe,n(a.reproduct().mating.lastDate),1),Ne,Ee,t("p",Oe,n(a.reproduct().check.count),1),Pe,t("p",je,n(a.reproduct().check.lastDate),1)])]),_:1},8,["loading"]),t("div",Ke,[o(k,{icon:"babyFace",loading:e.loading.birth,title:"การคลอดลูก","header-icon":""},{default:c(()=>[t("div",ze,[He,t("p",Je,n(a.birth().count),1),We,t("p",Ge,n(a.birth().lastDate),1),Xe,t("p",Ze,n(a.birth().countMale),1),$e,t("p",et,n(a.birth().countFemale),1)])]),_:1},8,["loading"]),o(k,{icon:"doctor",loading:e.loading.heal,title:"การรักษา","header-icon":""},{default:c(()=>[t("div",tt,[st,t("p",lt,n(a.heal().count),1),ot,t("p",at,n(a.heal().lastDate),1),it,t("p",nt,n(a.heal().lastDisease),1),rt,t("p",ct,n(a.heal().lastMethod),1)])]),_:1},8,["loading"])]),e.protections.length>0?(y(),w(v,{key:0,title:"การป้องกัน/วัคซีน",items:e.protections,datas:e.protectionDatas,loading:e.loading.protection,perPage:"5",icon:"pillMultiple"},null,8,["items","datas","loading"])):x("",!0),o(k,{icon:"foodDrumstickOutline",loading:e.loading.food,title:"การให้อาหาร - คอก "+e.cow.corral,"header-icon":""},{default:c(()=>[e.foods.length<=0?(y(),B("div",dt," ไม่มีรายการให้อาหาร... ")):(y(!0),B(K,{key:1},j(e.foods,(i,R)=>(y(),B("div",{class:"grid gap-5 grid-cols-1",key:i._id},[t("p",null,n(R+1+". สูตร"+i.recipe.name+" จำนวน "+i.qty+" กก./วัน คิดเป็นเงินต้นทุน "+i.amount+" บาท/วัน และ "+i.amountAvg+" บาท/ตัว โดยมีวัวทั้งหมด "+i.numCow+" ตัว"),1)]))),128))]),_:1},8,["loading","title"])]),e.historyMilks.length>0?(y(),w(v,{key:0,title:"ประวัติการรีดนม",items:e.historyMilks,datas:e.milkDatas,loading:e.loading.milk,icon:"waterCheck"},null,8,["items","datas","loading"])):x("",!0),e.reproducts.length>0?(y(),w(v,{key:1,title:"ประวัติการสืบพันธ์ุ/ผสมพันธ์ุ",items:e.reproducts,datas:e.reproductDatas,loading:e.loading.reproduct},null,8,["items","datas","loading"])):x("",!0),e.births.length>0?(y(),w(v,{key:2,title:"ประวัติการคลอดลูก",items:e.births,datas:e.birthDatas,loading:e.loading.birth},null,8,["items","datas","loading"])):x("",!0),e.heals.length>0?(y(),w(v,{key:3,title:"ประวัติการรักษา",items:e.heals,datas:e.healDatas,loading:e.loading.heal},null,8,["items","datas","loading"])):x("",!0)]),_:1})]),_:1})}const Mt=U(re,[["render",ut]]);export{Mt as default};

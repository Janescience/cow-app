import{z as B,X as b,p as S,m as k,_ as w,l as N,F as M,i as q,j as F,f as T,N as L,E as n,G as C,H as y,o as _,c as g,w as r,d as a,s as O,h as U,t as E,k as j,e as A,S as H,C as I,D as P}from"./index-069f51b0.js";import{T as R}from"./Table-300d2158.js";import{C as z}from"./Criteria-747c3720.js";import{_ as G}from"./FormField-7d674cdb.js";import{T as v}from"./alert-62b6290e.js";import{P as m}from"./protection-f54a014b.js";import{_ as X}from"./FormCheckRadioPicker-6a4bd8bb.js";import"./Cow-f5735d70.js";import"./cow-97abdeab.js";const J={data(){return{protection:{dateCurrent:new Date,dateNext:null,vaccine:"",frequency:null,remark:""},loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},user(){return this.$store.state.auth.user}},watch:{data(e){e&&this.mode==="edit"&&(this.protection=e,this.protection.dateCurrent=new Date(e.dateCurrent),this.protection.dateNext=new Date(e.dateNext))},"protection.frequency"(e){e&&(this.protection.dateNext=b(new Date(this.protection.dateCurrent),e))},"protection.dateCurrent"(e){e&&(this.protection.dateNext=b(new Date(e),this.protection.frequency))}},methods:{clear(){this.protection.dateCurrent=new Date,this.protection.dateNext=null,this.protection.vaccine="",this.protection.frequency="",this.protection.remark=""},confirmCancel(e){this.value=!1,this.$emit(e)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await m.create(this.protection)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")):await m.update(this.protection._id,this.protection)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")),v.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})}catch(e){console.error("Error : ",e),this.clear(),this.loading=!1,this.alert=await e.response.data.message,v.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}}},components:{BaseButton:S,BaseButtons:k,CardBox:w,BaseDivider:N,OverlayLayer:M,FormField:G,FormControl:q,NotificationBar:F,BaseLevel:T,FormCheckRadioPicker:X,BaseIcon:L},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},K={class:"grid grid-cols-2 lg:grid-cols-3 gap-8"};function Q(e,o,x,V,t,l){const s=n("FormControl"),c=n("FormField"),p=n("NotificationBar"),f=n("BaseDivider"),d=n("BaseButton"),h=n("BaseButtons"),u=n("CardBox"),D=n("OverlayLayer");return C((_(),g(D,null,{default:r(()=>[C(a(u,{title:(this.mode==="create"?"บันทึก":"แก้ไข")+"การป้องกัน/บำรุง",class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"",onSubmit:A(l.submit,["prevent"]),onHeaderIconClick:l.cancel},{default:r(()=>[O("div",K,[a(c,{label:"วัคซีน",help:"* ห้ามว่าง"},{default:r(()=>[a(s,{modelValue:t.protection.vaccine,"onUpdate:modelValue":o[0]||(o[0]=i=>t.protection.vaccine=i),icon:"needle",required:""},null,8,["modelValue"])]),_:1}),a(c,{label:"ความถี่/วัคซีน (เดือน)",help:"* ห้ามว่าง"},{default:r(()=>[a(s,{modelValue:t.protection.frequency,"onUpdate:modelValue":o[1]||(o[1]=i=>t.protection.frequency=i),icon:"calendarClock",type:"number",required:""},null,8,["modelValue"])]),_:1}),a(c,{label:"ฉีดวัคซีนล่าสุด",help:"* ห้ามว่าง"},{default:r(()=>[a(s,{modelValue:t.protection.dateCurrent,"onUpdate:modelValue":o[2]||(o[2]=i=>t.protection.dateCurrent=i),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),a(c,{label:"ฉีดวัคซีนครั้งต่อไป",help:"* ห้ามว่าง"},{default:r(()=>[a(s,{modelValue:t.protection.dateNext,"onUpdate:modelValue":o[3]||(o[3]=i=>t.protection.dateNext=i),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),a(c,{label:"หมายเหตุ",class:"col-span-2"},{default:r(()=>[a(s,{modelValue:t.protection.remark,"onUpdate:modelValue":o[4]||(o[4]=i=>t.protection.remark=i),type:"textarea"},null,8,["modelValue"])]),_:1})]),t.alert?(_(),g(p,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:r(()=>[U(E(t.alert),1)]),_:1})):j("",!0),a(f),a(h,{type:"justify-center"},{default:r(()=>[a(d,{label:"บันทึก",color:"success",type:"submit",loading:t.loading},null,8,["loading"]),a(d,{label:"ยกเลิก",color:"danger",onClick:l.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[y,l.value]])]),_:1},512)),[[y,l.value]])}const W=B(J,[["render",Q]]),Y={data(){return{openModal:!1,modalData:null,items:[],forms:[{label:"วัคซีน",value:"vaccine",icon:"needle"},{label:"ฉีดวัคซีนล่าสุด",value:"dateCurrent",icon:"calendar",type:"date"},{label:"ฉีดวัคซีนครั้งต่อไป",value:"dateNext",icon:"calendar",type:"date"}],search:{dateCurrent:null,dateNext:null,vaccine:""},loading:!1,mode:"create",dataEdit:null,checked:{label:{value:"vaccine"}},datas:[{label:"วัคซีน",class:"text-center",value:"vaccine"},{label:"ความถี่/วัคซีน (เดือน)",class:"text-center",value:"frequency"},{label:"ฉีดวัคซีนล่าสุด",class:"text-center",value:"dateCurrent",type:"date"},{label:"ฉีดวัคซีนครั้งต่อไป",class:"text-center",value:"dateNext",type:"date"},{label:"หมายเหตุ",class:"text-center",value:"remark"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},components:{SectionMain:H,LayoutAuthenticated:I,SectionTitleBarSub:P,Table:R,Modal:W,Criteria:z},computed:{user(){return this.$store.state.auth.user}},created(){this.getDatas()},methods:{async getDatas(e){this.loading=!0;const o=await m.all(e);this.items=[],o.data&&(this.items=o.data.protections),this.loading=!1},async remove(e){this.loading=!0,(await m.delete(e)).data&&this.getDatas(),this.loading=!1,v.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},edit(e){this.modalData=e,this.mode="edit",this.openModal=!0},reset(){this.search.dateCurrent=null,this.search.dateNext=null,this.search.vaccine=""}}};function Z(e,o,x,V,t,l){const s=n("SectionTitleBarSub"),c=n("Modal"),p=n("Criteria"),f=n("Table"),d=n("SectionMain"),h=n("LayoutAuthenticated");return _(),g(h,null,{default:r(()=>[a(d,null,{default:r(()=>[a(s,{icon:"doctor",title:"การป้องกัน/บำรุง","has-btn-add":"",onOpenModal:o[0]||(o[0]=u=>{t.mode="create",t.openModal=!0}),btnText:"เพิ่มการป้องกัน/บำรุง"}),a(c,{modelValue:t.openModal,"onUpdate:modelValue":o[1]||(o[1]=u=>t.openModal=u),data:t.modalData,mode:t.mode,onConfirm:l.getDatas},null,8,["modelValue","data","mode","onConfirm"]),a(p,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:l.getDatas,onReset:l.reset,forms:t.forms,search:t.search},null,8,["onSearch","onReset","forms","search"]),a(f,{title:"รายการป้องกัน/บำรุง","has-checkbox":"","checked-data":t.checked,items:t.items,datas:t.datas,buttons:t.buttons,onEdit:l.edit,onDelete:l.remove,onDeleteSelected:e.removeSelected,loading:t.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const se=B(Y,[["render",Z]]);export{se as default};

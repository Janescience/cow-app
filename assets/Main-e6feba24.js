import{z as J,B as K,p as de,m as ce,_ as X,l as Z,F as ue,i as me,j as he,f as ee,N as F,E as v,G as C,H as B,o as r,c as L,w as _,d as n,I as m,k as S,s as o,h as O,t as g,J as b,K as D,e as fe,a as w,L as ge,M as ve,n as z,q as W,S as ke,C as _e,D as ye}from"./index-93a5fe65.js";import{T as pe}from"./Table-5029edfc.js";import{_ as we}from"./FormField-c5331b04.js";import{_ as xe}from"./FormCheckRadioPicker-e1255609.js";import{D as Me}from"./Cow-3e90172e.js";import{M as I}from"./milking-b720c98d.js";import{T as G}from"./alert-2eef3ef6.js";import{u as be,_ as De}from"./Top-4422ea3a.js";import"./cow-0e4f1595.js";const Ce={data(){return{milk:{date:new Date,time:"M"},milkDetail:{cow:{},qty:null,amount:null},milkDetails:[],loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{calAmount(){return this.milkDetail.amount=this.milkDetail.qty*100,this.milkDetail.amount},user(){return this.$store.state.auth.user},value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},watch:{data:{handler(e,l){e!=null&&(this.mode=="edit"&&(this.milkDetails=e.milkDetails),this.milk.date=e.date?new Date(e.date):new Date,this.milk.time=e.time?e.time:"M",this.milk._id=e._id)}}},methods:{clear(){this.milk={},this.milk.date=new Date,this.milk.time="M",this.milkDetails=[]},confirmCancel(e,l){this.value=!1,this.$emit(e,l)},confirm(e){this.clear(),this.confirmCancel("confirm",e)},cancel(){this.clear(),this.confirmCancel("cancel")},removeDetail(e){let l=this.milkDetails.indexOf(e);l!==-1&&this.milkDetails.splice(l,1)},add(){this.milkDetail.cow&&this.milkDetail.qty>0&&this.milkDetail.amount?this.milkDetails.filter(l=>{var a;return l.cow.code===((a=this.milkDetail)==null?void 0:a.cow.code)}).length<=0?(this.milkDetails.push(this.milkDetail),this.alert="",this.milkDetail={}):this.alert="โคซ้ำ":this.alert="กรุณากรอกข้อมูลให้ครบ"},async submit(){this.loading=!0,this.alert="",this.milk.milkDetails=this.milkDetails;const e={...this.milk};try{this.mode==="create"?await I.create(e)&&(this.loading=!1,this.value=!1,this.confirm(e),G.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})):await I.update(this.milk._id,this.milk)&&(this.loading=!1,this.value=!1,this.confirm(),G.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"}))}catch(l){console.error("Error : ",l),this.loading=!1,this.alert=l.response.data.message}},formatDate(e){return K(e).format("DD/MM/YYYY")}},components:{BaseButton:de,BaseButtons:ce,CardBox:X,BaseDivider:Z,OverlayLayer:ue,FormField:we,FormControl:me,NotificationBar:he,BaseLevel:ee,DDLCow:Me,FormCheckRadioPicker:xe,BaseIcon:F},props:{modelValue:{type:[String,Number,Boolean],default:null},mode:{type:String,default:""},data:{type:Object,default:null}}},Be={key:0,class:"grid grid-cols-2 gap-3 mt-1"},Ye={class:"grid grid-cols-2 lg:grid-cols-4 gap-5"},Ve=o("header",{class:"flex items-stretch border-b border-gray-100 dark:border-gray-800"},[o("p",{class:"flex items-center py-3 grow font-bold"}," รายการรีดนม ")],-1),Te={key:3,class:"overflow-x-auto"},Se=o("thead",null,[o("tr",null,[o("th",{class:"whitespace-nowrap text-center"}," โค "),o("th",{class:"whitespace-nowrap text-center"}," น้ำนมดิบ/กก. "),o("th",{class:"whitespace-nowrap text-center"}," จำนวนเงิน "),o("th")])],-1),Ee={"data-label":"โค"},Fe={"data-label":"น้ำนมดิบ/กก.",class:"text-center"},Oe={"data-label":"จำนวนเงิน",class:"text-right"},Le={class:"lg:w-6 whitespace-nowrap"},Qe={key:4,class:"text-center py-10 text-gray-500 dark:text-gray-400"},$e=o("p",null,"ไม่มีรายการ...",-1),qe=[$e];function Ae(e,l,a,U,d,c){const h=v("FormControl"),y=v("FormField"),Y=v("FormCheckRadioPicker"),V=v("BaseDivider"),T=v("DDLCow"),p=v("BaseButton"),x=v("BaseButtons"),q=v("NotificationBar"),A=v("CardBox"),Q=v("OverlayLayer");return C((r(),L(Q,null,{default:_(()=>[C(n(A,{title:a.mode==="create"?"การรีดนม":"การรีดนม ("+((d.milk.time=="M"?"เช้า":"บ่าย")+" - "+c.formatDate(d.milk.date))+")",class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"","has-scroll":"",onSubmit:fe(c.submit,["prevent"]),onHeaderIconClick:c.cancel},{default:_(()=>[a.mode!="edit"?(r(),m("div",Be,[n(y,{label:"วันที่รีดนม",help:"* ห้ามว่าง"},{default:_(()=>[n(h,{modelValue:d.milk.date,"onUpdate:modelValue":l[0]||(l[0]=f=>d.milk.date=f),icon:"calendar",type:"date",required:"",disabled:a.mode=="edit"},null,8,["modelValue","disabled"])]),_:1}),n(y,{label:"รอบ"},{default:_(()=>[n(Y,{modelValue:d.milk.time,"onUpdate:modelValue":l[1]||(l[1]=f=>d.milk.time=f),type:"radio",name:"milk-time",options:{M:"เช้า",A:"บ่าย"},disabled:a.mode=="edit"},null,8,["modelValue","disabled"])]),_:1})])):S("",!0),a.mode!="edit"?(r(),L(V,{key:1})):S("",!0),o("div",Ye,[n(y,{label:"โค",help:"* ห้ามว่าง"},{default:_(()=>[n(T,{modelValue:d.milkDetail.cow,"onUpdate:modelValue":l[2]||(l[2]=f=>d.milkDetail.cow=f),valueType:"object"},null,8,["modelValue"])]),_:1}),n(y,{label:"น้ำนมดิบ/กก.",help:"* ห้ามว่าง"},{default:_(()=>[n(h,{modelValue:d.milkDetail.qty,"onUpdate:modelValue":l[3]||(l[3]=f=>d.milkDetail.qty=f),type:"number",icon:"scale"},null,8,["modelValue"])]),_:1}),n(y,{label:"จำนวนเงินรวม",help:"ราคาน้ำนมดิบ/กก. 100 บาท"},{default:_(()=>[n(h,{modelValue:c.calAmount,"onUpdate:modelValue":l[4]||(l[4]=f=>c.calAmount=f),type:"number",icon:"cashMultiple"},null,8,["modelValue"])]),_:1}),n(x,{type:"justify-start"},{default:_(()=>[n(p,{label:"เพิ่ม",color:"info",onClick:l[5]||(l[5]=f=>c.add())})]),_:1})]),d.alert?(r(),L(q,{key:2,color:"danger",outline:"",icon:"alertCircleOutline"},{default:_(()=>[O(g(d.alert),1)]),_:1})):S("",!0),Ve,d.milkDetails.length>0?(r(),m("div",Te,[o("table",null,[Se,o("tbody",null,[(r(!0),m(b,null,D(d.milkDetails,f=>(r(),m("tr",{key:f.cow._id},[o("td",Ee,g(f.cow.code)+" : "+g(f.cow.name),1),o("td",Fe,g(f.qty),1),o("td",Oe,g(f.amount),1),o("td",Le,[n(x,{type:"justify-end lg:justify-start","no-wrap":""},{default:_(()=>[n(p,{color:"danger",icon:"trashCanOutline",small:"",onClick:j=>c.removeDetail(f)},null,8,["onClick"])]),_:2},1024)])]))),128))])])])):(r(),m("div",Qe,qe)),n(x,{type:"justify-center mt-3"},{default:_(()=>[n(p,{label:"บันทึก",color:"success",type:"submit",loading:d.loading},null,8,["loading"]),n(p,{label:"ยกเลิก",color:"danger",onClick:c.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[B,c.value]])]),_:1},512)),[[B,c.value]])}const te=J(Ce,[["render",Ae]]),Ne={ref:"calendarContainer",class:"min-h-full min-w-full text-gray-300"},Ie={class:"w-full grid grid-cols-7"},Ue=["onClick"],je=o("div",{class:"w-1/12"},[o("div",{class:"h-2 w-2 rounded-full bg-orange-600"})],-1),Pe={class:"w-11/12"},ze={class:"text-xs tracking-tight text-clip overflow-hidden"},Re=["onClick"],He={class:"w-1/12 mr-1"},We={class:"w-11/12"},Ge={class:"text-xs tracking-tight text-clip text-left overflow-hidden"},Je=["onClick"],Ke={class:"h-6 w-6 flex justify-center items-center text-xs bg-orange-600 rounded-full shadow-sm"},Xe={class:"font-medium text-white"},Ze={class:"mt-2"},et=["onClick"],tt={class:"text-sm text-clip overflow-hidden items-center"},lt=["onClick"],at={class:"opacity-40"},ot=o("p",{class:"hidden md:block"},"รีดนม",-1),st=["onClick"],nt={class:"h-6 w-6 flex justify-center items-center text-xs bg-orange-600 rounded-full shadow-sm"},it={class:"font-medium text-white"},rt={key:0,class:"md:hidden"},dt=["onClick"],ct={class:"text-sm text-clip overflow-hidden"},ut={__name:"Calendar",props:{events:{type:Object,required:!0}},emits:["confirm","month","year"],setup(e,{emit:l}){const a=be();a.$subscribe((u,s)=>{A(),Q()}),l("month",a.getMonth+1),l("year",a.getYear);const U={1:"อา",2:"จ.",3:"อ.",4:"พ.",5:"พฤ",6:"ศ.",7:"ส."},d=w(0),c=w(0),h=w(0),y=w(0),Y=w(!1),V=w(!1),T=w([]),p=w(""),x=w("create"),q=w({}),A=()=>{d.value=new Date(a.getYear,a.getMonth+1,0).getDate()},Q=()=>{h.value=new Date(a.getYear,a.getMonth,1).getDay()},f=()=>{c.value=new Date(a.getYear,a.getMonth,0).getDate()},j=()=>{let u=h.value<=4?35:42;y.value=u-d.value-h.value},N=u=>{let s=new Date;return a.getYear==s.getFullYear()&&a.getMonth==s.getMonth()&&u==s.getDate()},R=(u,s,t,i,k)=>a.getYear==s.substring(4,8)&&a.getMonth+(t?0:1)==s.substring(2,4)&&u==s.substring(0,2)&&i==k,le=(u,s,t)=>a.getYear==s.substring(4,8)&&a.getMonth+(t?0:1)==s.substring(2,4)&&u==s.substring(0,2),E=(u,s,t)=>{if(!s.length)return[];let i=[];return s.forEach(k=>{R(u,k.date,t)&&i.push(k)}),i},M=(u,s,t,i)=>{if(!s.length)return[];let k=[];return s.forEach(P=>{R(u,P.date,t,P.time,i)&&(k=P.milks)}),k},H=(u,s,t)=>{if(!s.length)return 0;let i=0;return s.forEach(k=>{le(u,k.date,t)&&(i+=k.sumQty)}),i},$=(u,s,t,i)=>{x.value=t?"edit":"create";let k=a.getYear+"-"+(a.getMonth+1)+"-"+u;q.value={_id:i,date:k,time:t,milkDetails:s},Y.value=!0},ae=(u,s)=>{const t=E(u,s);T.value=t,p.value=u,V.value=!0},oe=u=>{l("confirm",u)},se=()=>{a.decrementMonth(1),l("month",a.getMonth+1),l("year",a.getYear)},ne=()=>{a.incrementMonth(1),l("month",a.getMonth+1),l("year",a.getYear)},ie=u=>{l("month",u)},re=u=>{l("year",u)};return ge(()=>{A(),Q(),f(),j()}),ve(()=>{Q(),f(),j()}),(u,s)=>(r(),m(b,null,[o("div",Ne,[o("div",Ie,[n(De,{onMonth:ie,onYear:re}),(r(),m(b,null,D(U,t=>o("div",{key:t,class:"text-center text-sm md:text-base lg:text- font-medium border-b mt-3 border-gray-600"},g(t),1)),64)),(r(!0),m(b,null,D(h.value,t=>C((r(),m("div",{key:t,class:"h-16 md:h-36 w-full opacity-50 border-t border-gray-600 align-top"},[o("div",{class:z(["w-full h-full text-xs md:text-sm lg:text-base text-center transition-colors p-3",{"bg-slate-300 text-gray-900 font-medium  ":N(t),"hover:bg-gray-100 hover:text-gray-700":!N(t)}])},[O(g(c.value-(h.value-t))+" ",1),(r(!0),m(b,null,D(E(c.value-(h.value-t),e.events,!0),i=>C((r(),m("div",{key:i.title,class:"hidden md:block"},[o("div",{class:"w-full px-2 py-1 flex space-x-1 items-center whitespace-nowrap overflow-hidden hover:border hover:border-gray-200 cursor-pointer rounded-lg",onClick:k=>u.togglePopover(k,i)},[je,o("div",Pe,[o("h5",ze,g(i.title),1)])],8,Ue)])),[[B,E(c.value-(h.value-t),e.events,!0).length]])),128)),M(c.value-(h.value-t),e.events,!0).length>3?(r(),m("div",{key:0,class:"hidden md:flex mt-2 w-full px-2 py-1 space-x-2 items-center whitespace-nowrap overflow-hidden hover:text-gray-800 hover:font-medium cursor-pointer rounded-sm",onClick:i=>$(c.value-(h.value-t),M(c.value-(h.value-t),e.events,!0))},[o("div",He,[n(F,{path:"plus"})]),o("div",We,[o("h6",Ge,g(" มีอีก "+(M(c.value-(h.value-t),e.events,!0).length-3)+" รายการ"),1)])],8,Re)):S("",!0),M(c.value-(h.value-t),e.events,!0).length>0?(r(),m("div",{key:1,class:"flex md:hidden h-2/3 w-full justify-center items-center",onClick:i=>$(c.value-(h.value-t),M(c.value-(h.value-t),e.events,!0))},[o("div",Ke,[o("h3",Xe,g(M(c.value-(h.value-t),e.events,!0).length),1)])],8,Je)):S("",!0)],2)])),[[B,h.value>0]])),128)),(r(!0),m(b,null,D(d.value,t=>(r(),m("div",{key:t,class:"h-16 md:h-36 w-full border-t border-gray-600 align-top"},[o("div",{class:z(["w-full h-full text-xs md:text-sm lg:text-base text-center transition-colors p-2",{"bg-gray-600 text-gray-900 font-medium  ":N(t),"hover:bg-gray-100 hover:text-gray-700":!N(t)}])},[O(g(t)+" ",1),o("div",Ze,[(r(!0),m(b,null,D(E(t,e.events),i=>C((r(),m("div",{key:i.date,class:"hidden md:block p-1"},[o("div",{class:"w-full flex p-1 shadow-lg border border-gray-800 shadow cursor-pointer rounded-md",onClick:k=>$(t,M(t,e.events,!1,i.time),i.time,i.id)},[o("p",tt,[n(F,{path:i.time==="M"?"clockTimeSevenOutline":"clockTimeThreeOutline",class:z(i.time==="M"?"text-yellow-400":"text-orange-500")},null,8,["path","class"]),O(" "+g(i.time=="M"?"เช้า":"บ่าย")+" - "+g(i.sumQty)+" กก. ",1)])],8,et)])),[[B,E(t,e.events).length>0]])),128))]),C(o("div",null,[o("div",{class:"w-full mt-2 text-center items-center overflow-hidden hover:border hover:border-gray-200 cursor-pointer rounded-lg",onClick:i=>$(t,M(t,e.events))},[o("div",at,[n(F,{path:"plus"}),O(),ot])],8,lt)],512),[[B,E(t,e.events).length===0]]),H(t,e.events)>0?(r(),m("div",{key:0,class:"flex md:hidden h-2/3 w-full justify-center items-center",onClick:i=>ae(t,e.events)},[o("div",nt,[o("h3",it,g(H(t,e.events)),1)])],8,st)):S("",!0)],2)]))),128)),(r(!0),m(b,null,D(y.value,t=>C((r(),m("div",{key:t,class:"h-16 md:h-36 w-full opacity-50"})),[[B,y.value>0]])),128))]),n(ee,{type:"justify-between w-full mt-2",class:"md:hidden"},{default:_(()=>[n(F,{path:"chevronLeft",size:"30",class:"cursor-pointer hover:text-gray-300",onClick:s[0]||(s[0]=t=>se())}),n(F,{path:"chevronRight",size:"30",class:"cursor-pointer hover:text-gray-300",onClick:s[1]||(s[1]=t=>ne())})]),_:1}),n(Z),V.value?(r(),m("div",rt,[O(" รายการรีดนม "+g(p.value)+"/"+g(W(a).getMonth+1)+"/"+g(W(a).getYear+543)+" ",1),(r(!0),m(b,null,D(T.value,t=>C((r(),m("div",{key:t.date},[o("div",{class:"w-full text-left flex overflow-hidden p-2 mt-2 border border-gray-800 shadow cursor-pointer rounded-md",onClick:i=>$(p.value,M(p.value,e.events,!1,t.time),t.time,t.id)},[o("p",ct," รอบ "+g(t.time=="M"?"เช้า":"บ่าย")+" น้ำนมดิบ "+g(t.sumQty)+" กก. รีดแล้ว "+g(t.count)+" ตัว ",1)],8,dt)])),[[B,T.value.length>0]])),128))])):S("",!0)],512),n(te,{modelValue:Y.value,"onUpdate:modelValue":s[2]||(s[2]=t=>Y.value=t),mode:x.value,data:q.value,onConfirm:oe},null,8,["modelValue","mode","data"])],64))}},mt={data(){return{modalMilk:!1,monthMilk:new Date().getMonth()+1,yearMilk:new Date().getFullYear(),items:[],events:[],forms:[{label:"โค",class:"lg:col-start-2",value:"cow",type:"ddl",module:"cow"},{label:"วันที่รีดนม",value:"date",icon:"calendar",type:"date"}],loading:!1,mode:"create",dataEdit:null,checked:{code:{value:"date",type:"date"},label:{value:"cow.name"}},datas:[{label:"วันที่รีดนม",class:"text-center",type:"date",value:"date"},{label:"โค",class:"text-center",value:"relate.cow.name"},{label:"ปริมาณน้ำนมดิบ/เช้า (กก.)",class:"text-center",value:"morningQty"},{label:"ปริมาณน้ำนมดิบ/บ่าย (กก.)",class:"text-center",value:"afternoonQty"},{label:"ปริมาณน้ำนมดิบรวม (กก.)",class:"text-center",func:e=>e.morningQty+e.afternoonQty},{label:"จำนวนเงินรวม",class:"text-right",type:"number",value:"amount"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},components:{SectionMain:ke,LayoutAuthenticated:_e,Table:pe,SectionTitleBarSub:ye,MilkModal:te,Calendar:ut,CardBox:X},computed:{user(){return this.$store.state.auth.user}},created(){this.getMilks()},watch:{monthMilk(e){this.getMilks()},yearMilk(e){this.getMilks()}},methods:{async getMilks(){this.loading=!0;const e=await I.all({month:this.monthMilk,year:this.yearMilk});if(this.events=[],e.data)for(let l of e.data.milks)this.filterMilk(l);this.loading=!1},async removeMilk(e){this.loading=!0,(await I.delete(e)).data&&this.getMilks(),this.loading=!1},filterMilk(e){let l={};l.sumQty=0,l.sumAmt=0,e.milkDetails.map(a=>{a.cow=typeof a.cow=="string"?a.relate.cow:a.cow,l.sumQty+=a.qty,l.sumAmt+=a.amount}),l.count=e.milkDetails.length,l.milks=e.milkDetails,l.date=K(e.date,"YYYY-MM-DD").format("DDMMYYYY"),l.time=e.time,l.id=e._id,this.events.push(l)},addMilk(e){this.filterMilk(e)},getMonthMilk(e){this.monthMilk=e},getYearMilk(e){this.yearMilk=e},edit(e){this.dataEdit=e,this.mode="edit",this.modalMilk=!0}}};function ht(e,l,a,U,d,c){const h=v("SectionTitleBarSub"),y=v("MilkModal"),Y=v("Calendar"),V=v("CardBox"),T=v("SectionMain"),p=v("LayoutAuthenticated");return r(),L(p,null,{default:_(()=>[n(T,null,{default:_(()=>[n(h,{icon:"cupWater",title:"การรีดนม",btnText:"เพิ่มการรีดนม","has-btn-add":"",onOpenModal:l[0]||(l[0]=x=>{d.mode="create",d.modalMilk=!0})}),n(y,{modelValue:d.modalMilk,"onUpdate:modelValue":l[1]||(l[1]=x=>d.modalMilk=x),mode:d.mode,dataEdit:d.dataEdit,onConfirm:c.getMilks},null,8,["modelValue","mode","dataEdit","onConfirm"]),d.loading?(r(),L(V,{key:1,loading:""})):(r(),L(V,{key:0},{default:_(()=>[n(Y,{events:d.events,onConfirm:c.addMilk,onMonth:c.getMonthMilk,onYear:c.getYearMilk},null,8,["events","onConfirm","onMonth","onYear"])]),_:1}))]),_:1})]),_:1})}const Mt=J(mt,[["render",ht]]);export{Mt as default};

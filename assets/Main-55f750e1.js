import{z as S,C as P,D as w,E as L,T as A,f as T,g as $,_ as q,O as F,Q as C,c as k,w as _,F as c,o as n,d as i,J as d,K as M,L as O,s as y,t as x,k as b}from"./index-0dd72056.js";import{C as j}from"./Criteria-41401166.js";import{F as v}from"./food-05df9223.js";import{C as z}from"./cow-03286990.js";import{T as B}from"./alert-6f0e4046.js";import"./CardBoxCollapse-5c9adac4.js";import"./FormField-0978f139.js";import"./Cow-c2b9691d.js";import"./Vaccine-3f5ceba8.js";const E={data(){return{perPage:12,currentPage:0,openModal:!1,modalData:null,items:[],ddlCorral:[],forms:[{label:"สูตรอาหาร",value:"recipe",type:"ddl",module:"recipe"},{label:"คอก",value:"corral",icon:"barn",type:"number"}],search:{recipe:{},corral:""},loading:!1,mode:"create",dataEdit:null,checked:{code:{value:"corral"},label:{value:"recipe.name"}},datas:[{label:"คอก",class:"text-center",value:"corral"},{label:"จำนวนวัว",class:"text-center",value:"numCow"},{label:"สูตรอาหาร",class:"text-center",value:"recipe.name"},{label:"จำนวนที่ให้/วัน (กก.)",class:"text-center",value:"qty"},{label:"รวมเป็นเงิน/วัน",class:"text-center",value:"amount",func:e=>e.amount.toFixed(2)},{label:"คิดเป็นเงิน/ตัว",class:"text-center",value:"amountAvg",func:e=>e.amountAvg.toFixed(2)}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},components:{SectionMain:P,LayoutAuthenticated:w,SectionTitleBarSub:L,Table:A,Criteria:j,BaseLevel:T,UserAvatar:$,CardBox:q,BaseIcon:F},computed:{getDataCopy(){return{...this.modalData}},corral(){return this.ddlCorral},itemsPaginated(){return this.items?this.items.slice(this.perPage*this.currentPage,this.perPage*(this.currentPage+1)):[]},numPages(){return Math.ceil((this.items?this.items.length:0)/this.perPage)},currentPageHuman(){return this.currentPage+1},pagesList(){const e=[];for(let t=0;t<this.numPages;t++)e.push(t);return e}},created(){this.getDatas()},methods:{async getDatas(e){this.loading=!0;const t=await v.all(e);if(this.items=[],t.data){const u=t.data.foods,a=C.groupBy(u,"corral");for(let o of Object.keys(a)){const s=a[o];let p=null,f=null,m=null;if(s.length>0){const r=s[0];r&&r.foodDetails.length>0&&(p=r.foodDetails.reduce((g,h)=>g+h.qty,0),f=r.foodDetails.reduce((g,h)=>g+h.amount,0),m=r==null?void 0:r.foodDetails.length)}this.items.push({corral:o,amount:f,qty:p,count:m,foods:s})}}this.getCorrals()},async remove(e){this.loading=!0,(await v.delete(e)).data&&this.getDatas(),this.loading=!1,B.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},async removeSelected(e){this.loading=!0;let t=[];for(let a of e)t.push(a._id);(await v.deletes(t)).data&&(this.getReproductions(),B.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})),this.loading=!1},async getCorrals(){const e=await z.all();if(e){const t=e.data.cows,u=C.groupBy(t,"corral");for(let a of Object.keys(u))this.ddlCorral.push({id:a,label:a}),this.items.map(s=>s.corral).indexOf(a)<0&&this.items.push({corral:a})}this.loading=!1},detail(e){this.$router.push({name:"foodDetail",params:{corral:e.corral}})},reset(){this.search.recipe=null,this.search.corral="",this.getDatas()},resetData(){this.modalData=null}}},I={key:0,class:"grid lg:gap-3 md:gap-2 gap-1 grid-cols-3 lg:grid-cols-5 md:grid-cols-4"},N={class:"bg-orange-900 rounded-full w-20 h-20 justify-center flex items-center"},R={class:"text-center mt-2"},V={class:"lg:text-3xl text-xl"},Q={key:0,class:"lg:text-md dark:text-gray-400 text-sm"},H={key:1,class:"lg:text-md dark:text-gray-400 text-sm"},J={key:2,class:"lg:text-md dark:text-gray-600 text-xs"},K={key:1,class:"text-center py-10 text-gray-500 dark:text-gray-400"},U=y("p",null," กำลังโหลดข้อมูล...",-1);function G(e,t,u,a,o,s){const p=c("SectionTitleBarSub"),f=c("Criteria"),m=c("BaseIcon"),r=c("BaseLevel"),g=c("CardBox"),h=c("SectionMain"),D=c("LayoutAuthenticated");return n(),k(D,null,{default:_(()=>[i(h,null,{default:_(()=>[i(p,{icon:"foodDrumstickOutline",title:"การให้อาหาร"}),i(f,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:s.getDatas,onReset:s.reset,forms:o.forms,search:o.search,btnLoading:o.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),o.loading?(n(),d("div",K,[i(m,{path:"dotsCircle",size:"22",class:"animate-spin"}),U])):(n(),d("div",I,[(n(!0),d(M,null,O(s.itemsPaginated,l=>(n(),k(g,{key:l.corral,onClick:W=>s.detail(l),hoverable:""},{default:_(()=>[i(r,{type:"justify-center mt-3"},{default:_(()=>[y("div",N,[i(m,{path:"barn",size:"50",class:"dark:text-orange-500"})])]),_:1}),y("div",R,[y("h4",V," คอก "+x(l.corral),1),l.qty?(n(),d("p",Q," จำนวนรวม "+x(e.$filters.number(l.qty))+" กก. ",1)):b("",!0),l.amount?(n(),d("p",H," ราคารวม "+x(e.$filters.currency(l.amount)),1)):b("",!0),l.qty?b("",!0):(n(),d("p",J," (ไม่ได้บันทึกการให้อาหาร) "))])]),_:2},1032,["onClick"]))),128))]))]),_:1})]),_:1})}const le=S(E,[["render",G]]);export{le as default};

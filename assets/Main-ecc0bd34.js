import{b as Y,_ as L,a as N,d as T,c as H}from"./BaseDivider-98f6dc1f.js";import{E as g,v as j,h as A,_ as I,z as s,G as F,H as M,o as x,c as S,w as r,d as l,j as y,f as m,t as u,g as q,e as P,x as R}from"./index-5a45805c.js";import{a as O}from"./CardBoxModal-aee8f745.js";import{_ as U}from"./FormField-7c373276.js";import{_ as E}from"./FormControl-5466ebf9.js";import{_ as W}from"./NotificationBar-5157a094.js";import{T as G}from"./Table-a0d4a443.js";import{_ as Q}from"./LayoutAuthenticated-df187f74.js";import{_ as J}from"./SectionTitleBarSub-4df96ee6.js";import{T as B}from"./alert-ea8f1763.js";import{g as K}from"./age-calculate-3b5fe841.js";import{_ as z}from"./FormCheckRadioPicker-a96c4d10.js";import{W as X}from"./worker-ac8c8381.js";import"./UserAvatar-4bc740bd.js";async function Z(e={}){let t="?";return e.worker&&(t=t+`worker=${e.worker}&`),e?t.replace(/&*$/,""):""}class ${async all(t){const n=await Z(t);return g.get("/salary"+n).then(h=>h)}get(t){return g.get(`/salary/${t}`)}create(t){return g.post("/salary",t)}delete(t){return g.delete(`/salary/${t}`)}update(t,n){return g.put(`/salary/${t}`,n)}}const b=new $,ee={data(){return{salary:{year:new Date().getFullYear(),month:new Date().getMonth()+1,amount:null,remark:""},years:[],months:[{id:1,label:"มกราคม"},{id:2,label:"กุมภาพันธ์"},{id:3,label:"มีนาคม"},{id:4,label:"เมษายน"},{id:5,label:"พฤษภาคม"},{id:6,label:"มิถุนายน"},{id:7,label:"กรกฏาคม"},{id:8,label:"สิงหาคม"},{id:9,label:"กันยายน"},{id:10,label:"ตุลาคม"},{id:11,label:"พฤศจิกายน"},{id:12,label:"ธันวาคม"}],loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},watch:{data(e){e&&this.mode==="edit"&&(this.salary=e)}},created(){this.getYears()},methods:{clear(){this.salary={}},confirmCancel(e){this.value=!1,this.$emit(e)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="",this.salary.worker=this.$route.params.id;try{this.mode==="create"?await b.create(this.salary)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")):await b.update(this.salary._id,this.salary)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")),B.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})}catch(e){console.error("Error : ",e),this.loading=!1,this.alert=e.response.data.message,B.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}},getYears(){const e=new Date().getFullYear()+543,t=new Date().getFullYear();for(let n=5;n>0;n--)this.years.push({id:t+n,label:e+n});this.years.push({id:t,label:e});for(let n=1;n<6;n++)this.years.push({id:t-n,label:e-n})}},components:{BaseButton:Y,BaseButtons:A,CardBox:L,BaseDivider:N,OverlayLayer:O,FormField:U,FormControl:E,NotificationBar:W,BaseLevel:I,FormCheckRadioPicker:z,BaseIcon:T},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},te={class:"grid grid-cols-2 lg:grid-cols-3 gap-5"};function ae(e,t,n,h,a,i){const _=s("FormControl"),p=s("FormField"),k=s("NotificationBar"),w=s("BaseDivider"),c=s("BaseButton"),v=s("BaseButtons"),C=s("CardBox"),D=s("OverlayLayer");return F((x(),S(D,null,{default:r(()=>[F(l(C,{title:"เงินเดือน "+(this.mode==="create"?"":"(แก้ไข)"),class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"",onSubmit:P(i.submit,["prevent"]),onHeaderIconClick:i.cancel},{default:r(()=>[y("div",te,[l(p,{label:"ปี พ.ศ.",help:"* ห้ามว่าง"},{default:r(()=>[l(_,{modelValue:a.salary.year,"onUpdate:modelValue":t[0]||(t[0]=d=>a.salary.year=d),options:a.years},null,8,["modelValue","options"])]),_:1}),l(p,{label:"เดือน",help:"* ห้ามว่าง"},{default:r(()=>[l(_,{modelValue:a.salary.month,"onUpdate:modelValue":t[1]||(t[1]=d=>a.salary.month=d),options:a.months},null,8,["modelValue","options"])]),_:1}),l(p,{label:"เงินเดือน",help:"* ห้ามว่าง "},{default:r(()=>[l(_,{icon:"cashMultiple",type:"number",modelValue:a.salary.amount,"onUpdate:modelValue":t[2]||(t[2]=d=>a.salary.amount=d)},null,8,["modelValue"])]),_:1}),l(p,{label:"หมายเหตุ"},{default:r(()=>[l(_,{modelValue:a.salary.remark,"onUpdate:modelValue":t[3]||(t[3]=d=>a.salary.remark=d),type:"textarea"},null,8,["modelValue"])]),_:1})]),a.alert?(x(),S(k,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:r(()=>[m(u(a.alert),1)]),_:1})):q("",!0),l(w),l(v,{type:"justify-center"},{default:r(()=>[l(c,{label:"บันทึก",color:"success",type:"submit",loading:a.loading},null,8,["loading"]),l(c,{label:"ยกเลิก",color:"danger",onClick:i.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[M,i.value]])]),_:1},512)),[[M,i.value]])}const le=j(ee,[["render",ae]]),oe={data(){return{openModal:!1,modalData:null,mode:"create",worker:{},salary:{},salaries:[],loading:!1,alert:"",datas:[{label:"ปี",value:"year",class:"text-center"},{label:"เดือน",class:"text-center",value:"month"},{label:"เงินเดือน",value:"amount",class:"text-right"},{label:"หมายเหตุ",class:"text-center",value:"remark"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},computed:{getDataCopy(){return{...this.modalData}}},created(){this.getWorker()},methods:{async getWorker(){this.loading=!0;const e=await X.get(this.$route.params.id);e.data&&(this.worker=e.data.worker,this.getSalaries()),this.loading=!1},async getSalaries(){this.loading=!0;const e=await b.all({worker:this.worker._id});e.data&&(this.salaries=e.data.salarys),this.loading=!1},async remove(e){this.loading=!0,(await b.delete(e)).data&&this.getSalaries(),this.loading=!1,B.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},async removeSelected(e){this.loading=!0;let t=[];for(let h of e)t.push(h._id);(await b.deletes(t)).data&&(this.getSalaries(),B.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})),this.loading=!1},edit(e){this.modalData=e,this.mode="edit",this.openModal=!0},resetData(){this.modalData=null},formatDate(e){return e?R(new Date(e)).format("DD/MM/YYYY"):""},calAge(e){return K(e).ageString}},components:{BaseButton:Y,BaseButtons:A,CardBox:L,BaseDivider:N,OverlayLayer:O,FormField:U,FormControl:E,NotificationBar:W,BaseLevel:I,FormCheckRadioPicker:z,BaseIcon:T,Table:G,LayoutAuthenticated:Q,SectionMain:H,SectionTitleBarSub:J,Modal:le}},re={class:"px-4 sm:px-0 mb-4 flex items-center justify-between"},se={class:"flex items-center justify-start"},ne=y("h1",{class:"text-base lg:text-2xl"}," จัดการเงินเดือน ",-1),ie={class:"grid grid-cols-2 lg:grid-cols-5 gap-5"};function ce(e,t,n,h,a,i){const _=s("BaseIcon"),p=s("BaseButton"),k=s("BaseButtons"),w=s("Modal"),c=s("FormField"),v=s("CardBox"),C=s("Table"),D=s("SectionMain"),d=s("LayoutAuthenticated");return x(),S(d,null,{default:r(()=>[l(D,null,{default:r(()=>[y("section",re,[y("div",se,[l(_,{path:"cashMultiple",size:"30",class:"mr-3"}),ne]),l(k,{class:"text-sm lg:text-base",type:"justify-end"},{default:r(()=>[l(p,{class:"lg:p-2 p-1",label:"ย้อนกลับ",color:"light",onClick:t[0]||(t[0]=o=>this.$router.push("/manage/worker"))}),l(p,{class:"lg:p-2 p-1",label:"เพิ่มเงินเดือน",color:"success",onClick:t[1]||(t[1]=o=>{a.mode="create",a.openModal=!0})})]),_:1})]),l(w,{modelValue:a.openModal,"onUpdate:modelValue":t[2]||(t[2]=o=>a.openModal=o),data:i.getDataCopy,mode:a.mode,onConfirm:i.getSalaries},null,8,["modelValue","data","mode","onConfirm"]),l(v,{icon:"accountBox",title:"ข้อมูลคนงาน",class:"shadow-lg w-full mb-5","header-icon":"",form:""},{default:r(()=>[y("div",ie,[l(c,{label:"ชื่อ"},{default:r(()=>{var o;return[m(u((o=a.worker)==null?void 0:o.name),1)]}),_:1}),l(c,{label:"อายุ"},{default:r(()=>{var o;return[m(u((o=a.worker)==null?void 0:o.age),1)]}),_:1}),l(c,{label:"วันที่เริ่มงาน"},{default:r(()=>{var o;return[m(u(i.formatDate((o=a.worker)==null?void 0:o.startDate)),1)]}),_:1}),l(c,{label:"วันที่สิ้นสุดงาน"},{default:r(()=>{var o,f;return[m(u((o=a.worker)!=null&&o.endDate?(f=a.worker)==null?void 0:f.endDate:"ถึงปัจจุบัน"),1)]}),_:1}),l(c,{label:"อายุงาน"},{default:r(()=>{var o,f,V;return[m(u(i.calAge((o=a.worker)==null?void 0:o.startDate,((f=a.worker)==null?void 0:f.status)==="L"?(V=a.worker)==null?void 0:V.endDate:null)),1)]}),_:1}),l(c,{label:"หน้าที่"},{default:r(()=>{var o;return[m(u((o=a.worker)==null?void 0:o.duty),1)]}),_:1}),l(c,{label:"ฐานเงินเดือนล่าสุด"},{default:r(()=>{var o;return[m(u((o=a.worker)==null?void 0:o.salary),1)]}),_:1}),l(c,{label:"หมายเหตุ"},{default:r(()=>{var o,f;return[m(u((o=a.worker)!=null&&o.remark?(f=a.worker)==null?void 0:f.remark:"-"),1)]}),_:1})])]),_:1}),l(C,{title:"ประวัติเงินเดือน","has-checkbox":"","checked-data":e.checked,items:a.salaries,datas:a.datas,buttons:a.buttons,onEdit:i.edit,onDelete:i.remove,onDeleteSelected:i.removeSelected,loading:a.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const Ce=j(oe,[["render",ce]]);export{Ce as default};

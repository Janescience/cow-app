import{y as m,B as k,z as S,p as Y,m as N,_ as F,l as U,F as L,i as T,j as q,f as E,N as O,E as n,G as v,H as C,o as w,c as D,w as r,d as l,s as H,k as B,h as R,t as W,e as A,S as j,C as I,D as P}from"./index-e109c5b3.js";import{T as z}from"./Table-e3f136a4.js";import{C as G}from"./Criteria-608800ac.js";import{_ as Q}from"./FormField-1c8f4106.js";import{T as _}from"./alert-faa5acbd.js";import{_ as J}from"./FormCheckRadioPicker-e9cd2263.js";import"./Cow-f17fda10.js";import"./cow-40799a72.js";import"./Vaccine-64d0b535.js";async function K(a={}){let e="?";return a.status&&(e=e+`status=${a.status}&`),a?e.replace(/&*$/,""):""}class X{async all(e){const i=await K(e);return m.get("/worker"+i).then(c=>c)}get(e){return m.get(`/worker/${e}`)}create(e){return e.startDate&&(e.startDate=k(new Date(e.startDate)).format("YYYY-MM-DD")),e.endDate&&(e.endDate=k(new Date(e.endDate)).format("YYYY-MM-DD")),m.post("/worker",e)}delete(e){return m.delete(`/worker/${e}`)}update(e,i){return i.startDate&&(i.startDate=k(new Date(i.startDate)).format("YYYY-MM-DD")),i.endDate&&(i.endDate=k(new Date(i.endDate)).format("YYYY-MM-DD")),m.put(`/worker/${e}`,i)}}const f=new X,V=a=>a==="ddl"?[{id:"",label:"ทั้งหมด"},{id:"W",label:"ทำงาน"},{id:"L",label:"เลิกจ้าง"},{id:"S",label:"พัก"}]:{W:"ทำงาน",L:"เลิกจ้าง",S:"พัก"},Z={data(){return{worker:{name:"",age:"",duty:"",startDate:new Date,endDate:null,phoneNumber:"",country:"",status:"W",salary:"",remark:"",change:!0},status:V("ddl"),loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(a){this.$emit("update:modelValue",a)}},user(){return this.$store.state.auth.user}},watch:{data(a){a&&this.mode==="edit"&&(this.worker=a,this.worker.startDate=new Date(a.startDate),this.worker.endDate=a.endDate?new Date(a.endDate):null)}},methods:{clear(){this.worker.name="",this.worker.age="",this.worker.startDate=new Date,this.worker.endDate=null,this.worker.country="",this.worker.phoneNumber="",this.worker.duty="",this.worker.remark="",this.worker.salary="",this.worker.status="W"},confirmCancel(a){this.value=!1,this.$emit(a)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await f.create(this.worker)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")):await f.update(this.worker._id,this.worker)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")),_.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})}catch(a){console.error("Error : ",a),this.loading=!1,this.alert=a.response.data.message,_.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}}},components:{BaseButton:Y,BaseButtons:N,CardBox:F,BaseDivider:U,OverlayLayer:L,FormField:Q,FormControl:T,NotificationBar:q,BaseLevel:E,FormCheckRadioPicker:J,BaseIcon:O},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},$={class:"grid grid-cols-2 lg:grid-cols-3 gap-5"};function ee(a,e,i,c,t,s){const d=n("FormControl"),u=n("FormField"),g=n("FormCheckRadioPicker"),b=n("NotificationBar"),y=n("BaseDivider"),h=n("BaseButton"),p=n("BaseButtons"),M=n("CardBox"),x=n("OverlayLayer");return v((w(),D(x,null,{default:r(()=>[v(l(M,{title:"คนงาน "+(this.mode==="create"?"":"(แก้ไข)"),class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"",onSubmit:A(s.submit,["prevent"]),onHeaderIconClick:s.cancel},{default:r(()=>[H("div",$,[l(u,{label:"ชื่อ",help:"* ห้ามว่าง"},{default:r(()=>[l(d,{modelValue:t.worker.name,"onUpdate:modelValue":e[0]||(e[0]=o=>t.worker.name=o),icon:"accountEdit",required:""},null,8,["modelValue"])]),_:1}),l(u,{label:"อายุ"},{default:r(()=>[l(d,{modelValue:t.worker.age,"onUpdate:modelValue":e[1]||(e[1]=o=>t.worker.age=o),type:"number",icon:"cardAccountDetails"},null,8,["modelValue"])]),_:1}),l(u,{label:"เบอร์โทรศัพท์"},{default:r(()=>[l(d,{modelValue:t.worker.phoneNumber,"onUpdate:modelValue":e[2]||(e[2]=o=>t.worker.phoneNumber=o),icon:"phone"},null,8,["modelValue"])]),_:1}),l(u,{label:"ประเทศ",help:"* ห้ามว่าง"},{default:r(()=>[l(d,{modelValue:t.worker.country,"onUpdate:modelValue":e[3]||(e[3]=o=>t.worker.country=o),icon:"flag",required:""},null,8,["modelValue"])]),_:1}),l(u,{label:"วันที่เริ่มงาน",help:"* ห้ามว่าง"},{default:r(()=>[l(d,{modelValue:t.worker.startDate,"onUpdate:modelValue":e[4]||(e[4]=o=>t.worker.startDate=o),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),l(u,{label:"วันที่สิ้นสุดงาน"},{default:r(()=>[l(d,{modelValue:t.worker.endDate,"onUpdate:modelValue":e[5]||(e[5]=o=>t.worker.endDate=o),icon:"calendar",type:"date"},null,8,["modelValue"])]),_:1}),l(u,{label:"หน้าที่",help:"* ห้ามว่าง"},{default:r(()=>[l(d,{modelValue:t.worker.duty,"onUpdate:modelValue":e[6]||(e[6]=o=>t.worker.duty=o),icon:"shovel",required:""},null,8,["modelValue"])]),_:1}),l(u,{label:"เงินเดือน",help:"* ห้ามว่าง"},{default:r(()=>[l(d,{modelValue:t.worker.salary,"onUpdate:modelValue":e[7]||(e[7]=o=>t.worker.salary=o),type:"number",icon:"cashMultiple",required:""},null,8,["modelValue"])]),_:1}),l(u,{label:"สถานะ"},{default:r(()=>[l(d,{modelValue:t.worker.status,"onUpdate:modelValue":e[8]||(e[8]=o=>t.worker.status=o),options:t.status},null,8,["modelValue","options"])]),_:1}),l(u,{label:"หมายเหตุ"},{default:r(()=>[l(d,{modelValue:t.worker.remark,"onUpdate:modelValue":e[9]||(e[9]=o=>t.worker.remark=o),type:"textarea"},null,8,["modelValue"])]),_:1})]),l(u,{label:"",help:"* เลือก = บันทึกประวัติเงินเดือนก่อนการเปลี่ยนแปลง, ไม่เลือก = ต้องการอัพเดตแค่ข้อมูลปัจจุบัน"},{default:r(()=>[i.mode==="edit"?(w(),D(g,{key:0,modelValue:t.worker.change,"onUpdate:modelValue":e[10]||(e[10]=o=>t.worker.change=o),name:"change",options:{change:"บันทึกประวัติการเปลี่ยนแปลง"}},null,8,["modelValue"])):B("",!0)]),_:1}),t.alert?(w(),D(b,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:r(()=>[R(W(t.alert),1)]),_:1})):B("",!0),l(y),l(p,{type:"justify-center"},{default:r(()=>[l(h,{label:"บันทึก",color:"success",type:"submit",loading:t.loading},null,8,["loading"]),l(h,{label:"ยกเลิก",color:"danger",onClick:s.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[C,s.value]])]),_:1},512)),[[C,s.value]])}const te=S(Z,[["render",ee]]),ae={data(){return{openModal:!1,modalData:null,items:[],forms:[{label:"สถานะ",value:"status",options:V("ddl")}],search:{status:""},loading:!1,mode:"create",dataEdit:null,checked:{code:{value:"name"},label:{value:"duty"}},datas:[{label:"ชื่อ",value:"name"},{label:"อายุ",class:"text-center",value:"age"},{label:"วันที่เริ่มงาน",class:"text-center",value:"startDate",type:"date"},{label:"วันที่สิ้นสุดงาน",class:"text-center",value:"endDate",type:"date"},{label:"หน้าที่",value:"duty"},{label:"เงินเดือน",value:"salary",class:"text-right"},{label:"เบอร​์โทรศัพท์",class:"text-center",value:"phoneNumber"},{label:"สถานะ",func:a=>V()[a.status]},{label:"ประเทศ",value:"country"},{label:"หมายเหตุ",value:"remark"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},components:{SectionMain:j,LayoutAuthenticated:I,SectionTitleBarSub:P,Table:z,Modal:te,Criteria:G},computed:{getDataCopy(){return{...this.modalData}}},created(){this.getDatas()},methods:{async getDatas(a){this.loading=!0;const e=await f.all(a);this.items=[],e.data&&(this.items=e.data.workers),this.loading=!1},async remove(a){this.loading=!0,(await f.delete(a)).data&&this.getDatas(),this.loading=!1,_.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},async removeSelected(a){this.loading=!0;let e=[];for(let c of a)e.push(c._id);(await f.deletes(e)).data&&(this.getDatas(),_.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})),this.loading=!1},edit(a){this.modalData=a,this.mode="edit",this.openModal=!0},reset(){this.search.status="",this.getDatas()},resetData(){this.modalData=null}}};function le(a,e,i,c,t,s){const d=n("SectionTitleBarSub"),u=n("Modal"),g=n("Criteria"),b=n("Table"),y=n("SectionMain"),h=n("LayoutAuthenticated");return w(),D(h,null,{default:r(()=>[l(y,null,{default:r(()=>[l(d,{icon:"accountHardHat",title:"คนงาน","has-btn-add":"",onOpenModal:e[0]||(e[0]=p=>{t.mode="create",t.openModal=!0}),btnText:"เพิ่มคนงาน"}),l(u,{modelValue:t.openModal,"onUpdate:modelValue":e[1]||(e[1]=p=>t.openModal=p),data:s.getDataCopy,mode:t.mode,onConfirm:s.getDatas,onCancel:s.resetData},null,8,["modelValue","data","mode","onConfirm","onCancel"]),l(g,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:s.getDatas,onReset:s.reset,forms:t.forms,search:t.search,btnLoading:t.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),l(b,{title:"รายการคนงาน","has-checkbox":"","checked-data":t.checked,items:t.items,datas:t.datas,buttons:t.buttons,onEdit:s.edit,onDelete:s.remove,onDeleteSelected:s.removeSelected,loading:t.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const fe=S(ae,[["render",le]]);export{fe as default};

import{y as m,B as y,z as V,p as k,m as E,_ as x,l as N,F,i as L,j as O,f as R,N as A,E as i,G as S,H as T,o as p,c as _,w as n,d as l,s as Y,k as M,h as I,t as q,e as H,S as U,C as W,D as j}from"./index-d5bd4e51.js";import{T as z}from"./Table-6dc0b3d7.js";import{C as G}from"./Criteria-4a12560d.js";import{_ as P}from"./FormField-7b910a84.js";import{T as g}from"./alert-745d7719.js";import{_ as Q}from"./FormCheckRadioPicker-c1046f06.js";import"./Cow-0825bf68.js";import"./cow-2eabc728.js";import"./Vaccine-204b6193.js";async function J(t={}){let e="?";return t.status&&(e=e+`status=${t.status}&`),t?e.replace(/&*$/,""):""}class K{async all(e){const s=await J(e);return m.get("/bill"+s).then(u=>u)}get(e){return m.get(`/bill/${e}`)}create(e){return e.date&&(e.date=y(new Date(e.date)).format("YYYY-MM-DD")),m.post("/bill",e)}delete(e){return m.delete(`/bill/${e}`)}update(e,s){return s.date&&(s.date=y(new Date(s.date)).format("YYYY-MM-DD")),m.put(`/bill/${e}`,s)}}const f=new K,X=t=>t==="create"?[{id:"WATER",label:"ค่าน้ำ"},{id:"ELECTRIC",label:"ค่าไฟ"},{id:"ACCOM",label:"ค่าที่พักคนงาน"},{id:"RENT",label:"ค่าเช่า"},{id:"INTERNET",label:"ค่าอินเทอร์เน็ต"},{id:"WASTE",label:"ค่าของเสีย"},{id:"OTH",label:"อื่นๆ"}]:[{id:"",label:"ทั้งหมด"},{id:"WATER",label:"ค่าน้ำ"},{id:"ELECTRIC",label:"ค่าไฟ"},{id:"ACCOM",label:"ค่าที่พักคนงาน"},{id:"RENT",label:"ค่าเช่า"},{id:"INTERNET",label:"ค่าอินเทอร์เน็ต"},{id:"WASTE",label:"ค่าของเสีย"},{id:"OTH",label:"อื่นๆ"}],Z={data(){return{bill:{name:"",code:"",date:new Date,amount:"",remark:""},expenses:X("create"),loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}}},watch:{data(t){t&&this.mode==="edit"&&(this.bill=t,this.bill.date=new Date(t.date))}},methods:{clear(){this.bill={},this.bill.date=new Date},confirmCancel(t){this.value=!1,this.$emit(t)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="";try{this.bill.name=this.expenses.filter(t=>t.id===this.bill.code)[0].label,this.mode==="create"?await f.create(this.bill)&&(this.loading=!1,this.confirm()):await f.update(this.bill._id,this.bill)&&(this.loading=!1,this.confirm()),g.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})}catch(t){console.error("Error : ",t),this.loading=!1,this.alert=t.response.data.message,g.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}}},components:{BaseButton:k,BaseButtons:E,CardBox:x,BaseDivider:N,OverlayLayer:F,FormField:P,FormControl:L,NotificationBar:O,BaseLevel:R,FormCheckRadioPicker:Q,BaseIcon:A},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},$={class:"grid grid-cols-2 lg:grid-cols-3 gap-5"};function ee(t,e,s,u,a,o){const c=i("FormControl"),d=i("FormField"),C=i("NotificationBar"),D=i("BaseDivider"),b=i("BaseButton"),B=i("BaseButtons"),h=i("CardBox"),w=i("OverlayLayer");return S((p(),_(w,null,{default:n(()=>[S(l(h,{title:"ค่าใช้จ่ายเพิ่มเติม "+(this.mode==="create"?"":"(แก้ไข)"),class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"",onSubmit:H(o.submit,["prevent"]),onHeaderIconClick:o.cancel},{default:n(()=>{var v;return[Y("div",$,[l(d,{label:"ค่าใช้จ่าย",help:"* ห้ามว่าง"},{default:n(()=>[l(c,{modelValue:a.bill.code,"onUpdate:modelValue":e[0]||(e[0]=r=>a.bill.code=r),icon:"accountEdit",options:a.expenses,required:""},null,8,["modelValue","options"])]),_:1}),((v=a.bill)==null?void 0:v.code)==="OTH"?(p(),_(d,{key:0,label:"รายละเอียดเพิ่มเติม",help:"* ห้ามว่าง"},{default:n(()=>[l(c,{modelValue:a.bill.remark,"onUpdate:modelValue":e[1]||(e[1]=r=>a.bill.remark=r),icon:"accountEdit",required:""},null,8,["modelValue"])]),_:1})):M("",!0),l(d,{label:"วันที่",help:"* ห้ามว่าง"},{default:n(()=>[l(c,{modelValue:a.bill.date,"onUpdate:modelValue":e[2]||(e[2]=r=>a.bill.date=r),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),l(d,{label:"จำนวน",help:"* ห้ามว่าง"},{default:n(()=>[l(c,{modelValue:a.bill.amount,"onUpdate:modelValue":e[3]||(e[3]=r=>a.bill.amount=r),type:"number",icon:"cashMultiple",required:""},null,8,["modelValue"])]),_:1})]),a.alert?(p(),_(C,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:n(()=>[I(q(a.alert),1)]),_:1})):M("",!0),l(D),l(B,{type:"justify-center"},{default:n(()=>[l(b,{label:"บันทึก",color:"success",type:"submit",loading:a.loading},null,8,["loading"]),l(b,{label:"ยกเลิก",color:"danger",onClick:o.cancel},null,8,["onClick"])]),_:1})]}),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[T,o.value]])]),_:1},512)),[[T,o.value]])}const te=V(Z,[["render",ee]]),ae={data(){return{openModal:!1,modalData:null,items:[],forms:[{label:"สถานะ",value:"status"}],search:{status:""},loading:!1,mode:"create",dataEdit:null,checked:{code:{value:"code"},label:{value:"name"}},datas:[{label:"รายการ",value:"name"},{label:"วันที่",class:"text-center",value:"date",type:"date"},{label:"ค่าใช้จ่าย",value:"amount",class:"text-right"},{label:"รายละเอียดเพิ่มเติม",value:"remark"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},components:{SectionMain:U,LayoutAuthenticated:W,SectionTitleBarSub:j,Table:z,Modal:te,Criteria:G},computed:{getDataCopy(){return{...this.modalData}}},created(){this.getDatas()},methods:{async getDatas(t){this.loading=!0;const e=await f.all(t);this.items=[],e.data&&(this.items=e.data.bills),this.loading=!1},async remove(t){this.loading=!0,(await f.delete(t)).data&&this.getDatas(),this.loading=!1,g.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},async removeSelected(t){this.loading=!0;let e=[];for(let u of t)e.push(u._id);(await f.deletes(e)).data&&(this.getDatas(),g.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})),this.loading=!1},edit(t){this.modalData=t,this.mode="edit",this.openModal=!0},reset(){this.search.status="",this.getDatas()},resetData(){this.modalData=null}}};function le(t,e,s,u,a,o){const c=i("SectionTitleBarSub"),d=i("Modal"),C=i("Criteria"),D=i("Table"),b=i("SectionMain"),B=i("LayoutAuthenticated");return p(),_(B,null,{default:n(()=>[l(b,null,{default:n(()=>[l(c,{icon:"cashMultiple",title:"ค่าใช้จ่ายเพิ่มเติม","has-btn-add":"",onOpenModal:e[0]||(e[0]=h=>{a.mode="create",a.openModal=!0}),btnText:"เพิ่มค่าใช้จ่ายเพิ่มเติม"}),l(d,{modelValue:a.openModal,"onUpdate:modelValue":e[1]||(e[1]=h=>a.openModal=h),data:o.getDataCopy,mode:a.mode,onConfirm:o.getDatas,onCancel:o.resetData},null,8,["modelValue","data","mode","onConfirm","onCancel"]),l(C,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:o.getDatas,onReset:o.reset,forms:a.forms,search:a.search,btnLoading:a.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),l(D,{title:"รายการค่าใช้จ่ายเพิ่มเติม","has-checkbox":"","checked-data":a.checked,items:a.items,datas:a.datas,buttons:a.buttons,onEdit:o.edit,onDelete:o.remove,onDeleteSelected:o.removeSelected,loading:a.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const fe=V(ae,[["render",le]]);export{fe as default};

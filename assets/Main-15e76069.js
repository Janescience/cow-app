import{b as w,_ as q,a as Y,d as N,c as T}from"./BaseDivider-d71bfeec.js";import{_ as F}from"./LayoutAuthenticated-b15d27dc.js";import{_ as U}from"./SectionTitleBarSub-854c78cc.js";import{T as L}from"./Table-748b264b.js";import{C as O}from"./Criteria-5bd6ec3f.js";import{v as B,y as P,x as f,h as j,_ as E,z as o,G as V,H as x,o as u,c as d,w as l,d as n,j as H,f as h,t as v,g as D,e as A}from"./index-400adc90.js";import{a as I}from"./CardBoxModal-05bcb9f4.js";import{_ as R}from"./FormField-39e0ae9c.js";import{_ as z}from"./FormControl-773f832f.js";import{_ as G}from"./NotificationBar-315522c1.js";import{T as C}from"./alert-4b9315cd.js";import{V as _}from"./Vaccine-99aff13a.js";import{P as J}from"./protection-9c0c74e5.js";import{_ as K}from"./FormCheckRadioPicker-382eab69.js";import"./UserAvatar-70af2860.js";import"./CardBoxCollapse-65410340.js";import"./Cow-7eca16c2.js";import"./cow-949167b7.js";import"./Recipe-ea48d54e.js";import"./Corral-0c64611c.js";const Q={data(){return{vaccine:{currentDate:null,nextDate:null,code:"",name:"",price:null,quantity:null,amount:null,frequency:null,remark:"",protections:[]},loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},user(){return this.$store.state.auth.user}},watch:{async data(t){if(t){if(this.vaccine=t,this.vaccine.currentDate)this.vaccine.currentDate=f(this.vaccine.currentDate).format("DD/MM/YYYY"),this.vaccine.nextDate=f(this.vaccine.nextDate).format("DD/MM/YYYY");else if(await this.getProtections(),this.vaccine.protections.length>0){const a=P.orderBy(this.vaccine.protections,"date","desc");a.length>0&&(this.vaccine.currentDate=f(a[0].date).format("DD/MM/YYYY"),this.vaccine.nextDate=f(a[0].date).add(this.vaccine.frequency,"months").format("DD/MM/YYYY"))}}},"vaccine.price"(t){t?this.vaccine.amount=t/this.vaccine.use:this.vaccine.amount=null},"vaccine.use"(t){t?this.vaccine.amount=this.vaccine.price/t:this.vaccine.amount=null}},methods:{clear(){this.vaccine={},this.vaccine.protections=[]},confirmCancel(t){this.value=!1,this.$emit(t),this.$emit("update:data",null)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async getProtections(){const t=await J.all({vaccine:this.vaccine._id});t&&(this.vaccine.protections=t.data.protections)},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await _.create(this.vaccine)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")):await _.update(this.vaccine._id,this.vaccine)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")),C.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})}catch(t){console.error("Error : ",t),this.clear(),this.loading=!1,this.alert=await t.response.data.message,C.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}}},components:{BaseButton:w,BaseButtons:j,CardBox:q,BaseDivider:Y,OverlayLayer:I,FormField:R,FormControl:z,NotificationBar:G,BaseLevel:E,FormCheckRadioPicker:K,BaseIcon:N},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},W={class:"grid grid-cols-2 lg:grid-cols-3 gap-8"};function X(t,a,M,k,e,i){const s=o("FormControl"),r=o("FormField"),b=o("NotificationBar"),y=o("BaseDivider"),m=o("BaseButton"),g=o("BaseButtons"),p=o("CardBox"),S=o("OverlayLayer");return V((u(),d(S,null,{default:l(()=>[V(n(p,{title:(this.mode==="create"?"บันทึก":"แก้ไข")+"วัคซีน",class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"",onSubmit:A(i.submit,["prevent"]),onHeaderIconClick:i.cancel},{default:l(()=>[H("div",W,[n(r,{label:"รหัสวัคซีน",help:"* ห้ามว่าง"},{default:l(()=>[n(s,{modelValue:e.vaccine.code,"onUpdate:modelValue":a[0]||(a[0]=c=>e.vaccine.code=c),icon:"needle",required:""},null,8,["modelValue"])]),_:1}),n(r,{label:"ชื่อวัคซีน",help:"* ห้ามว่าง"},{default:l(()=>[n(s,{modelValue:e.vaccine.name,"onUpdate:modelValue":a[1]||(a[1]=c=>e.vaccine.name=c),icon:"needle",required:""},null,8,["modelValue"])]),_:1}),n(r,{label:"ความถี่ (เดือน)",help:"* ห้ามว่าง"},{default:l(()=>[n(s,{modelValue:e.vaccine.frequency,"onUpdate:modelValue":a[2]||(a[2]=c=>e.vaccine.frequency=c),icon:"calendarClock",type:"number",required:""},null,8,["modelValue"])]),_:1}),n(r,{label:"ราคาวัคซีน",help:"* ห้ามว่าง"},{default:l(()=>[n(s,{modelValue:e.vaccine.price,"onUpdate:modelValue":a[3]||(a[3]=c=>e.vaccine.price=c),icon:"cashMultiple",type:"number",required:""},null,8,["modelValue"])]),_:1}),n(r,{label:"ปริมาณ (ลิตร)",help:"* ห้ามว่าง"},{default:l(()=>[n(s,{modelValue:e.vaccine.quantity,"onUpdate:modelValue":a[4]||(a[4]=c=>e.vaccine.quantity=c),icon:"quantity",type:"number",required:""},null,8,["modelValue"])]),_:1}),n(r,{label:"จำนวนโค",help:"* ห้ามว่าง "},{default:l(()=>[n(s,{modelValue:e.vaccine.use,"onUpdate:modelValue":a[5]||(a[5]=c=>e.vaccine.use=c),icon:"cashMultiple",type:"number",required:""},null,8,["modelValue"])]),_:1}),n(r,{label:"คิดเป็นเงิน/ตัว"},{default:l(()=>[h(v(e.vaccine.amount?e.vaccine.amount:"-"),1)]),_:1}),this.mode==="edit"?(u(),d(r,{key:0,label:"ฉีดวัคซีนล่าสุด"},{default:l(()=>[h(v(e.vaccine.currentDate?e.vaccine.currentDate:"-"),1)]),_:1})):D("",!0),this.mode==="edit"?(u(),d(r,{key:1,label:"ฉีดวัคซีนครั้งต่อไป"},{default:l(()=>[h(v(e.vaccine.nextDate?e.vaccine.nextDate:"-"),1)]),_:1})):D("",!0),n(r,{label:"หมายเหตุ",class:"col-span-2"},{default:l(()=>[n(s,{modelValue:e.vaccine.remark,"onUpdate:modelValue":a[6]||(a[6]=c=>e.vaccine.remark=c),type:"textarea"},null,8,["modelValue"])]),_:1})]),e.alert?(u(),d(b,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:l(()=>[h(v(e.alert),1)]),_:1})):D("",!0),n(y),n(g,{type:"justify-center"},{default:l(()=>[n(m,{label:"บันทึก",color:"success",type:"submit",loading:e.loading},null,8,["loading"]),n(m,{label:"ยกเลิก",color:"danger",onClick:i.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[x,i.value]])]),_:1},512)),[[x,i.value]])}const Z=B(Q,[["render",X]]),$={data(){return{openModal:!1,modalData:null,items:[],forms:[{label:"วัคซีน",value:"vaccine",icon:"needle"},{label:"ฉีดวัคซีนล่าสุด",value:"dateCurrent",icon:"calendar",type:"date"},{label:"ฉีดวัคซีนครั้งต่อไป",value:"dateNext",icon:"calendar",type:"date"}],search:{dateCurrent:null,dateNext:null,vaccine:""},loading:!1,mode:"create",dataEdit:null,checked:{label:{value:"vaccine"}},datas:[{label:"รหัสวัคซีน",value:"code"},{label:"ชื่อวัคซีน",value:"name"},{label:"ความถี่ (เดือน)",class:"text-center",value:"frequency"},{label:"ราคาวัคซีน",class:"text-right",value:"price",type:"currency"},{label:"ปริมาณ (ลิตร)",class:"text-center",value:"quantity",type:"number"},{label:"ใช้ได้ (ตัว)",class:"text-center",value:"use"},{label:"คิดเป็นเงิน/ตัว",class:"text-right",value:"amount",type:"currency"},{label:"เริ่มฉีดวัคซีน",class:"text-center",value:"startDate",type:"date"},{label:"ฉีดวัคซีนล่าสุด",class:"text-center",value:"currentDate",type:"date"},{label:"ฉีดวัคซีนครั้งต่อไป",class:"text-center",value:"nextDate",type:"date"},{label:"หมายเหตุ",class:"text-center",value:"remark"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"},{label:"การแจ้งเตือน",type:"oth",color:"light",func:t=>{this.$router.push({name:"notification-parameter"})}},{label:"ประวัติ",type:"oth",color:"info",func:t=>{this.$router.push({name:"protectionHistory",params:{vaccine:t._id}})}}]}},components:{SectionMain:T,LayoutAuthenticated:F,SectionTitleBarSub:U,Table:L,Modal:Z,Criteria:O},computed:{user(){return this.$store.state.auth.user},getDataCopy(){return{...this.modalData}}},created(){this.getDatas()},methods:{async getDatas(t){this.loading=!0;const a=await _.all(t);this.items=[],a.data&&(this.items=a.data.vaccines),this.loading=!1},async remove(t){this.loading=!0,(await _.delete(t)).data&&this.getDatas(),this.loading=!1,C.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},edit(t){this.modalData=t,this.mode="edit",this.openModal=!0},resetData(){this.modalData=null},reset(){this.search.dateCurrent=null,this.search.dateNext=null,this.search.vaccine=""}}};function ee(t,a,M,k,e,i){const s=o("SectionTitleBarSub"),r=o("Modal"),b=o("Criteria"),y=o("Table"),m=o("SectionMain"),g=o("LayoutAuthenticated");return u(),d(g,null,{default:l(()=>[n(m,null,{default:l(()=>[n(s,{icon:"needle",title:"วัคซีน","has-btn-add":"",onOpenModal:a[0]||(a[0]=p=>{e.mode="create",e.openModal=!0}),btnText:"เพิ่มวัคซีน"}),n(r,{modelValue:e.openModal,"onUpdate:modelValue":a[1]||(a[1]=p=>e.openModal=p),data:i.getDataCopy,mode:e.mode,onConfirm:i.getDatas,onCancel:i.resetData},null,8,["modelValue","data","mode","onConfirm","onCancel"]),n(b,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:i.getDatas,onReset:i.reset,forms:e.forms,search:e.search},null,8,["onSearch","onReset","forms","search"]),n(y,{title:"รายการวัคซีน","has-checkbox":"","checked-data":e.checked,items:e.items,datas:e.datas,buttons:e.buttons,onEdit:i.edit,onDelete:i.remove,onDeleteSelected:t.removeSelected,loading:e.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const De=B($,[["render",ee]]);export{De as default};

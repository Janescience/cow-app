import{z as V,E as o,o as f,I as T,d as l,w as i,h as b,p as x,m as M,_ as N,l as O,F as j,i as F,j as L,f as I,N as q,G as C,H as S,c as y,s as A,t as D,k as E,e as U,S as H,C as P,D as R}from"./index-19f2b6c9.js";import{T as z}from"./Table-d16bbf6a.js";import{C as G}from"./Criteria-71e32843.js";import{V as J}from"./vaccine-a2ff827d.js";import{_ as K}from"./FormField-a8e87a70.js";import{T as g}from"./alert-461bf33c.js";import{P as h}from"./protection-fd508f54.js";import{_ as Q}from"./FormCheckRadioPicker-f20a73e2.js";import"./Cow-bfcb247e.js";import"./cow-4a6ea16d.js";const W={data(){return{datas:[]}},created(){this.initialData()},computed:{value:{get(){var e,t,s;return this.valueType==="object"&&(e=this.modelValue)!=null&&e.vaccine_data&&(this.modelValue.vaccine_data=((t=this.modelValue)==null?void 0:t.code)+" : "+((s=this.modelValue)==null?void 0:s.name)),this.modelValue},set(e){this.$emit("update:modelValue",e)}},user(){return this.$store.state.auth.user}},methods:{async initialData(){try{const e=await J.all();if(this.datas=[],e&&(this.datas=e.data.vaccines,this.datas.map(t=>t.vaccine_data=t.code+" : "+t.name)),this.defaultValue){const t=this.datas.filter(s=>s[this.defaultType]==this.defaultValue);t&&this.handleInput(this.reduceAction(t[0]))}}catch(e){this.datas=[],console.error("Error: "+e.message)}},reduceAction(e){return this.valueType==="object"?e:e[this.valueType]},handleInput(e){this.$emit("update:value",e),this.dataSelected=this.datas.find(t=>t.name===e||t.code===e),this.$emit("update:dataSelected",this.dataSelected)}},props:{clear:{default:!0,type:Boolean},disabled:{default:!1,type:Boolean},dataSelected:{default:null,type:Object},defaultType:{default:null,type:Object},valueType:{default:"_id",type:Object},defaultValue:{default:null,type:Object},modelValue:{type:[String,Number,Boolean,Array,Object],default:""},multiple:{default:!1,type:Boolean}}},X={class:"relative"};function Y(e,t,s,B,a,n){const u=o("mdicon"),c=o("v-select");return f(),T("div",X,[l(c,{class:"ddl",clearable:s.clear,disabled:s.disabled,options:a.datas,reduce:n.reduceAction,label:"vaccine_data",placeholder:"เลือกวัคซีน",onInput:n.handleInput,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=r=>n.value=r),dataSelected:s.dataSelected,multiple:s.multiple},{"no-options":i(()=>[l(u,{name:"alertCircleOutline",width:"16",height:"16",class:"inline-block"}),b(" ไม่พบข้อมูล ")]),_:1},8,["clearable","disabled","options","reduce","onInput","modelValue","dataSelected","multiple"])])}const Z=V(W,[["render",Y]]),$={data(){return{protection:{date:new Date,vaccine:null,qty:null,amount:null,remark:""},loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},user(){return this.$store.state.auth.user}},watch:{data(e){e&&this.mode==="edit"&&(this.protection=e,this.protection.date=new Date(e.date))},"protection.qty"(e){e&&(this.protection.amount=e*this.protection.vaccine.amount)}},methods:{clear(){this.protection.date=new Date,this.protection.vaccine=null,this.protection.qty=null,this.protection.amount=null,this.protection.remark=""},confirmCancel(e){this.value=!1,this.$emit(e)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await h.create(this.protection)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")):await h.update(this.protection._id,this.protection)&&(this.loading=!1,this.value=!1,this.confirmCancel("confirm")),g.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})}catch(e){console.error("Error : ",e),this.clear(),this.loading=!1,this.alert=await e.response.data.message,g.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}}},components:{BaseButton:x,BaseButtons:M,CardBox:N,BaseDivider:O,OverlayLayer:j,FormField:K,FormControl:F,NotificationBar:L,BaseLevel:I,FormCheckRadioPicker:Q,BaseIcon:q,DDLVaccine:Z},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},ee={class:"grid grid-cols-2 lg:grid-cols-4 gap-5"};function te(e,t,s,B,a,n){const u=o("DDLVaccine"),c=o("FormField"),r=o("FormControl"),_=o("NotificationBar"),v=o("BaseDivider"),m=o("BaseButton"),p=o("BaseButtons"),k=o("CardBox"),w=o("OverlayLayer");return C((f(),y(w,null,{default:i(()=>[C(l(k,{title:(this.mode==="create"?"บันทึก":"แก้ไข")+"การป้องกัน/บำรุง",class:"shadow-lg w-full lg:w-3/5 z-50","header-icon":"close",modal:"",form:"",onSubmit:U(n.submit,["prevent"]),onHeaderIconClick:n.cancel},{default:i(()=>[A("div",ee,[l(c,{label:"วัคซีน",help:"* ห้ามว่าง",class:"col-span-2"},{default:i(()=>[l(u,{modelValue:a.protection.vaccine,"onUpdate:modelValue":t[0]||(t[0]=d=>a.protection.vaccine=d),valueType:"object"},null,8,["modelValue"])]),_:1}),l(c,{label:"จำนวนที่ฉีด (ตัว)",help:"* ห้ามว่าง"},{default:i(()=>[l(r,{modelValue:a.protection.qty,"onUpdate:modelValue":t[1]||(t[1]=d=>a.protection.qty=d),icon:"calendarClock",type:"number",required:""},null,8,["modelValue"])]),_:1}),l(c,{label:"รวมเป็นเงิน (บาท)"},{default:i(()=>[b(D(a.protection.amount),1)]),_:1}),l(c,{label:"วันที่ฉีดวัคซีน",help:"* ห้ามว่าง"},{default:i(()=>[l(r,{modelValue:a.protection.date,"onUpdate:modelValue":t[2]||(t[2]=d=>a.protection.date=d),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),l(c,{label:"หมายเหตุ",class:"col-span-2"},{default:i(()=>[l(r,{modelValue:a.protection.remark,"onUpdate:modelValue":t[3]||(t[3]=d=>a.protection.remark=d),type:"textarea"},null,8,["modelValue"])]),_:1})]),a.alert?(f(),y(_,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:i(()=>[b(D(a.alert),1)]),_:1})):E("",!0),l(v),l(p,{type:"justify-center"},{default:i(()=>[l(m,{label:"บันทึก",color:"success",type:"submit",loading:a.loading},null,8,["loading"]),l(m,{label:"ยกเลิก",color:"danger",onClick:n.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[S,n.value]])]),_:1},512)),[[S,n.value]])}const ae=V($,[["render",te]]),le={data(){return{openModal:!1,modalData:null,items:[],forms:[{label:"วัคซีน",value:"vaccine",icon:"needle"},{label:"ฉีดวัคซีนล่าสุด",value:"dateCurrent",icon:"calendar",type:"date"},{label:"ฉีดวัคซีนครั้งต่อไป",value:"dateNext",icon:"calendar",type:"date"}],search:{dateCurrent:null,dateNext:null,vaccine:""},loading:!1,mode:"create",dataEdit:null,checked:{label:{value:"vaccine"}},datas:[{label:"วัคซีน",value:"vaccine.name"},{label:"จำนวนที่ฉีด (ตัว)",class:"text-center",value:"qty"},{label:"รวมเป็นเงิน (บาท)",class:"text-center",value:"amount"},{label:"วันที่ฉีดวัคซีน",class:"text-center",value:"date",type:"date"},{label:"หมายเหตุ",class:"text-center",value:"remark"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},components:{SectionMain:H,LayoutAuthenticated:P,SectionTitleBarSub:R,Table:z,Modal:ae,Criteria:G},computed:{user(){return this.$store.state.auth.user}},created(){this.getDatas()},methods:{async getDatas(e){this.loading=!0;const t=await h.all(e);this.items=[],t.data&&(this.items=t.data.protections),this.loading=!1},async remove(e){this.loading=!0,(await h.delete(e)).data&&this.getDatas(),this.loading=!1,g.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},edit(e){this.modalData=e,this.mode="edit",this.openModal=!0},reset(){this.search.dateCurrent=null,this.search.dateNext=null,this.search.vaccine=""}}};function oe(e,t,s,B,a,n){const u=o("SectionTitleBarSub"),c=o("Modal"),r=o("Criteria"),_=o("Table"),v=o("SectionMain"),m=o("LayoutAuthenticated");return f(),y(m,null,{default:i(()=>[l(v,null,{default:i(()=>[l(u,{icon:"doctor",title:"การป้องกัน/บำรุง","has-btn-add":"",onOpenModal:t[0]||(t[0]=p=>{a.mode="create",a.openModal=!0}),btnText:"เพิ่มการป้องกัน/บำรุง"}),l(c,{modelValue:a.openModal,"onUpdate:modelValue":t[1]||(t[1]=p=>a.openModal=p),data:a.modalData,mode:a.mode,onConfirm:n.getDatas},null,8,["modelValue","data","mode","onConfirm"]),l(r,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:n.getDatas,onReset:n.reset,forms:a.forms,search:a.search},null,8,["onSearch","onReset","forms","search"]),l(_,{title:"รายการป้องกัน/บำรุง","has-checkbox":"","checked-data":a.checked,items:a.items,datas:a.datas,buttons:a.buttons,onEdit:n.edit,onDelete:n.remove,onDeleteSelected:e.removeSelected,loading:a.loading},null,8,["checked-data","items","datas","buttons","onEdit","onDelete","onDeleteSelected","loading"])]),_:1})]),_:1})}const he=V(le,[["render",oe]]);export{he as default};

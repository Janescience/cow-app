import{z as M,Q as L,p as I,m as R,_ as q,l as U,G as z,i as E,j as H,f as P,O as j,T as O,F as s,H as F,I as S,o as h,c as B,w as a,d as l,s as d,h as u,t as y,k as G,e as J,C as K,D as Q,E as Y,g as W,J as V,K as X,L as Z}from"./index-a2228708.js";import{D as $,C as ee}from"./Criteria-67e42ee8.js";import{_ as te}from"./FormField-903f5b21.js";import{T as x}from"./alert-dafa9dff.js";import{F as b}from"./food-ad58f895.js";import{C as T}from"./cow-23553641.js";import{m as oe,y as le}from"./date-66c7a2ce.js";import{_ as ae}from"./FormCheckRadioPicker-683b6072.js";import"./CardBoxCollapse-f30e1078.js";import"./Cow-c76fd2f8.js";import"./Vaccine-9d16f011.js";const se={data(){return{food:{corral:"",amount:0,amountAvg:0,numCow:0,year:new Date().getFullYear(),month:new Date().getMonth()+1},foodDetail:{recipe:{},qty:null},foodDetails:[],loading:!1,alert:"",ddlCorral:[],numCowCorral:null,corrals:[],months:oe(),years:le(),foodDetailColumns:[{label:"สูตรอาหาร",value:"recipe.name"},{label:"ราคา/กก.",value:"amount",type:"currency"},{label:"จำนวนที่ให้/วัน (กก.)",value:"qty",type:"number"},{label:"รวมเป็นเงิน",value:"sumAmount",type:"currency"}],buttons:[{label:"ลบ",type:"delete",color:"danger"}]}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},watch:{data(e){e&&(this.food=e)},"food.recipe"(e){if(e){const o=this.food.qty?this.food.qty:0;this.food.amount=o*e.amount}else this.food.amount=null},"food.qty"(e){var o,i,c,t;if(e){const r=(i=(o=this.food)==null?void 0:o.recipe)!=null&&i.amount?(t=(c=this.food)==null?void 0:c.recipe)==null?void 0:t.amount:0;this.food.amount=e*r}else this.food.amount=null},"food.corral"(e){e&&(this.numCowCorral=this.corrals[e].length>0?this.corrals[e].length:null)}},created(){this.getCorrals()},methods:{clear(){this.food={},this.numCowCorral=null},confirmCancel(e){this.value=!1,this.$emit(e)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},add(){const e=this.foodDetail.recipe,o=this.foodDetail.qty,i=e.amount,c=o*i;this.foodDetails.push({recipe:e,qty:o,amount:i,sumAmount:c}),this.foodDetail={}},remove(e){let o=this.cows.indexOf(e);o!==-1&&this.foodDetails.splice(o,1)},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await b.create(this.food)&&(this.loading=!1,this.confirm()):await b.update(this.food._id,this.food)&&(this.loading=!1,this.confirm()),x.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})}catch(e){console.error("Error : ",e),this.clear(),this.loading=!1,this.alert=await e.response.data.message,x.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}},async getCorrals(){const e=await T.all();if(e){const o=e.data.cows;this.corrals=L.groupBy(o,"corral");for(let i of Object.keys(this.corrals))this.ddlCorral.push({id:i,label:i})}}},components:{BaseButton:I,BaseButtons:R,CardBox:q,BaseDivider:U,OverlayLayer:z,FormField:te,FormControl:E,NotificationBar:H,BaseLevel:P,DDLRecipe:$,FormCheckRadioPicker:ae,BaseIcon:j,Table:O},props:{modelValue:{type:[String,Number,Boolean],default:null},data:{type:Object,default:null},mode:{type:String,default:""}}},ne={class:"grid lg:grid-cols-3 grid-cols-2 gap-5"},re={class:"grid lg:grid-cols-3 grid-cols-2 gap-5"},ie={class:"text-red-700 font-bold p-2"},ce=d("br",null,null,-1),de={class:"text-red-700 font-bold p-2"},ue=d("br",null,null,-1),me={class:"text-red-700 font-bold p-2"},fe={class:"text-red-700 font-bold p-2"};function pe(e,o,i,c,t,r){const _=s("FormControl"),m=s("FormField"),w=s("DDLRecipe"),f=s("BaseButton"),v=s("BaseButtons"),k=s("Table"),g=s("BaseLevel"),D=s("CardBox"),p=s("NotificationBar"),A=s("BaseDivider"),N=s("OverlayLayer");return F((h(),B(N,null,{default:a(()=>[F(l(D,{title:(this.mode==="create"?"บันทึก":"แก้ไข")+"การให้อาหาร",class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"",onSubmit:J(r.submit,["prevent"]),onHeaderIconClick:r.cancel},{default:a(()=>[d("div",ne,[l(m,{label:"ปี พ.ศ.",help:"* ห้ามว่าง"},{default:a(()=>[l(_,{modelValue:t.food.year,"onUpdate:modelValue":o[0]||(o[0]=n=>t.food.year=n),options:t.years},null,8,["modelValue","options"])]),_:1}),l(m,{label:"เดือน",help:"* ห้ามว่าง"},{default:a(()=>[l(_,{modelValue:t.food.month,"onUpdate:modelValue":o[1]||(o[1]=n=>t.food.month=n),options:t.months},null,8,["modelValue","options"])]),_:1}),l(m,{label:"คอก",help:"* ห้ามว่าง"},{default:a(()=>[l(_,{modelValue:t.food.corral,"onUpdate:modelValue":o[2]||(o[2]=n=>t.food.corral=n),options:t.ddlCorral,required:""},null,8,["modelValue","options"])]),_:1})]),l(D,{title:"รายละเอียดสูตรอาหาร","header-icon":"",class:"dark:bg-slate-700"},{default:a(()=>[d("div",re,[l(m,{label:"สูตรอาหาร",help:"* ห้ามว่าง",class:"lg:col-span-1 col-span-2"},{default:a(()=>[l(w,{modelValue:t.foodDetail.recipe,"onUpdate:modelValue":o[3]||(o[3]=n=>t.foodDetail.recipe=n),valueType:"object"},null,8,["modelValue"])]),_:1}),l(m,{label:"จำนวนที่ให้/วัน (กก.)",help:"* ห้ามว่าง"},{default:a(()=>[l(_,{modelValue:t.foodDetail.qty,"onUpdate:modelValue":o[4]||(o[4]=n=>t.foodDetail.qty=n),icon:"shaker",type:"number",required:""},null,8,["modelValue"])]),_:1}),l(v,{type:"justify-start"},{default:a(()=>[l(f,{label:"ล้าง",color:"danger",onClick:o[5]||(o[5]=n=>e.reset())}),l(f,{label:"เพิ่ม",color:"info",onClick:o[6]||(o[6]=n=>r.add())})]),_:1})]),l(k,{title:"รายการสูตรอาหาร ("+t.foodDetails.length+" รายการ)",items:t.foodDetails,datas:t.foodDetailColumns,buttons:t.buttons,onDelete:r.remove},null,8,["title","items","datas","buttons","onDelete"]),l(m,{class:"lg:col-span-3 col-span-2"},{default:a(()=>[l(g,{type:"justify-end"},{default:a(()=>{var n,C;return[u(" ราคาสูตรอาหาร/กก. "),d("p",ie,y(((C=(n=t.food)==null?void 0:n.recipe)==null?void 0:C.amount)>0?t.food.recipe.amount.toFixed(2):"-"),1),u(" บาท "),ce]}),_:1}),l(g,{type:"justify-end"},{default:a(()=>[u(" จำนวนโค "),d("p",de,y(t.numCowCorral>0&&t.numCowCorral?t.numCowCorral:"-"),1),u(" ตัว "),ue]),_:1}),l(g,{type:"justify-end"},{default:a(()=>{var n,C;return[u(" รวมเป็นเงิน/วัน "),d("p",me,y(t.food.qty&&((C=(n=t.food)==null?void 0:n.recipe)==null?void 0:C.amount)>0?t.food.amount.toFixed(2):"-"),1),u(" บาท ")]}),_:1}),l(g,{type:"justify-end"},{default:a(()=>[u(" คิดเป็นเงิน/ตัว "),d("p",fe,y(t.food.qty&&t.food.amount&&t.numCowCorral?(t.food.amount/t.numCowCorral).toFixed(2):"-"),1),u(" บาท ")]),_:1})]),_:1})]),_:1}),t.alert?(h(),B(p,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:a(()=>[u(y(t.alert),1)]),_:1})):G("",!0),l(A),l(v,{type:"justify-center"},{default:a(()=>[l(f,{label:"บันทึก",color:"success",type:"submit",loading:t.loading},null,8,["loading"]),l(f,{label:"ยกเลิก",color:"danger",onClick:r.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[S,r.value]])]),_:1},512)),[[S,r.value]])}const he=M(se,[["render",pe]]),_e={data(){return{perPage:10,currentPage:0,openModal:!1,modalData:null,items:[],ddlCorral:[],forms:[{label:"สูตรอาหาร",value:"recipe",type:"ddl",module:"recipe"},{label:"คอก",value:"corral",icon:"barn",type:"number"}],search:{recipe:{},corral:""},loading:!1,mode:"create",dataEdit:null,checked:{code:{value:"corral"},label:{value:"recipe.name"}},datas:[{label:"คอก",class:"text-center",value:"corral"},{label:"จำนวนวัว",class:"text-center",value:"numCow"},{label:"สูตรอาหาร",class:"text-center",value:"recipe.name"},{label:"จำนวนที่ให้/วัน (กก.)",class:"text-center",value:"qty"},{label:"รวมเป็นเงิน/วัน",class:"text-center",value:"amount",func:e=>e.amount.toFixed(2)},{label:"คิดเป็นเงิน/ตัว",class:"text-center",value:"amountAvg",func:e=>e.amountAvg.toFixed(2)}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},components:{SectionMain:K,LayoutAuthenticated:Q,SectionTitleBarSub:Y,Table:O,Modal:he,Criteria:ee,BaseLevel:P,UserAvatar:W,CardBox:q,BaseIcon:j},computed:{getDataCopy(){return{...this.modalData}},corral(){return this.ddlCorral},itemsPaginated(){return this.items?this.items.slice(this.perPage*this.currentPage,this.perPage*(this.currentPage+1)):[]},numPages(){return Math.ceil((this.items?this.items.length:0)/this.perPage)},currentPageHuman(){return this.currentPage+1},pagesList(){const e=[];for(let o=0;o<this.numPages;o++)e.push(o);return e}},created(){this.getDatas(),this.getCorrals()},methods:{async getDatas(e){this.loading=!0;const o=await b.all(e);if(this.items=[],o.data){const i=o.data.foods,c=L.groupBy(i,"corral");for(let t of Object.keys(c))this.items.push({corral:t})}this.loading=!1},async remove(e){this.loading=!0,(await b.delete(e)).data&&this.getDatas(),this.loading=!1,x.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})},async removeSelected(e){this.loading=!0;let o=[];for(let c of e)o.push(c._id);(await b.deletes(o)).data&&(this.getReproductions(),x.fire({icon:"success",title:"ลบข้อมูลสำเร็จ"})),this.loading=!1},async getCorrals(){const e=await T.all();if(e){const o=e.data.cows,i=L.groupBy(o,"corral");for(let c of Object.keys(i))this.ddlCorral.push({id:c,label:c})}},edit(e){this.modalData=e,this.mode="edit",this.openModal=!0},reset(){this.search.recipe=null,this.search.corral="",this.getDatas()},resetData(){this.modalData=null}}},ge={key:0,class:"grid lg:gap-3 md:gap-2 gap-1 grid-cols-3 lg:grid-cols-5 md:grid-cols-4"},ye={class:"text-center mt-2"},Ce={class:"lg:text-2xl text-xl"},be={key:1,class:"text-center py-10 text-gray-500 dark:text-gray-400"},ve=d("p",null," กำลังโหลดข้อมูล...",-1);function De(e,o,i,c,t,r){const _=s("SectionTitleBarSub"),m=s("Modal"),w=s("Criteria"),f=s("BaseIcon"),v=s("BaseLevel"),k=s("CardBox"),g=s("SectionMain"),D=s("LayoutAuthenticated");return h(),B(D,null,{default:a(()=>[l(g,null,{default:a(()=>[l(_,{icon:"foodDrumstickOutline",title:"การให้อาหาร","has-btn-add":"",onOpenModal:o[0]||(o[0]=p=>{t.mode="create",t.openModal=!0,this.modalData=null}),btnText:"เพิ่มการให้อาหาร"}),l(m,{modelValue:t.openModal,"onUpdate:modelValue":o[1]||(o[1]=p=>t.openModal=p),data:r.getDataCopy,mode:t.mode,onConfirm:r.getDatas,onCancel:r.resetData},null,8,["modelValue","data","mode","onConfirm","onCancel"]),l(w,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:r.getDatas,onReset:r.reset,forms:t.forms,search:t.search,btnLoading:t.loading},null,8,["onSearch","onReset","forms","search","btnLoading"]),t.loading?(h(),V("div",be,[l(f,{path:"dotsCircle",size:"22",class:"animate-spin"}),ve])):(h(),V("div",ge,[(h(!0),V(X,null,Z(r.itemsPaginated,p=>(h(),B(k,{key:p.corral,hoverable:""},{default:a(()=>[l(v,{type:"justify-center mt-3"},{default:a(()=>[l(f,{path:"barn",size:"58",class:"dark:text-gray-600"})]),_:1}),d("div",ye,[d("h4",Ce," คอก "+y(p.corral),1)])]),_:2},1024))),128))]))]),_:1})]),_:1})}const je=M(_e,[["render",De]]);export{je as default};

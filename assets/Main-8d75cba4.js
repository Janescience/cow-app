import{y as f,z as m,B as _,S,C as T,D,c as v,w as l,E as s,o as x,d as i}from"./index-6cd41bb2.js";import{T as A}from"./Table-cee4d623.js";import{C as M}from"./Criteria-69f7721e.js";import{T as c}from"./alert-1a863840.js";import"./FormField-220195fa.js";import"./FormCheckRadioPicker-0b4126b1.js";import"./Cow-5cb91144.js";import"./cow-637b06c9.js";async function w(t={}){let e="?";if(t.status&&(e=e+`status=${t.status}&`),t.createdAt){const n=m(new Date(t.createdAt)).format("YYYY-MM-DD");e=e+`createdAt=${n}&`}return t.type&&(e=e+`type=${t.type}&`),t?e.replace(/&*$/,""):""}class B{async get(e){const n=await w(e);return f.get("/notification/logs"+n).then(o=>o)}}const C=new B,Y="/line";class ${notify(e){return f.post(Y+"/notify",e)}}const k=new $,u=t=>t=="ddl"?[{id:"",label:"ทั้งหมด"},{id:"S",label:"สำเร็จ"},{id:"F",label:"ไม่สำเร็จ"}]:{S:"สำเร็จ",F:"ไม่สำเร็จ"},d=t=>t=="ddl"?[{id:"",label:"ทั้งหมด"},{id:"B",label:"ระบบ(ตามเงื่อนไข)"},{id:"T",label:"ทดสอบจากผู้ใช้"},{id:"S",label:"ระบบ(อัตโนมัติ)"}]:{B:"ระบบ(ตามเงื่อนไข)",T:"ทดสอบจากผู้ใช้",S:"ระบบ(อัตโนมัติ)"},L={data(){return{items:[],forms:[{label:"วันที่",value:"createdAt",icon:"calendar",type:"date"},{label:"ประเภท",value:"type",options:d("ddl")},{label:"สถานะ",value:"status",options:u("ddl")}],search:{createdAt:null,type:"",status:""},loading:!1,datas:[{label:"วันที่",class:"text-center",func:t=>m(t.createdAt).format("DD/MM/YYYY HH:mm:ss")},{label:"ประเภท",class:"text-center",func:t=>d()[t.type]},{label:"ข้อความ",class:"text-center",value:"message"},{label:"สถานะ",class:"text-center",func:t=>u()[t.status]}]}},components:{SectionMain:S,LayoutAuthenticated:T,SectionTitleBarSub:D,Table:A,Criteria:M},computed:{user(){return this.$store.state.auth.user}},created(){this.getDatas()},methods:{async getDatas(){this.loading=!0;const t=await C.get(this.search);this.items=[],t.data&&(this.items=t.data.notifications),this.loading=!1},async notify(t){this.loading=!0;try{(await k.notify({message:t,lineToken:this.user.farm.lineToken})).data&&(this.loading=!1,c.fire({icon:"success",title:"แจ้งเตือนสำเร็จ"}),this.getDatas())}catch{this.loading=!1,c.fire({icon:"error",title:"แจ้งเตือนไม่สำเร็จ"})}},reset(){this.search.recipe=null,this.search.corral="",this.getDatas()}}};function N(t,e,n,o,a,r){const h=s("SectionTitleBarSub"),p=s("Criteria"),g=s("Table"),y=s("SectionMain"),b=s("LayoutAuthenticated");return x(),v(b,null,{default:l(()=>[i(y,null,{default:l(()=>[i(h,{icon:"bellCogOutline",title:"ประวัติการแจ้งเตือน","has-btn-add":"","btn-text":"ทดสอบแจ้งเตือน",onOpenModal:e[0]||(e[0]=q=>r.notify("ทดสอบการแจ้งเตือน"))}),i(p,{grid:"grid-cols-2 lg:grid-cols-4",onSearch:r.getDatas,onReset:r.reset,forms:a.forms,search:a.search},null,8,["onSearch","onReset","forms","search"]),i(g,{title:"รายการแจ้งเตือน",items:a.items,datas:a.datas,loading:a.loading},null,8,["items","datas","loading"])]),_:1})]),_:1})}const j=_(L,[["render",N]]);export{j as default};

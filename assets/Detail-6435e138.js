import{z as A,S as O,C as I,p as L,N as T,m as Q,_ as N,i as E,g as P,f as j,P as V,B as _,c as x,w as d,E as b,o as D,d as a,s as t,h as q,t as n,k as B,I as F,K,J as z}from"./index-74d9eab0.js";import{_ as H}from"./FormField-07dc6251.js";import{I as J}from"./ImageUpload-d86fcbae.js";import{T as W}from"./Table-7f21b5b8.js";import{C as S}from"./cow-01e8ae3f.js";import{M as G}from"./milking-64a81fbc.js";import{r as R,a as X,R as Z}from"./reproduct-ce7555d6.js";import{s as $,o as ee,B as te}from"./birth-32ccbed3.js";import{H as le}from"./heal-1d6978bf.js";import{P as se}from"./protection-2b012c65.js";import{F as ae}from"./food-575c4089.js";import{N as oe}from"./notification-8ea89aaf.js";import{g as ie}from"./age-calculate-bb92e417.js";import{T as U}from"./alert-835c877b.js";import{s as ne,q as re}from"./cow-ae6b6e19.js";const ce={data(){return{cow:{},milks:[],milkDetails:[],historyMilks:[],reproducts:[],births:[],heals:[],protections:[],foods:[],notifications:[],loading:{cow:!1,milk:!1,reproduct:!1,birth:!1,heal:!1,protection:!1,food:!1,notification:!1},alert:"",newCow:!1,status:ne("create"),quality:re("create"),milkDatas:[{label:"วันที่รีดนม",class:"text-center",type:"date",value:"date"},{label:"ปริมาณน้ำนมดิบ/เช้า (กก.)",class:"text-center",value:"mQty"},{label:"ปริมาณน้ำนมดิบ/บ่าย (กก.)",class:"text-center",value:"aQty"},{label:"ปริมาณน้ำนมดิบรวม (กก.)",class:"text-center",func:l=>l.mQty+l.aQty},{label:"จำนวนเงินรวม",class:"text-right",type:"number",value:"amount"}],reproductDatas:[{label:"ครั้งที่",class:"text-center",value:"seq"},{label:"วันที่เข้าระบบสืบพันธุ์",class:"text-center",value:"loginDate",type:"date"},{label:"ผล",func:l=>R()[l.result].label},{label:"วันที่เป็นสัด",class:"text-center",value:"estrusDate",type:"date"},{label:"วันที่ผสมพันธุ์",class:"text-center",value:"matingDate",type:"date"},{label:"วันที่ตรวจท้อง",class:"text-center",value:"checkDate",type:"date"},{label:"พ่อพันธุ์",value:"dad"},{label:"สถานะ",func:l=>X()[l.status].label},{label:"วิธีรักษา",value:"howTo"}],birthDatas:[{label:"ครั้งที่",value:"seq",class:"text-center"},{label:"วันที่ตั้งครรภ์",class:"text-center",value:"pregnantDate",type:"date"},{label:"อายุครรภ์",func:l=>this.calAge(l==null?void 0:l.pregnantDate)},{label:"วันที่คลอด",class:"text-center",value:"birthDate",type:"date"},{label:"เพศ",class:"text-center",func:l=>$()[l.sex]},{label:"ลูกวัว",class:"text-center",func:l=>{var s,m;return l.calf?((s=l.calf)==null?void 0:s.code)+" : "+((m=l.calf)==null?void 0:m.name):""}},{label:"รกค้าง",class:"text-center",func:l=>ee()[l.overgrown]},{label:"วันที่ใช้ยาขับ",class:"text-center",value:"drugDate",type:"date"},{label:"วันที่ล้างมดลูก",class:"text-center",value:"washDate",type:"date"}],protectionDatas:[{label:"วัคซีน",value:"vaccine.name"},{label:"ครั้งที่",class:"text-center",value:"seq"},{label:"ให้ยาล่าสุด",class:"text-center",value:"vaccine.currentDate",type:"date"},{label:"ให้ยาครั้งต่อไป",class:"text-center",value:"vaccine.nextDate",type:"date"}],notificationDatas:[{label:"รายการ",value:"name"},{label:"ก่อน",class:"text-center",value:"before"},{label:"มีผล",class:"text-center",value:"date"},{label:"หลัง",class:"text-center",value:"after"},{label:"แจ้งเตือน",class:"text-center",value:"alert",type:"icon"}],healDatas:[{label:"ครั้งที่",value:"seq",class:"text-center"},{label:"วันที่รักษา",class:"text-center",value:"date",type:"date"},{label:"อาการ/โรค",class:"text-center",value:"disease"},{label:"วิธีการรักษา",class:"text-center",value:"method"},{label:"คนรักษา",class:"text-center",value:"healer"},{label:"ค่ารักษา",class:"text-center",value:"amount"}]}},components:{SectionMain:O,LayoutAuthenticated:I,BaseButton:L,BaseIcon:T,BaseButtons:Q,CardBox:N,FormControl:E,FormField:H,UserAvatar:P,BaseLevel:j,ImageUpload:J,Table:W},computed:{canRemove(){return this.milks.length==0&&this.reproducts.length==0&&this.births.length==0},user(){return this.$store.state.auth.user},milk(){let l=0,s=0,m=0;this.historyMilks=[],Object.keys(this.milks).forEach(e=>{let i=this.milks[e],h={},p=0,f=0,u=0;i.map(r=>{r.milkDetails.map(c=>{r.time==="M"?(s+=c.qty,p+=c.qty):(m+=c.qty,f+=c.qty),u+=c.amount}),r.milkDetails.length>0&&(l+=r.milkDetails.length,h.date=r.date,h.mQty=p,h.aQty=f,h.amount=u)}),Object.keys(h).length!==0&&this.historyMilks.push(h)});let w=(s+m)/l;return{avg:(l>0?w:0).toFixed(2),all:(s+m).toFixed(2)}}},created(){const l=this.$route.params.id;this.getCowData(l)},methods:{async getCow(l){this.loading.cow=!0;const s=await S.get(l);s.data&&(this.cow=s.data.cow,this.cow.birthDate=new Date(this.cow.birthDate),this.loading.cow=!1)},async getCowData(l){this.loading.cow=!0;const s=await S.get(l);if(s.data){this.cow=s.data.cow,this.cow.birthDate=new Date(this.cow.birthDate),this.loading.cow=!1,this.loading.reproduct=!0;const m=await Z.all({cow:l});m.data&&(this.reproducts=m.data.reproducts),this.loading.reproduct=!1,this.loading.birth=!0;const w=await te.all({cow:l,status:"B"});w&&(this.births=w.data.births),this.loading.birth=!1,this.loading.heal=!0;const e=await le.all({cow:l});e&&(this.heals=e.data.heals),this.loading.heal=!1,this.loading.protection=!0;const i=await se.all({cows:l});if(i){const u=V.groupBy(i.data.protections,"vaccine._id");for(let r of Object.keys(u)){const c=u[r],g=V.orderBy(c,"seq","desc");g.length>0&&this.protections.push(g[0])}}this.loading.protection=!1,this.loading.food=!0;const h=await ae.all({corral:this.cow.corral});h&&(this.foods=h.data.foods),this.loading.food=!1,this.loading.milk=!0;const p=await G.get({cow:l});if(p.data){for(let u of p.data.milks)u.groupKey=_(u.date,"YYYY-MM-DD").format("YYYYMMDD");this.milks=V.groupBy(p.data.milks,"groupKey")}this.loading.milk=!1;const f=await oe.getCalendar({cow:l});if(f.data){const u=V.groupBy(f.data.events,"code"),r=_(new Date).startOf("day");let c=[];for(let g of Object.keys(u)){const v=u[g];let y="",C=null,Y=null,o=null,M=null;for(let k of v)k.period=="today"?(y=k.name,C=_(k.time.start).format("DD/MM/YYYY"),M=_(k.time.start).startOf("day")):k.period=="before"?Y=_(k.time.start).format("DD/MM/YYYY"):k.period=="after"&&(o=_(k.time.start).format("DD/MM/YYYY"));c.push({name:y,date:C,dueDate:M,before:Y,after:o,alert:r.isAfter(M)?"bellCheckOutline":"bellAlertOutline"})}this.notifications=V.orderBy(c,"dueDate","desc")}}},async update(){this.loading.cow=!0,this.alert="";try{await S.update(this.cow._id,this.cow)&&(this.getCow(this.$route.params.id),U.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"}))}catch(l){console.error("Error : ",l),this.loading=!1,this.alert=l.response.data.message,U.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}},reproduct(){let l=_(),s=this.reproducts.length>0?this.reproducts.length:"-",m=this.reproducts.length>0?this.formatDate(this.reproducts[0].loginDate):"-",w=this.reproducts.length>0?R()[this.reproducts[0].result].label:"-",e=0,i=0,h=0,p="-",f="-",u="-";for(let r of this.reproducts)r.estrusDate!=null&&_(r.estrusDate)<=l&&(e++,p=this.formatDate(r.estrusDate)),r.matingDate!=null&&_(r.matingDate)<=l&&(i++,f=this.formatDate(r.matingDate)),r.checkDate!=null&&_(r.checkDate)<=l&&(h++,u=this.formatDate(r.checkDate));return{login:{count:s,lastDate:m,result:w},estrus:{count:e>0?e:"-",lastDate:p},mating:{count:i>0?i:"-",lastDate:f},check:{count:h>0?h:"-",lastDate:u}}},birth(){return{count:this.births.length>0?this.births.length:"-",lastDate:this.births.length>0?this.formatDate(this.births[0].birthDate):"-",countMale:this.births.length>0?this.births.filter(l=>l.sex==="M").length:"-",countFemale:this.births.length>0?this.births.filter(l=>l.sex==="F").length:"-"}},heal(){let l=this.heals.length>0?this.heals.length:"-",s=this.heals.length>0?this.formatDate(this.heals[0].date):"-",m=this.heals.length>0?this.heals[0].disease:"-",w=this.heals.length>0&&this.heals[0].method?this.heals[0].method:"-";return{count:l,lastDate:s,lastDisease:m,lastMethod:w}},formatDate(l){return l?_(new Date(l)).format("DD/MM/YYYY"):""},calAge(l){return ie(l)}}},de={class:"px-4 sm:px-0 mb-4 flex items-center justify-between"},ue={class:"flex items-center justify-start"},he=t("h1",{class:"text-base lg:text-2xl"}," รายละเอียดโค ",-1),me={class:"grid lg:gap-3 gap-2 grid-cols-2 lg:grid-cols-7 md:grid-cols-6"},pe={class:"row-span-2"},ge={class:"grid gap-5 grid-cols-1 lg:grid-cols-2 md:grid-cols-2"},fe={class:"grid gap-5 grid-cols-4"},_e=t("p",{class:"col-span-2"}," น้ำนมดิบ เฉลี่ย/วัน ",-1),be={class:"underline decoration-orange-700 decoration-4"},De=t("p",null," กิโลกรัม ",-1),we=t("p",{class:"col-span-2"}," น้ำนมดิบ ทั้งหมด ",-1),ye={class:"underline decoration-orange-700 decoration-4"},ve=t("p",null," กิโลกรัม ",-1),ke={class:"grid gap-5 lg:grid-cols-3 grid-cols-2"},xe=t("p",{class:"lg:row-span-3 col-span-2 lg:col-span-1"}," การเข้าระบบสืบพันธุ์ ",-1),Be=t("p",{class:"ml-5"}," จำนวนครั้ง ",-1),Me={class:"ml-5"},Ve=t("p",{class:"ml-5"}," เข้าระบบครั้งล่าสุด ",-1),Ce={class:"ml-5"},Ye=t("p",{class:"ml-5"}," ผลครั้งล่าสุด ",-1),qe={class:"ml-5"},Fe=t("p",{class:"lg:row-span-2 col-span-2 lg:col-span-1 font-bold"}," การเป็นสัด ",-1),Se=t("p",{class:"ml-5"}," จำนวนครั้ง ",-1),Re={class:"ml-5"},Ue=t("p",{class:"ml-5"}," เป็นสัดครั้งล่าสุด ",-1),Ae={class:"ml-5"},Oe=t("p",{class:"lg:row-span-2 col-span-2 lg:col-span-1 font-bold"}," การผสม ",-1),Ie=t("p",{class:"ml-5"}," จำนวนครั้ง ",-1),Le={class:"ml-5"},Te=t("p",{class:"ml-5"}," ผสมครั้งล่าสุด ",-1),Qe={class:"ml-5"},Ne=t("p",{class:"lg:row-span-2 col-span-2 lg:col-span-1 font-bold"}," การตรวจท้อง ",-1),Ee=t("p",{class:"ml-5"}," จำนวนครั้ง ",-1),Pe={class:"ml-5"},je=t("p",{class:"ml-5"}," ตรวจท้องครั้งล่าสุด ",-1),Ke={class:"ml-5"},ze={class:"grid gap-5 grid-cols-1 lg:grid-cols-2"},He={class:"grid gap-5 grid-cols-2"},Je=t("p",null," จำนวนครั้ง ",-1),We=t("p",null," คลอดลูกล่าสุด ",-1),Ge=t("p",null," จำนวนเพศผู้ ",-1),Xe=t("p",null," จำนวนเพศเมีย ",-1),Ze={class:"grid gap-5 grid-cols-2"},$e=t("p",null," จำนวนครั้ง ",-1),et=t("p",null," รักษาล่าสุด ",-1),tt=t("p",null," อาการ/โรคล่าสุด ",-1),lt=t("p",null," วิธีการรักษาล่าสุด ",-1),st={key:0,class:"text-slate-600"},at={class:"underline decoration-sky-500 decoration-2",href:"/manage/recipe"};function ot(l,s,m,w,e,i){const h=b("BaseIcon"),p=b("BaseButton"),f=b("BaseButtons"),u=b("ImageUpload"),r=b("BaseLevel"),c=b("FormControl"),g=b("FormField"),v=b("CardBox"),y=b("Table"),C=b("SectionMain"),Y=b("LayoutAuthenticated");return D(),x(Y,null,{default:d(()=>[a(C,{class:"text-sm lg:text-base"},{default:d(()=>[t("section",de,[t("div",ue,[a(h,{path:"cow",size:"30",class:"mr-3"}),he]),a(f,{class:"text-sm lg:text-base",type:"justify-end"},{default:d(()=>[a(p,{class:"lg:p-2 p-1",label:"ย้อนกลับ",color:"light",onClick:s[0]||(s[0]=o=>this.$router.push("/manage/cow"))}),a(p,{class:"lg:p-2 p-1",label:"ออกรายงาน",color:"info",onClick:s[1]||(s[1]=o=>l.exportReport())})]),_:1})]),a(v,{class:"mb-5",loading:e.loading.cow,title:"ข้อมูลโค","header-icon":"",icon:"cardTextOutline"},{default:d(()=>[t("div",me,[t("div",pe,[a(u,{modelValue:e.cow.image,"onUpdate:modelValue":s[2]||(s[2]=o=>e.cow.image=o),class:"mt-8 mr-2"},null,8,["modelValue"]),a(r,{type:"justify-center text-xs font-thin text-slate-500"},{default:d(()=>[q(" อัพโหลดรูปภาพ (คลิกที่รูป) ")]),_:1})]),a(g,{label:"รหัสโค",help:"* ห้ามว่าง"},{default:d(()=>[a(c,{modelValue:e.cow.code,"onUpdate:modelValue":s[3]||(s[3]=o=>e.cow.code=o),icon:"barcode",required:""},null,8,["modelValue"])]),_:1}),a(g,{label:"ชื่อโค",help:"* ห้ามว่าง"},{default:d(()=>[a(c,{modelValue:e.cow.name,"onUpdate:modelValue":s[4]||(s[4]=o=>e.cow.name=o),icon:"cow",required:""},null,8,["modelValue"])]),_:1}),a(g,{label:"วันเกิด",help:"* ห้ามว่าง"},{default:d(()=>[a(c,{modelValue:e.cow.birthDate,"onUpdate:modelValue":s[5]||(s[5]=o=>e.cow.birthDate=o),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),a(g,{label:"สถานะ",help:"* ห้ามว่าง"},{default:d(()=>[a(c,{modelValue:e.cow.status,"onUpdate:modelValue":s[6]||(s[6]=o=>e.cow.status=o),options:e.status,icon:"",required:""},null,8,["modelValue","options"])]),_:1}),a(g,{label:"คุณภาพน้ำนม",help:"* ห้ามว่าง"},{default:d(()=>[a(c,{modelValue:e.cow.quality,"onUpdate:modelValue":s[7]||(s[7]=o=>e.cow.quality=o),options:e.quality,icon:""},null,8,["modelValue","options"])]),_:1}),a(g,{label:"คอก"},{default:d(()=>[a(c,{modelValue:e.cow.corral,"onUpdate:modelValue":s[8]||(s[8]=o=>e.cow.corral=o),icon:"barn"},null,8,["modelValue"])]),_:1}),a(g,{label:"พ่อพันธุ์"},{default:d(()=>[a(c,{modelValue:e.cow.dad,"onUpdate:modelValue":s[9]||(s[9]=o=>e.cow.dad=o),icon:"genderMale"},null,8,["modelValue"])]),_:1}),a(g,{label:"แม่พันธุ์"},{default:d(()=>[a(c,{modelValue:e.cow.mom,"onUpdate:modelValue":s[10]||(s[10]=o=>e.cow.mom=o),icon:"genderFemale"},null,8,["modelValue"])]),_:1}),a(f,{type:"md:justify-end lg:justify-end justify-center",class:"md:col-span-2 lg:col-span-4 col-span-2 md:mt-5"},{default:d(()=>[a(p,{disabled:!i.canRemove,label:"ลบ",color:"danger",onClick:s[11]||(s[11]=o=>l.remove())},null,8,["disabled"]),a(p,{label:"บันทึก",color:"success",onClick:s[12]||(s[12]=o=>i.update())})]),_:1})])]),_:1},8,["loading"]),t("div",ge,[a(v,{icon:"cupWater",loading:e.loading.milk,title:"ข้อมูลน้ำนม","header-icon":""},{default:d(()=>[t("div",fe,[_e,t("p",be,n(i.milk.avg),1),De,we,t("p",ye,n(i.milk.all),1),ve])]),_:1},8,["loading"]),a(v,{icon:"reproduction",class:"row-span-2",loading:e.loading.reproduct,title:"ข้อมูลการสืบพันธุ์/ผสมพันธุ์","header-icon":""},{default:d(()=>[t("div",ke,[xe,Be,t("p",Me,n(i.reproduct().login.count),1),Ve,t("p",Ce,n(i.reproduct().login.lastDate),1),Ye,t("p",qe,n(i.reproduct().login.result),1),Fe,Se,t("p",Re,n(i.reproduct().estrus.count),1),Ue,t("p",Ae,n(i.reproduct().estrus.lastDate),1),Oe,Ie,t("p",Le,n(i.reproduct().mating.count),1),Te,t("p",Qe,n(i.reproduct().mating.lastDate),1),Ne,Ee,t("p",Pe,n(i.reproduct().check.count),1),je,t("p",Ke,n(i.reproduct().check.lastDate),1)])]),_:1},8,["loading"]),t("div",ze,[a(v,{icon:"babyFace",loading:e.loading.birth,title:"การคลอดลูก","header-icon":""},{default:d(()=>[t("div",He,[Je,t("p",null,n(i.birth().count),1),We,t("p",null,n(i.birth().lastDate),1),Ge,t("p",null,n(i.birth().countMale),1),Xe,t("p",null,n(i.birth().countFemale),1)])]),_:1},8,["loading"]),a(v,{icon:"doctor",loading:e.loading.heal,title:"การรักษา","header-icon":""},{default:d(()=>[t("div",Ze,[$e,t("p",null,n(i.heal().count),1),et,t("p",null,n(i.heal().lastDate),1),tt,t("p",null,n(i.heal().lastDisease),1),lt,t("p",null,n(i.heal().lastMethod),1)])]),_:1},8,["loading"])]),e.protections.length>0?(D(),x(y,{key:0,title:"การป้องกัน/วัคซีน",items:e.protections,datas:e.protectionDatas,loading:e.loading.protection,perPage:"5",icon:"pillMultiple"},null,8,["items","datas","loading"])):B("",!0),e.notifications.length>0?(D(),x(y,{key:1,title:"การแจ้งเตือน",items:e.notifications,datas:e.notificationDatas,loading:e.loading.protection,perPage:"5",icon:"messageBadgeOutline"},null,8,["items","datas","loading"])):B("",!0)]),a(v,{icon:"foodDrumstickOutline",loading:e.loading.food,title:"การให้อาหาร - คอก "+e.cow.corral,"header-icon":"",class:"mb-5"},{default:d(()=>[e.foods.length<=0?(D(),F("div",st," ไม่มีรายการให้อาหาร... ")):(D(!0),F(z,{key:1},K(e.foods,(o,M)=>(D(),F("div",{class:"grid gap-5 grid-cols-1",key:o._id},[t("p",null,[q(n(M+1+".")+" ",1),t("a",at,n("สูตร"+o.recipe.name),1),q(" "+n(" จำนวน "+o.qty+" กก./วัน คิดเป็นเงินต้นทุน "+o.amount+" บาท/วัน และ "+o.amountAvg+" บาท/ตัว โดยมีวัวทั้งหมด "+o.numCow+" ตัว"),1)])]))),128))]),_:1},8,["loading","title"]),e.historyMilks.length>0?(D(),x(y,{key:0,title:"ประวัติการรีดนม",items:e.historyMilks,datas:e.milkDatas,loading:e.loading.milk,icon:"waterCheck"},null,8,["items","datas","loading"])):B("",!0),e.reproducts.length>0?(D(),x(y,{key:1,title:"ประวัติการสืบพันธ์ุ/ผสมพันธ์ุ",items:e.reproducts,datas:e.reproductDatas,loading:e.loading.reproduct},null,8,["items","datas","loading"])):B("",!0),e.births.length>0?(D(),x(y,{key:2,title:"ประวัติการคลอดลูก",items:e.births,datas:e.birthDatas,loading:e.loading.birth},null,8,["items","datas","loading"])):B("",!0),e.heals.length>0?(D(),x(y,{key:3,title:"ประวัติการรักษา",items:e.heals,datas:e.healDatas,loading:e.loading.heal},null,8,["items","datas","loading"])):B("",!0)]),_:1})]),_:1})}const yt=A(ce,[["render",ot]]);export{yt as default};

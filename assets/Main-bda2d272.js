import{z as G,B as K,p as ie,m as ne,_ as J,l as X,F as re,i as ce,j as de,f as Z,N as q,E as k,G as D,H as C,o as r,c as F,w as v,d as i,I as u,k as P,s as o,h as E,t as f,J as M,K as b,e as ue,a as w,L as me,M as he,n as Q,q as H,S as fe,C as ge,D as ke}from"./index-04349aa3.js";import{T as ve}from"./Table-91dae829.js";import{_ as _e}from"./FormField-d75ed071.js";import{_ as pe}from"./FormCheckRadioPicker-6dfb3ddc.js";import{D as ye}from"./Cow-9efce7d8.js";import{M as $}from"./milking-9d562efb.js";import{P as we}from"./param-c1e6841c.js";import{T as W}from"./alert-14053880.js";import{u as Me,_ as xe}from"./Top-d7c246e1.js";import"./cow-ed6ca93d.js";const be={data(){return{milk:{date:new Date,time:this.checkTime()},milkDetail:{cow:{},qty:null,amount:null},priceRawMilk:null,milkDetails:[],loading:!1,alert:{}}},emits:["update:modelValue","cancel","confirm"],computed:{calAmount(){return this.milkDetail.amount=this.milkDetail.qty*this.priceRawMilk,this.milkDetail.amount},user(){return this.$store.state.auth.user},value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},watch:{data:{handler(e,t){e&&(this.mode=="edit"&&(this.milkDetails=e.milkDetails),this.milk.date=e.date?new Date(e.date):new Date,this.milk._id=e._id,this.milk.time=e.time?e.time:this.checkTime(),this.getPriceRawMilk())}},"milkDetail.cow"(e){e!=null&&Object.keys(e).length>0&&this.milkDetails.length>0&&(this.alert={},this.milkDetails.filter(a=>a.cow.code===e.code).length>0&&(this.milkDetail.cow={},this.alert.text="โคซ้ำ กรุณาเลือกรายการอื่น",this.alert.color="warning"))}},created(){this.getPriceRawMilk()},methods:{clear(){this.milk={},this.milk.date=new Date,this.milk.time="M",this.milkDetails=[]},confirmCancel(e){this.value=!1,this.$emit(e)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},removeDetail(e){let t=this.milkDetails.indexOf(e);t!==-1&&this.milkDetails.splice(t,1)},reset(){this.milkDetail.cow={},this.milkDetail.qty=null,this.milkDetail.amount=null},checkTime(){return new Date().getHours()<=12?"M":"A"},add(){this.milkDetail.cow&&this.milkDetail.qty>0&&this.milkDetail.amount?this.milkDetails.filter(t=>{var a;return t.cow.code===((a=this.milkDetail)==null?void 0:a.cow.code)}).length<=0?(this.milkDetails.push(this.milkDetail),this.alert={},this.milkDetail={}):(this.alert.text="โคซ้ำ",this.alert.color="warning"):(this.alert.text="กรุณากรอกข้อมูลให้ครบ",this.alert.color="warning")},async submit(){this.loading=!0,this.alert={},this.milk.milkDetails=this.milkDetails;const e={...this.milk};try{this.mode==="create"?await $.create(e)&&(this.loading=!1,this.confirm(),W.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})):await $.update(this.milk._id,this.milk)&&(this.loading=!1,this.confirm(),W.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"}))}catch(t){console.error("Error : ",t),this.loading=!1,this.alert.text=t.response.data.message,this.alert.color="danger"}},async getPriceRawMilk(){const e=await we.all({code:"RAW_MILK"});if(e.data){const t=e.data.params;t.length>0&&(this.priceRawMilk=t[0].valueNumber)}},formatDate(e){return K(e).format("DD/MM/YYYY")}},components:{BaseButton:ie,BaseButtons:ne,CardBox:J,BaseDivider:X,OverlayLayer:re,FormField:_e,FormControl:ce,NotificationBar:de,BaseLevel:Z,DDLCow:ye,FormCheckRadioPicker:pe,BaseIcon:q},props:{modelValue:{type:[String,Number,Boolean],default:null},mode:{type:String,default:""},data:{type:Object,default:null}}},De={key:0,class:"grid lg:grid-cols-4 grid-cols-2 gap-5"},Ce={class:"grid grid-cols-2 lg:grid-cols-4 gap-5"},Be=o("header",{class:"flex items-stretch border-b border-gray-100 dark:border-gray-800"},[o("p",{class:"flex items-center py-3 grow font-bold"}," รายการรีดนม ")],-1),Ye={key:3,class:"overflow-x-auto"},Ve=o("thead",null,[o("tr",null,[o("th",{class:"whitespace-nowrap text-center"}," รหัสโค "),o("th",{class:"whitespace-nowrap text-center"}," ชื่อโค "),o("th",{class:"whitespace-nowrap text-center"}," น้ำนมดิบ (กก.) "),o("th",{class:"whitespace-nowrap text-center"}," จำนวนเงิน "),o("th")])],-1),Te={"data-label":"รหัสโค"},Se={"data-label":"ชื่อโค"},Fe={"data-label":"น้ำนมดิบ/กก.",class:"text-center"},Oe={"data-label":"จำนวนเงิน",class:"text-right"},Le={class:"lg:w-6 whitespace-nowrap"},Ae={key:4,class:"text-center py-10 text-gray-500 dark:text-gray-400"},Re=o("p",null,"ไม่มีรายการ...",-1),qe=[Re];function Ee(e,t,a,j,n,c){const g=k("FormControl"),p=k("FormField"),B=k("FormCheckRadioPicker"),V=k("BaseDivider"),T=k("DDLCow"),y=k("BaseButton"),x=k("BaseButtons"),N=k("NotificationBar"),I=k("CardBox"),O=k("OverlayLayer");return D((r(),F(O,null,{default:v(()=>[D(i(I,{title:a.mode==="create"?"การรีดนม":"การรีดนม ("+((n.milk.time=="M"?"เช้า":"บ่าย")+" - "+c.formatDate(n.milk.date))+")",class:"shadow-lg w-full lg:w-1/2 z-50","header-icon":"close",modal:"",form:"","has-scroll":"",onSubmit:ue(c.submit,["prevent"]),onHeaderIconClick:c.cancel},{default:v(()=>{var L;return[a.mode!="edit"?(r(),u("div",De,[i(p,{label:"วันที่รีดนม",help:"* ห้ามว่าง"},{default:v(()=>[i(g,{modelValue:n.milk.date,"onUpdate:modelValue":t[0]||(t[0]=m=>n.milk.date=m),icon:"calendar",type:"date",required:"",disabled:a.mode=="edit"},null,8,["modelValue","disabled"])]),_:1}),i(p,{label:"รอบ"},{default:v(()=>[i(B,{modelValue:n.milk.time,"onUpdate:modelValue":t[1]||(t[1]=m=>n.milk.time=m),type:"radio",name:"milk-time",options:{M:"เช้า",A:"บ่าย"},disabled:a.mode=="edit"},null,8,["modelValue","disabled"])]),_:1})])):P("",!0),a.mode!="edit"?(r(),F(V,{key:1})):P("",!0),o("div",Ce,[i(p,{label:"โค",help:"* ห้ามว่าง"},{default:v(()=>[i(T,{modelValue:n.milkDetail.cow,"onUpdate:modelValue":t[2]||(t[2]=m=>n.milkDetail.cow=m),valueType:"object"},null,8,["modelValue"])]),_:1}),i(p,{label:"น้ำนมดิบ (กก.)",help:"* ห้ามว่าง"},{default:v(()=>[i(g,{modelValue:n.milkDetail.qty,"onUpdate:modelValue":t[3]||(t[3]=m=>n.milkDetail.qty=m),type:"number",icon:"scale"},null,8,["modelValue"])]),_:1}),i(p,{label:"คิดเป็นเงิน",help:"ราคาน้ำนมดิบ/กก. "+n.priceRawMilk+" บาท"},{default:v(()=>[i(g,{modelValue:c.calAmount,"onUpdate:modelValue":t[4]||(t[4]=m=>c.calAmount=m),type:"number",icon:"cashMultiple"},null,8,["modelValue"])]),_:1},8,["help"]),i(x,{type:"justify-start"},{default:v(()=>[i(y,{label:"ล้าง",color:"danger",onClick:t[5]||(t[5]=m=>c.reset())}),i(y,{label:"เพิ่ม",color:"info",onClick:t[6]||(t[6]=m=>c.add())})]),_:1})]),(L=n.alert)!=null&&L.text?(r(),F(N,{key:2,color:n.alert.color,outline:"",icon:"alertCircleOutline"},{default:v(()=>[E(f(n.alert.text),1)]),_:1},8,["color"])):P("",!0),Be,n.milkDetails.length>0?(r(),u("div",Ye,[o("table",null,[Ve,o("tbody",null,[(r(!0),u(M,null,b(n.milkDetails,m=>(r(),u("tr",{key:m.cow._id},[o("td",Te,f(m.cow.code),1),o("td",Se,f(m.cow.name),1),o("td",Fe,f(m.qty.toFixed(2)),1),o("td",Oe,f(m.amount),1),o("td",Le,[i(x,{type:"justify-end lg:justify-start","no-wrap":""},{default:v(()=>[i(y,{color:"danger",icon:"trashCanOutline",small:"",onClick:A=>c.removeDetail(m)},null,8,["onClick"])]),_:2},1024)])]))),128))])])])):(r(),u("div",Ae,qe)),i(x,{type:"justify-center mt-3"},{default:v(()=>[i(y,{label:"ยกเลิก",color:"danger",onClick:c.cancel},null,8,["onClick"]),i(y,{label:"บันทึก",color:"success",type:"submit",disabled:n.milkDetails.length==0,loading:n.loading},null,8,["disabled","loading"])]),_:1})]}),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[C,c.value]])]),_:1},512)),[[C,c.value]])}const ee=G(be,[["render",Ee]]),Pe={ref:"calendarContainer",class:"min-h-full min-w-full text-gray-300"},Ne={class:"w-full grid grid-cols-7"},Ie=["onClick"],Qe=o("div",{class:"w-1/12"},[o("div",{class:"h-2 w-2 rounded-full bg-orange-600"})],-1),$e={class:"w-11/12"},je={class:"text-xs tracking-tight text-clip overflow-hidden"},Ue=["onClick"],ze={class:"h-6 w-6 flex justify-center items-center text-xs bg-orange-600 rounded-full shadow-sm"},He={class:"font-medium text-white"},We={class:"lg:mt-2"},Ge=["onClick"],Ke={class:"text-sm text-clip overflow-hidden items-center"},Je=["onClick"],Xe={class:"opacity-40"},Ze=o("p",{class:"hidden md:block"}," รีดนม",-1),et=["onClick"],tt={class:"font-medium text-black"},lt={key:0,class:"md:hidden"},at=["onClick"],ot={class:"text-sm text-clip overflow-hidden"},st={__name:"Calendar",props:{events:{type:Object,required:!0}},emits:["confirm","month","year"],setup(e,{emit:t}){const a=Me();a.$subscribe((h,d)=>{I(),O()}),t("month",a.getMonth+1),t("year",a.getYear);const j={1:"อา",2:"จ.",3:"อ.",4:"พ.",5:"พฤ",6:"ศ.",7:"ส."},n=w(0),c=w(0),g=w(0),p=w(0),B=w(!1),V=w(!1),T=w([]),y=w(""),x=w("create"),N=w({}),I=()=>{n.value=new Date(a.getYear,a.getMonth+1,0).getDate()},O=()=>{g.value=new Date(a.getYear,a.getMonth,1).getDay()},L=()=>{c.value=new Date(a.getYear,a.getMonth,0).getDate()},m=()=>{let h=g.value<=4?35:42;p.value=h-n.value-g.value},A=h=>{let d=new Date;return a.getYear==d.getFullYear()&&a.getMonth==d.getMonth()&&h==d.getDate()},z=(h,d,l,s,_)=>a.getYear==d.substring(4,8)&&a.getMonth+(l?0:1)==d.substring(2,4)&&h==d.substring(0,2)&&s==_,S=(h,d,l)=>{if(!d.length)return[];let s=[];return d.forEach(_=>{z(h,_.date,l)&&s.push(_)}),s},Y=(h,d,l,s)=>{if(!d.length)return[];let _=[];return d.forEach(U=>{z(h,U.date,l,U.time,s)&&(_=U.milks)}),_},R=(h,d,l,s)=>{x.value=l?"edit":"create";let _=a.getYear+"-"+(a.getMonth+1)+"-"+h;N.value={_id:s,date:_,time:l||null,milkDetails:d},B.value=!0},te=h=>{t("confirm",h)},le=()=>{a.decrementMonth(1),t("month",a.getMonth+1),t("year",a.getYear)},ae=()=>{a.incrementMonth(1),t("month",a.getMonth+1),t("year",a.getYear)},oe=h=>{t("month",h)},se=h=>{t("year",h)};return me(()=>{I(),O(),L(),m()}),he(()=>{O(),L(),m()}),(h,d)=>(r(),u(M,null,[o("div",Pe,[o("div",Ne,[i(xe,{onMonth:oe,onYear:se}),(r(),u(M,null,b(j,l=>o("div",{key:l,class:"text-center text-sm md:text-base lg:text- font-medium border-b mt-3 border-gray-600"},f(l),1)),64)),(r(!0),u(M,null,b(g.value,l=>D((r(),u("div",{key:l,class:"h-26 md:h-36 w-full opacity-50 border-t border-gray-600 align-top"},[o("div",{class:Q(["w-full h-full text-xs md:text-sm lg:text-base text-center transition-colors p-3",{"bg-slate-300 text-gray-900 font-medium  ":A(l),"hover:bg-gray-100 hover:text-gray-700":!A(l)}])},[E(f(c.value-(g.value-l))+" ",1),(r(!0),u(M,null,b(S(c.value-(g.value-l),e.events,!0),s=>D((r(),u("div",{key:s.title,class:"hidden md:block"},[o("div",{class:"w-full px-2 py-1 flex space-x-1 items-center whitespace-nowrap overflow-hidden hover:border hover:border-gray-200 cursor-pointer rounded-lg",onClick:_=>h.togglePopover(_,s)},[Qe,o("div",$e,[o("h5",je,f(s.title),1)])],8,Ie)])),[[C,S(c.value-(g.value-l),e.events,!0).length]])),128)),Y(c.value-(g.value-l),e.events,!0).length>0?(r(),u("div",{key:0,class:"flex md:hidden h-2/3 w-full justify-center items-center",onClick:s=>R(c.value-(g.value-l),Y(c.value-(g.value-l),e.events,!0))},[o("div",ze,[o("h3",He,f(Y(c.value-(g.value-l),e.events,!0).length),1)])],8,Ue)):P("",!0)],2)])),[[C,g.value>0]])),128)),(r(!0),u(M,null,b(n.value,l=>(r(),u("div",{key:l,class:"h-26 md:h-36 w-full border-t border-gray-600 align-top"},[o("div",{class:Q(["w-full h-full text-xs md:text-sm lg:text-base text-center transition-colors p-2",{"bg-gray-600 text-gray-900 font-medium  ":A(l),"hover:bg-gray-100 hover:text-gray-700":!A(l)}])},[E(f(l)+" ",1),o("div",We,[(r(!0),u(M,null,b(S(l,e.events),s=>D((r(),u("div",{key:s.date,class:"hidden md:block p-1"},[o("div",{class:"w-full flex p-1 shadow-lg border border-gray-800 shadow cursor-pointer rounded-md",onClick:_=>R(l,Y(l,e.events,!1,s.time),s.time,s.id)},[o("p",Ke,[i(q,{path:s.time==="M"?"clockTimeSevenOutline":"clockTimeThreeOutline",class:Q(s.time==="M"?"text-yellow-400":"text-orange-500")},null,8,["path","class"]),E(" "+f(s.time=="M"?"เช้า":"บ่าย")+" - "+f(s.sumQty)+" กก. ",1)])],8,Ge)])),[[C,S(l,e.events).length>0]])),128))]),D(o("div",null,[o("div",{class:"w-full lg:mt-2 text-center items-center overflow-hidden hover:border hover:border-gray-200 cursor-pointer rounded-lg",onClick:s=>R(l,Y(l,e.events))},[o("div",Xe,[i(q,{path:"plus"}),Ze])],8,Je)],512),[[C,S(l,e.events).length<2]]),(r(!0),u(M,null,b(S(l,e.events),s=>(r(),u("div",{key:s.date,class:"flex md:hidden mt-1 w-full justify-center items-center",onClick:_=>R(l,Y(l,e.events,!1,s.time),s.time,s.id)},[o("div",{class:Q(["h-6 w-6 flex justify-center items-center text-xs rounded shadow-sm",[s.time==="M"?"bg-yellow-400":"bg-orange-500"]])},[o("h3",tt,f(s.sumQty),1)],2)],8,et))),128))],2)]))),128)),(r(!0),u(M,null,b(p.value,l=>D((r(),u("div",{key:l,class:"h-16 md:h-36 w-full opacity-50"})),[[C,p.value>0]])),128))]),i(Z,{type:"justify-between w-full mt-2",class:"md:hidden"},{default:v(()=>[i(q,{path:"chevronLeft",size:"30",class:"cursor-pointer hover:text-gray-300",onClick:d[0]||(d[0]=l=>le())}),i(q,{path:"chevronRight",size:"30",class:"cursor-pointer hover:text-gray-300",onClick:d[1]||(d[1]=l=>ae())})]),_:1}),i(X),V.value?(r(),u("div",lt,[E(" รายการรีดนม "+f(y.value)+"/"+f(H(a).getMonth+1)+"/"+f(H(a).getYear+543)+" ",1),(r(!0),u(M,null,b(T.value,l=>D((r(),u("div",{key:l.date},[o("div",{class:"w-full text-left flex overflow-hidden p-2 mt-2 border border-gray-800 shadow cursor-pointer rounded-md",onClick:s=>R(y.value,Y(y.value,e.events,!1,l.time),l.time,l.id)},[o("p",ot," รอบ "+f(l.time=="M"?"เช้า":"บ่าย")+" น้ำนมดิบ "+f(l.sumQty)+" กก. รีดแล้ว "+f(l.count)+" ตัว ",1)],8,at)])),[[C,T.value.length>0]])),128))])):P("",!0)],512),i(ee,{modelValue:B.value,"onUpdate:modelValue":d[2]||(d[2]=l=>B.value=l),mode:x.value,data:N.value,onConfirm:te},null,8,["modelValue","mode","data"])],64))}},it={data(){return{modalMilk:!1,monthMilk:new Date().getMonth()+1,yearMilk:new Date().getFullYear(),items:[],events:[],forms:[{label:"โค",class:"lg:col-start-2",value:"cow",type:"ddl",module:"cow"},{label:"วันที่รีดนม",value:"date",icon:"calendar",type:"date"}],loading:!1,mode:"create",modalData:null,checked:{code:{value:"date",type:"date"},label:{value:"cow.name"}},datas:[{label:"วันที่รีดนม",class:"text-center",type:"date",value:"date"},{label:"โค",class:"text-center",value:"relate.cow.name"},{label:"ปริมาณน้ำนมดิบ/เช้า (กก.)",class:"text-center",value:"morningQty"},{label:"ปริมาณน้ำนมดิบ/บ่าย (กก.)",class:"text-center",value:"afternoonQty"},{label:"ปริมาณน้ำนมดิบรวม (กก.)",class:"text-center",func:e=>e.morningQty+e.afternoonQty},{label:"จำนวนเงินรวม",class:"text-right",type:"number",value:"amount"}],buttons:[{label:"ลบ",type:"delete",color:"danger"},{label:"แก้ไข",type:"edit",color:"warning"}]}},components:{SectionMain:fe,LayoutAuthenticated:ge,Table:ve,SectionTitleBarSub:ke,MilkModal:ee,Calendar:st,CardBox:J},computed:{user(){return this.$store.state.auth.user}},created(){this.getMilks()},watch:{monthMilk(e){this.getMilks()},yearMilk(e){this.getMilks()}},methods:{async getMilks(){this.loading=!0;const e=await $.all({month:this.monthMilk,year:this.yearMilk});if(this.events=[],e.data)for(let t of e.data.milks)this.filterMilk(t);this.loading=!1},async removeMilk(e){this.loading=!0,(await $.delete(e)).data&&this.getMilks(),this.loading=!1},filterMilk(e){let t={};t.sumQty=0,t.sumAmt=0,e.milkDetails.map(a=>{a.cow=typeof a.cow=="string"?a.relate.cow:a.cow,t.sumQty+=a.qty,t.sumAmt+=a.amount}),t.count=e.milkDetails.length,t.milks=e.milkDetails,t.date=K(e.date,"YYYY-MM-DD").format("DDMMYYYY"),t.time=e.time,t.id=e._id,this.events.push(t)},addMilk(e){this.filterMilk(e)},getMonthMilk(e){this.monthMilk=e},getYearMilk(e){this.yearMilk=e},edit(e){this.modalData=e,this.mode="edit",this.modalMilk=!0}}};function nt(e,t,a,j,n,c){const g=k("SectionTitleBarSub"),p=k("MilkModal"),B=k("Calendar"),V=k("CardBox"),T=k("SectionMain"),y=k("LayoutAuthenticated");return r(),F(y,null,{default:v(()=>[i(T,null,{default:v(()=>[i(g,{icon:"cupWater",title:"การรีดนม",btnText:"เพิ่มการรีดนม","has-btn-add":"",onOpenModal:t[0]||(t[0]=x=>{n.mode="create",n.modalMilk=!0})}),i(p,{modelValue:n.modalMilk,"onUpdate:modelValue":t[1]||(t[1]=x=>n.modalMilk=x),mode:n.mode,onConfirm:c.getMilks},null,8,["modelValue","mode","onConfirm"]),n.loading?(r(),F(V,{key:1,loading:""})):(r(),F(V,{key:0},{default:v(()=>[i(B,{events:n.events,onConfirm:c.getMilks,onMonth:c.getMonthMilk,onYear:c.getYearMilk},null,8,["events","onConfirm","onMonth","onYear"])]),_:1}))]),_:1})]),_:1})}const _t=G(it,[["render",nt]]);export{_t as default};

import{z as H,R as P,S as R,p as G,m as J,_ as K,l as W,G as ee,i as Y,j as te,g as Q,f as X,F as n,H as I,I as T,o as d,c as w,w as l,d as t,h as U,s as c,t as p,k as Z,e as ae,C as se,D as oe,O as le,T as ne,E as re,J as _,K as E,L as N,n as O}from"./index-efcf4ef9.js";import{_ as $}from"./FormField-2d06baa7.js";import{C as ie}from"./Criteria-8171750e.js";import{I as ce}from"./ImageUpload-8174de17.js";import{C}from"./cow-b5abd581.js";import{T as L}from"./alert-06176626.js";import{D as de}from"./Cow-e7483fe3.js";import{g as ue}from"./age-calculate-9ec51286.js";import"./CardBoxCollapse-9b156af1.js";import"./FormCheckRadioPicker-84fa76bc.js";import"./Vaccine-502ccf7e.js";const me={data(){return{cow:{image:"/image/img-mockup.png",code:"",name:"",status:1,birthDate:null,corral:"",dad:"",mom:"",quality:1},status:P("create"),quality:R("create"),loading:!1,alert:""}},emits:["update:modelValue","cancel","confirm"],computed:{value:{get(){return this.modelValue},set(a){this.$emit("update:modelValue",a)}},user(){return this.$store.state.auth.user}},watch:{dataEdit:{handler(a,e){a!=null&&this.mode=="edit"&&(this.cow=a,this.cow.image=this.cow.image?this.cow.image:"/image/img-mockup.png")},deep:!0}},methods:{clear(){this.$emit("update:dataEdit",null),this.cow.image="/image/img-mockup.png",this.cow.code="",this.cow.name="",this.cow.birthDate=null,this.cow.status=1,this.cow.corral="",this.cow.dad="",this.cow.mom="",delete this.cow._id},confirmCancel(a){this.value=!1,this.$emit(a)},confirm(){this.clear(),this.confirmCancel("confirm")},cancel(){this.clear(),this.confirmCancel("cancel")},async submit(){this.loading=!0,this.alert="";try{this.mode==="create"?await C.create(this.cow)&&(this.loading=!1,this.value=!1,this.confirm(),L.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"})):await C.update(this.cow._id,this.cow)&&(this.loading=!1,this.value=!1,this.confirm(),L.fire({icon:"success",title:"บันทึกข้อมูลสำเร็จ"}))}catch(a){console.error("Error : ",a),this.loading=!1,this.alert=a.response.data.message,L.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ"})}}},components:{BaseButton:G,BaseButtons:J,CardBox:K,BaseDivider:W,OverlayLayer:ee,FormField:$,FormControl:Y,NotificationBar:te,UserAvatar:Q,BaseLevel:X,ImageUpload:ce},props:{modelValue:{type:[String,Number,Boolean],default:null},mode:{type:String,default:""},dataEdit:{type:Object,default:null}}},ge={class:"grid lg:grid-cols-4 grid-cols-2 gap-5 mt-3"};function fe(a,e,u,y,s,r){const x=n("ImageUpload"),V=n("BaseLevel"),m=n("FormControl"),g=n("FormField"),h=n("NotificationBar"),f=n("BaseDivider"),B=n("BaseButton"),k=n("BaseButtons"),S=n("CardBox"),D=n("OverlayLayer");return I((d(),w(D,null,{default:l(()=>[I(t(S,{title:u.mode==="create"?"เพิ่มโค":"แก้ไขโค",class:"shadow-lg w-full md:w-3/5 lg:w-1/1 z-50","header-icon":"close",modal:"",form:"",onSubmit:ae(r.submit,["prevent"]),onHeaderIconClick:r.cancel},{default:l(()=>[t(x,{modelValue:s.cow.image,"onUpdate:modelValue":e[0]||(e[0]=i=>s.cow.image=i)},null,8,["modelValue"]),t(V,{type:"justify-center mb-6 text-sm"},{default:l(()=>[U(" อัพโหลดรูปภาพ (คลิกที่รูป) ")]),_:1}),c("div",ge,[t(g,{label:"รหัสโค",help:"* ห้ามว่าง"},{default:l(()=>[t(m,{modelValue:s.cow.code,"onUpdate:modelValue":e[1]||(e[1]=i=>s.cow.code=i),icon:"barcode",required:""},null,8,["modelValue"])]),_:1}),t(g,{label:"ชื่อโค",help:"* ห้ามว่าง"},{default:l(()=>[t(m,{modelValue:s.cow.name,"onUpdate:modelValue":e[2]||(e[2]=i=>s.cow.name=i),icon:"cow",required:""},null,8,["modelValue"])]),_:1}),t(g,{label:"วันเกิด",help:"* ห้ามว่าง"},{default:l(()=>[t(m,{modelValue:s.cow.birthDate,"onUpdate:modelValue":e[3]||(e[3]=i=>s.cow.birthDate=i),icon:"calendar",type:"date",required:""},null,8,["modelValue"])]),_:1}),t(g,{label:"สถานะ",help:"* ห้ามว่าง"},{default:l(()=>[t(m,{modelValue:s.cow.status,"onUpdate:modelValue":e[4]||(e[4]=i=>s.cow.status=i),options:s.status,icon:"",required:""},null,8,["modelValue","options"])]),_:1}),t(g,{label:"คุณภาพน้ำนม",help:"* ห้ามว่าง"},{default:l(()=>[t(m,{modelValue:s.cow.quality,"onUpdate:modelValue":e[5]||(e[5]=i=>s.cow.quality=i),options:s.quality,icon:""},null,8,["modelValue","options"])]),_:1}),t(g,{label:"คอก"},{default:l(()=>[t(m,{modelValue:s.cow.corral,"onUpdate:modelValue":e[6]||(e[6]=i=>s.cow.corral=i),icon:"barn"},null,8,["modelValue"])]),_:1}),t(g,{label:"พ่อพันธุ์"},{default:l(()=>[t(m,{modelValue:s.cow.dad,"onUpdate:modelValue":e[7]||(e[7]=i=>s.cow.dad=i),icon:"genderMale"},null,8,["modelValue"])]),_:1}),t(g,{label:"แม่พันธุ์"},{default:l(()=>[t(m,{modelValue:s.cow.mom,"onUpdate:modelValue":e[8]||(e[8]=i=>s.cow.mom=i),icon:"genderFemale"},null,8,["modelValue"])]),_:1})]),s.alert?(d(),w(h,{key:0,color:"danger",outline:"",icon:"alertCircleOutline"},{default:l(()=>[U(p(s.alert),1)]),_:1})):Z("",!0),t(f),t(k,{type:"justify-center"},{default:l(()=>[t(B,{label:"บันทึก",color:"success",type:"submit",loading:s.loading},null,8,["loading"]),t(B,{label:"ยกเลิก",color:"danger",onClick:r.cancel},null,8,["onClick"])]),_:1})]),_:1},8,["title","onSubmit","onHeaderIconClick"]),[[T,r.value]])]),_:1},512)),[[T,r.value]])}const pe=H(me,[["render",fe]]),he={data(){return{perPage:20,currentPage:0,modalCow:!1,cowStatus:P(),items:[],forms:[{label:"โค",value:"code",type:"ddl",module:"cow",valueType:"code"},{label:"สถานะ",value:"status",options:P()},{label:"คุณภาพน้ำนม",value:"quality",options:R()},{label:"คอก",value:"corral",icon:"barn"}],search:{code:null,status:"",quality:"",corral:"",flag:"Y"},mode:"create",loading:!1}},computed:{itemsPaginated(){return this.items?this.items.slice(this.perPage*this.currentPage,this.perPage*(this.currentPage+1)):[]},numPages(){return Math.ceil((this.items?this.items.length:0)/this.perPage)},currentPageHuman(){return this.currentPage+1},pagesList(){const a=[];for(let e=0;e<this.numPages;e++)a.push(e);return a},user(){return this.$store.state.auth.user}},components:{SectionMain:se,LayoutAuthenticated:oe,BaseButton:G,BaseIcon:le,BaseButtons:J,CardBox:K,FormControl:Y,FormField:$,BaseDivider:W,DDLCow:de,CreateCowModal:pe,Table:ne,SectionTitleBarSub:re,Criteria:ie,UserAvatar:Q,BaseLevel:X},created(){this.getCows()},methods:{async getCows(){var e,u;this.loading=!0;const a=await C.all(this.search);if(this.items=[],a.data){this.items=a.data.cows,this.loading=!1;for(let y of this.items){const s=await C.getDetails(y._id);s.data&&(y.grade=(u=(e=s.data)==null?void 0:e.quality)==null?void 0:u.grade,y.sum=s.data.sum)}}},async removeCow(a){this.loading=!0,(await C.update(a,{flag:"N"})).data&&this.getCows(),this.loading=!1},detail(a){this.$router.push({name:"cowDetail",params:{id:a._id}})},reset(){this.search.code=null,this.search.status="",this.search.quality="",this.search.corral=""},filter(a){const e={},u={};return a.status==1?(e.icon="humanPregnant",e.style="warning"):a.status==2?(e.icon="waterOff",e.style="danger"):a.status==3?(e.icon="water",e.style="success"):a.status==4&&(e.icon="babyFaceOutline",e.style="light"),e.desc=this.cowStatus[a.status].label,a.grade==="A+"?u.style="text-lime-500":a.grade==="A"?u.style="text-green-500":a.grade==="B"?u.style="":a.grade==="C"?u.style="text-orange-500":a.grade==="D"&&(u.style="text-red-500"),{status:e,grade:u}},calAge(a){return ue(a)}}},_e={key:0,class:"grid lg:gap-3 md:gap-2 gap-1 grid-cols-3 lg:grid-cols-5 md:grid-cols-4"},we={class:"text-center mt-2"},ye={class:"lg:text-xl text-md flex justify-center"},be={key:0},Ce={key:1},Be={class:"grid lg:grid-cols-5 grid-cols-2 gap-1 mt-2 lg:p-2"},ve={class:"text-gray-900 col-span-2 font-bold text-sm text-center dark:bg-zinc-500 lg:rounded h-6 min-w-4 shadow-lg"},xe={class:"mr-2"},Ve={class:"font-bold dark:bg-zinc-900 lg:rounded h-6 text-sm min-full lg:col-span-3 col-span-2 shadow-lg"},ke={class:"mr-2"},Se={class:"text-left dark:bg-zinc-700 text-gray-300 lg:rounded h-6 min-w-4 text-xs lg:col-span-3 col-span-2 shadow-lg"},De={class:"mr-2"},Le={class:"text-left dark:bg-gray-700 text-black font-bold lg:rounded h-6 min-w-4 text-xs col-span-2 shadow-lg"},Pe={key:0,class:"mr-2"},Ue={key:1,class:"text-center py-10 text-gray-500 dark:text-gray-400"},Fe=c("p",null," กำลังโหลดข้อมูล...",-1),qe={class:"p-2 mt-2 border-t border-gray-100 dark:border-gray-800"};function ze(a,e,u,y,s,r){const x=n("SectionTitleBarSub"),V=n("CreateCowModal"),m=n("Criteria"),g=n("UserAvatar"),h=n("BaseLevel"),f=n("BaseIcon"),B=n("CardBox"),k=n("BaseButton"),S=n("BaseButtons"),D=n("SectionMain"),i=n("LayoutAuthenticated");return d(),w(i,null,{default:l(()=>[t(D,null,{default:l(()=>[t(x,{icon:"cow",title:"โค",btnText:"เพิ่มโค","has-btn-add":"",onOpenModal:e[0]||(e[0]=o=>{s.mode="create",s.modalCow=!0})}),t(V,{modelValue:s.modalCow,"onUpdate:modelValue":e[1]||(e[1]=o=>s.modalCow=o),onConfirm:r.getCows,mode:s.mode,dataEdit:a.dataEdit},null,8,["modelValue","onConfirm","mode","dataEdit"]),t(m,{grid:"grid-cols-2 md:grid-cols-3 lg:grid-cols-5",onSearch:r.getCows,onReset:r.reset,forms:s.forms,search:s.search},null,8,["onSearch","onReset","forms","search"]),s.loading?(d(),_("div",Ue,[t(f,{path:"dotsCircle",size:"22",class:"animate-spin"}),Fe])):(d(),_("div",_e,[(d(!0),_(E,null,N(r.itemsPaginated,o=>(d(),w(B,{key:o.name,onClick:v=>r.detail(o),"has-table":"",hoverable:""},{default:l(()=>{var v,F;return[t(h,{type:"justify-center"},{default:l(()=>[t(g,{username:"profile-card",class:"lg:w-24 lg:h-24 w-20 h-20 mt-2",avatar:o.image},null,8,["avatar"])]),_:2},1024),c("div",we,[c("h4",ye,[c("p",{class:O(((F=(v=r.filter(o))==null?void 0:v.grade)==null?void 0:F.style)+"  font-extrabold  lg:text-base text-sm text-center dark:bg-black rounded-full lg:h-6 h-5 w-6 shadow-xl mr-1")},[o.grade?(d(),_("div",be,p(o.grade),1)):(d(),_("div",Ce,[t(f,{path:"dotsCircle",size:"16",class:"animate-spin text-gray-500"})]))],2),U(p(o.name),1)]),c("div",Be,[c("p",ve,[t(h,{type:"justify-between"},{default:l(()=>[t(f,{path:"barn",size:"16"}),c("div",xe,p(o.corral),1)]),_:2},1024)]),c("p",Ve,[t(h,{type:"justify-between"},{default:l(()=>{var b,q,z,A,M,j;return[o.status?(d(),w(f,{key:0,class:O((q=(b=r.filter(o))==null?void 0:b.status)==null?void 0:q.style),path:(A=(z=r.filter(o))==null?void 0:z.status)==null?void 0:A.icon,size:"16"},null,8,["class","path"])):Z("",!0),c("div",ke,p((j=(M=r.filter(o))==null?void 0:M.status)==null?void 0:j.desc),1)]}),_:2},1024)]),c("p",Se,[t(h,{type:"justify-between"},{default:l(()=>[t(f,{path:"timelapse",size:"16"}),c("div",De,p(r.calAge(o.birthDate)),1)]),_:2},1024)]),c("p",Le,[t(h,{type:"justify-between"},{default:l(()=>{var b;return[t(f,{path:"cupWater",size:"16"}),o.sum?(d(),_("div",Pe,p(a.$filters.number((b=o.sum)==null?void 0:b.rawmilk)),1)):(d(),w(f,{key:1,path:"dotsCircle",size:"16",class:"animate-spin text-gray-500 mr-2"}))]}),_:2},1024)])])])]}),_:2},1032,["onClick"]))),128))])),c("div",qe,[t(h,null,{default:l(()=>[t(S,null,{default:l(()=>[(d(!0),_(E,null,N(r.pagesList,o=>(d(),w(k,{key:o,active:o===s.currentPage,label:o+1,small:"",onClick:v=>s.currentPage=o},null,8,["active","label","onClick"]))),128))]),_:1}),c("small",null,"หน้า "+p(r.currentPageHuman)+" จาก "+p(r.numPages),1)]),_:1})])]),_:1})]),_:1})}const Je=H(he,[["render",ze]]);export{Je as default};
